これで温度サービスを実装する準備ができました。 前のユニットでは、サーバーなしのソリューションが自分のニーズに最適であることがわかりました。 Azure 関数を保持するために、関数アプリを作成することから始めましょう。

[!include[](../../../includes/azure-sandbox-activate.md)]

## <a name="what-is-a-function-app"></a>関数アプリとは

関数は、**関数アプリ**と呼ばれる実行コンテキストでホストされます。 Azure では、関数とコンピューティング リソースを論理的にグループ化し、構造化するために、関数アプリを定義します。 エレベーターの例では、エスカレーター駆動歯車の温度サービスをホストする関数アプリを作成します。 関数アプリを作成するために、いくつかの決定を行う必要があります。サービス プランを選択し、互換性のあるストレージ アカウントを選択する必要があります。

### <a name="choosing-a-service-plan"></a>サービス プランを選択する

関数アプリでは、2 種類のサービス プランのいずれかを使用できます。 最初のサービス プランは、**従量課金サービス プラン**です。 これは、Azure のサーバーレス アプリケーション プラットフォームを使用するときに選択するプランです。 従量課金サービス プランでは、自動スケーリングが提供され、関数が実行されているときに課金されます。 従量課金プランには、関数の実行に対して構成可能なタイムアウト期間が付属します。 既定は 5 分ですが、最長 10 分までのタイムアウトを構成できます。

2 つ目のプランは、**Azure App Service プラン**と呼ばれています。 このプランでは、定義した VM 上で関数が連続的に実行されるようにして、タイムアウト期間を避けることができます。 App Service プランを使用している場合、お客様は関数を実行するアプリ リソースを管理する責任があるため、これは技術的にはサーバーレス プランではありません。 ただし、関数が連続的に使用される場合、あるいは従量課金プランよりも多くの処理能力または実行時間が必要な場合に、このプランを選択することをお勧めします。

### <a name="storage-account-requirements"></a>ストレージ アカウントの要件

関数アプリを作成する場合、関数アプリはストレージ アカウントにリンクされている必要があります。 既存のアカウントを選択するか、新しいアカウントを作成できます。 関数アプリでは、関数実行の記録や実行トリガーの管理など、内部操作のためにこのストレージ アカウントが使用されます。 従量課金サービス プランでは、これは関数コードと構成ファイルが格納される場所でもあります。

## <a name="create-a-function-app"></a>関数アプリの作成

Azure portal で関数アプリを作成しましょう。

1. サンドボックスをアクティブ化したときと同じアカウントを使用して、[Azure portal](https://portal.azure.com/triplecrownlabs.onmicrosoft.com?azure-portal=true) にサインインします。

1. Azure portal の左上隅にある **[リソースの作成]** ボタンを選択し、**[作業の開始] > [Serverless Function App]** の順に選択して、Function App の *[作成]* ブレードを開きます。 または、**[計算]、[Function App]** オプションの順に選択して、同じブレードを開くこともできます。

  ![[計算] セクションと Function App が強調表示されている [リソースの作成] ブレードを示す Azure portal のスクリーンショット。](../media/3-create-function-app-blade.png)

1. グローバルに一意のアプリ名を選択します。 これはご自分のサービスのベース URL として機能します。 たとえば、**escalator-functions-xxxxxxx** という名前を付けることができます。xxxxxxx は自分のイニシャルや誕生年に置き換えることができます。 グローバルに一意でない場合、別の組み合わせをお試しください。 有効な文字は a-z、0-9、- (ハイフン) です。

1. 関数アプリをホストする Azure サブスクリプションを選択します。

1. **<rgn>[サンドボックス リソース グループ名]</rgn>** という名前の既存のリソース グループを選択します。

1. OS として **[Windows]** を選択します。

1. **[ホスティング プラン]** では、サーバーレス ホスティング オプションである **[従量課金プラン]** を選択します。

1. 自分が住んでいる場所に最も近い地域を選択します。 運用システムでは、関数の顧客やコンシューマーに近い場所を選択します。

    [!include[](../../../includes/azure-sandbox-regions-first-mention-note-friendly.md)]

1. 新しいストレージ アカウントを作成します。 Azure では、アプリ名に基づいて名前が指定されます。 必要に応じて変更できますが、この名前も固有である必要があります。

1. Azure Application Insights が **[オン]** になっていることを確認し、自分 (または顧客) から最も近いリージョンを選択します。
  完了したら、構成は次のスクリーンショットにある構成のようになります。

  ![前の手順に従ってすべてのフィールドが構成された Function App の [作成] ブレードを示す Azure portal のスクリーンショット。](../media/3-create-function-app-settings.png)

1. **[作成]** を選択します。デプロイには数分かかります。 完了すると、通知を受け取ります。

## <a name="verify-your-azure-function-app"></a>Azure 関数アプリの確認

1. Azure portal の左側にあるメニューから、**[リソース グループ]** を選択します。 使用可能なグループの一覧に **<rgn>[サンドボックス リソース グループ名]</rgn>** という名前のリソース グループが表示されます。

  ![[リソース グループ] メニュー項目と <rgn>[サンドボックス リソース グループ名]</rgn> リスト アイテムが強調表示されている [リソース グループ] ブレードを示す Azure portal のスクリーンショット。](../media/3-resource-group.png)

1. **<rgn>[サンドボックス リソース グループ名]</rgn>** というリソース グループを選択します。 次の一覧のようにリソース リストが表示されます。

  ![App Service プラン、ストレージ アカウント、Application Insights リソースおよび App Service へのエントリを含む、<rgn>[サンドボックス リソース グループ名]</rgn> グループ内のすべてのリソースを示す Azure portal のスクリーンショット。](../media/3-resource-list.png)

App Service として一覧されている稲妻関数アイコンの付いた項目は、新しい関数アプリです。 クリックして新しい関数の詳細を表示することができます。ここには、この関数アプリに割り当てられたパブリック URL があり、ブラウザーで開いた場合は、その Function App が実行されていることを示す既定の Web ページを取得します。
