関数アプリを作成したので、関数をビルド、構成、実行する方法について確認しましょう。

### <a name="triggers"></a>トリガー

関数はイベント駆動型です。つまり、イベントに応答して実行されるということです。

関数を開始するイベントの種類は、*トリガー*と呼ばれます。 関数は必ず 1 つのトリガーで構成する必要があります。

Azure では、次のサービスに対してトリガーをサポートしています。

| サービス                 | トリガーの説明  |
|-------------------------|---------|
| BLOB ストレージ            | 新しい BLOB または更新された BLOB が検出されたときに関数を開始します。       |
| Cosmos DB               | 挿入および更新が検出されたときに関数を開始します。      |
| Event Grid              | Event Grid からイベントを受信したときに関数を開始します。       |
| HTTP                    | HTTP 要求で関数を開始します。      |
| Microsoft Graph イベント  | Microsoft Graph から受信した Webhook に応答して関数を開始します。 このトリガーの各インスタンスは、それぞれ Microsoft Graph の 1 つのリソースの種類に応答できます。       |
| Queue Storage           | キューで新しい項目を受け取ったときに関数を開始します。 キュー メッセージは、関数への入力として提供されます。      |
| Service Bus             | Service Bus キューからのメッセージに応答して関数を開始します。       |
| Timer                   | スケジュールに従って関数を開始します。       |
| Webhook                | Webhook 要求で関数を開始します。       |

### <a name="bindings"></a>バインド

バインドは、データとサービスを作成した関数に接続するための宣言型の方法です。 バインドは、さまざまなサービスに応答する方法を理解しています。つまり、データ ソースに接続して、接続を管理するために、自分で関数にコードを記述する必要はないということです。 ユーザーの代わりに、プラットフォームによってその複雑さがバインド コードの一部として処理されます。 バインドごとに方向が 1 つあります。お客様のコードでは、*入力*バインディングからデータを読み取り、*出力*バインディングにデータを書き込みます。 各関数には、関数によって処理された入出力データを管理するために、0 個またはそれ以上のバインドを持つことができます。

> [!NOTE]
> 技術的には、トリガーは、実行を開始する追加機能を持つ特殊な入力バインディングです。

Azure では、さまざまなストレージとメッセージング サービスに接続するために、[多数のバインド](https://docs.microsoft.com/azure/azure-functions/functions-triggers-bindings#supported-bindings)が提供されます。

### <a name="a-sample-binding-definition"></a>バインド定義のサンプル

入力バインディング (トリガー) と出力バインディングで関数を構成する例を見てみましょう。 BLOB ストレージからデータを読み取り、関数で処理して、キューにメッセージを書き込む必要があるとします。 *BLOB* の種類の_入力バインディング_と*キュー*の種類の_出力バインディング_を構成します。

バインドは Azure portal で定義することができ、直接編集することもできる JSON ファイルとして保存されます。 次の JSON は、関数に対するトリガーとバインドの定義のサンプルです。

```json
{
  "bindings": [
    {
      "name": "order",
      "type": "queueTrigger",
      "direction": "in",
      "queueName": "myqueue-items",
      "connection": "MY_STORAGE_ACCT_APP_SETTING"
    },
    {
      "name": "$return",
      "type": "table",
      "direction": "out",
      "tableName": "outTable",
      "connection": "MY_TABLE_STORAGE_ACCT_APP_SETTING"
    }
  ]
}
```

この例は、メッセージが **myqueue-items** という名前のキューに追加されることによってトリガーされる関数を示しています。 次に、関数の戻り値を Azure テーブル ストレージ内の **outTable** テーブルに送信します。 これは非常にシンプルな例で、出力を SendGrid バインディングを使用する電子メールに変更したり、アーキテクチャ内のその他のコンポーネントに通知するために Service Bus にイベントを配置したりすることができます。また、さまざまなサービスにデータをプッシュするように、複数の出力バインディングを含めることもできます。

## <a name="creating-a-function-in-the-azure-portal"></a>Azure portal で関数をテストする

Azure では、一般的なシナリオに使用できる、いくつかの事前に作成された関数テンプレートを提供します。

### <a name="quickstart-templates"></a>クイック スタート テンプレート

初めて関数を追加する場合、クイック スタート画面が表示されます。 この画面では、トリガーの種類 (HTTP、タイマーまたはデータ) およびプログラミング言語 (C#、JavaScript、F# または Java) を選ぶことができます。 次に、選択内容に基づいて、Azure では、ログで受け取った入力データを表示するために提供されたサンプル コードを使って、ユーザーのために関数コードと構成が生成されます。 
 
### <a name="custom-function-templates"></a>カスタムの関数テンプレート

クイック スタート テンプレートを選択すると、最も一般的なシナリオへの簡単なアクセスが提供されます。 しかし、Azure では使用を開始できるテンプレートが 30 個以上提供されています。 これらのテンプレートは、後続の関数の作成時にテンプレート リストの画面から選択できます。または、クイック スタート画面で **[カスタム関数]** オプションを使用することで選択できます。

- HTTP トリガーと C#、F#、または JavaScript
- タイマー トリガーと C#、F#、または JavaScript
- キュー トリガーと C#、F#、または JavaScript
- Service Bus キュー トリガーと C#、F#、または JavaScript
- Cosmos DB トリガーと C#、F#、または JavaScript
- IoT Hub (イベント ハブ) と C#、F#、または JavaScript
- ... その他

## <a name="navigating-to-your-function-and-files"></a>関数とファイルに移動する

テンプレートから関数を作成すると、複数のファイルが作成されます。 たとえば、JavaScript を使用して Webhook + API クイック スタートを使用することを選択した場合は、構成ファイル (**function.json**) とソース コード ファイル (**index.js**) が生成されます。 関数アプリで作成した関数は、関数アプリ ポータル内の **[関数]** メニュー項目の下に表示されます。

関数アプリで関数を選択すると、次のスクリーンショットで示されているように、コード エディターが開き、ご自分の関数用のコードが表示されます。

![関数テンプレートの選択インターフェイスには、関数の開発を高速化するために使用できるテンプレートのセットが一覧されます。](../media-draft/4-file-navigation.png)

前のスクリーンショットで確認できるように、右側にポップアップ メニューがあり、**[ファイルの表示]** へのタブが含まれています。 このタブを選択すると、ご自分の関数を構成するファイル構造が表示されます。  

## <a name="testing-your-azure-function"></a>Azure 関数をテストする

関数を作成したら、テストする必要があります。 手動で実行する方法と、Azure portal 内からテストする方法の 2 種類があります。

### <a name="manual-execution"></a>手動での実行

構成されたトリガーを手動でトリガーすることによって、関数を開始できます。 たとえば、HTTP トリガーを使用している場合、Postman や cURL などのツールを使用して、ご自分の関数エンドポイント URL への HTTP 要求を開始することができます。これは HTTP のトリガー定義から利用できます (**[Get function URL]\(関数の URL の取得\)**)。  

### <a name="testing-in-the-azure-portal"></a>Azure portal でテストする

ポータルにも、関数をテストするための便利な手段が用意されています。 コード ウィンドウの右側に、タブ付きのポップアップ ナビゲーション メニューがあります。 このメニューには、**[テスト]** 項目が含まれています。 メニューを展開してこのタブを選択すると、別の方法で関数を実行し、結果を表示することができます。 このテスト ウィンドウで **[実行]** をクリックすると、その結果が出力ウィンドウに状態コードと共に表示されます。 

## <a name="monitoring-dashboard"></a>監視ダッシュボード

関数を監視する機能は、開発時および運用環境で重要です。 Azure portal では、Application Insights の統合を有効にした場合に利用できる監視ダッシュボードを提供します。 関数アプリのナビゲーション メニューでは、関数ノードを展開すると、**[監視]** メニュー項目が表示されます。 この監視ダッシュボードでは、関数の実行履歴を表示する簡単な方法が提供され、Application Insights によって設定されたタイムスタンプ、結果コード、期間、操作 ID が表示されます。

![関数の呼び出しの成功と失敗の一覧を示している、**[監視]** 関数のメニュー項目から起動した監視ダッシュボードのスクリーンショット。](../media-draft/4-monitor-function.png)

## <a name="streaming-log-window"></a>ストリーミング ログ ウィンドウ

Azure portal でデバッグのために、ご自分の関数にログ ステートメントを追加することもできます。 言語ごとに呼び出されたメソッドによって、情報をログ記録するために使用される可能性がある "ログ記録" オブジェクトが、コード ウィンドウの下部にあるタブ付きのポップアップ メニューに配置されたログ ウィンドウに渡されます。 

次の JavaScript コード スニペットは、`context.log` メソッドを使用してメッセージを記録する方法について示します (`context` オブジェクトはハンドラーに渡されます)。

```javascript
  context.log('Enter your logging statement here');
```  

C# では `log.Info` メソッドを使用して同じことを行えます。 この場合、`log` オブジェクトは、その関数を処理する C# メソッドに渡されます。

```csharp
  log.Info("Enter your logging statement here");
```

### <a name="errors-and-warnings-window"></a>エラーと警告ウィンドウ

エラーと警告ウィンドウ タブは、ログ ウィンドウと同じポップアップ メニューで検索できます。 このウィンドウには、コード内のコンパイル エラーと警告が表示されます。
