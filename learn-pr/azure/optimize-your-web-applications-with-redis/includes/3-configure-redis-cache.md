スポーツ統計情報の開発チームにより、キャッシュが最近要求されたデータのパフォーマンスを大幅に向上させる可能性があると判断されました。 次の手順として、Azure Redis Cache インスタンスを作成および構成します。

### <a name="create-and-configure-the-azure-redis-cache-instance"></a>Azure Redis Cache インスタンスの作成および構成

1. Azure Redis Cache インスタンスは、Azure portal のデータベース リソースから追加することできます。

1. グローバルに一意な名前を付けます。 この名前は、1 から 63 文字の文字列で、数字、英字、'-' 文字のみを使用する必要があります。 キャッシュ名の先頭と末尾には '-' 文字を使用できません。また、連続する '-' 文字は無効です。

1. この新しい Azure Redis Cache インスタンスが作成されるサブスクリプションを提供します。

1. キャッシュを作成するリソース グループに名前を付けます。 アプリのすべてのリソースを 1 つのグループ内に配置すると、それらを一緒に管理できるようになります。

1. データのコンシューマーに近い場所を選択します。

    > [!NOTE]
    > キャッシュは、データ ストアよりもデータ コンシューマーに近い方がはるかに重要です。

1. 価格レベルを選択します。 データの永続化を活用するには、Premium レベルを選択する必要があることを念頭に置いておいてください。

    - Premium レベルでは、ディザスター リカバリーの提供のために、次の 2 つのうちの 1 つの方法でデータを永続化できます。

        - RDB 永続化では、定期的にスナップショットが撮られます。エラーが発生した場合には、このスナップショットを使用してキャッシュを再構築できます。

            ![新しい Redis Cache インスタンスの RDB 永続化オプションを示す Azure portal のスクリーンショット。](../media/3-redis-persistence-1.png)

        - AOF 永続化では、すべての書き込み操作がログに最低 1 秒に 1 度保存されます。 これでは、ファイル サイズが RDB よりも大きくなりますが、データの損失は少ないです。

            ![新しい Redis Cache インスタンスの AOF 永続化オプションを示す Azure portal のスクリーンショット。](../media/3-redis-persistence-2.png)

    - 仮想ネットワークを使用して、キャッシュをセキュリティ保護します。
      Premium レベルの Redis Cache がある場合、クラウドの仮想ネットワークにそれをデプロイします。 キャッシュは同じ仮想ネットワーク内の他の仮想マシンやアプリケーションのみが使用できます。

    - クラスタリングでキャッシュを分散します。
      Premium レベルの Redis Cache では、クラスタリングを実装して、複数のノードに自動的にデータセットが分割されるようにできます。 クラスタリングを実装するには、最大を 10 とし、シャードの数値を指定します。 これのコストは、元のノードにシャード数を掛けたものです。

    - Azure Managed Cache Service から移行します。
      Azure Managed Cache Service を使用するアプリケーションの Azure Redis Cache への移行は、使用されている Managed Cache Service の機能によっては、最小限の変更をアプリケーションに対して行うだけで実現できます。 API は正確には同じではありませんが、類似しています。 Managed Cache Service を使用してキャッシュにアクセスする既存のコードの多くは、最小限の変更で再利用できます。

### <a name="configure-your-client"></a>クライアントの構成

クライアント アプリケーションを構成して、Redis Cache を使用できるようにする必要があります。 .NET 言語用に人気のある高性能な Redis クライアントは **StackExchange.Redis** です。 Visual Studio で、**NuGet Package Manager** で、**Install-Package** コマンドを使用して Redis クライアントを追加します。

次いで、キャッシュに接続するようにクライアントを構成します。 ホスト名とプライマリまたはセカンダリ キーの設定を含む、ファイル拡張子が **.config** のテキスト ファイルを作成します。 ファイルの構造は次のとおりです。

```XML
    <appSettings>
        <add key="CacheConnection" value="HOST-NAME.redis.cache.windows.net,abortConnect=false,ssl=true,password=PRIMARY-KEY"/>
    </appSettings>
```

次いで、**App.config** ファイルを編集して更新し、作成した config ファイルを参照する **appSettings** ファイル属性が含まれるようにします。

### <a name="what-are-access-keys"></a>アクセス キーとは

Azure Redis Cache のインスタンスに接続するときには、キャッシュ クライアントにキャッシュのホスト名、ポート、およびキーが必要です。 この情報は、Azure portal で取得できます。

### <a name="connection-settings"></a>接続の設定

Azure Redis Cache に接続するには、ホスト名とアクセス キーが必要です。 ホスト名とは、*sportsresults.redis.cache.windows.net* など、ご自分のキャッシュのインターネット アドレスです。 アクセス キーは、ご自分のキャッシュのパスワードとして動作します。 アクセス キーには、プライマリとセカンダリがあります。 いずれのキーも使用できますが、2 つ用意されているのは、プライマリ キーを変更する必要があるときのためです。 プライマリ キーを変更するときは、サービスが失われることがないよう、すべてのクライアントをセカンダリ キーに切り替えてから行います。
