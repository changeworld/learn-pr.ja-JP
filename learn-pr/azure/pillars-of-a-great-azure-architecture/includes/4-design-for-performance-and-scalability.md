<span data-ttu-id="32b60-101">自分の会社が開発した画期的ながん治療法が、第一面のニュースになっているところを想像してみてください。</span><span class="sxs-lookup"><span data-stu-id="32b60-101">Imagine a news story has just been published covering your organization's breakthrough cancer treatment.</span></span> <span data-ttu-id="32b60-102">これはすばらしいマイルストーンであり、会社の Web サイトには間違いなくアクセスが殺到するでしょう。</span><span class="sxs-lookup"><span data-stu-id="32b60-102">This is a terrific milestone, and will undoubtedly bring a large influx of traffic to your website.</span></span> <span data-ttu-id="32b60-103">その Web サイトは、このアクセスの増加に対応できるでしょうか。サイトの反応が低下したり応答しなくなったりするおそれはないでしょうか。</span><span class="sxs-lookup"><span data-stu-id="32b60-103">Will the website handle this traffic increase, or will the load cause the site to be slow or unresponsive?</span></span>

<span data-ttu-id="32b60-104">ここでは、スケーリングと最適化の原則を使用して優れたアプリケーション パフォーマンスを確保する基本原理を見ていきます。</span><span class="sxs-lookup"><span data-stu-id="32b60-104">Here, we'll look at some of the basic principles of ensuring outstanding application performance using scaling and optimization principles.</span></span>

## <a name="what-is-scaling-and-performance-optimization"></a><span data-ttu-id="32b60-105">スケーリングとパフォーマンスの最適化とは何ですか。</span><span class="sxs-lookup"><span data-stu-id="32b60-105">What is scaling and performance optimization?</span></span>

<span data-ttu-id="32b60-106">スケーリングとパフォーマンスの最適化とは、利用可能なリソースを受信要求を持つアプリケーションに適合させることです。</span><span class="sxs-lookup"><span data-stu-id="32b60-106">Scaling and performance optimization are about matching the resources available to an application with the demand it is receiving.</span></span> <span data-ttu-id="32b60-107">パフォーマンスの最適化には、リソースをスケーリングすること、潜在的なボトルネックを識別して最適化すること、最高のパフォーマンスが得られるようアプリケーション コードを最適化することが含まれています。</span><span class="sxs-lookup"><span data-stu-id="32b60-107">Performance optimization includes scaling resources, identifying and optimizing potential bottlenecks, and optimizing your application code for peak performance.</span></span>

### <a name="scaling"></a><span data-ttu-id="32b60-108">スケーリング</span><span class="sxs-lookup"><span data-stu-id="32b60-108">Scaling</span></span>

<span data-ttu-id="32b60-109">コンピューティング リソースは、2 つの方向にスケーリングできます。</span><span class="sxs-lookup"><span data-stu-id="32b60-109">Compute resources can be scaled in two different directions:</span></span>

* <span data-ttu-id="32b60-110">スケーリング "*アップ*" は他のリソースを 1 つのインスタンスに追加する操作です。</span><span class="sxs-lookup"><span data-stu-id="32b60-110">Scaling *up* is the action of adding more resources to a single instance.</span></span>
* <span data-ttu-id="32b60-111">スケーリング "*アウト*" とはインスタンスの追加です。</span><span class="sxs-lookup"><span data-stu-id="32b60-111">Scaling *out* is the addition of instances.</span></span>

![パフォーマンス機能を向上するための、仮想マシンのスケーリング アップおよびスケーリング アウトを示す図。](../media/scale-up-scale-out.png)

<span data-ttu-id="32b60-113">スケールアップでは CPU やメモリなどの他のリソースを 1 つのインスタンスに追加します。</span><span class="sxs-lookup"><span data-stu-id="32b60-113">Scaling up is concerned with adding more resources, such as CPU or memory, to a single instance.</span></span> <span data-ttu-id="32b60-114">このインスタンスは、仮想マシンまたは PaaS サービスである場合があります。</span><span class="sxs-lookup"><span data-stu-id="32b60-114">This instance could be a virtual machine or a PaaS service.</span></span> <span data-ttu-id="32b60-115">インスタンスへより多くの容量を追加する機能により、アプリケーションで使用できるリソースが向上しますが、上限があります。</span><span class="sxs-lookup"><span data-stu-id="32b60-115">The act of adding more capacity to the instance increases the resources available to your application, but it does come with a limit.</span></span> <span data-ttu-id="32b60-116">仮想マシンは実行中のホストの容量までに限られ、ホスト自体に物理的な制限があります。</span><span class="sxs-lookup"><span data-stu-id="32b60-116">Virtual machines are limited to the capacity of the host they run on, and hosts themselves have physical limitations.</span></span> <span data-ttu-id="32b60-117">最終的には、インスタンスのスケール アップを行う時に、これらの上限に達して、インスタンスにさらにリソースを追加する機能は制約を受けます。</span><span class="sxs-lookup"><span data-stu-id="32b60-117">Eventually, when you scale up an instance, you can run into these limits, restricting your ability to add further resources to the instance.</span></span>

<span data-ttu-id="32b60-118">スケール アウトは、サービスに追加のインスタンスを付加することが関係しています。</span><span class="sxs-lookup"><span data-stu-id="32b60-118">Scaling out is concerned with adding additional instances to a service.</span></span> <span data-ttu-id="32b60-119">これらの追加のインスタンスは仮想マシンや PaaS サービスでもかまいませんが、1 つのインスタンスを強化することで容量を追加するのではなく、インスタンスの合計数を増やすことで容量を増加させます。</span><span class="sxs-lookup"><span data-stu-id="32b60-119">These can be virtual machines or PaaS services, but instead of adding more capacity by making a single instance more powerful, we add capacity by increasing the overall total number of instances.</span></span> <span data-ttu-id="32b60-120">スケール アウトのメリットは、アーキテクチャに複数のマシンを追加すれば、想定上は永久にスケール アウトが可能である点です。</span><span class="sxs-lookup"><span data-stu-id="32b60-120">The advantage of scaling out is that you can conceivably scale out forever if you have more machines to add to the architecture.</span></span> <span data-ttu-id="32b60-121">スケール アウトには、何らかの種類の負荷分散が必要です。</span><span class="sxs-lookup"><span data-stu-id="32b60-121">Scaling out requires some type of load distribution.</span></span> <span data-ttu-id="32b60-122">利用可能な複数のサーバー間に要求を分散させるロード バランサーや、要求の送信先となるアクティブなサーバーを識別するためのサービス検出メカニズムが考えられます。</span><span class="sxs-lookup"><span data-stu-id="32b60-122">This could be in the form of a load balancer distributing requests across available servers, or a service discovery mechanism for identifying active servers to send requests to.</span></span>

<span data-ttu-id="32b60-123">どちらの場合も、リソースを削減し、コストの最適化を実現できます。</span><span class="sxs-lookup"><span data-stu-id="32b60-123">In both cases, resources can be reduced, bringing cost optimization into the picture.</span></span>

### <a name="performance-optimization"></a><span data-ttu-id="32b60-124">パフォーマンスの最適化</span><span class="sxs-lookup"><span data-stu-id="32b60-124">Performance optimization</span></span>

<span data-ttu-id="32b60-125">パフォーマンスを最適化するときは、ネットワークとストレージで許容できるパフォーマンスレベルを確保してください。</span><span class="sxs-lookup"><span data-stu-id="32b60-125">When optimizing for performance, you'll look at network and storage to ensure performance is acceptable.</span></span> <span data-ttu-id="32b60-126">どちらもアプリケーションの応答時間に影響を与える可能性があります。</span><span class="sxs-lookup"><span data-stu-id="32b60-126">Both can impact the response time of your application.</span></span> <span data-ttu-id="32b60-127">実際のアーキテクチャに合った適切なネットワーク テクノロジとストレージ テクノロジを選択することが、最上級のエクスペリエンスをコンシューマーに提供することにつながります。</span><span class="sxs-lookup"><span data-stu-id="32b60-127">Selecting the right networking and storage technologies for your architecture will help you ensure you're providing the best experience for your consumers.</span></span>

<span data-ttu-id="32b60-128">パフォーマンスの最適化には、アプリケーション自体がどのように実行されているかを理解することも含まれます。</span><span class="sxs-lookup"><span data-stu-id="32b60-128">Performance optimization will also include understanding how the applications themselves are performing.</span></span> <span data-ttu-id="32b60-129">依存システム内でのエラー、不具合のあるコード、ボトルネックはすべて、アプリケーション パフォーマンス管理ツールで明らかになります。</span><span class="sxs-lookup"><span data-stu-id="32b60-129">Errors, poorly performing code, and bottlenecks in dependent systems can all be uncovered through an application performance management tool.</span></span> <span data-ttu-id="32b60-130">多くの場合、これらの問題はエンドユーザーや開発者、管理者には見えなかったり、わかりにくかったりします。そして、ご利用のアプリケーションの全体的なパフォーマンスに悪影響を及ぼす可能性があります。</span><span class="sxs-lookup"><span data-stu-id="32b60-130">Often, these issues may be hidden or obfuscated for end users, developers, and administrators, but can have adverse impact on the overall performance of your application.</span></span>

## <a name="scalability-and-performance-patterns-and-practices"></a><span data-ttu-id="32b60-131">スケーラビリティとパフォーマンスのパターンとプラクティス</span><span class="sxs-lookup"><span data-stu-id="32b60-131">Scalability and performance patterns and practices</span></span>

<span data-ttu-id="32b60-132">ご利用のアプリケーションのスケーラビリティとパフォーマンスを強化するために利用できるいくつかのパターンとプラクティスを見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="32b60-132">Let's take a look at some patterns and practices that can be leveraged to enhance the scalability and performance of your application.</span></span>

### <a name="data-partitioning"></a><span data-ttu-id="32b60-133">データのパーティション分割</span><span class="sxs-lookup"><span data-stu-id="32b60-133">Data partitioning</span></span>

<span data-ttu-id="32b60-134">多くの大規模なソリューションでは、個別に管理およびアクセスすることができる複数の独立したパーティションにデータが分割されています。</span><span class="sxs-lookup"><span data-stu-id="32b60-134">In many large-scale solutions, data is divided into separate partitions that can be managed and accessed separately.</span></span> <span data-ttu-id="32b60-135">パーティション分割戦略は、メリットを最大限に活かし、悪影響を最小限に抑えるために、入念に選択する必要があります。</span><span class="sxs-lookup"><span data-stu-id="32b60-135">The partitioning strategy must be chosen carefully to maximize the benefits while minimizing adverse effects.</span></span> <span data-ttu-id="32b60-136">パーティション分割を行うことで、拡張性が向上し、競合が少なくなり、パフォーマンスが最適化されます。</span><span class="sxs-lookup"><span data-stu-id="32b60-136">Partitioning can help improve scalability, reduce contention, and optimize performance.</span></span>

### <a name="caching"></a><span data-ttu-id="32b60-137">キャッシュ</span><span class="sxs-lookup"><span data-stu-id="32b60-137">Caching</span></span>

<span data-ttu-id="32b60-138">ご利用のアーキテクチャでキャッシュを使用すると、パフォーマンスの向上につながる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="32b60-138">Use caching in your architecture can help improve performance.</span></span> <span data-ttu-id="32b60-139">キャッシュは、使用頻繁の高いデータや資産 (Web ページ、画像) を、より高速に取得できるように格納するメカニズムです。</span><span class="sxs-lookup"><span data-stu-id="32b60-139">Caching is a mechanism to store frequently used data or assets (web pages, images) for faster retrieval.</span></span> <span data-ttu-id="32b60-140">アプリケーションのさまざまなレイヤーで、キャッシュを使用できます。</span><span class="sxs-lookup"><span data-stu-id="32b60-140">Caching can be used at different layers of your application.</span></span> <span data-ttu-id="32b60-141">アプリケーション サーバーとデータベース間でキャッシュを使用でき、データ取得時間を短縮することができます。</span><span class="sxs-lookup"><span data-stu-id="32b60-141">You can use caching between your application servers and a database, to decrease data retrieval times.</span></span> <span data-ttu-id="32b60-142">エンドユーザーと Web サーバーとの間にキャッシュを使用することもできます。静的なコンテンツをユーザーの近くに配置することで、エンドユーザーに Web ページを返すのにかかる時間を短縮することができます。</span><span class="sxs-lookup"><span data-stu-id="32b60-142">You could also use caching between your end users and your web servers, placing static content closer to the user and decreasing the time it takes to return web pages to the end user.</span></span> <span data-ttu-id="32b60-143">これには、ご利用のデータベース サーバーや Web サーバーから要求の負荷をオフロードし、他の要求のパフォーマンスを高めるという二次的な効果もあります。</span><span class="sxs-lookup"><span data-stu-id="32b60-143">This also has a secondary effect of offloading requests from your database or web servers, increasing the performance for other requests.</span></span>

### <a name="autoscaling"></a><span data-ttu-id="32b60-144">自動スケール</span><span class="sxs-lookup"><span data-stu-id="32b60-144">Autoscaling</span></span>

<span data-ttu-id="32b60-145">自動スケールは、パフォーマンス要件に合わせてリソースを動的に割り当てるプロセスです。</span><span class="sxs-lookup"><span data-stu-id="32b60-145">Autoscaling is the process of dynamically allocating resources to match performance requirements.</span></span> <span data-ttu-id="32b60-146">作業量が増加すると、アプリケーションで、サービス レベル アグリーメント (SLA) に準拠し、必要なパフォーマンス レベルを維持するために追加のリソースが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="32b60-146">As the volume of work grows, an application may need additional resources to maintain the desired performance levels and satisfy service-level agreements (SLAs).</span></span> <span data-ttu-id="32b60-147">需要が減り、追加のリソースが必要なくなった場合は、コストを最小限に抑えるためにそれらのリソースの割り当てを解除できます。</span><span class="sxs-lookup"><span data-stu-id="32b60-147">As demand slackens and the additional resources are no longer needed, they can be de-allocated to minimize costs.</span></span>

<span data-ttu-id="32b60-148">自動スケールでは、クラウドでホストされている環境の弾力性が活用されると同時に、管理上の負担が軽減されます。</span><span class="sxs-lookup"><span data-stu-id="32b60-148">Autoscaling takes advantage of the elasticity of cloud-hosted environments while easing management overhead.</span></span> <span data-ttu-id="32b60-149">これにより、オペレーターがシステムのパフォーマンスを常時監視したり、リソースの追加や削除を判断したりする必要がなくなります。</span><span class="sxs-lookup"><span data-stu-id="32b60-149">It reduces the need for an operator to continually monitor the performance of a system and make decisions about adding or removing resources.</span></span>

### <a name="decouple-resource-intensive-tasks-as-background-jobs"></a><span data-ttu-id="32b60-150">バック グラウンド ジョブとしてリソースを集中的に使用するタスクを切り離す</span><span class="sxs-lookup"><span data-stu-id="32b60-150">Decouple resource-intensive tasks as background jobs</span></span>

<span data-ttu-id="32b60-151">さまざまな種類のアプリケーションにおいて、ユーザー インターフェイス (UI) とは無関係に実行されるバックグラウンド タスクが必須となっています。</span><span class="sxs-lookup"><span data-stu-id="32b60-151">Many types of applications require background tasks that run independently of the user interface (UI).</span></span> <span data-ttu-id="32b60-152">その例として、バッチ ジョブ、多くの処理能力を消費するタスク、長時間実行されるプロセス (ワークフローなど) を挙げることができます。</span><span class="sxs-lookup"><span data-stu-id="32b60-152">Examples include batch jobs, intensive processing tasks, and long-running processes such as workflows.</span></span> <span data-ttu-id="32b60-153">バックグラウンド ジョブの実行は、ユーザーの介入を必要としません。アプリケーションでジョブを起動した後も、ユーザーから対話式に送られる要求を処理し続けることができます。</span><span class="sxs-lookup"><span data-stu-id="32b60-153">Background jobs can be executed without requiring user interaction--the application can start the job and then continue to process interactive requests from users.</span></span> <span data-ttu-id="32b60-154">アプリケーションの UI に対する負荷が小さくなるので、稼働率が向上し、対話の応答時間が短縮されます。</span><span class="sxs-lookup"><span data-stu-id="32b60-154">This can help to minimize the load on the application UI, which can improve availability and reduce interactive response times.</span></span>

### <a name="use-a-messaging-layer-between-services"></a><span data-ttu-id="32b60-155">サービス間のメッセージング レイヤーを使用する</span><span class="sxs-lookup"><span data-stu-id="32b60-155">Use a messaging layer between services</span></span>

<span data-ttu-id="32b60-156">サービスとサービスの間にメッセージング レイヤーを追加することで、パフォーマンスとスケーラビリティが向上する場合があります。</span><span class="sxs-lookup"><span data-stu-id="32b60-156">Adding a messaging layer in between services can have a benefit to performance and scalability.</span></span> <span data-ttu-id="32b60-157">メッセージング レイヤーを追加することで、サービス間に要求のバッファーが形成され、アプリケーションの処理が追い付かなくなった場合でも、エラーが生じることなく要求のフローが維持されるようになります。</span><span class="sxs-lookup"><span data-stu-id="32b60-157">Adding a messaging layer creates a buffer for requests between the services so that requests can continue to flow in without error if the application can’t keep up.</span></span> <span data-ttu-id="32b60-158">アプリケーションによって絶えず要求が処理されるので、受信した順序で応答が返されます。</span><span class="sxs-lookup"><span data-stu-id="32b60-158">As the application works through the requests, they will be answered in the order in which they were received.</span></span>

### <a name="implement-scale-units"></a><span data-ttu-id="32b60-159">スケール ユニットを実装する</span><span class="sxs-lookup"><span data-stu-id="32b60-159">Implement scale units</span></span>

<span data-ttu-id="32b60-160">ユニットとしてスケーリングします。</span><span class="sxs-lookup"><span data-stu-id="32b60-160">Scale as a unit.</span></span> <span data-ttu-id="32b60-161">リソースごとに、スケーリング アクティビティが依存システムにどのような影響を及ぼす可能性があるかを特定します。</span><span class="sxs-lookup"><span data-stu-id="32b60-161">For each resource, determine the impact that a scaling activity may have on dependent systems.</span></span> <span data-ttu-id="32b60-162">これにより、スケール アウト操作を容易に適用できるようになるため、アプリケーションは悪影響を受けにくくなります。</span><span class="sxs-lookup"><span data-stu-id="32b60-162">This makes applying scale-out operations easier, and less prone to negative impact on the application.</span></span> <span data-ttu-id="32b60-163">たとえば、x 個の Web ロールおよび worker ロールを追加すると、それらのロールによって生成される追加のワークロードを処理するために、y 個の追加キューおよび z 個のストレージ アカウントが必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="32b60-163">For example, adding x number of web and worker roles might require y number of additional queues and z number of storage accounts to handle the additional workload generated by the roles.</span></span> <span data-ttu-id="32b60-164">スケール ユニットは x 個の Web ロールおよび worker ロール、y 個のキュー、z 個のストレージ アカウントで構成することが可能です。</span><span class="sxs-lookup"><span data-stu-id="32b60-164">A scale unit could consist of x web and worker roles, y queues, and z storage accounts.</span></span> <span data-ttu-id="32b60-165">1 つ以上のスケール ユニットを追加することでスケーリングが容易になるように、アプリケーションを設計してください。</span><span class="sxs-lookup"><span data-stu-id="32b60-165">Design the application so that it's easily scaled by adding one or more scale units.</span></span>

### <a name="performance-monitoring"></a><span data-ttu-id="32b60-166">パフォーマンスの監視</span><span class="sxs-lookup"><span data-stu-id="32b60-166">Performance monitoring</span></span>

<span data-ttu-id="32b60-167">クラウドで実行される分散アプリケーションとサービスは、その性質上、数多くの変化する部分で構成される複雑なソフトウェアです。</span><span class="sxs-lookup"><span data-stu-id="32b60-167">Distributed applications and services running in the cloud are, by their nature, complex pieces of software that comprise many moving parts.</span></span> <span data-ttu-id="32b60-168">運用環境では、ユーザーによるシステムの利用方法を追跡し、リソースの使用率をトレースし、システムの正常性とパフォーマンスを総合的に監視できることが重要です。</span><span class="sxs-lookup"><span data-stu-id="32b60-168">In a production environment, it's important to be able to track the way in which users utilize your system, trace resource utilization, and generally monitor the health and performance of your system.</span></span> <span data-ttu-id="32b60-169">この情報を診断に使用して、問題の検出と修正に役立てることができます。さらに、潜在的な問題を見つけてその発生を防止するために役立てることもできます。</span><span class="sxs-lookup"><span data-stu-id="32b60-169">You can use this information as a diagnostic aid to detect and correct issues, and also to help spot potential problems and prevent them from occurring.</span></span>

<span data-ttu-id="32b60-170">ご利用のアプリケーションのすべての階層を確認して、そのアプリケーションでのパフォーマンスのボトルネックを識別して修復します。</span><span class="sxs-lookup"><span data-stu-id="32b60-170">Look across all layers of your application and identify and remediate performance bottlenecks in your application.</span></span> <span data-ttu-id="32b60-171">ご利用のアプリケーションのほか、ご利用のデータベースにインデックスを追加するプロセスでさえ、これらのボトルネックによってパフォーマンスの低いメモリ処理が行われている可能性があります。</span><span class="sxs-lookup"><span data-stu-id="32b60-171">These bottlenecks could be poor memory handling in your application, or even the process of adding indexes into your database.</span></span> <span data-ttu-id="32b60-172">1 つのボトルネックを解決すると、今まで気が付かなかった別のボトルネックが発覚するため、これは反復的なプロセスとなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="32b60-172">It may be an iterative process as you relieve one bottleneck and then uncover another that you were unaware of.</span></span>

<span data-ttu-id="32b60-173">パフォーマンスの監視に完全な方法を使用することで、ご利用のアーキテクチャにメリットのあるパターンおよびプラクティスの種類を特定することができます。</span><span class="sxs-lookup"><span data-stu-id="32b60-173">With a thorough approach to performance monitoring, you'll be able to determine what types of patterns and practices your architecture will benefit from.</span></span>