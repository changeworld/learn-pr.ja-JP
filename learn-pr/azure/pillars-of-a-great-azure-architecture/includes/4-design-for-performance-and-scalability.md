自分の会社が開発した画期的ながん治療法が、第一面のニュースになっているところを想像してみてください。 これはすばらしいマイルストーンであり、会社の Web サイトには間違いなくアクセスが殺到するでしょう。 その Web サイトは、このアクセスの増加に対応できるでしょうか。サイトの反応が低下したり応答しなくなったりするおそれはないでしょうか。

ここでは、スケーリングと最適化の原則を使用して優れたアプリケーション パフォーマンスを確保する基本原理を見ていきます。

## <a name="what-is-scaling-and-performance-optimization"></a>スケーリングとパフォーマンスの最適化とは何ですか。

スケーリングとパフォーマンスの最適化とは、利用可能なリソースを受信要求を持つアプリケーションに適合させることです。 パフォーマンスの最適化には、リソースをスケーリングすること、潜在的なボトルネックを識別して最適化すること、最高のパフォーマンスが得られるようアプリケーション コードを最適化することが含まれています。

### <a name="scaling"></a>スケーリング

コンピューティング リソースは、2 つの方向にスケーリングできます。

* スケーリング "*アップ*" は他のリソースを 1 つのインスタンスに追加する操作です。
* スケーリング "*アウト*" とはインスタンスの追加です。

![スケールアップとスケールアウト](../media-draft/scale-up-scale-out.png)

スケールアップでは CPU やメモリなどの他のリソースを 1 つのインスタンスに追加します。 このインスタンスは、仮想マシンまたは PaaS サービスである場合があります。 インスタンスへより多くの容量を追加する機能により、アプリケーションで使用できるリソースが向上しますが、上限があります。 仮想マシンは実行中のホストの容量までに限られ、ホスト自体に物理的な制限があります。 最終的には、インスタンスのスケール アップを行う時に、これらの上限に達して、インスタンスにさらにリソースを追加する機能は制約を受けます。

スケール アウトは、サービスに追加のインスタンスを付加することが関係しています。 これらの追加のインスタンスは仮想マシンや PaaS サービスでもかまいませんが、1 つのインスタンスを強化することで容量を追加するのではなく、インスタンスの合計数を増やすことで容量を増加させます。 スケール アウトのメリットは、アーキテクチャに複数のマシンを追加すれば、想定上は永久にスケール アウトが可能である点です。 スケール アウトには、何らかの種類の負荷分散が必要です。 利用可能な複数のサーバー間に要求を分散させるロード バランサーや、要求の送信先となるアクティブなサーバーを識別するためのサービス検出メカニズムが考えられます。

どちらの場合も、リソースを削減し、コストの最適化を実現できます。

### <a name="performance-optimization"></a>パフォーマンスの最適化

パフォーマンスを最適化するときは、ネットワークとストレージで許容できるパフォーマンスレベルを確保してください。 どちらもアプリケーションの応答時間に影響を与える可能性があります。 実際のアーキテクチャに合った適切なネットワーク テクノロジとストレージ テクノロジを選択することが、最上級のエクスペリエンスをコンシューマーに提供することにつながります。

パフォーマンスの最適化には、アプリケーション自体がどのように実行されているかを理解することも含まれます。 依存システム内でのエラー、不具合のあるコード、ボトルネックはすべて、アプリケーション パフォーマンス管理ツールで明らかになります。 たいていの場合、これらの問題はエンドユーザーや開発者、管理者には見えなかったり、わかりにくかったりしますが、アプリケーションの全体的なパフォーマンスには悪影響があります。

## <a name="scalability-and-performance-best-practices"></a>拡張性とパフォーマンスのベスト プラクティス

アプリケーションのすべての階層を確認して、アプリケーションでのパフォーマンスのボトルネックを識別して修復します。 お使いのアプリケーションで、または、データベースにインデックスを追加するプロセスでも、これらのボトルネックが低いメモリ処理を行っている可能性があります。 1 つのボトルネックを解決すると、今まで気が付かなかった別のボトルネックが発覚することがあるため、これは反復的なプロセスとなることが考えられます。

アーキテクチャでキャッシュを使用すると、パフォーマンスを向上させることができます。 キャッシュは、使用頻繁の高いデータや資産 (Web ページ、画像) を、より高速に取得できるように格納するメカニズムです。 アプリケーションのさまざまなレイヤーで、キャッシュを使用できます。 アプリケーション サーバーとデータベース間でキャッシュを使用でき、データ取得時間を短縮することができます。 エンドユーザーと Web サーバーとの間にキャッシュを使用することもできます。静的なコンテンツをユーザーの近くに配置することで、エンドユーザーに Web ページを返すのにかかる時間を短縮することができます。 これには、データベース サーバーや Web サーバーから要求の負荷をオフロードし、他の要求のパフォーマンスを高めるという二次的な効果もあります。

いくつものタスクを実行する 1 つの大規模なアプリケーションとして構築されたレガシー アプリケーションは珍しくありません。 このアーキテクチャは、スケールアップのみに限定されていることが多く、スケール アウトに対応していません。このようなタイプのアーキテクチャでは、アプリケーションを最新化し、サービス間の分離度を高めます。 分離とは、アプリケーションの主要な機能を別のアプリケーションに切り離す作業です。 分離後は、必要に応じて各サービスを個別にスケール アウトまたはスケール インすることができます、

分離と合わせて、サービスとサービスの間にメッセージング レイヤーを追加することで、パフォーマンスが向上する場合があります。 メッセージング レイヤーを追加することで、サービス間に要求のバッファーが形成され、アプリケーションの処理が追い付かなくなった場合でも、エラーが生じることなく要求のフローが維持されるようになります。 アプリケーションによって絶えず要求が処理されるので、受信した順序で応答が返されます。

アプリケーションのパフォーマンスを最適化するために注意を払うべき領域は、アーキテクチャによってさまざまです。 実際のアプリケーションのパフォーマンスを評価し、最適に実行できていない領域をご自身で見つける必要があります。
