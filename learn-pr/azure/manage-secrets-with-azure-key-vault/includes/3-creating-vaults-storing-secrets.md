## <a name="creating-key-vaults-for-your-applications"></a>アプリケーション用の Key Vault を作成する

ご利用のアプリケーションのデプロイ環境 (開発、テスト、運用など) ごとに、個別のコンテナーを作成することをお勧めします。 複数のアプリでシークレットを共有して使用することは可能ですが、攻撃者がコンテナーへの読み取りアクセスを得た場合の影響は、コンテナー内のシークレットの数と共に高まります。

> [!TIP]
> 1 つのアプリケーションに対し、異なる環境間でシークレットに同じ名前を使用する場合、アプリ内で変更する必要がある環境固有の構成は、コンテナー URL だけです。

コンテナーの作成には、初期構成は必要ありません。 ユーザー ID にはシークレット管理アクセス許可の完全なセットが自動的に付与され、すぐにシークレットの追加を開始することができます。 コンテナーを作成したら、シークレットの追加と管理は、Azure 管理インターフェイス (Azure portal、Azure CLI、Azure PowerShell など) から実行できます。 そのコンテナーを使用するようにアプリケーションを設定する場合、適切なアクセス許可を割り当てる必要があります。これについては次のユニットで説明します。

## <a name="vault-authentication-and-permissions"></a>コンテナーの認証とアクセス許可

Azure Key Vault の API では、Azure Active Directory を使用してユーザーとアプリケーションを認証します。 コンテナー アクセス ポリシーは*アクション*に基づいており、コンテナー全体に適用されます。 たとえば、コンテナーへの **Get** (シークレット値の読み取り)、**List** (すべてのシークレットの名前を一覧表示)、および **Set** (シークレット値の作成または更新) アクセス許可を持つアプリケーションでは、シークレットの作成、シークレット名の一覧表示、およびそのコンテナー内のすべてのシークレット値を設定することができます。

コンテナーで実行される*すべて*のアクションには、認証と承認が必要です &mdash; いかなる種類の匿名アクセスも許可されることはありません。

> [!TIP]
> 開発者とアプリにコンテナーへのアクセスを許可する場合は、必要最小限のアクセス許可のセットのみを付与します。 アクセス許可の制限は、コードのバグに起因する事故を回避し、資格情報の盗難やアプリに挿入された悪意のあるコードによる影響を軽減することに役立ちます。

通常、開発者に必要なのは、開発環境コンテナーへの **Get** アクセス許可と **List** アクセス許可のみです。 主任開発者または上級開発者には、必要に応じてシークレットを変更したり追加したりするため、コンテナーへの完全なアクセス許可が必要になります。 運用環境コンテナーへの完全なアクセス許可は、通常は上級の運用スタッフのために予約されています。

アプリでは、通常は **Get** アクセス許可のみが必要です。 一部のアプリでは、アプリの実装方法によっては、**List** アクセス許可が必要な場合があります。 このモジュールの演習で実装するアプリでは、コンテナーからシークレットを読み取るために使用する手法により、**List** アクセス許可が必要になります。

経営陣は、アプリケーション シークレットについて会社が抱えているすべての問題を考慮して、他の開発者を正しい道に誘導するための小規模なスターター アプリを作成することをあなたに求めています。 アプリは、できる限り簡単かつ安全にシークレットを管理するためのベスト プラクティスを示す必要があります。

## <a name="create-the-vault-and-store-the-secret-in-it"></a>コンテナーを作成してシークレットを格納する
手始めに、コンテナーを作成し、1 つのシークレットを格納します。

###  <a name="create-the-vault"></a>コンテナーの作成

最初に、コンテナーを作成し、そこにシークレットを格納します。

[!include[](../../../includes/azure-sandbox-activate.md)]

**Key Vault 名はグローバルに一意である必要があるため、一意の名前を選択する必要があります**。 Vault の名前は長さを 3 - 24 文字とし、英数字と特殊文字のハイフン (-) のみを使用する必要があります。 自分で決めたコンテナーの名前をメモしておきます。この演習を通して必要になります。

[!include[](../../../includes/azure-sandbox-regions-first-mention-note.md)]

Cloud Shell で次のコマンドを実行し、コンテナーを作成します。 上記の選択と異なる場所に置く場合、`--location` 値を置換してください。

```azurecli
az keyvault create \
    --name <your-unique-vault-name> \
    --resource-group <rgn>[Sandbox resource group name]</rgn> \
    --location eastus
```

完了すると、新しいコンテナーを記述する JSON 出力が表示されます。

> [!TIP]
> このコマンドでは、**<rgn>[サンドボックス リソース グループ名]</rgn>** という名前の事前に作成されたリソース グループが使用されました。 独自のサブスクリプションを使用するとき、新しいリソース グループを作成するか、以前に作成した既存のリソース グループを使用します。

### <a name="add-the-secret"></a>シークレットの追加

シークレットを追加します。シークレットは **SecretPassword** という名前で、**reindeer_flotilla** の値を持ちます。

```azurecli
az keyvault secret set \
    --name SecretPassword \
    --value reindeer_flotilla \
    --vault-name <your-unique-vault-name>
```

この後すぐにアプリケーションのコードを記述しますが、まず、アプリがコンテナーへの認証を行う方法について少し説明する必要があります。