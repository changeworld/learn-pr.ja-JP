Azure Key Vault では、**Azure Active Directory** を使用してコンテナーにアクセスを試行するユーザーとアプリケーションを認証します。 コンテナーへのアクセスを Web アプリケーションに付与するには、まず Azure Active Directory にアプリを登録する必要があります。 登録すると、アプリに対して ID が作成されます。 アプリに ID が作成されたら、それにコンテナーのアクセス許可を割り当てることができます。

アプリおよびユーザーは、Azure Active Directory の認証トークンを使用して、Key Valut に対して認証を行います。 トークンを持っているすべてのユーザーはアプリケーション ID を使用して、コンテナーのすべてのシークレットにアクセスできるので、Azure Active Directory からトークンを取得するには、シークレットまたは証明書が必要です。

アプリケーションのシークレットは、コンテナーでセキュリティで保護されていますが、それにアクセスするために、コンテナー外でもシークレットまたは証明書を保持する必要があります。 この問題は、*ブートストラップの問題*と呼ばれており、Azure にはそのソリューションがあります。

## <a name="managed-identities-for-azure-resources"></a>Azure リソースのマネージド ID

Azure リソースの管理対象 id は、アプリでも、コンテナーの外部でシークレットを 1 つを管理することがなく Key Vault と他の Azure サービスへのアクセスに使用できる Azure の機能です。 管理対象 id を使用するとは、web アプリから Key Vault を活用するために単純かつ安全な方法です。

Web アプリの管理対象 id を有効にすると Azure では、アプリからの専用の個別トークン許可 REST サービスがアクティブにします。 アプリはトークンを Azure Active Directory に直接要求するのではなく、このサービスに要求します。 アプリはシークレットを使ってこのサービスにアクセスする必要がありますが、そのシークレットは、アプリの起動時に App Service によってご利用のアプリの環境変数に挿入されます。 管理や任意の場所では、この秘密の値を格納する必要はありませんし、このシークレットまたは管理対象 id のトークン サービス エンドポイントにアクセスできるアプリの外部で何もします。

Azure リソースの管理対象 id は、Azure Active Directory でアプリを登録します。 また web アプリを削除するか、またはそのマネージド id が無効にする場合、登録が削除されます。

管理対象 id を Azure サブスクリプションに含まれている無償のエディションを含む、Azure Active Directory のすべてのエディションで利用できます。 これを App Service で使用する場合、追加コストや構成が不要です。またアプリでいつでも有効または無効にできます。

> [!NOTE]
> Linux またはコンテナーの web アプリの Azure リソースの管理対象の id が現在サポートされていません。

Web アプリの管理対象 id を有効にするには、構成なしで 1 つの Azure CLI コマンドのみが必要です。 これは、後ほど App Service アプリを設定し、Azure にデプロイするときに行います。 その前に、ただし、ここをアプリのコードを記述する管理対象 id の知識を適用します。