Azure Key Vault では、**Azure Active Directory** を使用してコンテナーにアクセスを試行するユーザーとアプリケーションを認証します。 コンテナーへのアクセスを Web アプリケーションに付与するには、まず Azure Active Directory にアプリを登録する必要があります。 登録すると、アプリに対して ID が作成されます。 アプリに ID が作成されたら、それにコンテナーのアクセス許可を割り当てることができます。

アプリおよびユーザーは、Azure Active Directory の認証トークンを使用して、Key Valut に対して認証を行います。 トークンを持っているすべてのユーザーはアプリケーション ID を使用して、コンテナーのすべてのシークレットにアクセスできるので、Azure Active Directory からトークンを取得するには、シークレットまたは証明書が必要です。

アプリケーションのシークレットは、コンテナーでセキュリティで保護されていますが、それにアクセスするために、コンテナー外でもシークレットまたは証明書を保持する必要があります。 この問題は、*ブートストラップの問題*と呼ばれており、Azure にはそのソリューションがあります。

## <a name="managed-identities-for-azure-resources"></a>Azure リソースのマネージド ID

Azure リソースのマネージド ID とは、1 つのシークレットもコンテナー外で管理する必要なく Key Vault や他の Azure サービスにアクセスするために、ご利用のアプリで使用できる Azure の機能です。 マネージド ID の使用は、Web アプリから Key Vault を活用するための単純かつ安全な方法です。

Web アプリでマネージド ID を有効にすると、Azure ではご利用のアプリが専用に使用されるよう、個別のトークンが付与される REST サービスがアクティブ化されます。 アプリはトークンを Azure Active Directory に直接要求するのではなく、このサービスに要求します。 アプリはシークレットを使ってこのサービスにアクセスする必要がありますが、そのシークレットは、アプリの起動時に App Service によってご利用のアプリの環境変数に挿入されます。 このシークレット値をどこかで管理したり格納する必要はありません。また、アプリ外部からこのシークレットまたはマネージド ID トークン サービスのエンドポイントにアクセスすることはできません。

また、Azure リソースのマネージド ID により、Azure Active Directory にアプリが自動的に登録されます。Web アプリを削除するか、そのマネージド ID を無効にすると登録が解除されます。

マネージド ID は、Azure サブスクリプションに含まれる無償エディションを含む Azure Active Directory のすべてのエディションで利用できます。 これを App Service で使用する場合、追加コストや構成が不要です。またアプリでいつでも有効または無効にできます。

> [!NOTE]
> Azure リソースのマネージド ID は現在、Linux またはコンテナー Web アプリではサポートされていません。

Web アプリのマネージド ID を有効にするには、構成は不要で、1 つの Azure CLI コマンドのみで実行できます。 これは、後ほど App Service アプリを設定し、Azure にデプロイするときに行います。 ただしその前に、マネージド ID に関する知識を使って、アプリ用のコードを記述しましょう。