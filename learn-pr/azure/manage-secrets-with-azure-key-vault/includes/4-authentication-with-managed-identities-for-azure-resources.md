<span data-ttu-id="1b69f-101">Azure Key Vault では、**Azure Active Directory** を使用してコンテナーにアクセスを試行するユーザーとアプリケーションを認証します。</span><span class="sxs-lookup"><span data-stu-id="1b69f-101">Azure Key Vault uses **Azure Active Directory** to authenticate users and applications that try to access a vault.</span></span> <span data-ttu-id="1b69f-102">コンテナーへのアクセスを Web アプリケーションに付与するには、まず Azure Active Directory にアプリを登録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1b69f-102">To grant our web application access to the vault, we first need to register our app with Azure Active Directory.</span></span> <span data-ttu-id="1b69f-103">登録すると、アプリに対して ID が作成されます。</span><span class="sxs-lookup"><span data-stu-id="1b69f-103">Registering creates an identity for the app.</span></span> <span data-ttu-id="1b69f-104">アプリに ID が作成されたら、それにコンテナーのアクセス許可を割り当てることができます。</span><span class="sxs-lookup"><span data-stu-id="1b69f-104">Once the app has an identity, we can assign vault permissions to it.</span></span>

<span data-ttu-id="1b69f-105">アプリおよびユーザーは、Azure Active Directory の認証トークンを使用して、Key Valut に対して認証を行います。</span><span class="sxs-lookup"><span data-stu-id="1b69f-105">Apps and users authenticate to Key Vault using an Azure Active Directory authentication token.</span></span> <span data-ttu-id="1b69f-106">トークンを持っているすべてのユーザーはアプリケーション ID を使用して、コンテナーのすべてのシークレットにアクセスできるので、Azure Active Directory からトークンを取得するには、シークレットまたは証明書が必要です。</span><span class="sxs-lookup"><span data-stu-id="1b69f-106">Getting a token from Azure Active Directory requires a secret or certificate, because anyone with a token could use the application identity to access all of the secrets in the vault.</span></span>

<span data-ttu-id="1b69f-107">アプリケーションのシークレットは、コンテナーでセキュリティで保護されていますが、それにアクセスするために、コンテナー外でもシークレットまたは証明書を保持する必要があります。</span><span class="sxs-lookup"><span data-stu-id="1b69f-107">Our application secrets are secure in the vault, but we still need to keep a secret or certificate outside of the vault in order to access them!</span></span> <span data-ttu-id="1b69f-108">この問題は、*ブートストラップの問題*と呼ばれており、Azure にはそのソリューションがあります。</span><span class="sxs-lookup"><span data-stu-id="1b69f-108">This problem is called the *bootstrapping problem*, and Azure has a solution for it.</span></span>

## <a name="managed-identities-for-azure-resources"></a><span data-ttu-id="1b69f-109">Azure リソースのマネージド ID</span><span class="sxs-lookup"><span data-stu-id="1b69f-109">Managed identities for Azure resources</span></span>

<span data-ttu-id="1b69f-110">Azure リソースのマネージド ID とは、1 つのシークレットもコンテナー外で管理する必要なく Key Vault や他の Azure サービスにアクセスするために、ご利用のアプリで使用できる Azure の機能です。</span><span class="sxs-lookup"><span data-stu-id="1b69f-110">Managed identities for Azure resources is an Azure feature that your app can use to access Key Vault and other Azure services without having to manage even a single secret outside of the vault.</span></span> <span data-ttu-id="1b69f-111">マネージド ID の使用は、Web アプリから Key Vault を活用するための単純かつ安全な方法です。</span><span class="sxs-lookup"><span data-stu-id="1b69f-111">Using a managed identity is a simple and secure way to take advantage of Key Vault from your web app.</span></span>

<span data-ttu-id="1b69f-112">Web アプリでマネージド ID を有効にすると、Azure ではご利用のアプリが専用に使用されるよう、個別のトークンが付与される REST サービスがアクティブ化されます。</span><span class="sxs-lookup"><span data-stu-id="1b69f-112">When you enable managed identity on your web app, Azure activates a separate token-granting REST service specifically for use by your app.</span></span> <span data-ttu-id="1b69f-113">アプリはトークンを Azure Active Directory に直接要求するのではなく、このサービスに要求します。</span><span class="sxs-lookup"><span data-stu-id="1b69f-113">Your app will request tokens from this service instead of directly from Azure Active Directory.</span></span> <span data-ttu-id="1b69f-114">アプリはシークレットを使ってこのサービスにアクセスする必要がありますが、そのシークレットは、アプリの起動時に App Service によってご利用のアプリの環境変数に挿入されます。</span><span class="sxs-lookup"><span data-stu-id="1b69f-114">Your app needs to use a secret to access this service, but that secret is injected into your app's environment variables by App Service when it starts up.</span></span> <span data-ttu-id="1b69f-115">このシークレット値をどこかで管理したり格納する必要はありません。また、アプリ外部からこのシークレットまたはマネージド ID トークン サービスのエンドポイントにアクセスすることはできません。</span><span class="sxs-lookup"><span data-stu-id="1b69f-115">You don't need to manage or store this secret value anywhere, and nothing outside of your app can access this secret or the managed identity token service endpoint.</span></span>

<span data-ttu-id="1b69f-116">また、Azure リソースのマネージド ID により、Azure Active Directory にアプリが自動的に登録されます。Web アプリを削除するか、そのマネージド ID を無効にすると登録が解除されます。</span><span class="sxs-lookup"><span data-stu-id="1b69f-116">Managed identities for Azure resources also registers your app in Azure Active Directory for you, and will delete the registration if you delete the web app or disable its managed identity.</span></span>

<span data-ttu-id="1b69f-117">マネージド ID は、Azure サブスクリプションに含まれる無償エディションを含む Azure Active Directory のすべてのエディションで利用できます。</span><span class="sxs-lookup"><span data-stu-id="1b69f-117">Managed identities are available in all editions of Azure Active Directory, including the Free edition included with an Azure subscription.</span></span> <span data-ttu-id="1b69f-118">これを App Service で使用する場合、追加コストや構成が不要です。またアプリでいつでも有効または無効にできます。</span><span class="sxs-lookup"><span data-stu-id="1b69f-118">Using it in App Service has no extra cost and requires no configuration, and it can be enabled or disabled on an app at any time.</span></span>

> [!NOTE]
> <span data-ttu-id="1b69f-119">Azure リソースのマネージド ID は現在、Linux またはコンテナー Web アプリではサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="1b69f-119">Managed identities for Azure resources is not currently supported for Linux or Container web apps.</span></span>

<span data-ttu-id="1b69f-120">Web アプリのマネージド ID を有効にするには、構成は不要で、1 つの Azure CLI コマンドのみで実行できます。</span><span class="sxs-lookup"><span data-stu-id="1b69f-120">Enabling a managed identity for a web app requires only a single Azure CLI command with no configuration.</span></span> <span data-ttu-id="1b69f-121">これは、後ほど App Service アプリを設定し、Azure にデプロイするときに行います。</span><span class="sxs-lookup"><span data-stu-id="1b69f-121">We'll do it later on when we set up an App Service app and deploy to Azure.</span></span> <span data-ttu-id="1b69f-122">ただしその前に、マネージド ID に関する知識を使って、アプリ用のコードを記述しましょう。</span><span class="sxs-lookup"><span data-stu-id="1b69f-122">Before that, though, we're going to apply our knowledge of managed identities to write the code for our app.</span></span>