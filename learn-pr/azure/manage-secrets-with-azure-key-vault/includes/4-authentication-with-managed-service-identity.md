Azure Key Vault では、**Azure Active Directory** を使用してコンテナーにアクセスを試行するユーザーとアプリケーションを認証します。 コンテナーへのアクセスを Web アプリケーションに付与するには、まず Azure Active Directory にアプリを登録する必要があります。 登録すると、アプリに対して ID が作成されます。 アプリに ID が作成されたら、それにコンテナーのアクセス許可を割り当てることができます。

アプリおよびユーザーは、Azure Active Directory の認証トークンを使用して、Key Valut に対して認証を行います。 トークンを持っているすべてのユーザーはアプリケーション ID を使用して、コンテナーのすべてのシークレットにアクセスできるので、Azure Active Directory からトークンを取得するには、シークレットまたは証明書が必要です。

アプリケーションのシークレットは、コンテナーでセキュリティで保護されていますが、それにアクセスするために、コンテナー外でもシークレットまたは証明書を保持する必要があります。 この問題は、*ブートストラップの問題*と呼ばれており、Azure にはそのソリューションがあります。

## <a name="managed-service-identity"></a>マネージド サービス ID

*マネージド サービス ID* (MSI) とは、1 つのシークレットもコンテナー外で管理する必要なく Key Vault や他の Azure サービスにアクセスするために、ご利用のアプリで使用できる Azure App Service の機能です。 MSI の使用は、Web アプリから Key Vault を活用するための単純かつ安全な方法です。

MSI を有効にすると、Azure ではご利用のアプリが専用に使用するよう、個別のトークンが付与される REST サービスがアクティブ化されます。 アプリはトークンを Azure Active Directory に直接要求するのではなく、このサービスに要求します。 アプリはシークレットを使ってこのサービスにアクセスする必要がありますが、そのシークレットは、アプリの起動時に App Service によってご利用のアプリの環境変数に挿入されます。 このシークレット値をどこかで管理したり格納する必要はありません。また、アプリ外部からこのシークレットまたは MSI トークン サービスのエンドポイントにアクセスすることはできません。

MSI は、ユーザーのために Azure Active Directory にご利用のアプリを登録し、MSI を無効にしたり、そのアプリを削除した場合には登録を削除します。

MSI は、Azure サブスクリプションに含まれる無償エディションを含む Azure Active Directory のすべてのエディションで利用できます。 これを App Service で使用する場合、追加コストや構成が不要です。またアプリでいつでも有効または無効にできます。

> [!NOTE]
> MSI は現在、Linux またはコンテナー Web アプリではサポートされていません。

MSI を有効にするには、構成は不要で、1 つの Azure CLI コマンドのみで実行できます。 これは、後ほど App Service アプリを設定し、Azure にデプロイするときに行います。 ですがその前に、MSI に関する知識を使って、アプリ用のコードを記述しましょう。