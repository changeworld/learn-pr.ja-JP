<span data-ttu-id="a7caf-101">Azure Key Vault では、**Azure Active Directory** を使用してコンテナーにアクセスを試行するユーザーとアプリケーションを認証します。</span><span class="sxs-lookup"><span data-stu-id="a7caf-101">Azure Key Vault uses **Azure Active Directory** to authenticate users and applications that try to access a vault.</span></span> <span data-ttu-id="a7caf-102">コンテナーへのアクセスを Web アプリケーションに付与するには、まず Azure Active Directory にアプリを登録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7caf-102">To grant our web application access to the vault, we first need to register our app with Azure Active Directory.</span></span> <span data-ttu-id="a7caf-103">登録すると、アプリに対して ID が作成されます。</span><span class="sxs-lookup"><span data-stu-id="a7caf-103">Registering creates an identity for the app.</span></span> <span data-ttu-id="a7caf-104">ID を取得したら、それにコンテナーのアクセス許可を割り当てることができます。</span><span class="sxs-lookup"><span data-stu-id="a7caf-104">Once we have an identity, we can assign vault permissions to it.</span></span>

<span data-ttu-id="a7caf-105">アプリおよびユーザーは、Azure Active Directory の認証トークンを使用して、Key Valut に対して認証を行います。</span><span class="sxs-lookup"><span data-stu-id="a7caf-105">Apps and users authenticate to Key Vault using an Azure Active Directory authentication token.</span></span> <span data-ttu-id="a7caf-106">トークンを持っているすべてのユーザーはアプリケーション ID を使用して、コンテナーのすべてのシークレットにアクセスできるので、Azure Active Directory からトークンを取得するには、シークレットまたは証明書が必要です。</span><span class="sxs-lookup"><span data-stu-id="a7caf-106">Getting a token from Azure Active Directory requires a secret or certificate, because anyone with a token could use the application identity to access all of the secrets in the vault.</span></span>

<span data-ttu-id="a7caf-107">アプリケーションのシークレットは、コンテナーでセキュリティで保護されていますが、それにアクセスするために、コンテナー外でもシークレットまたは証明書を保持する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a7caf-107">Our application secrets are secure in the vault, but we still need to keep a secret or certificate outside of the vault in order to access them!</span></span> <span data-ttu-id="a7caf-108">この問題は、*ブートストラップの問題*と呼ばれており、Azure にはそのソリューションがあります。</span><span class="sxs-lookup"><span data-stu-id="a7caf-108">This problem is called the *bootstrapping problem*, and Azure has a solution for it.</span></span>

## <a name="managed-service-identity"></a><span data-ttu-id="a7caf-109">管理対象のサービス ID</span><span class="sxs-lookup"><span data-stu-id="a7caf-109">Managed Service Identity</span></span>

<span data-ttu-id="a7caf-110">*マネージド サービス ID* (MSI) とは、1 つのシークレットも管理する必要なく Key Vault や他の Azure サービスにアクセスするために、ご利用のアプリで使用できる Azure App Service の機能です。</span><span class="sxs-lookup"><span data-stu-id="a7caf-110">*Managed Service Identity* (MSI) is a feature of Azure App Service that your app can use to access Key Vault and other Azure services without having to manage even a single secret.</span></span> <span data-ttu-id="a7caf-111">MSI の使用は、自分でシークレットを管理するよりも簡単かつ安全です。</span><span class="sxs-lookup"><span data-stu-id="a7caf-111">Using MSI is simpler and more secure than managing a secret yourself.</span></span>

<span data-ttu-id="a7caf-112">MSI を有効にすると、Azure ではご利用のアプリが専用に使用するよう、個別のトークンが付与される REST サービスがアクティブ化されます。</span><span class="sxs-lookup"><span data-stu-id="a7caf-112">When you enable MSI, Azure activates a separate token-granting REST service specifically for use by your app.</span></span> <span data-ttu-id="a7caf-113">ご利用のアプリがトークンを MSI トークン サービスに要求すると、サービスが MSI ID 用にトークンを取得できるよう Azure Active Directory に接続し、Key Vault で使用するためにそれをアプリに戻します。</span><span class="sxs-lookup"><span data-stu-id="a7caf-113">When your app requests a token from the MSI token service, the service contacts Azure Active Directory to get a token for the MSI identity and hands it back to your app for use with Key Vault.</span></span> <span data-ttu-id="a7caf-114">このワークフローの最も重要な部分は、ご利用のアプリが MSI トークン サービスに対して認証される方法です。ご利用のアプリは、構成で管理する必要のあるシークレットや証明書の代わりに、Azure が起動時に環境変数に安全に挿入するシークレットを使用します。</span><span class="sxs-lookup"><span data-stu-id="a7caf-114">The most important part of this workflow is the way that your app authenticates to the MSI token service &mdash; instead of requiring a secret or certificate you need to manage in your configuration, your app uses a secret that Azure securely injects into its environment variables when it starts up.</span></span> <span data-ttu-id="a7caf-115">このシークレット値は、いずれかの場所で管理したり、保存する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="a7caf-115">You don't need to manage or store this secret value anywhere.</span></span> <span data-ttu-id="a7caf-116">ご利用のアプリ外のいずれもこのシークレットまたは MSI トークン サービス エンドポイントにはアクセスできません。</span><span class="sxs-lookup"><span data-stu-id="a7caf-116">Nothing outside of your app can access this secret or the MSI token service endpoint.</span></span>

<span data-ttu-id="a7caf-117">MSI は、ユーザーのために Azure Active Directory にご利用のアプリを登録し、MSI を無効にしたり、そのアプリを削除した場合には登録を削除します。</span><span class="sxs-lookup"><span data-stu-id="a7caf-117">MSI also registers your app in Azure Active Directory for you, and will delete the registration if you disable MSI or delete the app.</span></span>

<span data-ttu-id="a7caf-118">MSI は、Azure サブスクリプションに含まれる無償エディションを含む Azure Active Directory のすべてのエディションで利用できます。</span><span class="sxs-lookup"><span data-stu-id="a7caf-118">MSI is available in all editions of Azure Active Directory, including the Free edition included with an Azure subscription.</span></span> <span data-ttu-id="a7caf-119">これを App Service で使用する場合、追加コストや構成が不要です。またアプリでいつでも有効または無効にできます。</span><span class="sxs-lookup"><span data-stu-id="a7caf-119">Using it in App Service has no extra cost and requires no configuration, and it can be enabled or disabled on an app at any time.</span></span>

> [!NOTE]
> <span data-ttu-id="a7caf-120">MSI は現在、Linux またはコンテナー Web アプリではサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="a7caf-120">MSI is not currently supported for Linux or Container web apps.</span></span>

<span data-ttu-id="a7caf-121">MSI を有効にするには、構成は不要で、1 つの Azure CLI コマンドのみで実行できます。</span><span class="sxs-lookup"><span data-stu-id="a7caf-121">Enabling MSI requires only a single Azure CLI command with no configuration.</span></span> <span data-ttu-id="a7caf-122">これは、App Service アプリを設定し、Azure にデプロイするときのユニット 5 で行います。</span><span class="sxs-lookup"><span data-stu-id="a7caf-122">We'll do it in unit 5 when we set up an App Service app and deploy to Azure.</span></span> <span data-ttu-id="a7caf-123">ですがその前に、アプリ用のコードの記述に、MSI に関する知識を使用します。</span><span class="sxs-lookup"><span data-stu-id="a7caf-123">Before that, though, we're going to apply our knowledge of MSI to write the code for our app.</span></span>