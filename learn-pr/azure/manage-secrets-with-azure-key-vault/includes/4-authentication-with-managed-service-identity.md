Azure Key Vault では、**Azure Active Directory** を使用してコンテナーにアクセスを試行するユーザーとアプリケーションを認証します。 コンテナーへのアクセスを Web アプリケーションに付与するには、まず Azure Active Directory にアプリを登録する必要があります。 登録すると、アプリに対して ID が作成されます。 ID を取得したら、それにコンテナーのアクセス許可を割り当てることができます。

アプリおよびユーザーは、Azure Active Directory の認証トークンを使用して、Key Valut に対して認証を行います。 トークンを持っているすべてのユーザーはアプリケーション ID を使用して、コンテナーのすべてのシークレットにアクセスできるので、Azure Active Directory からトークンを取得するには、シークレットまたは証明書が必要です。

アプリケーションのシークレットは、コンテナーでセキュリティで保護されていますが、それにアクセスするために、コンテナー外でもシークレットまたは証明書を保持する必要があります。 この問題は、*ブートストラップの問題*と呼ばれており、Azure にはそのソリューションがあります。

## <a name="managed-service-identity"></a>管理対象のサービス ID

*マネージド サービス ID* (MSI) とは、1 つのシークレットも管理する必要なく Key Vault や他の Azure サービスにアクセスするために、ご利用のアプリで使用できる Azure App Service の機能です。 MSI の使用は、自分でシークレットを管理するよりも簡単かつ安全です。

MSI を有効にすると、Azure ではご利用のアプリが専用に使用するよう、個別のトークンが付与される REST サービスがアクティブ化されます。 ご利用のアプリがトークンを MSI トークン サービスに要求すると、サービスが MSI ID 用にトークンを取得できるよう Azure Active Directory に接続し、Key Vault で使用するためにそれをアプリに戻します。 このワークフローの最も重要な部分は、ご利用のアプリが MSI トークン サービスに対して認証される方法です。ご利用のアプリは、構成で管理する必要のあるシークレットや証明書の代わりに、Azure が起動時に環境変数に安全に挿入するシークレットを使用します。 このシークレット値は、いずれかの場所で管理したり、保存する必要はありません。 ご利用のアプリ外のいずれもこのシークレットまたは MSI トークン サービス エンドポイントにはアクセスできません。

MSI は、ユーザーのために Azure Active Directory にご利用のアプリを登録し、MSI を無効にしたり、そのアプリを削除した場合には登録を削除します。

MSI は、Azure サブスクリプションに含まれる無償エディションを含む Azure Active Directory のすべてのエディションで利用できます。 これを App Service で使用する場合、追加コストや構成が不要です。またアプリでいつでも有効または無効にできます。

> [!NOTE]
> MSI は現在、Linux またはコンテナー Web アプリではサポートされていません。

MSI を有効にするには、構成は不要で、1 つの Azure CLI コマンドのみで実行できます。 これは、App Service アプリを設定し、Azure にデプロイするときのユニット 5 で行います。 ですがその前に、アプリ用のコードの記述に、MSI に関する知識を使用します。