<span data-ttu-id="c521f-101">次に、データベースに対するデータ スループットを検討します。</span><span class="sxs-lookup"><span data-stu-id="c521f-101">Next we'll consider the data throughout for our database.</span></span> <span data-ttu-id="c521f-102">これはビジネス ニーズに合ったトランザクションの量を確実に処理できるようにするために重要です。</span><span class="sxs-lookup"><span data-stu-id="c521f-102">This is important to ensure we can handle the volume of transactions for our business needs.</span></span> <span data-ttu-id="c521f-103">スループットの要件は、必ずしも一貫性があるとは限りません。</span><span class="sxs-lookup"><span data-stu-id="c521f-103">Throughput requirements aren't always consistent.</span></span> <span data-ttu-id="c521f-104">たとえば、セールや祝日の間に拡大させる必要があるショッピング Web サイトを構築している可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c521f-104">For example, you may be building a shopping website that needs to scale during sales or holidays.</span></span> <span data-ttu-id="c521f-105">データベース スループットの要件の見積もりを開始します。</span><span class="sxs-lookup"><span data-stu-id="c521f-105">We'll start estimating your database throughput requirements.</span></span>

## <a name="what-is-database-throughput"></a><span data-ttu-id="c521f-106">データベース スループットとは</span><span class="sxs-lookup"><span data-stu-id="c521f-106">What is database throughput?</span></span> 

<span data-ttu-id="c521f-107">データベース スループットは、データベースによって 1 秒で実行できる読み取り/書き込みの数です。</span><span class="sxs-lookup"><span data-stu-id="c521f-107">Database throughput is the number of reads and writes that your database can perform in a single second.</span></span> 

<span data-ttu-id="c521f-108">戦略的にスループットをスケーリングするには、さまざまな時間およびさまざまなドキュメント サイズをサポートする必要がある読み取り/書き込みの数を見積もることで、スループットのニーズを見積もる必要があります。</span><span class="sxs-lookup"><span data-stu-id="c521f-108">To scale throughput strategically, you need to estimate your throughput needs by estimating the number of reads and writes you'll have to support at different times and for different document sizes.</span></span> <span data-ttu-id="c521f-109">正しく見積もれた場合は、要求が急増したときもユーザーは適切に使用し続けられます。</span><span class="sxs-lookup"><span data-stu-id="c521f-109">If you estimate correctly, you'll keep your users happy when demand spikes.</span></span> <span data-ttu-id="c521f-110">正しく見積もれなかった場合は、要求の使用回数が制限され、長い待ち時間や不幸な顧客が発生するなど、操作の待機や再試行が必要になります。</span><span class="sxs-lookup"><span data-stu-id="c521f-110">If you estimate incorrectly, your requests can get rate-limited and operations will have to wait and retry, likely causing high latency and unhappy customers.</span></span>

## <a name="what-is-a-request-unit"></a><span data-ttu-id="c521f-111">要求ユニットとは?</span><span class="sxs-lookup"><span data-stu-id="c521f-111">What is a request unit?</span></span>

<span data-ttu-id="c521f-112">Azure Cosmos DB では、**要求ユニット (RU)** と呼ばれるものを使ってスループットを測定します。</span><span class="sxs-lookup"><span data-stu-id="c521f-112">Azure Cosmos DB measures throughput using something called a **request unit (RU)**.</span></span> <span data-ttu-id="c521f-113">要求ユニットの使用は 1 秒ごとに測定されるため、単位は **1 秒あたりの要求ユニット (RU/秒)** になります。</span><span class="sxs-lookup"><span data-stu-id="c521f-113">Request unit usage is measured per second, so the unit of measure is **request units per second (RU/s)**.</span></span> <span data-ttu-id="c521f-114">事前に Azure Cosmos DB にプロビジョニングさせる RU/秒の数を予約する必要があり、そのため、見積もった読み込みを処理することができます。また、現在の要求を満たすようにいつでも RU/秒をスケールアップ、またはスケールダウンすることができます。</span><span class="sxs-lookup"><span data-stu-id="c521f-114">You must reserve the number of RU/s you want Azure Cosmos DB to provision in advance, so it can handle the load you've estimated, and you can scale your RU/s up or down at any time to meet current demand.</span></span>

## <a name="request-unit-basics"></a><span data-ttu-id="c521f-115">要求ユニットの基本</span><span class="sxs-lookup"><span data-stu-id="c521f-115">Request unit basics</span></span>

<span data-ttu-id="c521f-116">単一の要求ユニット (1 RU) とは、ドキュメントの ID を使用した、1 KB のドキュメントにおける単一の GET 要求を実行する概算コストと同じです。</span><span class="sxs-lookup"><span data-stu-id="c521f-116">A single request unit, 1 RU, is equal to the approximate cost of performing a single GET request on a 1-KB document using a document's ID.</span></span> <span data-ttu-id="c521f-117">ドキュメントの ID を使用することによって GET を実行することは、ドキュメントを取得するために効率的な手段であり、コストは少額です。</span><span class="sxs-lookup"><span data-stu-id="c521f-117">Performing a GET by using a document's ID is an efficient means for retrieving a document, and thus the cost is small.</span></span> <span data-ttu-id="c521f-118">同じアイテムを作成、置換、または削除するには、サービスによる追加の処理が必要です。そのため、追加の要求ユニットが必要になります。</span><span class="sxs-lookup"><span data-stu-id="c521f-118">Creating, replacing, or deleting the same item requires additional processing by the service, and therefore requires more request units.</span></span>

<span data-ttu-id="c521f-119">操作に使用する要求ユニット数は、ドキュメント サイズ、ドキュメントのプロパティの数、実行されている操作、追加の複雑な概念 (一貫性やインデックス作成ポリシーなど) によって異なります。</span><span class="sxs-lookup"><span data-stu-id="c521f-119">The number of request units used for an operation changes depending on the document size, the number of properties in the document, the operation being performed, and some additional complex concepts such as consistency and indexing policy.</span></span>

<span data-ttu-id="c521f-120">次の表は、3 種類のサイズのアイテム (1 KB、4 KB、64 KB) を 2 種類のパフォーマンス レベル (500 読み取り/秒 + 100 書き込み/秒と、500 読み取り/秒 + 500 書き込み/秒) で必要な要求ユニット数を示しています。</span><span class="sxs-lookup"><span data-stu-id="c521f-120">The following table shows the number of request units required for items of three different sizes (1 KB, 4 KB, and 64 KB) and at two different performance levels (500 reads/second + 100 writes/second and 500 reads/second + 500 writes/second).</span></span> <span data-ttu-id="c521f-121">この例では、データの一貫性が "**セッション**" に設定され、インデックス作成ポリシーは "**なし**" に設定されています。</span><span class="sxs-lookup"><span data-stu-id="c521f-121">In this example, the data consistency is set to **Session**, and the indexing policy is set to **None**.</span></span>

| <span data-ttu-id="c521f-122">アイテムのサイズ</span><span class="sxs-lookup"><span data-stu-id="c521f-122">Item size</span></span> | <span data-ttu-id="c521f-123">読み取り/秒</span><span class="sxs-lookup"><span data-stu-id="c521f-123">Reads/second</span></span> | <span data-ttu-id="c521f-124">書き込み数/秒</span><span class="sxs-lookup"><span data-stu-id="c521f-124">Writes/second</span></span> | <span data-ttu-id="c521f-125">要求ユニット</span><span class="sxs-lookup"><span data-stu-id="c521f-125">Request units</span></span>
| --- | --- | --- | --- |
| <span data-ttu-id="c521f-126">1 KB</span><span class="sxs-lookup"><span data-stu-id="c521f-126">1 KB</span></span> | <span data-ttu-id="c521f-127">500</span><span class="sxs-lookup"><span data-stu-id="c521f-127">500</span></span> | <span data-ttu-id="c521f-128">100</span><span class="sxs-lookup"><span data-stu-id="c521f-128">100</span></span> | <span data-ttu-id="c521f-129">(500 \* 1) + (100 \* 5) = 1,000 RU/秒</span><span class="sxs-lookup"><span data-stu-id="c521f-129">(500 \* 1) + (100 \* 5) = 1,000 RU/s</span></span>
| <span data-ttu-id="c521f-130">1 KB</span><span class="sxs-lookup"><span data-stu-id="c521f-130">1 KB</span></span> | <span data-ttu-id="c521f-131">500</span><span class="sxs-lookup"><span data-stu-id="c521f-131">500</span></span> | <span data-ttu-id="c521f-132">500</span><span class="sxs-lookup"><span data-stu-id="c521f-132">500</span></span> | <span data-ttu-id="c521f-133">(500 \* 1) + (500 \* 5) = 3,000 RU/秒</span><span class="sxs-lookup"><span data-stu-id="c521f-133">(500 \* 1) + (500 \* 5) = 3,000 RU/s</span></span>
| <span data-ttu-id="c521f-134">4 KB</span><span class="sxs-lookup"><span data-stu-id="c521f-134">4 KB</span></span> | <span data-ttu-id="c521f-135">500</span><span class="sxs-lookup"><span data-stu-id="c521f-135">500</span></span> | <span data-ttu-id="c521f-136">100</span><span class="sxs-lookup"><span data-stu-id="c521f-136">100</span></span> | <span data-ttu-id="c521f-137">(500 \* 1.3) + (100 \* 7) = 1,350 RU/秒</span><span class="sxs-lookup"><span data-stu-id="c521f-137">(500 \* 1.3) + (100 \* 7) = 1,350 RU/s</span></span>
| <span data-ttu-id="c521f-138">4 KB</span><span class="sxs-lookup"><span data-stu-id="c521f-138">4 KB</span></span> | <span data-ttu-id="c521f-139">500</span><span class="sxs-lookup"><span data-stu-id="c521f-139">500</span></span> | <span data-ttu-id="c521f-140">500</span><span class="sxs-lookup"><span data-stu-id="c521f-140">500</span></span> | <span data-ttu-id="c521f-141">(500 \* 1.3) + (500 \* 7) = 4,150 RU/秒</span><span class="sxs-lookup"><span data-stu-id="c521f-141">(500 \* 1.3) + (500 \* 7) = 4,150 RU/s</span></span>
| <span data-ttu-id="c521f-142">64 KB</span><span class="sxs-lookup"><span data-stu-id="c521f-142">64 KB</span></span> | <span data-ttu-id="c521f-143">500</span><span class="sxs-lookup"><span data-stu-id="c521f-143">500</span></span> | <span data-ttu-id="c521f-144">100</span><span class="sxs-lookup"><span data-stu-id="c521f-144">100</span></span> | <span data-ttu-id="c521f-145">(500 \* 10) + (100 \* 48) = 9,800 RU/秒</span><span class="sxs-lookup"><span data-stu-id="c521f-145">(500 \* 10) + (100 \* 48) = 9,800 RU/s</span></span>
| <span data-ttu-id="c521f-146">64 KB</span><span class="sxs-lookup"><span data-stu-id="c521f-146">64 KB</span></span> | <span data-ttu-id="c521f-147">500</span><span class="sxs-lookup"><span data-stu-id="c521f-147">500</span></span> | <span data-ttu-id="c521f-148">500</span><span class="sxs-lookup"><span data-stu-id="c521f-148">500</span></span> | <span data-ttu-id="c521f-149">(500 \* 10) + (500 \* 48) = 29,000 RU/秒</span><span class="sxs-lookup"><span data-stu-id="c521f-149">(500 \* 10) + (500 \* 48) = 29,000 RU/s</span></span>
 
<span data-ttu-id="c521f-150">ご覧のとおり、アイテムがより大きくなり、読み取り/書き込みが多くなるほど、受け取る必要がある要求ユニットが多くなります。</span><span class="sxs-lookup"><span data-stu-id="c521f-150">As you can see, the larger the item is, and the more reads and writes are required, the more request units you need to reserve.</span></span> <span data-ttu-id="c521f-151">アプリケーションのスループットのニーズを見積もる必要がある場合、Azure Cosmos DB [Capacity Planner](https://www.documentdb.com/capacityplanner) が、サンプルの JSON ドキュメントをアップロードし、1 秒あたりに完了する必要がある操作の数を設定できるようにするオンライン ツールです。</span><span class="sxs-lookup"><span data-stu-id="c521f-151">If you need to estimate the throughput needs of an application, the Azure Cosmos DB [Capacity Planner](https://www.documentdb.com/capacityplanner) is an online tool that enables you to upload a sample JSON document and set the number of operations you need to complete per second.</span></span> <span data-ttu-id="c521f-152">これによって、予約する推定される合計が示されます。</span><span class="sxs-lookup"><span data-stu-id="c521f-152">It then provides an estimated total to reserve.</span></span>

## <a name="exceeding-throughput-limits"></a><span data-ttu-id="c521f-153">スループット上限の超過</span><span class="sxs-lookup"><span data-stu-id="c521f-153">Exceeding throughput limits</span></span>

<span data-ttu-id="c521f-154">十分な要求ユニットを予約せずに、プロビジョニングしたスループットで許可されるよりも多くデータの読み取り/書き込みを試行する場合は、お客様の要求の使用回数が制限されます。</span><span class="sxs-lookup"><span data-stu-id="c521f-154">If you don’t reserve enough request units, and you attempt to read or write more data than your provisioned throughput allows, your request will be rate-limited.</span></span> <span data-ttu-id="c521f-155">要求の使用回数が制限された場合、指定した間隔後にもう一度要求を再試行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c521f-155">When a request is rate-limited, the request has to be retried again after a specified interval.</span></span> <span data-ttu-id="c521f-156">.NET SDK を使用する場合は、ヘッダーの後の再試行で指定した時間を待機してから要求は自動的に再試行されます。</span><span class="sxs-lookup"><span data-stu-id="c521f-156">If you use the .NET SDK, the request will be retried automatically after waiting the amount of time specified in the retry-after header.</span></span>

## <a name="creating-an-account-built-to-scale"></a><span data-ttu-id="c521f-157">スケーリングするためのアカウントを作成する</span><span class="sxs-lookup"><span data-stu-id="c521f-157">Creating an account built to scale</span></span>

<span data-ttu-id="c521f-158">いつでもデータベースにプロビジョニングされた要求ユニット数を変更できます。</span><span class="sxs-lookup"><span data-stu-id="c521f-158">You can change the number of request units provisioned to a database at any time.</span></span> <span data-ttu-id="c521f-159">そのため、大量の処理が発生する期間中はスケールアップして多くの要求に対応し、ピーク時以外はプロビジョニングされたスループットを削減してコストを節約することができます。</span><span class="sxs-lookup"><span data-stu-id="c521f-159">So, during heavy volume periods, you can scale up to accommodate those high demands, and then reduce provisioned throughput during off peak times to reduce costs.</span></span>

<span data-ttu-id="c521f-160">アカウントを作成すると、ポータルで最小値で 400 RU/秒、または最大値で 250,000 RU/秒をプロビジョニングできます。</span><span class="sxs-lookup"><span data-stu-id="c521f-160">When you create an account, you can provision a minimum of 400 RU/s, or a maximum of 250,000 RU/s in the portal.</span></span> <span data-ttu-id="c521f-161">さらにスループットが必要な場合は、Azure portal でチケットを入力します。</span><span class="sxs-lookup"><span data-stu-id="c521f-161">If you need even more throughput, fill out a ticket in the Azure portal.</span></span> <span data-ttu-id="c521f-162">ほぼすべてのアカウントにおいて、最初のスループットを 1000 RU/秒に設定することをお勧めします。10 GB を超えるストレージが必要な場合、実際にはこれがデータベースのサイズに自動設定される最小値になります。</span><span class="sxs-lookup"><span data-stu-id="c521f-162">Setting the initial throughput to 1000 RU/s is recommended for almost all accounts, as it is the minimum value in which your database will autoscale should you need more than 10 GB of storage.</span></span> <span data-ttu-id="c521f-163">最初のスループットを 1000 RU/秒より小さい値に設定した場合は、データベースをプロビジョニングして、パーティション キーを指定しない限り、データベースを 10 GB より大きくスケーリングすることはできません。</span><span class="sxs-lookup"><span data-stu-id="c521f-163">If you set the initial throughput to any value less than 1000 RU/s, your database will not be able to scale to larger than 10 GB unless you reprovision the database and provide a partition key.</span></span> <span data-ttu-id="c521f-164">パーティション キーでは、Azure Cosmos DB 内のデータをすばやく参照することができ、必要なときにデータベースのサイズを自動設定できます。</span><span class="sxs-lookup"><span data-stu-id="c521f-164">Partition keys enable quick lookup of data in Azure Cosmos DB and enable it to autoscale your database when needed.</span></span> <span data-ttu-id="c521f-165">パーティション キーは次のユニットで説明されます。</span><span class="sxs-lookup"><span data-stu-id="c521f-165">Partition keys are discussed in the next unit.</span></span>

## <a name="summary"></a><span data-ttu-id="c521f-166">まとめ</span><span class="sxs-lookup"><span data-stu-id="c521f-166">Summary</span></span>

<span data-ttu-id="c521f-167">要求ユニットを使用して Azure Cosmos DB に対するスループットの見積もりと絞り込みを行う方法について理解しました。</span><span class="sxs-lookup"><span data-stu-id="c521f-167">You now understand how to estimate and scope throughput for an Azure Cosmos DB using request units.</span></span> <span data-ttu-id="c521f-168">要求ユニットはいつでも変更することができ、アカウントを作成するときに 1000 RU/秒に設定すると、後でデータベースをスケーリングする準備ができたことを確認するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="c521f-168">Request units can be modified at any time, and setting them to 1000 RU/s when you create an account helps ensure your database is ready to scale later.</span></span>