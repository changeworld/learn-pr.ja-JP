サーバーには、日々の要求を処理できるだけのリソースが必要です。 VM の作成時には、標準的なワークロードに必要なサイズを選択しておき、要求量に変化があったときにサイズを変更するのが一般的な戦略です。

玩具企業のシナリオで、中期的な成長に合わせてリソースを管理したければ、この戦略が効果的でしょう。 VM のサイズを大きくすることで、事業の拡大に伴う要求量の増加に対応することができます。

## <a name="what-is-virtual-machine-size"></a>仮想マシンのサイズとは

仮想マシンの "_サイズ_" とは、その CPU とメモリ、ディスク、想定されているネットワーク帯域幅の尺度です。 仮想マシンは、あらかじめ決められたサイズ値で提供されます。 たとえば、**Standard_F32s_v2** サイズは、仮想 CPU が 32 個、メモリが 64 GiB、ローカル SSD が 256 GiB、見込まれるネットワーク帯域幅が 14,000 Mbps となっています。

Azure で新しい仮想マシンを作成するときは、サイズを選択する必要があります。 サイズが大きくなるほど、コストも大きくなります。 必要以上の処理能力を構成することなく、実際のワークロードを処理できるサイズを選ぶことが理想です。

## <a name="what-is-virtual-machine-type"></a>仮想マシンのタイプとは

仮想マシンの "_タイプ_" とは、その VM の最適化の対象となったワークロードです。 たとえば、Web サーバーのホスティングなど、CPU 負荷の高いタスクを対象とした VM があります。 一方、データベースの実行など、ストレージが重視されるジョブを意図したものも存在します。

**計算**、**メモリ**、**ストレージ**、**GPU** など、今日のコンピューターの核となるハードウェア コンポーネントごとに、対応する "_タイプ_" が存在します。 バランスのとれたリソースの組み合わせが必要な場合のために、**汎用**タイプも存在します。 次の表は、それぞれのタイプと、そのタイプに該当する VM サイズの一覧です。対象のワークロードについての簡単な説明も記載されています。

|タイプ|サイズ|説明|
|---|---|---|
|汎用|B、Ds_v3、D_v3、DS_v2 (一部)、D_v2、A_v2 (一部)|汎用マシンは、CPU とメモリのバランスの取れた比率を提供します。 汎用マシンは、テスト用サーバーや開発サーバーに適しているほか、小から中規模のデータベース、そして低から中程度のトラフィックの Web サーバーにも適しています。|
|コンピューティング最適化|Fs_v2、Fs、F|コンピューティング最適化仮想マシンは、汎用マシンよりも高い CPU 対メモリ比を備えています。アプリケーション サーバー、ネットワーク アプライアンス、中程度のトラフィックの Web サーバーなど、追加の処理能力を必要とするタスクが対象です。|
|メモリ最適化|Es_v3、E_v3、M、GS、G、DS_v2 (一部)、D_v2 (一部)|メモリ最適化仮想マシンは、高いメモリ対 CPU 比を備えています。 これらのマシンは、リレーショナル データベース サーバーや、キャッシュを大量に必要とする (または頻繁にキャッシュを実行する) サーバー、インメモリ分析を実行するサーバーに適しています。|
|ストレージ最適化|Ls|これらの仮想マシンは、ディスク スループットが高く IO が大きい操作を想定して構成され、ビッグ データや SQL、NoSQL データベースに適しています。|
|GPU|NV、NC、NC_v2、NC_v3、ND|GPU 仮想マシンは、負荷の高いグラフィックのレンダリングやビデオ編集、ディープ ラーニングを使用したモデル トレーニングと推論 (ND シリーズ) などのタスクに特化されています。 これらのマシンでは、単一の GPU または複数の GPU を選択できます。|
|ハイ パフォーマンス コンピューティング|H|これらの仮想マシンには、最も高速かつ強力な CPU が備わっています。 高スループットのネットワーク インターフェイス (RDMA) を追加することもできます。|

## <a name="clusters"></a>クラスター

Azure のリージョンでは、物理サーバーのハードウェアがクラスターにグループ化されています。 それぞれのクラスターは、物理ハードウェアに応じて、いくつかの異なる仮想マシン サイズをサポートします。

仮想マシンを作成して特定のサイズを選択すると、そのサイズの適切なハードウェア クラスターに仮想マシンがプロビジョニングされます。 仮想マシンは作成後にサイズを変更できますが、初期サイズに選んだハードウェア クラスターによってサイズ変更の選択肢が制限されることがあります。

## <a name="what-is-vertical-scaling"></a>垂直方向のスケーリングとは

"_垂直スケーリング_" とは、仮想マシンの "_サイズ_" を変更するプロセスです。 要求の量の増加に対応するには、より大きなサイズを選んで "_スケールアップ_" し、割り当てリソースを減らしてコストを削減するには "_スケールダウン_" します。 次の図は、仮想マシンのサイズ変更の例を示しています。

![パフォーマンス機能を変更するための、仮想マシンのスケールアップおよびスケールダウンを示す図。](../media/2-ScaleUpDown.png)

VM のサイズは、Azure portal、Azure PowerShell、Azure コマンド ライン インターフェイス (CLI) のいずれかを使って変更できます。

### <a name="resize-in-the-portal"></a>ポータルを使用してサイズを変更する

Azure portal で仮想マシンのサイズを変更するには、目的の仮想マシンを選択し、**[サイズ]** エントリをクリックして、**[サイズの選択]** ブレードからいずれかのエントリを選択します。 

その時点で仮想マシンを実行中である場合、選択可能なサイズは、ご利用のリージョンで提供されているサイズによって異なります。 表示されるのは、現在仮想マシンが実行されているハードウェア クラスターと互換性があるサイズ変更オプション ("*サイズ ファミリー*" と呼ばれることもあります) だけです。 仮想マシンの実行中に新しいサイズを選択した場合、VM が自動的に再起動されて新しいサイズが適用されます。

仮想マシンの実行中、目的のサイズがポータルに表示されない場合、仮想マシンをシャットダウンすると、他の選択肢が表示されます。 マシンの状態が "**停止済み (割り当て解除)**" であるときは、同じリージョン内の他のハードウェアのサイズを選ぶことができます。

### <a name="resize-with-powershell"></a>PowerShell を使用してサイズを変更する

PowerShell を使用すると、垂直スケーリングを対話形式またはスクリプトで実行することができます。 スクリプトは、複数の VM のサイズを一度に変更する必要がある場合など、複雑なシナリオに適しています。 また、ユーザーの中断を避けて非稼働時間帯にサイズ変更を実行する場合にも便利です。

次のコマンドレットは、現在のハードウェアと同じサイズ ファミリーの VM サイズを一覧表示しています。

```PowerShell
Get-AzureRmVMSize -ResourceGroupName "myResourceGroup" -VMName "MyVM"
```

目的のサイズが表示された場合は、次のコマンドレットを使用して仮想マシンのサイズを変更します。

```PowerShell
$vm = Get-AzureRmVM -ResourceGroupName "myResourceGroup" -VMName "MyVM"
$vm.HardwareProfile.VmSize = "<newVMsize>"
Update-AzureRmVM -VM $vm -ResourceGroupName "myResourceGroup"
```

マシンを実行した状態で目的のサイズが表示されない場合は、次のコマンドを使用して仮想マシンの割り当てを解除し、マシンのサイズを変更してから、再度マシンを起動してください。

```PowerShell
Stop-AzureRmVM -ResourceGroupName "myResourceGroup" -Name "MyVM" -Force
$vm = Get-AzureRmVM -ResourceGroupName "myResourceGroup" -VMName "MyVM"
$vm.HardwareProfile.VmSize = "<newVMSize>"
Update-AzureRmVM -VM $vm -ResourceGroupName "myResourceGroup"
Start-AzureRmVM -ResourceGroupName "myResourceGroup" -Name "MyVM"
```

Azure の仮想マシンは、パフォーマンスを向上させたりコストを削減したりする目的で、必要に応じてサイズを変更できます。 事業の拡大に段階的に対応する場合や、要求量の変化について事前に把握しているときは、ポータルまたはスクリプトを使った手動でのサイズ変更が適しています。 玩具企業のシナリオであれば、商戦シーズンの前にスケールアップして要求量の急増に対応し、その後、スケールダウンすることが考えられます。