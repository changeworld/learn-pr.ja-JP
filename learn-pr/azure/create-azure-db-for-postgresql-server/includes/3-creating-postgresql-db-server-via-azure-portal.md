柔軟なデータ型および地理空間のサポートによるオンプレミスの PostgreSQL リレーショナル データベースを現在使用しているとします。 会社はデータベースをスケーリングする必要があり、拡張を考えています。 追加のハードウェアに投資する代わりに、あなたは最適なクラウド ホスト型データベース サービスを探す任務を負い、Azure Database for PostgreSQL サーバーを使用することに決めました。

## <a name="what-is-an-azure-database-for-postgresql-server"></a>Azure Database for PostgreSQL サーバーとは

PostgreSQL サーバーは、1 つ以上のデータベースの中央管理ポイントです。 Azure の PostgreSQL サービスは、パフォーマンスを保証する管理対象リソースであり、アクセスと機能をサーバー レベルで提供します。

**Azure Database for PostgreSQL** サーバーは、データベースの親_リソース_です。 _リソース_は、Azure を通じて管理できる要素です。 このリソースを作成すると、サーバー インスタンスを構成できます。

### <a name="what-is-an-azure-database-for-postgresql-server-resource"></a>Azure Database for PostgreSQL サーバー リソースとは

Azure Database for PostgreSQL サーバー リソースは、その存続期間を通してサーバーとデータベースに強力な影響を与えるコンテナーです。 サーバー リソースが削除されると、データベースもすべて削除されます。 親に属しているすべてのリソースが同じリージョンでホストされていることに留意してください。

サーバー リソース名は、サーバー エンドポイント名の定義に使用されます。 たとえば、リソース名が **mypgsqlserver** の場合、サーバー名は **mypgsqlserver.postgres.database.azure.com** になります。

また、サーバー リソースは、データベースに適用される管理ポリシーの__接続スコープ__も提供します。 たとえば、ログイン、ファイアウォール、ユーザー、ロール、構成などです。

PostgreSQL のオープン ソース バージョンと同様に、このサーバーはいくつかのバージョンが用意されていて、拡張機能のインストールが可能です。 インストールするサーバー バージョンを選択します。

> [!NOTE]
> 拡張機能により、複数の SQL オブジェクトを 1 つのパッケージにまとめて、1 つのコマンドで読み込んだり削除したりすることができます。 拡張機能の例としては、自動暗号化パスワードのデータ型を提供する ```chkpass``` があります。

## <a name="pricing-tiers"></a>価格レベル

Azure Database for PostgreSQL では、コンピューティング能力やストレージなどのパラメーターに基づいて 3 つの価格レベルから選択できます。

### <a name="basic"></a>Basic

**Basic** レベルは、低負荷なコンピューティングと I/O パフォーマンスを必要とするワークロードに最適です。 このレベルでは、次のハードウェアにアクセスできます。

- 1 つまたは 2 つの仮想コアの構成が可能な 2673-Intel E5 v3 (Haswell) 2.4 GHz プロセッサを基盤とする、Gen 4 コンピューティング CPU
- 1 つまたは 2 つの仮想コアの構成が可能な Intel E5-2673 v4 (Broadwell) 2.3-GHz プロセッサを基盤とする、Gen 5 コンピューティング CPU
- 1 TB までのストレージ
- ローカル冗長バックアップ

後でサンプル サーバーを作成するときに、特定のシナリオのサポートを示すために特定の価格レベル設定を使用します。 ただし、運用サーバーでは環境に合わせて価格レベルを選択します。

### <a name="general-purpose"></a>汎用

**汎用**レベルは、負荷分散されたコンピューティング、メモリ、スケーラブルな I/O スループットを必要とする大部分のビジネス ワークロードに最適です。 このレベルでは、次のハードウェアにアクセスできます。

- 2、4、8、18、32 個の仮想コアの構成が可能な 2673-Intel E5 v3 (Haswell) 2.4 GHz プロセッサを基盤とする、Gen 4 コンピューティング CPU
- 2、4、8、18、32 個の仮想コアの構成が可能な Intel E5-2673 v4 (Broadwell) 2.3-GHz プロセッサを基盤とする、Gen 5 コンピューティング CPU
- 4 TB までのストレージ
- ローカル冗長バックアップ
- 地理冗長バックアップ

### <a name="memory-optimized"></a>メモリ最適化

**メモリ最適化**レベルは、高速トランザクション処理と高い同時実行性を実現するためのインメモリ パフォーマンスを必要とする、高パフォーマンス データベース ワークロードに最適です。 このレベルでは、次のハードウェアにアクセスできます。

- 2、4、8、16 個の仮想コアの構成が可能な Intel E5-2673 v4 (Broadwell) 2.3-GHz プロセッサを基盤とする、Gen 5 コンピューティング CPU
- 4 TB までのストレージ
- ローカル冗長バックアップ
- 地理冗長バックアップ

## <a name="steps-to-create-an-azure-database-for-postgresql-server"></a>Azure Database for PostgreSQL サーバーを作成する手順

通常、Azure Database for PostgreSQL サーバーは Azure portal を使用して作成します。 それぞれの手順を見ていきましょう。

まず Azure portal にサインインし、**[リソースの作成]** をクリックします。

**[データベース]** と **[Azure Database for PostgreSQL]** を選択します。 検索機能を使用してこのカテゴリを検索することもできます。

ポータルに、ブレードとも呼ばれる PostgreSQL サーバー構成画面が表示されるので、ここで選択を行います。

![Azure portal での PostgreSQL サーバー作成用のユーザー インターフェイス ブレード](../media-draft/4-create-blade.png)

ブレード内のすべての項目に値を指定する必要があります。では、それぞれ見ていきましょう。

### <a name="server-name"></a>サーバー名

先ほど、サーバー リソースを作成することに言及しました。 サーバー名は、このリソースを指定する項目です。 そのため、サーバーには一意の名前を選択する必要があります。 サーバー名はすべて小文字とする必要があり、数字とハイフンを含めることができます。

たとえば、サーバーに _Adventure Works Tracking_ という名前を付けるとします。 その場合は、名前を ```adventure-works-tracking``` に設定します。 既に存在する名前と同じ名前のサーバーを作成しようとすると、それに対応するエラーが表示されます。

### <a name="subscription"></a>サブスクリプション

サブスクリプション フィールドは課金に使用します。 使用可能なサブスクリプションが複数ある場合は、特定のサブスクリプションを選択します。

### <a name="resource-group"></a>リソース グループ

リソース グループは、サーバーに関連するすべてのリソースを管理するために使用します。 新しいリソース グループを作成するか、既存のリソース グループを再使用できます。

### <a name="source"></a>ソース

既定の _[空白]_ オプションを選択してサーバーを最初から作成するか、または既存のバックアップから作成することができます。 [バックアップ] オプションでは、既存の Azure Database for PostgreSQL サーバーの geo バックアップを復元できます。

### <a name="server-admin-login-name"></a>サーバー管理者ログイン名

サーバー管理者ユーザーを作成します。 新しいサーバー用の管理者ログインとして使用するログイン名を選択します。 管理者のログイン名に azure_superuser、azure_pg_admin、admin、administrator、root、guest、または public は使用できません。 pg_ で始めることはできません。 今後の使用に備えてこの名前を覚えておくか、書き留めておきます。

### <a name="password"></a>パスワード

上記の管理者ログイン名と一緒に使用するパスワードを選択します。 パスワードには、英大文字、英小文字、数字 (0 から 9)、英数字以外の文字 (!、$、#、% など) のうち、3 種類の文字が含まれている必要があります。 今後の使用に備えてこのパスワードを覚えておくか、書き留めておきます。

### <a name="confirm-password"></a>パスワードの確認

確認のためにパスワードを再入力します。

### <a name="location"></a>場所

場所のオプションを使用すると、サーバーが物理的に作成される場所を指定できます。 自分が住んでいる場所に最も近い地域を選択します。 実際のシナリオでは、大部分のユーザーに最も近い場所にする必要があります。

### <a name="version"></a>バージョン

使用する PostgreSQL のバージョンを指定できます。 Microsoft では、基本的には PostgreSQL の現在のバージョンとそれより前の 2 つのバージョンがサポートされています。 運用環境に一致するバージョンを選択します。

> [!NOTE]
> 詳細については、次の資料を参照してください。
> - [サポートされている PostgreSQL Database バージョン](https://docs.microsoft.com/azure/postgresql/concepts-supported-versions)
> - [Versioning Policy (バージョン管理ポリシー)](https://www.postgresql.org/support/versioning/)

### <a name="pricing-tier"></a>価格レベル

サーバーのワークロードをサポートする価格レベルを選択します。 選択できるレベルは 3 つあります。 前述のように、これらの各レベルを使用して、コンピューティングとストレージのオプションを構成できます。 ここでは、Basic 価格レベルが選択されていて、Gen 5 コンピューティングを使用し、バックアップ保有期間が 25 日である例が示されています。

![価格レベル](../media-draft/4-azure-db-pricing-tier.png)

あとは、入力した値を確認し、後で必要となる可能性のあるすべての項目を書き留め、作成ボタンをクリックしてサーバーを作成するだけです。

サーバーをデプロイするには数分かかります。 デプロイが完了すると、通知を受け取ります。 通知から、新しく作成したサーバーに移動できます。

ここまでは、Azure Database for PostgreSQL を作成する手順を説明しました。 次の演習では、独自の Azure Database for PostgreSQL サーバーを作成してみます。
