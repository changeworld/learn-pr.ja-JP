アプリケーションに必要なクライアント ライブラリを追加し、Azure ストレージ アカウントに接続する準備が整いました。

ストレージ アカウント内のデータを使用するには、アプリは 2 つのデータ必要があります。

1. アクセス キー
1. REST API エンドポイント

## <a name="security-access-keys"></a>セキュリティのアクセス キー

各ストレージ アカウントに一意の 2 つ_アクセス キー_ストレージ アカウントをセキュリティ保護に使用します。 を、アプリが複数のストレージ アカウントに接続する必要がある場合、アプリが必要になりますアクセス キーの各ストレージ アカウント。

![アプリケーションの図解は、クラウド内の 2 つの異なるストレージ アカウントに接続します。 各ストレージ アカウントは一意のキーを使用してアクセスできます。](..\media\6-multiple-accounts.png)

## <a name="rest-api-endpoint"></a>REST API エンドポイント

ストレージ アカウントへの認証、アクセス キーだけでなく、アプリは、REST 要求を発行するストレージ サービス エンドポイントを把握する必要があります。 

REST エンドポイントでは、ストレージ アカウントの組み合わせ_名前_データ型、および既知のドメイン。 例:

| データ型 | たとえば、エンドポイント |
|-----------|------------------|
| BLOB     | `https://[name].blob.core.windows.net/` |
| キュー    | `https://[name].queue.core.windows.net/` |
| テーブル     | `https://[name].table.core.windows.net/` |
| ファイル     | `https://[name].file.core.windows.net/` |

Azure に関連付けられているカスタム ドメインがあれば、エンドポイントのカスタム ドメイン URL も作成できます。

## <a name="connection-strings"></a>Connection strings

この情報を処理する最も簡単な方法が使用するには、**ストレージ アカウント接続文字列**します。 接続文字列は、必要なすべての 1 つのテキスト文字列で接続情報を提供します。

Azure Storage 接続文字列は、下の例と類似していますが、ご利用の特定のストレージ アカウントのアクセス キーとアカウント名が使用されたものである必要があります。

```
DefaultEndpointsProtocol=https;AccountName={your-storage};
   AccountKey={your-access-key};
   EndpointSuffix=core.windows.net
```

## <a name="security"></a>セキュリティ

アクセス キーは、ストレージ アカウントにアクセスするために重要で、ストレージ アカウントにアクセスを許可したくないシステムまたはユーザーには知らせないようにする必要があります。 アクセス キーは、コンピューターにアクセスするためのユーザー名とパスワードと同じです。

通常、ストレージ アカウントの接続情報は、環境変数、データベース、または構成ファイルに格納されます。

> [!IMPORTANT]
> この情報を格納する構成ファイルでは危険なソース管理にそのファイルを含めるし、パブリック リポジトリに格納する場合に重要です。 これはよく行われる間違いで、パブリック リポジトリにあるソース コードのストレージ アカウントの接続情報は、すべてのユーザーが参照できてしまいます。

各ストレージ アカウントには、アクセス キーが 2 つあります。 これは、ストレージ アカウントを安全に保つためのセキュリティ上のベスト プラクティスとして、キーを定期的にローテーション (再生成) するためです。 このプロセスは、Azure portal または Azure CLI から実行できる PowerShell コマンド ライン ツール。

キーをローテーションすると元のキー値が即座に無効になり、キーを不正に取得したユーザーのアクセスが取り消されます。 2 つのキーがサポートされているため、キーのローテーション時に、キーを使用するアプリケーションでダウンタイムが発生しないようにできます。 その他のキーが再生成中に、代替アクセス キーを使用するアプリを切り替えることができます。 このストレージ アカウントを使用するアプリが複数ある場合、このテクニックを使用するために、すべてで同じキーを使用するようにする必要があります。 基本的な考え方を次に示します。

1. ストレージ アカウントのセカンダリ アクセス キーを参照するようにアプリケーション コードの接続文字列を更新します。
2. Azure ポータルまたはコマンド ライン ツールを使用して、ストレージ アカウントのプライマリ アクセス キーを再生成します。
3. 新しいプライマリ アクセス キーを参照するようにアプリケーション コードの接続文字列を更新します。
4. 同様に、セカンダリ アクセス キーを再生成します。

> [!TIP]
> パスワードを変更すると同じように、プライバシーが保たれるように、アクセス キーを定期的にローテーションすることを強くお勧めします。 サーバー アプリケーションでキーを使用する場合は、使用、 **Azure Key Vault**のアクセス キーを格納します。 Key Vault には、ストレージ アカウントに直接同期し、自動的にキーを定期的にローテーションのサポートが含まれます。 Key Vault を使用して、アプリは、アクセス キーを直接操作することはありませんがある、セキュリティの追加の層を提供します。

### <a name="shared-access-signatures-sas"></a>Shared Access Signatures (SAS)

アクセス キーは、ストレージ アカウントへのアクセスを認証する最も簡単な方法です。 ただし、コンピューターのルート パスワードのようなストレージ アカウント内のあらゆるものへのフル アクセスを提供します。

ストレージ アカウントと呼ばれる別の認証メカニズムには、 _shared access signature_制限付きアクセスを付与する必要があるシナリオの有効期限とアクセス許可が制限をサポートします。 ストレージ アカウントにデータを読み書きする他のユーザーを許可しているときに、この方法を使用する必要があります。 モジュールの最後にこの高度なトピックに関するドキュメントへのリンクがあります。
