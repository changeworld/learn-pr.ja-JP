クラウド プラットフォーム上でアプリケーションをホストすることで、従来のオンプレミス デプロイと比べて、多くの利点が得られます。 クラウドの共同責任モデルでは、クラウド プロバイダーの管理下にある物理ネットワーク、ビルドおよびホスト レベルでセキュリティを移行します。 このレベルでプラットフォームを侵害しようとする攻撃者は、収穫逓減と、プロバイダーによるインフラストラクチャの保護と監視に関する多額の投資と分析情報を比較します。

したがって、クラウド プラットフォームのお客様が発生させたアプリケーション レベルでの脆弱性を追求する攻撃者にとってははるかに効率的です。 さらに、アプリケーションをホストするサービスとしてのプラットフォーム (PaaS) を導入することで、お客様はオペレーティング システム セキュリティの管理からリソースを解放し、リソースをデプロイしてアプリケーション コードを強化し、アプリケーションの周囲の ID 境界を監視できます。 このユニットでは、設計によりアプリケーション セキュリティを強化できる方法をいくつか説明します。

## <a name="scenario"></a>シナリオ

Lamna Healthcare のお客様は、オンライン Web ポータルから個人の医療記録にアクセスする必要があります。 Health Insurance Portability and Accountability Act (HIPAA) の準拠は必須です。個人データの漏えいが発生した場合、会社に罰金が課せられる危険性が高いため、アプリケーションと、アプリケーションでやりとりされる個人データをセキュリティで保護することが重要です。

お客様のアプリケーションに関連する主な領域は次のとおりです。

- セキュリティで保護されたアプリケーションの設計
- データのセキュリティ
- ID 管理とアクセス管理
- エンドポイントのセキュリティ

## <a name="security-development-lifecycle"></a>セキュリティ開発ライフサイクル

Microsoft の[セキュリティ開発ライフサイクル](https://www.microsoft.com/sdl) (SDL) プロセスをアプリケーションの設計段階で使用することで、確実にソフトウェア開発ライフサイクルにセキュリティに関する懸念事項を組み込むことができます。 セキュリティとコンプライアンスの問題は、アプリケーションの設計時に対処するほうがはるかに簡単であり、最終製品のセキュリティの欠陥につながる可能性のある多くの一般的なエラーを減らすことができます。 ソフトウェア開発の早い段階で問題を解決することで、コストははるかに低くなります。 ソフトウェア プロジェクトで使用できる SDL の一般的な一連の手順は次のとおりです。

1. トレーニング

    - コア セキュリティのトレーニング

1. 要件

    - 要件と品質ゲートを定義する
    - セキュリティおよびプライバシー リスクを分析する
 
1. 設計

    - 攻撃対象領域の分析
    - 脅威モデリング
 
1. 実装

    - コードの品質を測定できることを確認するためのツールを指定する
    - 禁止されている API と関数を適用する
    - スタティック コード分析を実行する
    - リポジトリをスキャンして格納されたシークレットを調べる
 
1. 検証

    - 動的/ファジー テスト
    - 脅威モデル/攻撃対象領域を検証する
 
1. 解放

    - セキュリティ対応計画を立てる
    - 最終的なセキュリティ レビューを行う
    - アーカイブの解放
 
1. 対応 

    - 脅威に対応する

![セキュリティ開発ライフサイクル](../media/sdl.png)

SDL は、ツールのセットやプロセスであると同時に文化的側面もあります。 セキュリティがアプリケーション開発の主な焦点および要件であるという文化を築くことで、セキュリティに関する組織の能力を高めることに大きく前進できます。

<!-- Bear in mind that the migration of un-modified applications (especially COTS procured software systems) will not be able to perform many of the steps listed above.
 -->

## <a name="operational-security-assessment"></a>運用上のセキュリティの評価

アプリケーションがデプロイされた後、そのセキュリティに対する姿勢を継続的に評価し、検出された問題を軽減する方法を決定し、知識をソフトウェア開発サイクルにフィードバックすることが重要です。 これが実行される深さは、データのプライバシー要件と、ソフトウェア開発および運用チームの成熟度レベルの要因となります。

セキュリティの脆弱性をスキャンするソフトウェア サービスは、このプロセスを自動化し、侵入テストなど、コストのかかる手動プロセスでチームに負担をかけることなく、一定のリズムでセキュリティに関する懸念事項を評価するのに役立ちます。

Azure Security Center は無料のサービスであり、すべての Azure サブスクリプションに対して既定で有効になるようになりました。Azure Application Gateway や Azure Web アプリケーション ファイアウォールなどの他の Azure アプリケーション レベルのサービスと緊密に統合されています。 これらのサービスからのログを分析することで、ASC ではリアルタイムで既知の脆弱性をレポートし、脆弱性を減らすための対応を推奨でき、攻撃の対応でプレイブックを自動的に実行するように構成することもできます。

<!-- SDL culture
Key Vault / MSI
CSE = App  -> DB & App Storage
Mention approach of code scanning & SDL
Scanning for passwords - Git
 -->

## <a name="identity-as-the-perimeter"></a>境界としての ID

ID 検証は、アプリケーションに関する防御の最前線になりつつあります。 セッションを認証して承認し、Web アプリケーションへのアクセスを制限することで、攻撃対象領域を大幅に減らすことができます。 Azure AD と Azure AD B2C では、ID の責任を軽減し、フル マネージドのサービスにアクセスする効果的な方法が提供されます。 Azure AD の条件付きアクセス ポリシー、Privileged Identity Management および Identity Protection 制御により、お客様はさらに効率的に未承認のアクセスを防ぎ、変更を監視できるようになります。

## <a name="data-protection"></a>データ保護

顧客データは、Web アプリケーションに対するほぼすべての攻撃の対象となります。 アプリケーションとそのデータ ストレージ層の間のデータの保管と転送をセキュリティで保護することが重要です。

Lamna Healthcare では、特に機密性の高い患者の医療記録データを格納し、このデータにアクセスしています。 特に、1996 年に米国議会で制定された HIPAA では、医療機関や雇用主による電子医療記録のトランザクションに関する国家規格が定義されています。 Lamna では、患者と承認された関係者 (医師など) が医療データに安全にアクセスできるようにする必要があります。

これらの要件を満たすために、Lamna Healthcare ではアプリケーションを変更し、保存時および転送中のすべての患者のデータを暗号化するようにしました。 たとえば、Web アプリケーションとバックエンドの SQL データベースの間で交換されるデータを暗号化するためにトランスポート層セキュリティ (TLS) が使用されます。 SQL Server に保存されているデータも透過的なデータ暗号化 (TDE) を使用して暗号化されます。そのため、環境が侵害された場合でも、正しい復号化キーがないと誰もデータを効果的に使用することはできません。

BLOB ストレージに格納されているデータを暗号化する場合、クライアント側の暗号化を使用してメモリ内のデータを暗号化してから、ストレージ サービスに書き込むことができます。 この暗号化がサポートされているライブラリを .NET、Java、および Python で利用でき、データの暗号化をアプリケーションに直接統合してデータの整合性を高めることができます。

### <a name="secure-key-and-secret-storage"></a>キーとシークレットのストレージをセキュリティで保護する

アプリケーション シークレット (接続文字列やパスワードなど) と暗号化キーを、データにアクセスするために使用するアプリケーションから分離させることが重要です。 暗号化キーとアプリケーション シークレットを構成ファイルのアプリケーション コードに格納しないでください。 代わりに、Azure Key Vault などの安全なストアを使用してください。 そうすれば、マネージド サービス ID を使用してこの機密データへのアクセスをアプリケーション ID に制限することができ、キーを定期的に交換し、暗号化キーが漏えいした場合に露出を制限することができます。 お客様はオンプレミスのハードウェア セキュリティ モジュール (HSM) によって生成された独自の暗号化キーを使用し、Azure Key Vault インスタンスが必ず単一テナントの個別の HSM に実装されるようにすることもできます。

<!-- ### Secure and immutable file storage

All Azure storage accounts are encrypted by default using Microsoft managed keys. Azure customers also have the ability to use their own encryption keys (BYOK) to encrypt blob, file and queue data so that even the hosting provider has no access to unencrypted data. Data immutability is often required for auditing purposes or when legal disputes call for data to be effectively frozen for a determined amount of time. Azure has recently introduced an [immutable data storage](https://docs.microsoft.com/azure/storage/blobs/storage-blob-immutable-storage) option known as Write-Once, Read many (WORM) for this scenario. -->
