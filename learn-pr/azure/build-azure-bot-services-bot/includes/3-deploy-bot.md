### <a name="exercise-3-deploy-a-bot-with-visual-studio-code"></a>演習 3: Visual Studio Code を使用してボットをデプロイする

[演習 1](#Exercise1) で Azure Web アプリ ボットを作成したときに、それをホストするために Azure Web アプリがデプロイされました。 しかしボットにはいくつかのコードが必要で、それも Azure Web アプリにデプロイする必要があります。 さいわい、コードは Azure Bot Service によって生成されています。 この演習では、Visual Studio Code を使用してそのコードをローカル Git リポジトリに配置して、ローカル リポジトリからボットをホストする Azure Web アプリに接続されているリモート リポジトリに変更をプッシュして、ボットを Azure に発行します ([継続的インテグレーション](https://en.wikipedia.org/wiki/Continuous_integration)として知られるプロセス)。

1. ご使用の PC に [Git](https://git-scm.com/) がインストールされていない場合は、 https://git-scm.com/downloads に移動して、ご使用のオペレーティング システムの Git クライアントをインストールします。 Git は無料のオープン ソースの分散バージョン管理システムで、Visual Studio Code にシームレスに統合されます。 Git がインストールされているかどうかが不明な場合は、コマンド プロンプトまたはターミナル ウィンドウを開き、次のコマンドを実行します。

    ``` 
    git --version
    ```

    バージョン番号が表示された場合は、Git クライアントがインストールされています。

1. ご使用の PC に Node.js がインストールされていない場合は、 https://nodejs.org/ に移動して最新の LTS バージョンをインストールします。 Node がインストールされているかどうかを判断するには、コマンド プロンプトまたはターミナル ウィンドウを開き、次のコマンドを入力します。

    ```
    node --version
    ```

    Node がインストールされている場合は、バージョン番号が表示されます。

1. ご使用の PC に Visual Studio Code がインストールされていない場合は、 https://code.visualstudio.com/ に移動して今すぐインストールします。

1. ボットのソース コードを保持するため、自分のハード ディスク上の任意の場所に、"Factbot"という名前のフォルダーを作成します。

1. Azure portal に戻り、"factbot-rg" リソース グループを開きます。 次に、[演習 1](#Exercise1) で作成した Web アプリ ボットをクリックします。

    ![Web アプリ ボットを開く](../images/open-web-app-bot.png)

    "Web アプリ ボットを開く"__

1. 左側のメニューで **[ビルド]** をクリックし、**[Download zip file]\(ZIP ファイルのダウンロード\)** をクリックして、ボットのソース コードを含む ZIP ファイルを準備します。 ZIP ファイルの準備ができたら、**[Download zip file]\(ZIP ファイルのダウンロード\)** ボタンをクリックしてダウンロードします。 ダウンロードが完了したら、ZIP ファイルの内容を手順 4 で作成した "Factbot" フォルダーにコピーします。

    ![ソース コードをダウンロードする](../images/download-source.png)

    "ソース コードをダウンロードする"__
  
1. 引き続き [ビルド] ブレードで、**[Configure continuous deployment]\(継続的デプロイの構成\)** をクリックします。 **[ソースの選択]** に続いて表示されるブレードの上部で **[セットアップ]** をクリックします。 次に、デプロイ ソースとして **[ローカル Git リポジトリ]** を選択し、**[OK]** をクリックします。 
 
    ![デプロイ ソースとしてローカル Git リポジトリを指定する](../images/portal-set-local-git.png)

    "デプロイ ソースとしてローカル Git リポジトリを指定する"__  

1. [デプロイ] ブレードを閉じ、左側のメニューで **[All App service settings]\(すべての App Service の設定\)** をクリックします。

1. **[デプロイ資格情報]** をクリックしてから、ユーザー名とパスワードを入力します。 ユーザー名は Azure 内で一意である必要があるので、"FactbotAdministrator" 以外のユーザー名を入力する必要があります。 **[保存]** をクリックして、ブレードを閉じます。

    ![デプロイ資格情報を入力する](../images/portal-enter-ci-creds.png)

    "デプロイ資格情報を入力する"__  

1. Visual Studio Code を起動し、**[ファイル]** > **[フォルダーを開く]** コマンドを使用して、手順 6 でボットのソース コードをコピーした "Factbot" フォルダーを開きます。

1. Visual Studio Code の左側のアクティビティ バーで **[ソース管理]** ボタンをクリックし、上部の **[リポジトリの初期化]** アイコンをクリックします。 続いて表示されるダイアログで、**[リポジトリの初期化]** ボタンをクリックします。

    ![ローカル Git リポジトリを初期化する](../images/vs-init-git-repo.png)

    "ローカル Git リポジトリを初期化する"__  

1. メッセージ ボックスに「最初のコミット」と入力し、 チェック マークをクリックして変更をコミットします。

    ![変更内容をローカル リポジトリにコミットする](../images/vs-first-git-commit.png)

    "変更内容をローカル リポジトリにコミットする"__  

1. Visual Studio Code の **[表示]** メニューから **[統合ターミナル]** を選択し、統合ターミナルを開きます。 統合ターミナルで次のコマンドを実行します。2 か所の BOT_NAME を演習 1 の手順 3 で入力したボット名に置き換えます。

    ```
    git remote add qna-factbot https://BOT_NAME.scm.azurewebsites.net:443/BOT_NAME.git
    ```

1. ソース コントロール パネルの上部にある省略記号 (3 つのドット) をクリックし、メニューから **[ブランチの発行]** を選択して、ボット コードをローカル リポジトリから Azure にプッシュします。 資格情報を求められた場合は、この演習の手順 9 で指定したユーザー名とパスワードを入力します。

ボットは Azure に発行されています。 しかし、それをここでテストする前に、ローカルで実行して、Visual Studio Code でデバッグする方法について学習します。
