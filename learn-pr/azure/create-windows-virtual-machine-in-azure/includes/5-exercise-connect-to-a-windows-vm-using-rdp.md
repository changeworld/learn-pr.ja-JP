Windows VM の展開が完了して起動されていますが、タスクを行うための設定が行われていません。

今回使用するシナリオは映像処理システムであることを思い返してください。 プラットフォームは FTP を通じてファイルを受け取ります。 サーバー上のフォルダにマップされた既知の URL に向けて、交通カメラが映像クリップをアップロードします。 各 Windows VM 上のカスタム ソフトウェアがサービスとして実行され、フォルダを監視してアップロードされたそれぞれのクリップを処理します。 その後、正規化された映像を他の Azure サービス上で実行されているアルゴリズムに渡します。

このシナリオをサポートするためには、いくつかの設定を行う必要があります。

- FTP をインストールして通信を行うのに必要なポートを開ける。
- 都市のカメラ システムにあわせた独自の映像コーデックをインストールする。
- アップロードされた映像を処理するためのトランスコード サービスをインストールする。

これらの多くは一般的な管理上のタスクであり、ここでは実際にカバーしません。そしてインストールするソフトウェアもありません。 代わりに、Remote Desktop を使用してカスタムまたはサードパーティ製のソフトウェアをインストール_する_方法を、手順ごとにご紹介します。 それでは、接続情報の取得から始めましょう。

## <a name="connect-to-the-vm-with-remote-desktop-protocol"></a>Remote Desktop Protocol を使って VM に接続する

RDP クライアントを使って Azure VM に接続するには、次が必要になります。

- VM のパブリック IP アドレス（VM がお客様のネットワークへの接続設定をされている場合はプライベート アドレス）。
- ポート番号。

この情報を RDP クライアントに入力するか、事前設定された **RDP** ファイルをダウンロードすることができます。

### <a name="download-the-rdp-file"></a>RDP ファイルのダウンロード

1. [Azure portal](https://portal.azure.com?azure-portal=true) 内で、以前に作成した仮想マシンの**概要**パネルが開かれていることを確認します。 もしパネルを開く必要がある場合は、**すべてのリソース**下で VM を見つけることができます。 概要パネルには、VM に関する多数の情報があります。

    - VM が起動中か否かを確認可能。
    - VM の停止または再起動。
    - VM へ接続するためのパブリック IP アドレスを取得。
    - CPU、ディスク、およびネットワークの活動状況を確認。

1. パネル最上部の**接続**ボタンをクリックします。

1. **仮想マシンへの接続**ブレード内で、**IP アドレス**および**ポート番号**設定を控えたあと、**RDP ファイルのダウンロード**をクリックしてコンピュータに保存します。

1. 接続するまえに、いくつかの設定を調整しましょう。 Windows では、Explorer を使ってファイルを探し、右クリックをして**編集**を選択します。 MacOS では、まず RDP クライアントを使ってファイルを開く必要があります。その後表示されているリスト内のアイテムを右クリックし、**編集**を選択します。

1. さまざまな設定を調整して、Azure VM への接続エクスペリエンスを制御することが可能です。 調べる設定は以下のようなものがあります。

    - **表示**：デフォルトではフルスクリーンになっています。 この項目をより低解像度に変更したり、複数のモニタを持っている場合はすべてのモニタを使うこともできます。
    - **ローカル リソース**：ローカル ドライブを VM と共有することで、PC から VM へファイルをコピーすることができるようになります。 **ローカルのデバイスおよびリソース**の下にある**詳細**ボタンをクリックして、共有するものを選択します。
    - **エクスペリエンス**：ネットワーク品質に基づいてビジュアル エクスペリエンスを調整します。

1. VM から可視化するために、ローカルの C: を共有します。

1. **一般**タブに戻り、**保存**をクリックして変更を保存します。 他の設定を試すために、いつでもこのファイルの編集に戻ってくることができます。

### <a name="connect-to-the-windows-vm"></a>Windows VM に接続する

1. **接続**ボタンをクリックして、VM への接続を開始します。

1. **リモート デスクトップ接続** ダイアログ ボックスで、セキュリティに関する警告とリモート コンピューターの IP アドレスをメモしてから **接続** をクリックします。

1. **Windows Security** のダイアログ ボックス内で、手順 6 および 7 で使用したユーザー名とパスワードを入力します。
    
    > [!NOTE]
    > VM への接続に Windows クライアントを使用している場合、マシン上の既知の ID にデフォルト設定されます。 **複数の選択肢**オプションをクリックして「違うアカウントを使用する」を選択することで、別のユーザー名、パスワードまたはその組み合わせを入力することができます。
    
1. 2 番目の **リモート デスクトップ接続** ダイアログ ボックスで、証明書に関するエラーをメモしてから **はい** をクリックします。

### <a name="install-worker-roles"></a>ワーカー ロールのインストール

Windows サーバー VM への初回接続時は、サーバー マネージャーが起動します。 これによって、一般的なウェブまたはデータ タスクのワーカー ロールを割り当てることができます。 Start メニューからもサーバー マネージャーを立ち上げることができます。

ここで、サーバーに Web Server のロールを追加します。 これによって IIS がインストールされ、設定の一環として HTTP リクエストがオフになり、FTP サーバーが有効になります。 または、IIS の代わりにサードパーティー製の FTP サーバーをインストールすることもできます。 その後 FTP サーバーを設定し、VM に追加したビッグ データ ドライブのフォルダへのアクセスを有効にします。

ここでは実際の設定は行いませんので、サーバー マネージャーを閉じます。

## <a name="install-custom-software"></a>カスタム ソフトウェアのインストール

ソフトウェアをインストールする際に使用できる、2 種類のアプローチがあります。 先ず、この VM はインターネットに接続されています。 必要なソフトウェアがダウンロード可能なインストーラを提供している場合、RDP セッション内でウェブ ブラウザを開き、ソフトウェアをダウンロードしてインストールすることができます。 次に、ソフトウェアがカスタムである場合、ローカル マシンから VM へソフトウェアをコピーしてインストールすることができます。 後者のアプローチを見ていきましょう。

1. エクスプローラーを開きます。 サイドバーにある**この PC** をクリックします。 いくつかのドライブが見えます。

    - Windows（C:）ドライブは、OS を表しています。
    - 一時ストレージ（D:）ドライブです。
    - ローカルの C: ドライブです（下記に表示されているものと別の名前を持ちます）。

    ![Azure と共有するローカル ドライブ](../media-drafts/6-drive-list.png)

ローカル ドライブにアクセスしてカスタム ソフトウェアのファイルを VM にコピーし、ソフトウェアをインストールできます。 今回は模擬シナリオで実際にこの動作は行いませんが、どのような動きになるかを想像しておくことは可能です。

ドライブ一覧を確認して、何が_足りないのか_の情報を確認します。 **データ** ドライブが存在していないことに注目してください。 Azure は VHD を追加しましたが、初期化は行っていません。

## <a name="initialize-data-disks"></a>データ ディスクの初期化

最初から作成した追加のドライブはすべて、初期化およびフォーマットを行う必要があります。 これは、物理ディスクへ行う処理と同一です。

1. Start メニューから**ディスク管理**ツールを起動します。

1. これによって、初期化されていないディスクを検出したという警告が表示されます。

    ![VM 内のデータ ディスクの初期化](../media-drafts/6-disk-management.png)

1. **OK** をクリックしてディスクを初期化します。 その後、フォーマット可能なボリューム一覧が表示され、ドライブ名が割り当てられます。

1. ファイル エクスプローラーを開くと、データ ドライブが表示されるようになりました。

1. RDP クライアントを閉じて VM からサインアウトします。 サーバーは引き続き実行中となります。

RDP を使うと、ローカル コンピュータと同様の操作で Azure VM での作業が行えます。 デスクトップ UI アクセスを使って、他の Windows コンピュータと同じように、ソフトウェアのインストール、役割の設定、機能の調整およびその他の一般的なタスクなどを行うことができます。 ただし、これらはマニュアルでの処理です。もし今後何かのソフトウェアをインストールする必要がある場合、スクリプトを使った処理の自動化を検討するのも良いでしょう。