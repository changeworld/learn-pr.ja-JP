Windows VM をデプロイして実行させましたが、作業を行うようには構成していません。

これはビデオ処理システムのシナリオであることを思い出してください。 プラットフォームでは FTP 経由でファイルが受信されます。 交通監視カメラでは、サーバー上のフォルダーにマップされる既知の URL にビデオ クリップがアップロードされます。 各 Windows VM 上のカスタム ソフトウェアはサービスとして実行されます。このソフトウェアではフォルダーが監視され、アップロードされた各クリップが処理されます。 その後、正規化されたビデオは、他の Azure サービスで実行されているアルゴリズムに渡されます。

このシナリオをサポートするために構成する必要があるものがいくつかあります。

- FTP をインストールし、通信するために必要なポートを開きます。
- 都市のカメラ システムに一意の専用ビデオ コーデックをインストールします。
- アップロードされたビデオを処理するトランスコーディング サービスをインストールします。

これらの多くは一般的な管理タスクであり、ここでは実際に取り上げないため、インストールするソフトウェアはありません。 代わりに、リモート デスクトップを使用してカスタムまたはサード パーティのソフトウェアをインストール_できる_手順を説明します。 まず、接続情報を取得します。

## <a name="connect-to-the-vm-with-remote-desktop-protocol"></a>リモート デスクトップ プロトコルを使用して VM に接続する

RDP クライアントを使用して Azure VM に接続するには、次のものが必要です。

- VM のパブリック IP アドレス (ユーザーのネットワークに接続するように VM が構成されている場合はプライベート)。
- ポート番号。

RDP クライアントにこの情報を入力したり、事前に構成されている **RDP** ファイルをダウンロードしたりすることができます。

### <a name="download-the-rdp-file"></a>RDP ファイルをダウンロードする

1. [Azure portal](https://portal.azure.com/learn.docs.microsoft.com?azure-portal=true) 内で、以前に作成した仮想マシンの**概要**パネルが開かれていることを確認します。 もしパネルを開く必要がある場合は、**すべてのリソース**下で VM を見つけることができます。 概要パネルには、VM に関する多くの情報があります。

    - VM が実行中かどうかを確認できます。
    - VM を停止または再起動します。
    - VM に接続するためのパブリック IP アドレスを取得します。
    - CPU、ディスク、ネットワークのアクティビティを確認します。

1. ウィンドウの上部にある **[接続]** ボタンをクリックします。

1. **[仮想マシンへの接続]** ブレードで、**IP アドレス**と**ポート番号**の設定内容をメモしてから、**[RDP ファイルのダウンロード]** をクリックしてご利用のコンピューターに保存します。

1. 接続する前に、設定をいくつか調整します。 Windows では、エクスプローラーを使用してファイルを見つけ、右クリックして **[編集]** を選択します。 macOS では、最初に RDP クライアントでファイルを開いてから、表示されるリストで項目を右クリックして **[編集]** を選択する必要があります。

1. さまざまな設定を調整して、Azure VM への接続におけるエクスペリエンスを制御することができます。 確認する設定は次のとおりです。

    - **表示**: 既定では、全画面になります。 これを低解像度に変更することができ、モニターが複数ある場合、それらをすべて使用することもできます。
    - **ローカル リソース**: ローカル ドライブを VM と共有し、ご利用の PC から VM にファイルをコピーすることができます。 **[ローカル デバイスとリソース]** の下にある **[詳細]** ボタンをクリックして、共有するものを選択します。
    - **エクスペリエンス**: ネットワークの品質に基づいて視覚的効果を調整します。

1. ローカルの C: ドライブを共有して、VM に表示されるようにします。

1. **[全般]** タブに戻り、**[保存]** をクリックして変更内容を保存します。 後でいつでもこのファイルに戻り、編集して、他の設定を試すことができます。

### <a name="connect-to-the-windows-vm"></a>Windows VM に接続する

1. **[接続]** ボタンをクリックして、VM への接続を開始します。

1. **[リモート デスクトップ接続]** ダイアログ ボックスで、セキュリティに関する警告とリモート コンピューターの IP アドレスをメモしてから **[接続]** をクリックします。

1. **[Windows セキュリティ]** ダイアログ ボックスに、手順 6 と 7 で使用したユーザー名とパスワードを入力します。

    > [!NOTE]
    > Windows クライアントを使用して VM に接続する場合、既定でご利用のコンピューター上の既知の ID に設定されます。 **[すべての表示]** オプションをクリックし、[別のアカウントを使う] を選択して、別のユーザー名とパスワードの組み合わせを入力することができます。

1. 2 番目の **[リモート デスクトップ接続]** ダイアログ ボックスで、証明書に関するエラーをメモしてから **[はい]** をクリックします。

### <a name="install-worker-roles"></a>worker ロールをインストールする

最初に Windows サーバーの VM に接続するときに、サーバー マネージャーが起動します。 これにより、一般的な Web またはデータ タスク用の worker ロールを割り当てることができます。 [スタート] メニューからサーバー マネージャーを起動することもできます。

ここでサーバーに Web サーバー ロールを追加します。 これにより IIS がインストールされます。構成の一環として、HTTP 要求をオフにし、FTP サーバーを有効にします。 または、IIS を無視して、サード パーティの FTP サーバーをインストールできます。 その後、VM に追加したビッグ データ ドライブ上のフォルダーにアクセスできるように FTP サーバーを構成します。

実際にはここで構成しないため、単にサーバー マネージャーを閉じます。

## <a name="install-custom-software"></a>カスタム ソフトウェアをインストールする

ソフトウェアをインストールするために使用できる 2 つのアプローチがあります。 1 つ目のアプローチでは、この VM がインターネットに接続されます。 必要なソフトウェアのダウンロード可能なインストーラーがある場合は、RDP セッションで Web ブラウザーを開き、ソフトウェアをダウンロードしてインストールできます。 2 つ目のアプローチでは、ソフトウェアがカスタム (カスタム サービスなど) である場合、ローカル コンピューターから VM にコピーしてインストールすることができます。 この後者のアプローチを見てみましょう。

1. エクスプローラーを開きます。 サイドバーの **[この PC]** をクリックします。 ドライブがいくつか表示されます。

    - OS を表す Windows (C:) ドライブ。
    - 一時ストレージ (D:) ドライブ。
    - ローカルの C: ドライブ (以下に示す名前とは異なります)。

    ![Azure VM と共有するローカル ドライブを示すスクリーンショット。](../media/6-drive-list.png)

ローカル ドライブにアクセスしてカスタム ソフトウェア用のファイルを VM にコピーし、ソフトウェアをインストールできます。 これは単なるシミュレートされたシナリオであるため、実際には行いませんが、そのしくみを想像することはできます。

ドライブの一覧でさらに興味深いことは、_表示されていない_ものです。 **データ** ドライブが存在しないことに注目してください。 Azure で VHD が追加されていますが、初期化はされていません。

## <a name="initialize-data-disks"></a>データ ディスクの初期化

一から作成した追加ドライブはすべて、初期化してフォーマットする必要があります。 これを行うためのプロセスは、物理ドライブと同じです。

1. [スタート] メニューから **[ディスクの管理]** ツールを起動します。 場合によっては先に [コンピューター管理] ツールに移動し、次に [ディスクの管理] に移動する必要があります。あるいは、スタート メニューで "ディスク管理" を検索してみてください。

1. 初期化されていないディスクが検出されたことを示す警告が表示されます。

    ![[ディスクの管理] ツールのスクリーンショット。VM で初期化されていないデータ ディスクに関する警告が表示されています。](../media/6-disk-management.png)

1. **[OK]** をクリックしてディスクを初期化します。 フォーマットし、ドライブ文字を割り当てることができる場所がボリュームのリストに表示されます。

1. エクスプローラーを開くと、データ ドライブが表示されます。

1. 先に進み、RDP クライアントを閉じて VM からサインアウトします。 サーバーは引き続き実行されます。

RDP を使用すると、ローカル コンピューターと同じように Azure VM を操作できます。 デスクトップ UI アクセスでは、Windows コンピューターと同じようにこの VM を管理することができ、ソフトウェアのインストール、ロールの構成、機能の調整、他の一般的なタスクを実行できます。 しかし、それは手動プロセスです。常に一部のソフトウェアをインストールする必要がある場合は、スクリプトを使用してプロセスの自動化を検討してください。