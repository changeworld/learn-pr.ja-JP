バックアップは、永久的なデータ損失に対する最終かつ最強の防衛線です。 効果的なバックアップ戦略には、単純にデータをコピーする以上のことが必要で、アプリケーションのデータ アーキテクチャやインフラストラクチャを考慮しなければなりません。 アプリは、ファイル システムやデータベースなど、クラウドおよびオンプレミスのストレージ サービス全体に広がる、さまざまな重要度や種類のデータを管理します。 ジョブで適切なサービスや製品を使用することにより、バックアップ プロセスは簡素化されます。バックアップを復元する必要がある場合は、復旧時間が増加します。

## <a name="establish-backup-and-restoration-requirements"></a>バックアップおよび復元の要件を確定する

ディザスター リカバリー戦略では、費用便益分析に基づいてバックアップ要件を決定します。 アプリのデータは、データ保有期間に関する法律などの外部要件と、アプリが管理するさまざまなカテゴリのデータの相対的重要度を踏まえて分析する必要があります。

アプリのバックアップの要件を確立するために、アプリケーション データを吟味し、以下の要件に基づいて分析およびグループ化します。

* この種類のデータが失われても許容できる期間
* この種類のデータの復元にかけられる最大時間
* どのくらいの期間と頻度のバックアップを利用できるようにするかを示すバックアップ保有期間要件

これらの概念は、目標復旧時点と目標復旧時間 (RPO & RTO) の概念ときれいに対応します。 一般に、損失許容期間は、必要となるバックアップ間隔と RPO に直接変換できます。 復元にかかる最大時間は、アプリケーションのデータ コンポーネントの RTO に対応します。 どちらの要件も、実現にかかるコストと比較して検討する必要があります。どんな組織でも、"*すべて*" のデータが失われてはならないものだと言うでしょうが、それを実現するコストを考えれば、そうでないことが多いものです。

もちろん、バックアップにはディザスター リカバリー (DR) という役割がありますが、バックアップや復元、およびそれに関連するシナリオは DR だけではありません。 バックアップは、災害以外の状況で復元しなければならなくなるかもしれません。中には、RTO や RPO が重要な関心事にはならない場合もあるでしょう。 たとえば、バックアップの間隔よりも古い少量のデータが破損したり削除されたりしても、アプリケーションでダウンタイムが発生していない場合なら、アプリケーションの SLA を満たせなくなる危険はなく、復元が成功すればデータが失われることもありません。 ディザスター リカバリー計画には、災害以外の状況で復元を行う際のガイダンスを含めても含めなくても構いません。

> [!TIP]
> *アーカイブ*、*レプリケーション*、*バックアップ*を混同しないようにしてください。 アーカイブは、読み取りアクセス用の長期保存データ ストレージです。レプリケーションは、高可用性と特定のディザスター リカバリー シナリオをサポートするために、レプリカ間でデータをほぼリアルタイムにコピーすることです。 データ保有期間に関する法律などのいくつかの要件は、この 3 つすべてについての戦略に影響を与える可能性があります。しかし、アーカイブ、レプリケーション、バックアップは、すべて個別に分析して実装する必要があります。

## <a name="azure-backup-and-restore-capabilities"></a>Azure のバックアップと復元の機能

Azure では、Azure 内のデータやオンプレミスのデータなど、さまざまなシナリオに対応したいくつかのバックアップ関連サービスや機能を提供しています。 ほとんどの Azure サービスでは、何種類かのバックアップ機能が提供されています。 ここでは、特に人気のあるバックアップ関連 Azure サービスをいくつか紹介します。

### <a name="azure-backup"></a>Azure Backup

Azure Backup は、保管と復旧を目的として Azure Recovery Services コンテナーにデータをバックアップするバックアップ製品のファミリです。 Recovery Service コンテナーは、専用の Azure のストレージ リソースで、仮想マシン、サーバー、および個々のワークステーションやワークロードのデータと構成のバックアップを保持します。

> [!NOTE]
> Azure Backup と Azure Site Recovery は、どちらもストレージとして Azure Recovery Service コンテナーを使用しています。 Azure Backup は、汎用バックアップ ソリューションです。Azure Site Recovery は、レプリケーションとフェールオーバーを協調動作させ、RPO および RTO が小さいディザスター リカバリー操作をサポートします。

Azure Backup は、VM または物理サーバー上で動作するクラウドおよびオンプレミス ワークフロー用の汎用バックアップ ソリューションとして機能します。 従来型のバックアップ ソリューションのドロップイン置換として設計されており、アーカイブ テープなどのローカル物理メディアではなく Azure にデータを格納します。

Azure Backup を使用してバックアップを作成できるのは、次の 4 つの製品およびサービスです。

* **Azure Backup エージェント**は、小さな Windows アプリケーションで、インストールされた Windows VM またはサーバーのファイル、フォルダー、およびシステム状態のバックアップを行います。 多くのクラウド ベースのコンシューマー バックアップ ソリューションと同じように動作しますが、Azure Recovery コンテナーの構成が必要です。 ダウンロードして Windows サーバーまたは VM にインストールすると、1 日に 3 回までバックアップを作成するように構成できます。
* **System Center Data Protection Manager** は、あらゆる機能を備えた堅牢なエンタープライズ レベルのバックアップおよび回復システムです。 DPM は、ファイル システムと仮想マシン (Windows および Linux) のバックアップ、物理サーバーのベア メタル バックアップの作成、SQL Server や Exchange などの多くの Microsoft サーバー製品のアプリケーション対応バックアップを行うことができる Windows Server アプリケーションです。 DPM は、System Center ファミリ製品の一部で、System Center と合わせてライセンス供与および販売されています。ただし、Azure Recovery コンテナーにバックアップを格納できるため、Azure Backup ファミリの一部と見なされます。
* **Azure Backup Server** は、System Center DPM に似ていますが、Azure サブスクリプションの一部としてライセンス供与されるので、System Center ライセンスは必要ありません。 Azure Backup Server は、DPM と同様の機能をサポートしていますが、ローカル テープへのバックアップと他の System Center 製品との統合は除きます。
* **Azure IaaS VM バックアップ**は、Azure 仮想マシンのターンキー型のバックアップおよび復元機能です。 VM バックアップは、Windows および Linux 仮想マシンの 1 日 1 回のバックアップをサポートします。 個々のファイル、ディスク全体、および VM 全体の復旧をサポートしており、アプリケーションと整合性が取れたバックアップを行うこともできます。個々のアプリケーションをバックアップ操作に対応させることや、スナップショットを作成する前にファイル システム リソースを一貫性のある状態にすることも可能です。

![Azure Backup](../media-draft/azure-backup.png)

Azure Backup は、価値を追加し、ほぼすべてのサイズと形状の IaaS やオンプレミス アプリケーションのバックアップおよび復元戦略に貢献します。

### <a name="azure-blob-storage"></a>Azure BLOB ストレージ

Azure Storage には自動バックアップ機能は含まれませんが、BLOB はさまざまなソースからあらゆる種類のデータをバックアップする際によく使用されます。 バックアップ機能を提供するサービスの多くは、そのデータを格納する BLOB を使用します。BLOB は、あらゆる種類のバックアップ シナリオにおいて、スクリプトやツールの一般的なターゲットとなります。

General Purpose v2 ストレージ アカウントは、パフォーマンスやコストが異なる 3 種類の BLOB ストレージ階層をサポートします。 **クール** ストレージは、ほとんどのバックアップにおいてコストとパフォーマンスの比率が最高になります。逆に**ホット** ストレージでは、アクセス コストは低くなりますが、ストレージ コストは高くなります。 **アーカイブ**階層のストレージは、復旧時間への期待度が低いデータのセカンダリ バックアップに最適かもしれません。コストは安いものの、アクセスまでのリード タイムとして最大 15 時間が必要になります。

不変 BLOB ストレージは、ユーザーが指定した期間、消去不可や変更不可に構成することができます。 不変 BLOB ストレージは、主に財務データなどの特定の種類のデータに求められる厳密な要件を満たすために設計されたものですが、バックアップが誤って削除または変更されることを確実に防ぐことができる優れたオプションです。

### <a name="azure-sql-database"></a>Azure SQL Database

Azure SQL Database では、追加料金なしで包括的な自動バックアップ機能を利用できます。 完全バックアップが毎週作成され、差分バックアップが 12 時間ごと、ログ バックアップが 5 分ごとに作成されます。 このサービスによって作成されたバックアップは、特定の時点にデータベースを復元するために使用できます。データベースが削除された場合でも復元できます。 復元には、Azure portal、PowerShell、または REST API を使用できます。 Transparent Data Encryption で暗号化されているデータベースは、バックアップも暗号化されます。この機能は、既定で有効になっています。

SQL Database のバックアップは、エンタープライズ グレードで運用環境に使用できる準備が整っており、既定で有効になっています。 アプリの別のデータベース オプションを評価している場合、この機能はサービスにとって重要な利点となるため、費用便益分析の一部に含める必要があります。 ディザスター リカバリー計画やバックアップ/復元手順に Azure SQL Database を使用するすべてのアプリを含め、そのメリットを活用するようにしてください。

### <a name="azure-app-service"></a>Azure App Service

Azure App Service の Standard および Premium 層にホストされた Web アプリケーションは、ターンキー型のスケジュールされたバックアップと手動バックアップをサポートします。 バックアップには、構成とファイルの内容に加え、アプリが使用するデータベースの内容も含まれます。 また、ファイルを除外する簡単なフィルターをサポートしています。 復元操作は、別の App Service インスタンスをターゲットにすることもできるので、App Service バックアップはアプリのコンテンツを簡単に別のインスタンスに移動する方法にもなります。

App Service バックアップは、アプリとデータベースの内容を含め、合計 10 GB に制限されます。 開発中の新しいアプリや小規模なアプリに適したソリューションです。 それよりも成熟したアプリケーションは、App Service バックアップを使用しないのが一般的です。その代わりに、堅牢なデプロイおよびロールバック手順、アプリケーションのディスク ストレージを使わないストレージ戦略、そしてデータベースおよび永続的ストレージ向けの専用バックアップ戦略を利用します。

## <a name="verify-backups-and-test-restore-procedures"></a>バックアップの確認と復元手順のテスト

バックアップの確認と復元手順のテストを行う戦略なしに完成するバックアップ システムはありません。 専用のバックアップ サービスや製品を使う場合でも、確実に復旧手順を理解してシステムを想定された状態に戻すことができるように、復旧手順の文書化や練習を行う必要があります。

バックアップを確認するための戦略はさまざまで、インフラストラクチャの性質に依存します。 アプリケーションを新しくデプロイする、バックアップを復元する、2 つのインスタンスの状態を比較するなどの手法を検討したいと思う方もいるかもしれません。 多くの場合、これは実際のディザスター リカバリー手順にとてもよく似ています。 バックアップを作成した直後に、バックアップ データとライブ データのサブセットを比較するだけでも十分です。 バックアップ確認の一般的なコンポーネントは、古いバックアップがまだ有効でいつでも利用可能であることと、バックアップ システムが互換性を失うような形で変更されていないことを確認するために、古いバックアップを復元しようとします。

災害から復旧する際に、バックアップが破損していたり、不完全だったりすることがわかることに比べれば、どのような戦略も優れています。

バックアップと復元の戦略は、アーキテクチャが確実にデータの損失や破損を復旧できるようにする上で重要な一部となります。 アーキテクチャを確認して、バックアップと復元の要件を定義してください。 Azure は、すべてのアーキテクチャにバックアップおよび復元機能を提供するために、いくつかのサービスと機能を提供しています。
