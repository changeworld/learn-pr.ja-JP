Azure IoT Central では、デバイスがアプリケーションと交換できるデータは、デバイス (ここではコーヒー メーカー) の動作と機能を定義するデバイス テンプレートで指定されます。 デバイス テンプレートを作成すると、シミュレートされたデバイスがテンプレートから生成されます。 シミュレートされたデバイスは、物理デバイスを接続する前にアプリケーションの動作をテストできるように、テレメトリを生成します。 次のモジュールの後半では、実際のコーヒー メーカーを表す汎用の Node.js アプリケーションに接続します。 

このモジュールでは、コーヒー メーカーのデバイス テンプレートを作成し、次の機能と動作を指定します。
* 測定 
    * テレメトリ: 湿度、水温
    * 状態: 抽出している/抽出していない、カップあり/カップなし
* 設定: 適温
* プロパティ: コーヒー メーカーの最高温度と最低温度、デバイス保証期限切れ
* コマンド: メンテナンス モードの設定、抽出開始


## <a name="create-a-device-template-for-the-coffee-maker"></a>コーヒー メーカーのデバイス テンプレートを作成する
デバイス (ここではコーヒー メーカー) の動作と機能を定義するデバイス テンプレート。

1. ホーム ページに移動し、[Create Device Templates]\(デバイス テンプレートの作成\)を選択します。
![デバイス テンプレートを作成する](../images/2-device-template-a1.png)

1. カスタム デバイス テンプレートの名前を入力します。 たとえば、このモジュールでは「Connected Coffee Maker」と入力します。
![デバイス テンプレートを作成する](../images/2-device-template-a2.png)
 
1. コーヒー メーカー用に空のデバイス テンプレートを作成しました。ここに、コーヒー メーカーの動作と機能を定義します。 

## <a name="define-telemetry-measurement-temperature-and-humidity"></a>テレメトリ測定の温度と湿度を定義する
1.  **Connected Coffee Maker** デバイス テンプレートで、テレメトリを定義する **[測定]** ページを表示していることを確認します。 定義する各デバイス テンプレートには複数のページがあり、次のことができます。
    * デバイスが送信するテレメトリ、イベント、状態などの測定を指定します。
    * デバイスを制御するための設定を定義します。
    * デバイスに関する情報とデバイスによって送信されるデバイス プロパティを記録するために使用されるプロパティを定義します。
    * デバイスに関連付けられたルールを定義します。
    * デバイスに関連する情報が表示されるように、デバイスのダッシュボードをカスタマイズします。 

1.  温度テレメトリの測定を追加するために、**[新規の測定]** を選択します。 次に、測定の種類として **[テレメトリ]** を選択します。![デバイス テンプレートを作成する](../images/2-device-template-c.png)

1.  デバイス テンプレートに対して定義するテレメトリの各種類には、次のような構成オプションがあります。
    * 表示オプション。
    * テレメトリの詳細。
    * シミュレーションのパラメーター。

    温度と湿度のテレメトリを設定するには、次の表の情報を使用します。
    
    |表示名|フィールド名|単位|最小|最大|小数点以下の桁数|
    |---|---|---|---|---|---|
    |水温|waterTemperature|摂氏|90|98|1|
    |湿度|airHumidity|%|20|100|0|
   
    テレメトリの表示色を選択することもできます。 テレメトリの定義を保存するために、**[保存]** を選択します。![デバイス テンプレートを作成する](../images/2-device-template-d.png)

    デバイス テンプレートに、表に示すように正確にフィールド名を入力します。 フィールド名が一致しない場合は、テレメトリをアプリケーションに表示できません。 設定およびプロパティ情報を入力するときに同じようにします。 

## <a name="define-state-measurement-for-brewingnot-brewing-cup-detectedcup-not-detected"></a>状態測定 (抽出している/抽出していない、カップあり/カップなし) を定義する
**[新規の測定]** を選択して、**[測定]** ページに次の状態を追加します。 次に、測定の種類として **[状態]** を選択します。
    
|表示名|フィールド名|値 1|表示名|値 2|表示名|
|---|---|---|---|---|---|
|抽出している|stateBrewing|true|抽出していない|false|抽出していない|
|カップあり|stateCupDetected|true|カップなし|false|カップなし|

![デバイス テンプレートを作成する](../images/2-device-template-f.png)

デバイス テンプレートを作成すると、シミュレートされたデバイスがテンプレートから生成されます。 シミュレートされたデバイスは、物理デバイスを接続する前にアプリケーションの動作をテストできるように、テレメトリを生成します。
![デバイス テンプレートを作成する](../images/2-device-template-m.png)

## <a name="use-settings-to-set-the-optimal-temperature-of-the-coffee-machine"></a>[設定] を使用してコーヒー メーカーの適温を設定する
[設定] に移動します。 **[デザイン モード]** をオンにします。 **[設定]** ページで、次の数値の設定を追加します。

|表示名|フィールド名|単位|小数点|最小|最大|初期|
|---|---|---|---|---|---|---|---|
|適温|setTemperature|摂氏|1|92|99|95|

![デバイス テンプレートを作成する](../images/2-device-template-q.png)

## <a name="use-properties-to-store-warranty-info-and-water-temperature-range"></a>[プロパティ] を使用して保証情報と水温範囲を格納する
最初に **[デザイン モード]** を有効にして、**[プロパティ]** ページで次の**数値**プロパティを追加します。
|表示名|フィールド名|単位|小数点以下の桁数|最小|最大|初期
|---|---|---|---|---|---|---|
|コーヒー メーカー最低温度|propertyMinTemperature|摂氏|1|88|92|90|    
|コーヒー メーカー最高温度|propertyMaxTemperature|摂氏|1|96|99|98| 

![デバイス テンプレートを作成する](../images/2-device-template-n.png)

**[プロパティ]** ページで次の**デバイス プロパティ**を追加します。

|表示名|フィールド名|データ型|
|---|---|---|
|デバイスの保証期限切れ|propertyWarrantyExpired|number|
![デバイス テンプレートを作成する](../images/2-device-template-u.png)

> [!NOTE]
> デバイス プロパティがデバイス (ここではコーヒー メーカー) によって送信されます。 いったんコーヒー メーカーを Azure IoT Central に接続すると、デバイスの保証期限プロパティがアプリケーションに送信され、[デバイスの保証期限切れ] フィールドに表示されます。 

## <a name="use-commands-to-set-maintenance-mode-and-start-brewing"></a>コマンドを使用してメンテナンス モードを設定し抽出を開始する

最初に **[デザイン モード]** を有効にして、**[コマンド]** ページで次のコマンドを追加します。
|表示名|フィールド名|入力フィールド|データ型|
|---|---|---|---|---|---|---|
|メンテナンスの設定|cmdSetMaintance|30|text| 
|抽出開始|cmdStartBrewing|30|text|

![デバイス テンプレートを作成する](../images/2-device-template-s.png)


## <a name="summary"></a>まとめ

このモジュールでは、新しいデバイス タイプ (コーヒー メーカー) を作成し、デバイス テンプレートを使用して、コーヒー メーカーがアプリケーションと交換できるデータを指定しました。 水温と湿度のようなテレメトリと、コーヒーを抽出中かどうかといった状態を定義しました。 さらに、設定、プロパティ、コマンドを構成して、コーヒー メーカーの動作と機能を定義しました。 

