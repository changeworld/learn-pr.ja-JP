<span data-ttu-id="486d7-101">コーヒー マシンを Azure IoT Central アプリケーションに接続し、コーヒー マシンを監視して管理できるようにするデータの交換を有効にしました。</span><span class="sxs-lookup"><span data-stu-id="486d7-101">You have connected your coffee machine to the Azure IoT Central application, enabling the exchange of data that allows you to monitor and manage your coffee machine.</span></span> <span data-ttu-id="486d7-102">このモジュールでは、コーヒー マシンの水の温度が通常の範囲外にあるときにアクションをトリガーするルールを作成します。</span><span class="sxs-lookup"><span data-stu-id="486d7-102">In this module, you create rules that trigger actions when the water temperature of the coffee machine is out of the normal range.</span></span> <span data-ttu-id="486d7-103">アクションは、マシンが保証期間内かどうかに応じて、メールまたはモバイル通知のどちらかです。</span><span class="sxs-lookup"><span data-stu-id="486d7-103">The actions are either emails or mobile notifications depending on whether or not the machine is under warranty.</span></span> <span data-ttu-id="486d7-104">アクションとして Microsoft Flow を追加するには、Azure サブスクリプションが必要です。</span><span class="sxs-lookup"><span data-stu-id="486d7-104">To add Microsoft Flow as an action, you need an Azure subscription.</span></span> <span data-ttu-id="486d7-105">Azure サブスクリプションがない場合は、アクションとしての Microsoft Flow の追加は省略可能です。</span><span class="sxs-lookup"><span data-stu-id="486d7-105">If you do not have an Azure subscription, adding Microsoft Flow as an action is optional.</span></span>

## <a name="create-rules-in-iot-central-with-email-as-the-action"></a><span data-ttu-id="486d7-106">電子メールをアクションとして IoT Central でルールを作成する</span><span class="sxs-lookup"><span data-stu-id="486d7-106">Create rules in IoT Central with Email as the action</span></span>
<span data-ttu-id="486d7-107">Azure IoT Central には、通知を送信するネイティブなメール機能があります。</span><span class="sxs-lookup"><span data-stu-id="486d7-107">Azure IoT Central has its native email capabilities to send notifications.</span></span> <span data-ttu-id="486d7-108">このシナリオでは、コーヒー マシンが最適温度の範囲外にあり、保証で保護されていない場合、IoT Central によってクライアントのメンテナンス部門にメールが送信されます。</span><span class="sxs-lookup"><span data-stu-id="486d7-108">In this scenario, if the coffee machine is outside the optimal temperature range and is not protected by the warranty, an email is sent by IoT Central to the client’s maintenance department.</span></span>

<span data-ttu-id="486d7-109">コーヒー マシンの保証期限が切れていて、水の温度が最適範囲外になったときの、次の 2 つのルールを追加します。</span><span class="sxs-lookup"><span data-stu-id="486d7-109">Add the following two rules when the coffee machine warranty has expired and the water temperature is outside the optimal range.</span></span> <span data-ttu-id="486d7-110">完了したら、**[保存]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="486d7-110">When you're finished, choose **Save**.</span></span> 

> [!NOTE]
> <span data-ttu-id="486d7-111">条件が適用されるには、実行されるルールのすべてのステートメントが真になる必要があります。</span><span class="sxs-lookup"><span data-stu-id="486d7-111">When conditions are applied, all statements have to be true for the rules to be executed.</span></span> <span data-ttu-id="486d7-112">条件がこのシナリオのように "or" ステートメントの場合 (たとえば、保証が期限切れで、温度が 90 度より低いか、または 98 度より高い)、ここで示すように 2 つのルールにステートメントを分割します。</span><span class="sxs-lookup"><span data-stu-id="486d7-112">If your condition is an "or" statement as in this scenario (e.g. the optimal temperature is less than 90 Celsius or greater than 98 Celsius while the warranty has expired), split the statement into two rules as shown here.</span></span>

1. <span data-ttu-id="486d7-113">ルールの名前: コーヒー メーカーの水温が低すぎ (期限切れ)</span><span class="sxs-lookup"><span data-stu-id="486d7-113">Name the rule: Coffee Maker Water Too Cold (Expired)</span></span>

    <span data-ttu-id="486d7-114">条件の追加:</span><span class="sxs-lookup"><span data-stu-id="486d7-114">Add the conditions:</span></span>      
    * <span data-ttu-id="486d7-115">Device Warranty Expired equals 1</span><span class="sxs-lookup"><span data-stu-id="486d7-115">Device Warranty Expired equals 1</span></span>
    * <span data-ttu-id="486d7-116">Water Temperature is less than Coffee Makers Min Temperature ![ルールの使用](../images/5-flow-g.png)</span><span class="sxs-lookup"><span data-stu-id="486d7-116">Water Temperature is less than Coffee Makers Min Temperature ![Using Rule](../images/5-flow-g.png)</span></span>

1. <span data-ttu-id="486d7-117">ルールの名前: コーヒー メーカーの水温が高すぎ (期限切れ)</span><span class="sxs-lookup"><span data-stu-id="486d7-117">Name the rule: Coffee Maker Water Too Hot (Expired)</span></span>

    <span data-ttu-id="486d7-118">条件の追加:</span><span class="sxs-lookup"><span data-stu-id="486d7-118">Add the conditions:</span></span>      
    * <span data-ttu-id="486d7-119">Device Warranty Expired equals 1</span><span class="sxs-lookup"><span data-stu-id="486d7-119">Device Warranty Expired equals 1</span></span>
    * <span data-ttu-id="486d7-120">Water Temperature is greater than Coffee Makers Max Temperature ![ルールの使用](../images/5-flow-k.png)</span><span class="sxs-lookup"><span data-stu-id="486d7-120">Water Temperature is greater than Coffee Makers Max Temperature ![Using Rule](../images/5-flow-k.png)</span></span>     

1. <span data-ttu-id="486d7-121">**アクション**を追加するには、[Configure Telemetry Rule]\(テレメトリ ルールの構成\) パネルを下にスクロールし、[アクション] の横にある [+] を選択してから **[メール]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="486d7-121">To add an **Action**, scroll down on the Configure Telemetry Rule panel and choose the + next to Actions, then choose **Email**</span></span>

1. <span data-ttu-id="486d7-122">アクションを定義するには、IoT Central アプリケーションへのサインインに使用したメール アドレスを追加します。</span><span class="sxs-lookup"><span data-stu-id="486d7-122">To define the action, add the email address that you used to sign in to the IoT Central application.</span></span> <span data-ttu-id="486d7-123">水温度が暑すぎるときの通知メッセージを追加します。"コーヒー メーカーの水が熱すぎます。</span><span class="sxs-lookup"><span data-stu-id="486d7-123">Add the notification message when the water temperature is too hot: "Coffee maker's water is too hot.</span></span> <span data-ttu-id="486d7-124">メンテナンスが必要です。</span><span class="sxs-lookup"><span data-stu-id="486d7-124">Maintenance is required.</span></span>  <span data-ttu-id="486d7-125">保証は終了しています。"</span><span class="sxs-lookup"><span data-stu-id="486d7-125">Warranty has expired."</span></span> <span data-ttu-id="486d7-126">水温が低すぎる場合について同じ手順を繰り返します。</span><span class="sxs-lookup"><span data-stu-id="486d7-126">Repeat the same steps for when the water temperature is too cold.</span></span> <span data-ttu-id="486d7-127">メッセージを追加します。"コーヒー メーカーの水が冷たすぎます。</span><span class="sxs-lookup"><span data-stu-id="486d7-127">Add the message: "Coffee maker's water is too cold.</span></span> <span data-ttu-id="486d7-128">メンテナンスが必要です。</span><span class="sxs-lookup"><span data-stu-id="486d7-128">Maintenance is required.</span></span>  <span data-ttu-id="486d7-129">保証は終了しています。"</span><span class="sxs-lookup"><span data-stu-id="486d7-129">Warranty has expired."</span></span>

1. <span data-ttu-id="486d7-130">**[保存]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="486d7-130">Choose **Save**.</span></span> <span data-ttu-id="486d7-131">ルールが [ルール] ページに表示されます。</span><span class="sxs-lookup"><span data-stu-id="486d7-131">Your rule is listed on the Rules page:</span></span>

1. <span data-ttu-id="486d7-132">ルールをトリガーするには、温度が範囲外になるまで待つか、または設定の最適範囲外の温度に意図的に設定します。</span><span class="sxs-lookup"><span data-stu-id="486d7-132">To trigger the rule, you can wait for the temperature to go out of the range or you can purposely set the temperature out of the optimal range in settings.</span></span> <span data-ttu-id="486d7-133">メール通知の受信を開始したら、忘れずにルールを無効にして、Azure IoT Central からのメールで受信トレイがあふれないようにします。</span><span class="sxs-lookup"><span data-stu-id="486d7-133">Once you begin to receive email notification, remember to disable the rule to avoid flooding your Inbox with emails from Azure IoT Central.</span></span> 

> [!NOTE]
> <span data-ttu-id="486d7-134">検証が終わったら、メールで受信トレイがいっぱいにならないようにルールを無効にします。</span><span class="sxs-lookup"><span data-stu-id="486d7-134">Turn off the rules once you are done with validation to avoid flooding your Inbox with emails.</span></span> 

## <a name="create-rules-in-iot-central-with-microsoft-flow-as-the-action"></a><span data-ttu-id="486d7-135">Microsoft Flow をアクションとして IoT Central でルールを作成する</span><span class="sxs-lookup"><span data-stu-id="486d7-135">Create rules in IoT Central with Microsoft Flow as the action</span></span>

<span data-ttu-id="486d7-136">Microsoft Flow は、多くのアプリケーション間のワークフローを自動化します。</span><span class="sxs-lookup"><span data-stu-id="486d7-136">Microsoft Flow automates workflows across many applications.</span></span> <span data-ttu-id="486d7-137">IoT Central でルールが発動したときにトリガーできるアクションの 1 つです。</span><span class="sxs-lookup"><span data-stu-id="486d7-137">It’s one of the actions that can be triggered when a rule is fired in IoT Central.</span></span> <span data-ttu-id="486d7-138">このシナリオでは、コーヒー マシンが特定の温度しきい値に達して、保証が有効なときは、Microsoft Flow は地域の担当者にモバイル通知を送信します。</span><span class="sxs-lookup"><span data-stu-id="486d7-138">In this scenario, Microsoft Flow sends a mobile notification to a local technician when the coffee machine reaches certain temperature threshold and is under warranty.</span></span> <span data-ttu-id="486d7-139">**[ルール]** に移動して、条件を構成し、ルールが発動したときのアクションとしてフローを追加します。</span><span class="sxs-lookup"><span data-stu-id="486d7-139">Navigate to **Rules** to configure conditions and add a Flow as an action when the rule is fired.</span></span> 
 
> [!NOTE]
> <span data-ttu-id="486d7-140">Microsoft Flow を有効にするための Azure サブスクリプションがない場合、この演習は省略してかまいません。</span><span class="sxs-lookup"><span data-stu-id="486d7-140">This exercise is optional if you do not have an Azure subscription to turn on Microsoft Flow.</span></span>

<span data-ttu-id="486d7-141">コーヒー マシンが保証期間内のときの次のルールを追加します。</span><span class="sxs-lookup"><span data-stu-id="486d7-141">Add the following rules when the coffee machine is under warranty.</span></span> 

1. <span data-ttu-id="486d7-142">ルールの名前: コーヒー メーカーの水温が低すぎ (保証)</span><span class="sxs-lookup"><span data-stu-id="486d7-142">Name the rule: Coffee Maker Water Too Cold (Warranty)</span></span>

    <span data-ttu-id="486d7-143">条件の追加:</span><span class="sxs-lookup"><span data-stu-id="486d7-143">Add the conditions:</span></span>      
    * <span data-ttu-id="486d7-144">Device Warranty Expired equals 0</span><span class="sxs-lookup"><span data-stu-id="486d7-144">Device Warranty Expired equals 0</span></span>
    * <span data-ttu-id="486d7-145">Water Temperature is less than Coffee Makers Min Temperature ![ルールの使用](../images/5-flow-l.png)</span><span class="sxs-lookup"><span data-stu-id="486d7-145">Water Temperature is less than Coffee Makers Min Temperature ![Using Rule](../images/5-flow-l.png)</span></span>

1. <span data-ttu-id="486d7-146">ルールの名前: コーヒー メーカーの水温が高すぎ (保証)</span><span class="sxs-lookup"><span data-stu-id="486d7-146">Name the rule: Coffee Maker Water Too Hot (Warranty)</span></span>

    <span data-ttu-id="486d7-147">条件の追加:</span><span class="sxs-lookup"><span data-stu-id="486d7-147">Add the conditions:</span></span>      
    * <span data-ttu-id="486d7-148">Device Warranty Expired equals 0</span><span class="sxs-lookup"><span data-stu-id="486d7-148">Device Warranty Expired equals 0</span></span>
    * <span data-ttu-id="486d7-149">Water Temperature is greater than Coffee Makers Max Temperature ![ルールの使用](../images/5-flow-h.png)</span><span class="sxs-lookup"><span data-stu-id="486d7-149">Water Temperature is greater than Coffee Makers Max Temperature ![Using Rule](../images/5-flow-h.png)</span></span>

1. <span data-ttu-id="486d7-150">ルールの条件を保存した後、コーヒー メーカーが保証期間内のときの新しいアクションとして Microsoft Flow を選択します。</span><span class="sxs-lookup"><span data-stu-id="486d7-150">After you save the rule conditions, choose Microsoft Flow as a new action when the coffee maker is under warranty.</span></span> <span data-ttu-id="486d7-151">ブラウザー内に新しいタブまたはウィンドウが開き、Microsoft Flow が表示されます。</span><span class="sxs-lookup"><span data-stu-id="486d7-151">A new tab or window should open in your browser, taking you to Microsoft Flow.</span></span> <span data-ttu-id="486d7-152">概要ページが開き、カスタム アクションに接続している IoT Central コネクタが表示されます。</span><span class="sxs-lookup"><span data-stu-id="486d7-152">You land on an overview page showing an IoT Central connector connecting to a custom action.</span></span> <span data-ttu-id="486d7-153">**[続行]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="486d7-153">Choose **Continue**.</span></span> 

    <span data-ttu-id="486d7-154">ワークフローを作成するための Microsoft Flow デザイナーが表示されます。</span><span class="sxs-lookup"><span data-stu-id="486d7-154">You are taken to the Microsoft Flow designer to build your workflow.</span></span> <span data-ttu-id="486d7-155">ワークフローには、アプリケーションとルールが既に入力されている IoT Central トリガーが含まれています。</span><span class="sxs-lookup"><span data-stu-id="486d7-155">The workflow has an IoT Central trigger that has your Application and Rule already filled in.</span></span>

    <span data-ttu-id="486d7-156">ここでは、必要なすべてのアクションをワークフローに追加できます。</span><span class="sxs-lookup"><span data-stu-id="486d7-156">At this point, you can add any action you want to your workflow.</span></span> <span data-ttu-id="486d7-157">例として、モバイル通知を送信してみましょう。</span><span class="sxs-lookup"><span data-stu-id="486d7-157">As an example, let's send a mobile notification.</span></span> <span data-ttu-id="486d7-158">通知を検索し、[通知] > [Send me a mobile notification]\(モバイル通知を自分に送信する\) を選択します。</span><span class="sxs-lookup"><span data-stu-id="486d7-158">Search for notification, and choose Notifications - Send me a mobile notification.</span></span>

    <span data-ttu-id="486d7-159">このアクションの [テキスト] フィールドに通知の内容を入力します。</span><span class="sxs-lookup"><span data-stu-id="486d7-159">In the action, fill in the Text field with what you want your notification to say.</span></span> <span data-ttu-id="486d7-160">IoT Central ルールから動的なコンテンツを追加して、デバイスの ID や名前などの重要な情報を渡すことができます。</span><span class="sxs-lookup"><span data-stu-id="486d7-160">You can include Dynamic content from your IoT Central rule, passing along important information such as device ID and name.</span></span>
    <span data-ttu-id="486d7-161">![アクションとしての Microsoft Flow の使用](../images/5-flow-f.png)</span><span class="sxs-lookup"><span data-stu-id="486d7-161">![Using Microsoft Flow as an action](../images/5-flow-f.png)</span></span>

1. <span data-ttu-id="486d7-162">Microsoft Flow でのワークフローの設定が済んだら、Microsoft Store からモバイル デバイスに [Flow アプリ](https://www.microsoft.com/en-us/p/microsoft-flow/9nkn0p5l9n84?activetab=pivot%3aoverviewtab)をダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="486d7-162">Once you've set up the workflow in Microsoft Flow, download the [Flow app](https://www.microsoft.com/en-us/p/microsoft-flow/9nkn0p5l9n84?activetab=pivot%3aoverviewtab) from Microsoft Store to your mobile device.</span></span> <span data-ttu-id="486d7-163">Flow Web アプリでフローを設定するために使用したものと同じアカウントを使用してサインインします。</span><span class="sxs-lookup"><span data-stu-id="486d7-163">Sign in using the same account that you used to set up the flow in the Flow web app.</span></span> <span data-ttu-id="486d7-164">テストのため、最適範囲外の温度を設定してルールをトリガーします。</span><span class="sxs-lookup"><span data-stu-id="486d7-164">For testing purpose, set the optimal temperature out of range to trigger the rule.</span></span> 

    > [!NOTE]
    > <span data-ttu-id="486d7-165">デバイスのプロパティ: Device Warranty Expired (デバイス コードで 1 は保証期限切れ、0 は期間内) は、デバイスによってランダムに生成され、デバイスによって Azure IoT Central アプリケーションに送信されます。</span><span class="sxs-lookup"><span data-stu-id="486d7-165">Device Property: Device Warranty Expired (1 for expired or 0 for under warranty in the device code) is randomly generated by the device and then sent by the device to the Azure IoT Central application.</span></span> <span data-ttu-id="486d7-166">テストのため、Device Warranty Expired (1 または 0) を制御したい場合は、テストするアクションをトリガーする目的の保証状態を受信するまで、シミュレーターを再起動します。</span><span class="sxs-lookup"><span data-stu-id="486d7-166">For testing purpose, if you'd like to control Device Warranty Expired (1 or 0), reboot your simulator until you receive the intended warranty state to trigger the action that you're testing.</span></span> <span data-ttu-id="486d7-167">モバイル通知を受信するには、コンソール ログで Device Warranty Expired が 0 と表示されるまで、シミュレーターを再起動します。</span><span class="sxs-lookup"><span data-stu-id="486d7-167">To receive a mobile notification, reboot your simulator until you see that Device Warranty Expired is 0 in the console log.</span></span> 

    <span data-ttu-id="486d7-168">数分後、Flow モバイル アプリに通知が表示されます。</span><span class="sxs-lookup"><span data-stu-id="486d7-168">After several minutes, notification appears in the Flow mobile app.</span></span>

    ![アクションとしての Microsoft Flow の使用](../images/5-flow-a.png)

## <a name="summary"></a><span data-ttu-id="486d7-170">まとめ</span><span class="sxs-lookup"><span data-stu-id="486d7-170">Summary</span></span>
<span data-ttu-id="486d7-171">IoT Central でルールを作成する方法を学習し、ルールが発動したときに Microsoft Flow を介してメールやモバイル通知などのアクションをトリガーしました。</span><span class="sxs-lookup"><span data-stu-id="486d7-171">You’ve learned to create rules in IoT Central and triggered actions such as an email or a mobile notification through Microsoft Flow when the rule is fired.</span></span> <span data-ttu-id="486d7-172">この例では、コーヒー マシンの水温が最適範囲から外れると、保証の状態に応じて、通知が修理技術者またはクライアントに送信されます。</span><span class="sxs-lookup"><span data-stu-id="486d7-172">In this case, when the water temperature of the coffee machine is out of the optimal range, notifications are sent to either a repair technician or the client depending on the state of the warranty.</span></span> 


