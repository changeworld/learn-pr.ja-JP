このユニットでは、Azure portal を使用して、イベント ハブが想定どおりのパフォーマンスで動作していることを確認します。 また、イベント ハブが一時的に使用できなくなった場合にイベント ハブのメッセージングがどのように動作するかをテストし、Event Hubs メトリックを使用してイベント ハブのパフォーマンスを確認します。

## <a name="view-event-hub-activity"></a>イベント ハブのアクティビティの確認

1. サンドボックスをアクティブ化したときと同じアカウントを使用して、[Azure portal](https://portal.azure.com/learn.docs.microsoft.com?azure-portal=true) にサインインします。

1. 検索バーでイベント ハブを検索して開きます。

1. [概要] ページでメッセージ数を確認します。

    ![イベント ハブ名前空間とメッセージ数が表示されている Azure portal のスクリーン ショット。](../media/6-view-messages.png)

1. SimpleSend アプリケーションと EventProcessorSample アプリケーションは、100 件のメッセージを送信/受信するように構成されています。 イベント ハブが、SimpleSend アプリケーションからの 100 件のメッセージを処理し、EventProcessorSample アプリケーションに 100 件のメッセージを送信したことがわかります。

## <a name="test-event-hub-resilience"></a>イベント ハブの回復力のテスト

次の手順に従って、イベント ハブが一時的に使用できなくなっているときに、アプリケーションがメッセージを送信するとどうなるかを確認します。

1. SimpleSend アプリケーションを使用して、イベント ハブにメッセージを再送信します。 次のコマンドを使用します。

    ```azurecli
    cd ~
    cd azure-event-hubs/samples/Java/Basic/SimpleSend
    java -jar ./target/simplesend-1.0.0-jar-with-dependencies.jar
    ```

1. "**Send Complete...**" と表示されたら、<kbd>Enter</kbd> キーを押します。

1. **[概要]** 画面でイベント ハブを選択します。これで、イベント ハブに固有の詳細が表示されます。 ネームスペース ページの **[Azure Event Hubs]** エントリからこの画面を表示することもできます。

1. **[設定]** > **[プロパティ]** の順に選択します。

1. イベント ハブの状態の下で、**[無効]** をクリックします。 変更を保存します。

    ![イベント ハブの無効化](../media/7-disable-event-hub.png)

    **最低でも 5 分間待ちます。**

1. [イベント ハブの状態] の **[アクティブ]** をクリックしてイベント ハブを再度有効にし、変更を保存します。

1. EventProcessorSample アプリケーションを再実行して、メッセージを受信します。 次のコマンドを使用します。

    ```azurecli
    cd ~
    cd azure-event-hubs/samples/Java/Basic/EventProcessorSample
    java -jar ./target/eventprocessorsample-1.0.0-jar-with-dependencies.jar
    ```

1. メッセージがコンソールに表示されなくなったら、<kbd>Enter</kbd> キーを押します。

1. Azure portal で、イベント ハブの名前空間に戻ります。 [イベント ハブ] ページ上にいる場合は、画面上部のブレッドクラムを使用して後方に移動できます。 または、名前空間を検索して選択することもできます。

1. **[監視]** > **[メトリック (プレビュー)]** をクリックします。

    ![着信メッセージと発信メッセージの数が表示されたイベント ハブ メトリックを示すスクリーンショット。](../media/7-event-hub-metrics.png)

1. **[メトリック]** の一覧から **[受信メッセージ]** を選択し、**[メトリックの追加]** をクリックします。

1. **[メトリック]** の一覧から **[送信メッセージ]** を選択し、**[メトリックの追加]** をクリックします。

1. グラフの上部にある **[Last 24 hours (Automatic)]\(過去 24 時間 (自動)\)** をクリックして、期間を **[過去 30 分間]** に変更してデータ グラフを拡張します。

メッセージを送信したのはイベント ハブがしばらくオフラインになる前でしたが、100 件のメッセージがすべて正常に送信されていることがわかります。

## <a name="summary"></a>まとめ

このユニットでは、Event Hubs メトリックを使用して、イベント ハブがメッセージの送受信を正常に処理していることをテストしました。
