Web サイトとデータベースへのアクセス権を得た攻撃者を実行するいると仮定します。 攻撃者は攻撃では、dbo アカウントへのアクセスを得られるし、データベースで操作を実行することができます。 Dbo アカウントは、アクセスし、メタデータなどの情報を操作し、すべてのレベルのアクセスを実行できます。

攻撃者は、通常のユーザー アカウントへのアクセスのみ獲得場合、でしたのみアクセス テーブル、ビュー、ストアド プロシージャ、およびそのユーザー アカウントに対して定義されているその他のオブジェクト。 たとえば、データベースにアクセスする web サイトは、SQL インジェクション攻撃によって侵害された場合、自分の仕事でした攻撃者を制限は。

セキュリティ違反が発生した場合は、侵害の影響を軽減する役立ちます。 ユーザー層で SQL Azure データベースへのアクセスを制限する方法を見てみましょう。

## <a name="reduce-the-attack-surface-of-the-database"></a>データベースの攻撃対象領域を減らす

セキュリティ侵害の影響を減らすために、攻撃の対象範囲を制限します。 Dbo または管理者アカウントを使用して、データベースに接続しているし、攻撃者は、データベースへのアクセスを取得、攻撃者は、データベースのすべての操作を実行するアクセスがあります。 アクセスには、データベースのメタデータのクエリを実行する、どのようなデータが使用可能なまたは機密情報で確認してこの情報を悪用を含めることができます。

アクセス許可が制限されているデータベース ユーザーを作成して、このセキュリティ リスクを回避します。 ここでは、ユーザーは、テーブル、ビュー、ストアド プロシージャ、およびその作業を行うために必要なその他のエンティティへのアクセスにのみがある、最低限の特権の用語を使用します。

## <a name="create-a-database-user"></a>データベース ユーザーの作成

低い特権でのユーザーを作成するにはデータベース ユーザーを作成し、そのユーザーをデータベースに関連付けます。 SQL Server ユーザーを作成し、データベースにユーザーのアクセス許可を付与してみましょう。

> [!Note]
> 13 個 (13) SQL Server でのユーザーの種類があります。 別の種類のデータベース ユーザーを作成する必要がある場合は、適切なリンクを使用して、正しい構文を確認します。 参照してください[データベース ユーザーを作成](https://docs.microsoft.com/sql/relational-databases/security/authentication-access/create-a-database-user?view=sql-server-2017)です。

推奨されるプラクティスでは、データベース レベルでユーザーを作成します。 この手順では、保護しようとしているデータベースの継続的境界の外からは、ユーザー アクセスを許可できないようにします。

1. まず、データベースを選択します。
2. 次に、次のクエリを使用してユーザーを作成します。

   ```sql
   CREATE USER MyWebAppUser WITH PASSWORD = '<YourSuperStrongPassword>';
   ```

   前のクエリでは、ユーザーを作成します。 *MyWebUser*します。 既定では、ユーザーに任意のテーブル、ビュー、またはストアド プロシージャへのアクセスはありません。

3. 次に、db_datareader、db_datawriter などのロールに追加することで、ユーザーの適切なアクセス許可を作成します。

   Db_datareader ロールでは、すべてのユーザー テーブルおよびデータベース内のビューをユーザーのアクセスが許可されます。 同様に、db_datawriter ロールは、ユーザーに読み取り、書き込み、更新、アクセスを許可して、データベース内の行を削除します。

   ```sql
   ALTER ROLE db_datareader ADD MEMBER MyWebAppUser;
   ALTER ROLE db_datawriter ADD MEMBER MyWebAppUser;
   ```

DENY 演算子を使用して、データベース内の他の要素へのユーザーのアクセスを拒否することができます。 ここで、Customers テーブルからデータを選択する機能がユーザー MyWebAppUser を拒否しています。

```sql
DENY SELECT ON Customers TO MyWebAppUser;
```

ユーザーまたはロールにアクセス許可を明示的に付与するのにアクセス許可を付与を使用することもできます。

```sql
GRANT SELECT ON Customers TO MyWebAppUser;
```

データベースの操作を絞り込むために必要なアクセスのレベルにユーザーを取得するために進みます。 、ユーザーの代わりには、必要な最小のアクセス許可を持つロールを作成し、ロールにユーザーを追加します。

同じ権限を持つ複数のユーザーがある場合は、役割の一部としてそれらのユーザーを作成できます。 ユーザーは、すべてのアクセス許可を許可または拒否されていると、必要なものにのみアクセスがあります。
場合は、攻撃者は、新しく作成したユーザーを使用して、データベースへのアクセスを参照してくださいし、同じデータと、ユーザーが操作を実行するがのみ。 データベースへの攻撃の範囲を縮小が大幅にユーザーのアクセスをロックします。
