会社のセキュリティ管理者が潜在的なセキュリティ侵害が、ネットワーク上で検出されたことからアラートを受け取ったことを想像してください。 データベース サーバーを保護するために監査および監視を追加すること。

このユニットで、データベースに対する監査を構成する方法、およびこれらの監査を使用する方法に注目します。

## <a name="configure-auditing"></a>監査を構成します。

以降の検査のためのデータベースで発生する操作を格納する監査を有効にします。 またはが自動化されたツールに分析します。 コンプライアンスの管理や、データベースの使用方法については、監査も。 監査は、Azure 脅威の検出を Azure SQL database で使用する場合にも必要です。

データベースの監査を格納するためには、Azure ストレージ アカウントを監査履歴を格納する必要になります。

システムの監査を設定するための手順を見てみましょう。

1. ポータルで Azure SQL サーバーを選択します。

2. 左側の構成オプションで監査項目に移動します。 これは、セキュリティ カテゴリで表示されます。

3. 監査については、既定でオフにします。 データベース サーバーで有効にするには、ON ボタンをタップします。

4. ボタンを選択すると、ストレージ アカウントを定義する構成 ボタンを選択します。 既存のストレージ アカウントを選択したり、監査を格納する新しいストレージ アカウントを作成できます。 ストレージ アカウントは、サーバーと同じリージョンを使用するように構成する必要があります。

5. 変更を保存するには、ツールバーで、[保存] ボタンをクリックします。

これらのアクションは、データベースのサーバー レベルの監査を構成します。 データベース レベルで発生する監査を構成することもできます。

Advanced Threat Protection を今すぐ構成します。

## <a name="configure-advanced-threat-protection"></a>Advanced Threat Protection を構成します。

Advanced Threat Protection のシステムでは、潜在的な問題と、データベースに対する脅威を探すように監査ログを分析します。

システムで Advanced Threat Protection を構成するための手順を見てみましょう。

1. ポータルで Azure SQL サーバーを選択します。

2. 左側の構成オプションの Advanced Threat Protection の項目に移動します。 セキュリティ カテゴリを検索します。

3. '高度な脅威保護の有効化、サーバー上で' ボタンをクリックします。

4. Advanced Threat Protection スイッチを ON に変更します。

5. データベース システムのオプションを表示するビューの Advanced Threat Protection サーバーの設定を選択します。

6. 次に、通知電子メールがセミコロンのリストとして配信する区切りのメール アドレスを定義します。 電子メール サービスと共同管理者、サービス管理者への脅威の送信を選択します。

7. 今すぐサブスクリプションと、システム上のいずれかの脅威の分析されるストレージ アカウントを指定します。 サブスクリプションと Azure storage にはこのアカウントの監査用に構成します。 監査履歴を保持する日数を設定する必要があります。 0 に監査が永久に格納される値を設定します。

次に、監査に接続するためのストレージ アクセス キーを選択します。 オプションを構成した後は、[ok] を押します。

最後に、脅威検出の種類を設定します。 推奨されるオプションです。

すべては、次の値を表します。

- SQL インジェクションのレポートが、SQL インジェクション攻撃が発生しました。
- SQL インジェクションの脆弱性のレポートが SQL インジェクションの可能性がある可能性があります。そして
- 異常なクライアント ログインのログインを正規表現ではなく、潜在的な攻撃者アクセスなどの問題の原因になる可能性がありますを見ます。

をクリックして、**保存**変更を適用するボタンをクリックします。

脆弱性が検出されると、電子メール通知を受け取ります。 何が発生し、アクションを電子メールは概要を示します。

## <a name="enable-advanced-threat-protection"></a>Advanced Threat Protection を有効にします。

Advanced Threat Protection のサーバーを構成したら、個々 のデータベースのオプションが有効にします。 個々 のデータベースに移動し、' 高度な脅威保護の有効化、サーバー上で ' を選択して、Advanced Threat Protection を有効にします。

スキャンして、システムは 7 日おきの脆弱性を検索する定期的な反復スキャンを有効にできます。

定期的な定期的なスキャンのオプションを選択すると、スキャンが、設定を保存した後すぐに実行されます。

**[保存]** をクリックして、変更を保存します。

セキュリティ上の問題を通知する電子メール通知を受け取ります。 脅威にすぐに対応するを確認します。 さまざまな理由から、通知が表示可能性があります。

![Advanced Threat Protection からの例の通知警告](../media-draft/5-email-with-warning.png)

Advanced Threat Protection が実行されている場合は、Advanced Threat Protection オプションを選択すると、表示する問題の一覧が表示されます。 この一覧には、データの検出と分類の問題の機密データなど、システム、および潜在的な脅威の脆弱性の一覧を含めることができます。

![データの検出と分類](../media-draft/5-data-discovery-and-classification.png)

データの検出と分類のパネルには、保護する必要がある、テーブル内の列が表示されます。 一部の列、機密情報があります。 またはと思われる異なる国や地域に分類されています。

データの検出と分類のパネルをクリックします。

すべての列には、保護構成が必要がある場合、メッセージが表示されます。 このメッセージの形式になります *「分類の推奨事項の 10 個の列を発見しました」* します。 推奨事項を表示するテキストをクリックすることができます。

列の横にあるチェック マークをクリックして分類する列を選択またはスキーマ ヘッダーの左側にあるチェック ボックスを選択します。 分類の推奨事項を適用する Accept が選択されている推奨事項のオプションを選択します。

列を編集し、情報の種類とデータベースの機密ラベルを定義します。 変更を保存する [保存] ボタンをクリックします。

アクティブな推奨事項は表示されません、推奨事項を正常に管理しました。

![脆弱性評価のダッシュ ボード](../media-draft/5-vulnerability-assessment-dashboard.png)

脆弱性評価では、データベースと、関連するリスクの構成の問題が一覧表示します。 たとえば、上記の図で確認できますサーバー レベルのファイアウォールを設定する必要があります。

脆弱性の完全な一覧を確認する脆弱性評価のパネルをクリックします。 ここには、それぞれ個別の脆弱性をクリックします。

そのページで、脆弱性、および問題を解決する推奨される修復方法の説明に適用されるデータベースのリスク レベルなどの詳細が表示されます。 問題を解決する修復を適用します。 すべての脆弱性に対処してください。

![脅威の検出](../media-draft/5-threat-detection-dashboard.png)

最後のグラフには、脅威検出の一覧が表示されます。 たとえば、この一覧に潜在的な SQL インジェクション攻撃の数値が表示されます。

脆弱性のようには、脅威を確認するエントリの一覧に移動する脅威検出のパネルをクリックします。 推奨事項に従ってその問題に対処します。  SQL インジェクションの警告などの問題については、ことができますを調べて、クエリ、さかのぼって、コードでそのクエリが実行されている場所にします。 見つかると、問題がある不要になったため、コードを書き換えるします。
