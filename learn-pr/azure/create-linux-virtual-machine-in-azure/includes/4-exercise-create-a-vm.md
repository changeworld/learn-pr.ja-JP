目標は、Apache を実行している既存の Linux サーバーを Azure に移動することであることを思い出してください。 最初に、Ubuntu Linux サーバーを作成します。

## <a name="create-a-new-linux-virtual-machine"></a>新しい Linux 仮想マシンを作成する

Linux VM の作成は、Azure portal、Azure CLI、または Azure PowerShell で行うことができます。 Azure で始めるときの最も簡単な方法は、ポータルを使用することです。そうすれば、作成の間に、必要な情報が順番に示され、ヒントと有用なメッセージが提供されます。

1. [Azure portal](https://portal.azure.com?azure-portal=true) にサインインします。

1. Azure portal の左上隅にある **[リソースの作成]** をクリックします。

1. 検索ボックスに「**Ubuntu Server**」と入力し、使用できるバージョンを表示します。 表示された一覧から **Ubuntu Server 18.04** を選択します。

1. **[作成]** ボタンをクリックして、VM の構成を始めます。

## <a name="configure-the-vm-settings"></a>VM 設定を構成する

ポータルでの VM 作成エクスペリエンスは**ウィザード**の形式で提示され、VM のすべての構成領域が順番に示されます。 **[次へ]** ボタンをクリックすると、次の構成可能なセクションに移動します。 ただし、上部に並んでいるタブで各部分が示されており、自由にセクション間を移動できます。

![Ubuntu Server マシン用の最初の仮想マシン作成ブレードが表示されている Azure portal のスクリーンショット。](../media/3-azure-portal-create-vm.png)

必須のオプション (赤い星で示されたもの) をすべて入力したら、残りのウィザード エクスペリエンスをスキップし、下部にある **[確認および作成]** ボタンをクリックして VM の作成を始めることができます。

最初は **[基本]** セクションです。

### <a name="configure-basic-vm-settings"></a>VM の基本設定を構成する

1. VM 時間の請求対象である **[サブスクリプション]** を選択します。

1. **[リソース グループ]** で **[新規作成]** を選択し、リソース グループに「**ExerciseResources**」という名前を付けます。

> [!NOTE]  
> 設定を変更してフィールドから移動すると、各値が自動的に検証されて、問題がない場合は横に緑色のチェック マークが表示されます。 エラー インジケーターをポイントすると、検出された問題についての詳細が表示されます。

1. **[インスタンスの詳細]** セクションで、Web サーバー VM の名前を入力します (例: **test-web-eus-vm1**)。 この名前は、環境 (**test**)、ロール (**web**)、場所 (**米国東部**)、サービス (**vm**)、インスタンス番号 (**1**) を示します。
    - 目的を簡単に識別できるように、リソース名を標準化するのがベスト プラクティスです。 Linux VM の名前は、1 から 64 文字の範囲で、数字、文字、ダッシュで構成されている必要があります。

1. 近くのリージョンを選択します (ここでは**米国東部**)。

1. **可用性オプション**は **[なし]** のままにします。 このオプションは、複数の VM をグループ化して計画的または計画外のメンテナンス イベントや停止に対処することで、VM を高可用性にするために使用されます。

1. イメージが **Ubuntu Server 18.04 LTS** に設定されていることを確認します。 ドロップダウン リストを開いて、使用可能なすべてのオプションを確認できます。

1. **[サイズ]** フィールドを直接編集することはできず、汎用コンピューティングの選択肢の 1 つである既定サイズ **[DS2_v3]** になっています。 この選択はパブリック Web サーバーに最適ですが、**[Change size]\(サイズの変更\)** リンクをクリックして他の VM サイズを調べます。 結果のダイアログでは、**CPU の数**、**名前**、**ディスクの種類**に基づいてフィルター処理できます。 2 個の vCPU と 8 GB の RAM を提供する同じ **[DS2_v3]** を選択します。

    > [!TIP]
    > ビューを左側にスライドして新しいウィンドウを開いたときの VM 設定に戻し、ウィンドウをスライドしてそれを表示することもできます。

1. **[ADMINISTRATOR ACCESS]\(管理者アクセス\)** セクションで、**[認証の種類]** に対して SSH 公開キー オプションを選択します。

1. SSH でサインインするために使用する**ユーザー名**を入力します。

1. 公開キー ファイルから SSH キーをコピーして、**[SSH 公開キー]** フィールドに貼り付けます。

> [!IMPORTANT]
> Azure portal に公開キーをコピーするときは、余分な空白文字や改行文字が追加されないように注意してください。

1. **[受信ポートの規則]** セクションで一覧を開き、**[なし]** をオフにします。 これは Linux VM なので、リモートで SSH を使用して VM にアクセスできるようにします。 必要に応じて一覧をスクロールし、**ssh (22)** を見つけて選択します。 UI の注意事項が示すとおり、VM を作成した後でネットワーク ポートを調整することもできます。

    ![説明したように SSH アクセス用に Linux VM を開くための管理者アカウントと受信ポートの設定が表示されている Azure portal のスクリーンショット。](../media/3-open-ports.png) 

## <a name="configure-disks-for-the-vm"></a>VM 用にディスクを構成する

1. **[次へ]** をクリックして、**[ディスク]** セクションに移動します。

    ![[仮想マシンの作成] ブレードの [ディスク] セクションが表示されている Azure portal のスクリーンショット。](../media/3-configure-disks.png) 

1. **[OS ディスクの種類]** で **[Premium SSD]** を選択します。

1. マネージド ディスクを使用するので、ストレージ アカウントを使用する必要はありません。 GUI でスイッチを切り替えて、Azure で必要な情報の違いを確認できます。

### <a name="create-a-data-disk"></a>データ ディスクを作成する

OS ディスク (/dev/sda) と一時ディスク (/dev/sda) を使用することを思い出してください。 データ ディスクも追加してみましょう。

1. **[データ ディスク]** セクションで **[Create and attach a new disk]\(新しいディスクの作成とアタッチ\)** リンクをクリックします。

    ![[新しいディスクを作成する] ブレードが表示されている Azure portal のスクリーンショット。](../media/3-add-data-disk.png) 

1. すべての既定値を使用できます (Premium SSD、1023 GB、および**なし** (空のディスク))。ただし、ここではスナップショットまたは Azure Blob Storage を使用して VHD を作成することに注意してください。

1. **[OK]** をクリックしてディスクを作成し、**[データ ディスク]** セクションに戻ります。

1. 最初の行に新しいディスクが表示されるはずです。

    ![VM 作成プロセスで新しく作成されたデータ ディスクの行が表示されている Azure portal のスクリーンショット。](../media/3-new-disk.png) 

## <a name="configure-the-network"></a>ネットワークを構成する

1. **[次へ]** をクリックして、**[ネットワーク]** セクションに移動します。

1. 既に他のコンポーネントがある運用システムでは、"_既存の_" 仮想ネットワークを利用します。 そうすれば、VM はソリューション内の他のクラウド サービスと通信できます。 この場所でまだ定義されていない場合は、ここで作成して構成できます。
    - **[アドレス空間]**: このネットワークに使用できる IPV4 空間全域。
    - **[Subnet range]\(サブネット範囲\)**: アドレス空間を分割する最初のサブネット。定義されているアドレス空間内に収まる必要があります。 VNet が作成された後、別のサブネットを追加できます。

> [!NOTE]  
> 既定では、Azure によって VM 用に仮想ネットワーク、ネットワーク インターフェイス、パブリック IP が作成されます。 VM が作成された後でネットワーク オプションを変更するのは簡単ではないので、Azure で作成するサービスでのネットワーク割り当てを常に再確認してください。

## <a name="finish-configuring-the-vm-and-create-the-image"></a>VM の構成を完了してイメージを作成する

残りのオプションは既定値で問題ないので、どれも変更する必要はありません。 そうしたければ、他のタブを調べてもかまいません。 個々のオプションの横には `(i)` アイコンがあり、オプションを説明するヘルプ バブルが表示されます。 これは、VM の構成に使用できるさまざまなオプションについて学習するのによい方法です。

1. パネルの下部にある **[確認および作成]** ボタンをクリックします。

1. システムによってオプションが検証され、作成される VM についての詳細が表示されます。

1. **[作成]** をクリックして VM を作成し、デプロイします。 Azure ダッシュボードにはデプロイされている VM が表示されます。 これには数分かかる場合があります。

デプロイが行われている間に、この VM でできることを見てみましょう。