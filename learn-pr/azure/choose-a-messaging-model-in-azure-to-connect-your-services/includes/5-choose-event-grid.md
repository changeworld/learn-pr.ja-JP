多くのアプリケーションでは、何かが発生したときやいくつかのオブジェクトが変更されたとき、パブリックサブスクライブ モデルを使用して、分散されているコンポーネントに通知を行います。 Azure で実行される Web API を使用する音楽共有アプリケーションがあるとします。 あるユーザーから新しい曲がアップロードされた場合、アップロードされたジャンルに関心を持つ世界中のユーザーのデバイスを対象に、インストールされているすべてのモバイル アプリに通知する必要があります。

このようなアーキテクチャの場合、音声ファイルの発行者は、共有される音楽に関心を持つサブスクライバーを知っている必要はありません。 さらに、この新しい音楽と、それに関心があるかどうかを任意で決めることができる複数のサブスクライバーという、一対多の関係を持たせたいところです。 Azure Event Grid は、このようなアーキテクチャに最適なソリューションです。

## <a name="what-is-event-grid"></a>Event Grid とは
Event Grid とは、Azure Blob Storage アカウントや Azure Media Services などのさまざまなソースから Azure Functions や Web Hooks などへのさまざまなサブスクライバーに_イベント_を配布するサービスです。

### <a name="what-is-an-event-source"></a>イベント ソースとは
イベント ソースとは、イベントを生成できるコンポーネントです ("パブリッシャー" とも呼ばれます)。 たとえば、ユーザーが Microsoft の Web API を介して BLOB ストレージ アカウントに新しい曲を追加するとします。 その結果、Event Grid から関心のあるイベント サブスクライバーに配布できるイベントが生成されます。 パブリッシャーはイベントを送信しますが、その受信側や処理側には何も期待していません。

### <a name="what-is-an-event-subscriber"></a>イベント サブスクライバーとは
イベント サブスクライバーとは、Event Grid からイベントを受け取ることができるすべてのコンポーネントです。 たとえば、Azure Functions は、新しい曲が BLOB ストレージ アカウントに追加されたことに応答してコードを実行できます。 サブスクライバーは、処理するイベントを決めることができます。新しいイベントが使用できるようになると、関心のある各サブスクライバーに Event Grid から効率的に通知されます。ポーリングは必要ありません。

Event Grid は、ほとんどの Azure サービスをパブリッシャーまたはサブスクライバーとしてサポートしています。また、サードパーティのサービスでも使用できます。 そのため、パブリッシャーからサブスクライバーに状態の変化について通知できる、動的にスケーラブルで低コストのメッセージング システムを実現できます。

![Event Grid のソースとサブスクライバーの図](../images/6-event-grid.png)

> [!NOTE]
> Event Grid は、何らかの変化について通知するイベントをサブスクライバーに送信しますが、変更された_実際のオブジェクト_はイベント配信には含まれません。

## <a name="types-of-event-sources"></a>イベント ソースの種類
イベントは、次の種類の Azure リソースを使用して生成することができます。

- **Azure サブスクリプションとリソース グループ。** サブスクリプションおよびリソース グループは、Azure の管理オプションに関連するイベントを生成します。 たとえば、ユーザーが仮想マシンを作成した場合、このソースによってイベントが生成されます。
- **ストレージ アカウント。** ストレージ アカウントは、ユーザーが BLOB、ファイル、テーブル エントリ、またはキュー メッセージを追加するときにイベントを生成します。 イベント ソースとしては、BLOB アカウントと汎用アカウントの両方を使用できます。
- **Media Services。** Media Services は、動画および音声メディアをホストし、メディア ファイルの高度な管理機能を提供します。 Media Services では、エンコード ジョブが動画ファイルで開始されたときや完了したときに、イベントが生成されます。
- **Azure IoT Hub。** IoT Hub は、IoT デバイスと通信し、それらからテレメトリを収集します。 そのような通信を受信すると、イベントが生成されます。
- **カスタム イベント。** カスタム イベントは、REST API を使用するか、Java、GO、.NET、Node、Python および Ruby 上で Azure SDK を使用して生成されます。 たとえば、Azure App Service の Web Apps 機能で、カスタム イベントを作成できます。 これは、ストレージ キューからメッセージがピックアップされると、ワーカー ロールで発生する場合があります。

Azure のさまざまなイベント ソースが広範囲に統合されていることにより、Event Grid がほぼすべての Azure リソースに関連するイベントを配信できることが保証されています。

## <a name="topics"></a>トピック
Event Grid のトピックとは、関連イベントのコレクションです。 ソースからイベントが発行されるとき、それらのイベントでトピックが 1 つのみ必要か、複数のトピックに分割するかを決定する必要があります。 イベントを受信して処理するコンポーネントは、受信するイベントを決定するために、トピックにサブスクライブします。

## <a name="subscriptions"></a>サブスクリプション
イベント ハンドラーはサブスクリプションを使用して、トピック内のどのイベントを受け取るか Event Grid に伝えます。 サブスクリプションは、Event Grid がイベント通知を送信する場所であるエンドポイントの修正も行います。 サブスクリプションでは、その種類またはその件名でイベントをフィルタリングして、イベント ハンドラーが該当するイベントのみを受け取るようにすることもできます。

## <a name="event-handlers"></a>イベント ハンドラー
Azure の次のオブジェクト型では、Event Grid からイベントを受け取ってそれを処理することができます。

- **Azure Functions。** Azure Function は、ホスト仮想サーバーやコンテナーなしで Azure で実行されるカスタム コードで構成されます。 イベントに対する応答をコードでカスタマイズする場合、Azure Function をイベント ハンドラーとして使用します。
- **Webhook。** Webhook とは、プッシュ アーキテクチャを実装する Web API です。
- **Azure Logic Apps。** Azure Logic Apps は、ワークフローとして、ビジネス プロセスをホストします。
- **Microsoft Flow。** Flow でも、ワークフローがホストされます。技術スタッフ以外が簡単に使用できます。

## <a name="should-you-use-event-grid"></a>Event Grid を使用する場合
次の機能が必要な場合に、Event Grid を使用します。

- **簡単さ。** Event Grid では、ソースをサブスクライバーに容易に接続することができます。
- **高度なフィルタリング。** サブスクリプションでは、トピックから受け取るイベントを厳しく制限できます。
- **展開。** 同じイベントやトピックにエンドポイントを無制限にサブスクライブさせることができます。
- **信頼性。** Event Grid では、イベントの配信を、各サブスクリプションに対して最大で 24 時間再試行します。
- **イベントあたり従量課金。** 送信するイベント数のみに対して支払いが行われます。

## <a name="summary"></a>まとめ
Event Grid は、単純ですが、汎用的なイベント配信システムです。 これを使用すると、確実かつ迅速に個別のイベントをサブスクライバーに配信できます。 検討するメッセージング モデルはもう 1 つあります。大規模な_ストリーム_のイベントを配信するにはどうすればよいでしょうか。 このようなシナリオの場合、Event Grid は、一度の配信で 1 つのイベントを配信するように設計されているため、最適ではありません。 代わりに、別の Azure サービスである Event Hubs に目を向ける必要があります。