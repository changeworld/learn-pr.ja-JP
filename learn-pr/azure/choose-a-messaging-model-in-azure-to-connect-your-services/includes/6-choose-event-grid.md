多くのアプリケーションでは、何かが発生したときやいくつかのオブジェクトが変更されたとき、イベントを使用して、分散されているコンポーネントに通知を行います。 それらのイベントは、Azure で Azure Event Grid を使用して、簡単に配布することができます。

Azure で実行される Web API を使用する音楽共有アプリケーションがあるとします。 ユーザーが新しい音声ファイルをアップロードした場合、世界中のユーザー デバイスにインストールされているモバイル アプリにそれを通知する必要があります。

これを確実に迅速に実行するには、Event Grid へのサブスクリプションを使用できます。

## <a name="what-is-event-grid"></a>Event Grid とは

Event Grid とは、Azure Blob Storage アカウントや Azure Media Services などのソースから Azure Functions や Webhook などのサブスクライバーにイベントを配布するサービスです。

イベント ソースとは、イベントを生成することができるすべてのコンポーネントです。 たとえば、ユーザーが Blob Storage アカウントに新しいメディア ファイルを追加するとします。 これにより Event Grid が配布できるイベントが生成されます。

イベント サブスクライバーとは、Event Grid からイベントを受け取ることができるすべてのコンポーネントです。 たとえば、Functions では、BLOB ストレージ アカウントの新しいメディア ファイルに応答するコードを実行できます。

Event Grid は、複数のサブスクライバーにソースを接続するのを容易にします。

![Event Grid のソースとサブスクライバーの図](../images/6-event-grid.png)

## <a name="event-sources"></a>イベント ソース

イベントは、次の種類の Azure リソースを使用して生成することができます。

- **Azure サブスクリプションとリソース グループ。** サブスクリプションおよびリソース グループは、Azure の管理オプションに関連するイベントを生成します。 たとえば、ユーザーが仮想マシンを作成した場合、このソースによってイベントが生成されます。
- **ストレージ アカウント。** ストレージ アカウントは、ユーザーが BLOB、ファイル、テーブル エントリ、またはキュー メッセージを追加するときにイベントを生成します。 イベント ソースとしては、BLOB アカウントと汎用アカウントの両方を使用できます。
- **Media Services。** Media Services は、動画および音声メディアをホストし、メディア ファイルの高度な管理機能を提供します。 Media Services では、エンコード ジョブが動画ファイルで開始されたときや完了したときに、イベントが生成されます。
- **Azure IoT Hub。** IoT Hub は、IoT デバイスと通信し、それらからテレメトリを収集します。 そのような通信を受信すると、イベントが生成されます。
- **カスタム イベント。** カスタム イベントは、REST API を使用するか、Java、GO、.NET、Node、Python および Ruby 上で Azure SDK を使用して生成されます。 たとえば、Azure App Service の Web Apps 機能で、カスタム イベントを作成できます。 これは、ストレージ キューからメッセージがピックアップされると、ワーカー ロールで発生する場合があります。

Azure のさまざまなイベント ソースが広範囲に統合されていることにより、Event Grid がほぼすべての Azure リソースに関連するイベントを配信できることが保証されています。

## <a name="topics"></a>トピック

Event Grid のトピックとは、関連イベントのコレクションです。 ソースからイベントが発行されるとき、それらのイベントでトピックが 1 つのみ必要か、複数のトピックに分割するかを決定する必要があります。 イベントを受信して処理するコンポーネントは、受信するイベントを決定するために、トピックにサブスクライブします。

## <a name="subscriptions"></a>サブスクリプション

イベント ハンドラーはサブスクリプションを使用して、トピック内のどのイベントを受け取るか Event Grid に伝えます。 サブスクリプションは、Event Grid がイベント通知を送信する場所であるエンドポイントの修正も行います。 サブスクリプションでは、その種類またはその件名でイベントをフィルタリングして、イベント ハンドラーが該当するイベントのみを受け取るようにすることもできます。

## <a name="event-handlers"></a>イベント ハンドラー

Azure の次のオブジェクト型では、Event Grid からイベントを受け取ってそれを処理することができます。

- **Azure Functions。** Azure Function は、ホスト仮想サーバーやコンテナーなしで Azure で実行されるカスタム コードで構成されます。 イベントに対する応答をコードでカスタマイズする場合、Azure Function をイベント ハンドラーとして使用します。
- **Webhook。** Webhook とは、プッシュ アーキテクチャを実装する Web API です。
- **Azure Logic Apps。** Azure Logic Apps は、ワークフローとして、ビジネス プロセスをホストします。
- **Microsoft Flow。** Flow でも、ワークフローがホストされます。技術スタッフ以外が簡単に使用できます。

## <a name="how-to-choose"></a>選択する方法

次の機能が必要な場合に、Event Grid を使用します。

- **簡単さ。** Event Grid では、ソースをサブスクライバーに容易に接続することができます。
- **高度なフィルタリング。** サブスクリプションでは、トピックから受け取るイベントを厳しく制限できます。
- **展開。** 同じイベントやトピックにエンドポイントを無制限にサブスクライブさせることができます。
- **信頼性。** Event Grid では、イベントの配信を、各サブスクリプションに対して最大で 24 時間再試行します。
- **イベントあたり従量課金。** 送信するイベント数のみに対して支払いが行われます。

## <a name="summary"></a>まとめ

Event Grid は、単純ですが、汎用的なイベント配信システムです。 これを使用すると、確実かつ迅速にそれらのイベントをサブスクライバーに発行できます。