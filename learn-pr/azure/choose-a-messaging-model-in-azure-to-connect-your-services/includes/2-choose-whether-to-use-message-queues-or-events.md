<span data-ttu-id="3f080-101">あなたは、分散型の音楽共有アプリケーションのアーキテクチャを計画しているとします。</span><span class="sxs-lookup"><span data-stu-id="3f080-101">Suppose you are planning the architecture of a distributed music-sharing application.</span></span> <span data-ttu-id="3f080-102">このアプリケーションの信頼性とスケーラビリティをできるだけ高くする必要があるため、Azure のテクノロジを使用して堅牢な通信インフラストラクチャを構築しようとしています。</span><span class="sxs-lookup"><span data-stu-id="3f080-102">You want to ensure that the application is as reliable and scalable as possible, and you intend to use Azure technologies to build a robust communication infrastructure.</span></span>

<span data-ttu-id="3f080-103">適切な Azure テクノロジを選択するには、まずアプリケーションのコンポーネントが交わす個々の通信について理解しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="3f080-103">Before you can choose the right Azure technology, you must understand each individual communication that the components of the application exchange.</span></span> <span data-ttu-id="3f080-104">通信ごとに異なる Azure テクノロジを選択できます。</span><span class="sxs-lookup"><span data-stu-id="3f080-104">For each communication you can choose a different Azure technology.</span></span>

<span data-ttu-id="3f080-105">通信についてまず理解しなければならないのは、**メッセージ**と**イベント**のどちらを送信するかということです。</span><span class="sxs-lookup"><span data-stu-id="3f080-105">The first thing to understand about a communication is whether it sends **messages** or **events**.</span></span> <span data-ttu-id="3f080-106">これは基本となる選択の 1 つであり、使用する Azure サービスを適切に選択するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="3f080-106">This is a fundamental choice that will help you choose the appropriate Azure service to use.</span></span>

#### <a name="communication-strategies-in-azure-apis"></a><span data-ttu-id="3f080-107">(Api) を Azure での通信方法</span><span class="sxs-lookup"><span data-stu-id="3f080-107">Communication strategies in Azure (APIs)</span></span>

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE2yuaw]

## <a name="what-is-a-message"></a><span data-ttu-id="3f080-108">メッセージとは何でしょうか。</span><span class="sxs-lookup"><span data-stu-id="3f080-108">What is a message?</span></span>
<span data-ttu-id="3f080-109">分散アプリケーションの用語で、**メッセージ**には次の特性があります。</span><span class="sxs-lookup"><span data-stu-id="3f080-109">In the terminology of distributed applications, **messages** have the following characteristics:</span></span>

- <span data-ttu-id="3f080-110">メッセージには、1 つのコンポーネントによって生成され、別のコンポーネントで使用される生のデータが含まれています。</span><span class="sxs-lookup"><span data-stu-id="3f080-110">A message contains raw data, produced by one component, that will be consumed by another component.</span></span>
- <span data-ttu-id="3f080-111">メッセージには、データへの参照だけでなく、データ自体が含まれています。</span><span class="sxs-lookup"><span data-stu-id="3f080-111">A message contains the data itself, not just a reference to that data.</span></span>
- <span data-ttu-id="3f080-112">送信側コンポーネントは、メッセージのコンテンツが宛先コンポーネントによって特定の方法で処理されることを想定しています。</span><span class="sxs-lookup"><span data-stu-id="3f080-112">The sending component expects the message content to be processed in a certain way by the destination component.</span></span> <span data-ttu-id="3f080-113">システム全体の整合性は、特定のジョブを実行する送信側と受信側の両方によって決まる場合があります。</span><span class="sxs-lookup"><span data-stu-id="3f080-113">The integrity of the overall system may depend on both sender and receiver doing a specific job.</span></span>

<span data-ttu-id="3f080-114">たとえば、ユーザーがモバイルの音楽共有アプリを使用して新しい曲をアップロードするとします。</span><span class="sxs-lookup"><span data-stu-id="3f080-114">For example, suppose a user uploads a new song by using the mobile music-sharing app.</span></span> <span data-ttu-id="3f080-115">モバイル アプリは、Azure で実行されている Web API にその曲を送信する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3f080-115">The mobile app must send that song to the web API that runs in Azure.</span></span> <span data-ttu-id="3f080-116">新しい曲が追加されたことを示すアラートだけでなく、曲のメディア ファイル自体を送信する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3f080-116">The song media file itself must be sent, not just an alert that indicates that a new song has been added.</span></span> <span data-ttu-id="3f080-117">モバイル アプリは、Web API が新しい曲をデータベースに格納し、他のユーザーが利用できるようにすることを想定しています。</span><span class="sxs-lookup"><span data-stu-id="3f080-117">The mobile app expects that the web API will store the new song in the database and make it available to other users.</span></span> <span data-ttu-id="3f080-118">これはメッセージの例です。</span><span class="sxs-lookup"><span data-stu-id="3f080-118">This is an example of a message.</span></span>

## <a name="what-is-an-event"></a><span data-ttu-id="3f080-119">イベントとは何でしょうか。</span><span class="sxs-lookup"><span data-stu-id="3f080-119">What is an event?</span></span>

<span data-ttu-id="3f080-120">**イベント**はメッセージよりも軽量で、ほとんどの場合はブロードキャスト通信に使用されます。</span><span class="sxs-lookup"><span data-stu-id="3f080-120">**Events** are lighter weight than messages, and are most often used for broadcast communications.</span></span> <span data-ttu-id="3f080-121">イベントを送信するコンポーネントは**パブリッシャー**と呼ばれ、受信側は**サブスクライバー**と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="3f080-121">The components sending the event are known as **publishers**, and receivers are known as **subscribers**.</span></span>

<span data-ttu-id="3f080-122">イベントを使用するときは、基本的に受信側コンポーネントがどの通信に関心があるかを決定して、その通信を "サブスクライブ" します。</span><span class="sxs-lookup"><span data-stu-id="3f080-122">With events, receiving components will generally decide in which communications they are interested, and will "subscribe" to those.</span></span> <span data-ttu-id="3f080-123">サブスクリプションの管理は通常、Azure Event Grid や Azure Event Hubs などの仲介役が行います。</span><span class="sxs-lookup"><span data-stu-id="3f080-123">The subscription is usually managed by an intermediary, like Azure Event Grid or Azure Event Hubs.</span></span> <span data-ttu-id="3f080-124">パブリッシャーがイベントを送信すると、仲介役は関心を持っているサブスクライバーにそのイベントをルーティングします。</span><span class="sxs-lookup"><span data-stu-id="3f080-124">When publishers send an event, the intermediary will route that event to interested subscribers.</span></span> <span data-ttu-id="3f080-125">これを、"パブリッシュ/サブスクライブ アーキテクチャ" といいます。</span><span class="sxs-lookup"><span data-stu-id="3f080-125">This is known as a "publish-subscribe architecture."</span></span> <span data-ttu-id="3f080-126">これがイベントを扱う唯一の方法ではありませんが、最も一般的です。</span><span class="sxs-lookup"><span data-stu-id="3f080-126">It is not the only way to deal with events, but it is the most common.</span></span>

<span data-ttu-id="3f080-127">イベントには次の特性があります。</span><span class="sxs-lookup"><span data-stu-id="3f080-127">Events have the following characteristics:</span></span>

- <span data-ttu-id="3f080-128">イベントは、何かが発生したことを示す軽量の通知です。</span><span class="sxs-lookup"><span data-stu-id="3f080-128">An event is a lightweight notification that indicates that something happened.</span></span>
- <span data-ttu-id="3f080-129">送信されたイベントの受信者が複数のこともあれば、まったくいないこともあります。</span><span class="sxs-lookup"><span data-stu-id="3f080-129">The event may be sent to multiple receivers, or to none at all.</span></span>
- <span data-ttu-id="3f080-130">多くの場合、イベントは "ファンアウト" を意図しています。つまり、パブリッシャーのそれぞれに対して多数のサブスクライバーが存在します。</span><span class="sxs-lookup"><span data-stu-id="3f080-130">Events are often intended to "fan out," or have a large number of subscribers for each publisher.</span></span>
- <span data-ttu-id="3f080-131">イベントのパブリッシャーは、受信側コンポーネントがどのようなアクションを実行するかについて何も想定していません。</span><span class="sxs-lookup"><span data-stu-id="3f080-131">The publisher of the event has no expectation about the action a receiving component takes.</span></span>
- <span data-ttu-id="3f080-132">一部のイベントは個別のユニットであり、他のイベントに関連しません。</span><span class="sxs-lookup"><span data-stu-id="3f080-132">Some events are discrete units and unrelated to other events.</span></span> 
- <span data-ttu-id="3f080-133">あるいは、一連の関連するイベントに順序が付けられることもあります。</span><span class="sxs-lookup"><span data-stu-id="3f080-133">Some events are part of a related and ordered series.</span></span>  

<span data-ttu-id="3f080-134">たとえば、音楽ファイルのアップロードが完了し、新しい曲がデータベースに追加されたとします。</span><span class="sxs-lookup"><span data-stu-id="3f080-134">For example, suppose the music file upload has been completed, and the new song has been added to the database.</span></span> <span data-ttu-id="3f080-135">新しいファイルのことをユーザーに知らせるために、Web API は Web フロント エンドとモバイル アプリのユーザーに新しいファイルのことを通知する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3f080-135">In order to inform users of the new file, the web API must inform the web front end and mobile app users of the new file.</span></span> <span data-ttu-id="3f080-136">ユーザーは、その新しい曲を聴くかどうかを選択できます。したがって、最初の通知には音楽ファイルは含まれず、その曲が存在することだけをユーザーに通知します。</span><span class="sxs-lookup"><span data-stu-id="3f080-136">The users can choose whether to listen to the new song, so the initial notification does not include the music file but only notifies users that the song exists.</span></span> <span data-ttu-id="3f080-137">送信側は、イベントの受信側がこのイベント受信に応答して特に何かを実行することは、想定していません。</span><span class="sxs-lookup"><span data-stu-id="3f080-137">The sender does not have a specific expectation that the event receivers will do anything particular in responsiveness of receiving this event.</span></span>

<span data-ttu-id="3f080-138">これは、個別のイベントの例です。</span><span class="sxs-lookup"><span data-stu-id="3f080-138">This is an example of a discrete event.</span></span>

## <a name="how-to-choose-messages-or-events"></a><span data-ttu-id="3f080-139">メッセージまたはイベントを選択する方法</span><span class="sxs-lookup"><span data-stu-id="3f080-139">How to choose messages or events</span></span>

<span data-ttu-id="3f080-140">1 つのアプリケーションが、ある目的のためにイベントを使用し、別の目的のためにメッセージを使用するということはよくあります。</span><span class="sxs-lookup"><span data-stu-id="3f080-140">A single application is likely to use events for some purposes and messages for others.</span></span> <span data-ttu-id="3f080-141">選択を行う前に、アプリケーションのアーキテクチャとそのすべてのユース ケースを分析して、そのコンポーネントが相互に通信する際のさまざまな目的をすべて識別する必要があります。</span><span class="sxs-lookup"><span data-stu-id="3f080-141">Before you choose, you must analyze your application's architecture and all its use cases, to identify all the different purposes where its components have to communicate with each other.</span></span>

<span data-ttu-id="3f080-142">イベントは、ブロードキャストに使用される可能性が高く、多くの場合に一時的です。つまり、通信が現在サブスクライブされていない場合、受信側で処理されない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="3f080-142">Events are more likely to be used for broadcasts and are often ephemeral, meaning a communication might not be handled by any receiver if none are currently subscribing.</span></span> <span data-ttu-id="3f080-143">メッセージが使用される可能性が高いのは、分散アプリケーションで通信の処理を保証する必要がある場合です。</span><span class="sxs-lookup"><span data-stu-id="3f080-143">Messages are more likely to be used where the distributed application requires a guarantee that the communication will be processed.</span></span>

<span data-ttu-id="3f080-144">通信のそれぞれについて、**送信側コンポーネントはその通信が宛先コンポーネントによって特定の方法で処理されることを想定しているか?** を考えてみてください。</span><span class="sxs-lookup"><span data-stu-id="3f080-144">For each communication, consider the following question: **Does the sending component expect the communication to be processed in a particular way by the destination component?**</span></span>

<span data-ttu-id="3f080-145">答えが _"はい"_ の場合は、メッセージを使用します。</span><span class="sxs-lookup"><span data-stu-id="3f080-145">If the answer is _yes_, choose to use a message.</span></span> <span data-ttu-id="3f080-146">答えが _"いいえ"_ の場合は、イベントを使用できる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="3f080-146">If the answer is _no_, you may be able to use events.</span></span>

<span data-ttu-id="3f080-147">コンポーネントがどのように通信する必要があるかを理解することは、コンポーネントの通信方法を選択するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="3f080-147">Understanding how your components need to communicate will help you to choose how your components will communicate.</span></span> <span data-ttu-id="3f080-148">では、初めにメッセージについて見ていきましょう。</span><span class="sxs-lookup"><span data-stu-id="3f080-148">Let's start with messages.</span></span>