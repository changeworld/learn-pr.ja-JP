あなたは、分散型の音楽共有アプリケーションのアーキテクチャを計画しているとします。 このアプリケーションの信頼性とスケーラビリティをできるだけ高くする必要があるため、Azure のテクノロジを使用して堅牢な通信インフラストラクチャを構築しようとしています。

適切な Azure テクノロジを選択するには、まずアプリケーションのコンポーネントが交わす個々の通信について理解しておく必要があります。 通信ごとに異なる Azure テクノロジを選択できます。

通信についてまず理解しなければならないのは、**メッセージ**と**イベント**のどちらを送信するかということです。 これは基本となる選択の 1 つであり、使用する Azure サービスを適切に選択するのに役立ちます。

#### <a name="communication-strategies-in-azure-apis"></a>Azure での通信方法 (API)

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE2yuaw]

## <a name="what-is-a-message"></a>メッセージとは
分散アプリケーションの用語で、**メッセージ**には次の特性があります。

- メッセージには、1 つのコンポーネントによって生成され、別のコンポーネントで使用される生のデータが含まれています。
- メッセージには、データへの参照だけでなく、データ自体が含まれています。
- 送信側コンポーネントは、メッセージのコンテンツが宛先コンポーネントによって特定の方法で処理されることを想定しています。 システム全体の整合性は、特定のジョブを実行する送信側と受信側の両方によって決まる場合があります。

たとえば、ユーザーがモバイルの音楽共有アプリを使用して新しい曲をアップロードするとします。 モバイル アプリは、Azure で実行されている Web API にその曲を送信する必要があります。 新しい曲が追加されたことを示すアラートだけでなく、曲のメディア ファイル自体を送信する必要があります。 モバイル アプリは、Web API が新しい曲をデータベースに格納し、他のユーザーが利用できるようにすることを想定しています。 これはメッセージの例です。

## <a name="what-is-an-event"></a>イベントとは何でしょうか。

**イベント**はメッセージよりも軽量で、ほとんどの場合はブロードキャスト通信に使用されます。 イベントを送信するコンポーネントは**パブリッシャー**と呼ばれ、受信側は**サブスクライバー**と呼ばれます。

イベントを使用するときは、基本的に受信側コンポーネントがどの通信に関心があるかを決定して、その通信を "サブスクライブ" します。 サブスクリプションの管理は通常、Azure Event Grid や Azure Event Hubs などの仲介役が行います。 パブリッシャーがイベントを送信すると、仲介役は関心を持っているサブスクライバーにそのイベントをルーティングします。 これを、"パブリッシュ/サブスクライブ アーキテクチャ" といいます。 これがイベントを扱う唯一の方法ではありませんが、最も一般的です。

イベントには次の特性があります。

- イベントは、何かが発生したことを示す軽量の通知です。
- 送信されたイベントの受信者が複数のこともあれば、まったくいないこともあります。
- 多くの場合、イベントは "ファンアウト" を意図しています。つまり、パブリッシャーのそれぞれに対して多数のサブスクライバーが存在します。
- イベントのパブリッシャーは、受信側コンポーネントがどのようなアクションを実行するかについて何も想定していません。
- 一部のイベントは個別のユニットであり、他のイベントに関連しません。 
- あるいは、一連の関連するイベントに順序が付けられることもあります。  

たとえば、音楽ファイルのアップロードが完了し、新しい曲がデータベースに追加されたとします。 新しいファイルのことをユーザーに知らせるために、Web API は Web フロント エンドとモバイル アプリのユーザーに新しいファイルのことを通知する必要があります。 ユーザーは、その新しい曲を聴くかどうかを選択できます。したがって、最初の通知には音楽ファイルは含まれず、その曲が存在することだけをユーザーに通知します。 送信側は、イベントの受信側がこのイベント受信に応答して特に何かを実行することは、想定していません。

これは、個別のイベントの例です。

## <a name="how-to-choose-messages-or-events"></a>メッセージまたはイベントを選択する方法

1 つのアプリケーションが、ある目的のためにイベントを使用し、別の目的のためにメッセージを使用するということはよくあります。 選択を行う前に、アプリケーションのアーキテクチャとそのすべてのユース ケースを分析して、そのコンポーネントが相互に通信する際のさまざまな目的をすべて識別する必要があります。

イベントは、ブロードキャストに使用される可能性が高く、多くの場合に一時的です。つまり、通信が現在サブスクライブされていない場合、受信側で処理されない可能性があります。 メッセージが使用される可能性が高いのは、分散アプリケーションで通信の処理を保証する必要がある場合です。

通信のそれぞれについて、**送信側コンポーネントはその通信が宛先コンポーネントによって特定の方法で処理されることを想定しているか?** を考えてみてください。

答えが _"はい"_ の場合は、メッセージを使用します。 答えが _"いいえ"_ の場合は、イベントを使用できる可能性があります。

コンポーネントがどのように通信する必要があるかを理解することは、コンポーネントの通信方法を選択するのに役立ちます。 では、初めにメッセージについて見ていきましょう。