多くのアプリケーションを使用して、発行-サブスクライブ モデルか何か問題が発生した、いくつかのオブジェクトが変更された分散コンポーネントに通知します。 Azure で実行される Web API を使用する音楽共有アプリケーションがあるとします。 ユーザーは、新しい曲をアップロード、ジャンルに関心がある、世界各地のユーザー デバイスにインストールされているすべてのモバイル アプリに通知する必要があります。

このアーキテクチャではサウンド ファイルの発行元は、サブスクライバーが共有の音楽を関心について知っておく必要があります。 また、この新しい曲に興味のある、かどうかを決定できます必要に応じて複数のサブスクライバーには一対多リレーションシップを持つします。 Azure Event Grid は、このようなアーキテクチャに最適なソリューションです。

## <a name="what-is-azure-event-grid"></a>Azure Event Grid とは何ですか。
Azure Event Grid は、Azure Service Fabric 上で実行される完全に管理されたイベント ルーティング サービスです。 Event Grid は分散_イベント_Azure 関数または Webhook などのさまざまなハンドラーをなど、Azure Blob ストレージ アカウントまたは Azure Media Services では、さまざまなソースからです。 Event Grid は、イベント ベースのビルドに簡単にし、サーバーレス アプリケーションを Azure で作成されました。

Event Grid は、パブリッシャーまたはサブスクライバーとしてほとんどの Azure サービスをサポートし、サード パーティのサービスで使用できます。 そのため、パブリッシャーからサブスクライバーに状態の変化について通知できる、動的にスケーラブルで低コストのメッセージング システムを実現できます。 次の図は、Azure Event Grid の複数のソースからメッセージを受信し、サブスクリプションに基づいてイベント ハンドラーに配布します。

変換元、サブスクライバーに接続する Azure Event Grid の概念をいくつかあります。

1. **イベント** - 発生内容
1. **イベント ソース** - イベントの発生元
1. **トピック** - 発行元がイベントを送信するエンドポイント
1. **イベント サブスクリプション** - イベントを (時には複数のハンドラーに) ルーティングするエンドポイントまたは組み込みメカニズム サブスクリプションは、受信イベントをインテリジェントにフィルター処理するハンドラーによっても使用されます。
1. **イベント ハンドラー** - イベントに反応するアプリまたはサービス

![複数のイベント ソースおよび複数のイベント ハンドラーの間に配置する Azure Event Grid を示す図。 イベント ソースは、Event Grid にイベントを送信し、Event Grid はサブスクライバーに関連するイベントを転送します。 Event Grid では、トピックを使用するハンドラーに送信するのにイベントを決定できます。 イベント ソースが 1 つまたは複数のトピックでは、各イベントをタグ付けし、イベント ハンドラーは、関心のトピックをサブスクライブします。](../media-draft/5-event-grid.png)

### <a name="what-is-an-event"></a>イベントとは何でしょうか。
**イベント**ものは何が行われるかを示すデータ メッセージ Event Grid を通過します。 各イベントは自己完結型、最大は 64 kb、およびいくつかの Event Grid によって定義されているスキーマに基づく情報が含まれています。

```json
[
  {
    "topic": string,
    "subject": string,
    "id": string,
    "eventType": string,
    "eventTime": string,
    "data":{
      object-unique-to-each-publisher
    },
    "dataVersion": string,
    "metadataVersion": string
  }
]
```

| フィールド | 説明 |
|-------|-------------|
| **トピック** | イベント ソースへの完全なリソース パス。 この値は Event Grid によって指定されます。 |
| **subject** | 発行元が定義したイベントの対象のパス。 |
| **id** | イベントの一意の識別子。 |
| **eventType** | このイベント ソース用に登録されたイベントの種類のいずれか。 これはなどに対して、フィルターを作成して値`CustomerCreated`、 `BlobDeleted`、`HttpRequestReceived`など。 |
| **eventTime** | イベントが生成された時間、プロバイダーの UTC 時刻に基づきます。 |
| **データ** | イベントの種類に関連する固有の情報。 たとえば、Azure Storage に作成される新しいファイルに関するイベントには、`lastTimeModified` 値などのファイルの詳細が含まれます。 または、Event Hubs イベントには、キャプチャ ファイルの URL が含まれます。 このフィールドは省略可能です。 |
| **dataVersion** | データ オブジェクトのスキーマ バージョン。 スキーマ バージョンは発行元によって定義されます。 |
| **metadataVersion** | イベント メタデータのスキーマ バージョン。 最上位プロパティのスキーマは Event Grid によって定義されます。 この値は Event Grid によって指定されます。 |

> [!TIP]
> Event Grid は、発生したまたは変更が何かを示すイベントを送信します。 ただし、_実際のオブジェクト_が変更されたイベント データの一部ではありません。 代わりに、URL または識別子が変更されたオブジェクトを参照に渡される多くの場合。

### <a name="what-is-an-event-source"></a>イベント ソースとは
イベント ソースは、Event Grid にイベントを送信します。 各イベント ソースは、1 つまたは複数のイベントの種類に関連付けられます。 たとえば、Azure Storage は、BLOB 作成イベントのイベント ソースです。 IoT Hub は、デバイスによって作成されたイベントのためのイベント ソースです。 お客様のアプリケーションは、お客様が定義するカスタム イベントのイベント ソースです。 すぐにイベント ソースについて詳しくに注目します。

> [!NOTE]
> Azure Event Hub には、イベント発行者の概念も定義します。 Event Hub に発行元は、ユーザーまたは組織の Event Grid にイベントを送信することを決定します。 たとえば、Microsoft は、複数の Azure サービスのイベントをパブリッシュします。 お客様独自のアプリケーションからイベントを発行することができます。 Azure を使用しないでサービスをホストしている組織は、Event Grid からイベントを発行できます。 これは多くの場合、イベント ソースと混在を取得します。 完全に定義されているイベント ソースは、パブリッシャーとその発行元のイベントを生成する特定のサービスです。 "Publisher"、「イベント ソース」を使用ここでは、イベント ハブにメッセージを送信するエンティティを表すためには、同じ意味で。

### <a name="what-is-an-event-topic"></a>イベントのトピックでは何ですか。
イベントのトピックでは、イベントをグループに分類します。 トピックは、パブリック エンドポイントで表されます、、イベント ソースがイベントを送信_に_します。 アプリケーションを設計するときに作成するトピック数を決定できます。 小規模なソリューションは 1 つのトピックにすべてのイベントを送信する可能性があります、大規模なソリューションは、関連するイベントのカテゴリごとのカスタム トピックを作成します。 たとえば、ユーザー アカウントの変更と注文の処理に関連するイベントを送信するアプリケーションがあるものとします。 イベント ハンドラーで両方のイベント カテゴリが必要になることはまずありません。 このような場合は、2 つのカスタム トピックを作成し、イベント ハンドラーが自分と関係のあるトピックをサブスクライブできるようにします。 イベント サブスクライバーは、特定のトピックを参照するイベントの種類のフィルター処理できます。

トピックが分割**システム**トピック、および**カスタム**トピック。

#### <a name="system-topics"></a>システム トピック
システム トピックは、Azure サービスが提供する組み込みのトピックです。 発行元がトピックを所有するため、Azure サブスクリプションにシステム トピックは表示されませんが、トピックをサブスクライブすることはできます。 サブスクライブするには、イベントを受信するリソースに関する情報を入力します。 リソースへのアクセスがある限りは、そのイベントをサブスクライブできます。

#### <a name="custom-topics"></a>カスタム トピック
カスタム トピックは、アプリケーションとサード パーティのトピックです。 カスタムのトピックを作成した、またはカスタムのトピックへのアクセス権を割り当てられた場合は、サブスクリプション内にそのカスタム トピックが表示されます。

### <a name="what-is-an-event-subscription"></a>イベント サブスクリプションとは何ですか。
イベント サブスクリプションは、イベント ハンドラーが受信するトピックにイベントを定義します。 サブスクリプションには、イベント ハンドラーは関連するイベントだけを受信できるように、その型または件名、別のイベントがフィルター処理もできます。

### <a name="what-is-an-event-handler"></a>イベント ハンドラーとは何ですか。
(イベント「サブスクライバー」とも呼ばれます)、イベント ハンドラーは、Event Grid からイベントを受信できるコンポーネント (アプリケーションまたはリソース)。 たとえば、Azure Functions は、新しい曲が BLOB ストレージ アカウントに追加されたことに応答してコードを実行できます。 サブスクライバーは、処理するイベントを決めることができます。新しいイベントが使用できるようになると、関心のある各サブスクライバーに Event Grid から効率的に通知されます。ポーリングは必要ありません。

## <a name="types-of-event-sources"></a>イベント ソースの種類
イベントは、次の種類の Azure リソースを使用して生成することができます。

- **Azure サブスクリプションとリソース グループ。** サブスクリプションおよびリソース グループは、Azure の管理オプションに関連するイベントを生成します。 たとえば、ユーザーが仮想マシンを作成した場合、このソースによってイベントが生成されます。
- **コンテナー レジストリ。** Azure Container Registry サービスでは、レジストリ内のイメージの追加、削除、または変更されたときにイベントが生成されます。
- **イベント ハブです。** イベント ハブを使用して、処理し、さまざまなデータ ソースの通常のログ記録や関連のテレメトリからイベントを格納します。 イベント ハブは、ファイルをキャプチャするときに、Event Grid にイベントを生成できます。
- **Service Bus。** Service bus は、アクティブなレシーバーでアクティブなメッセージがある場合、Event Grid にイベントを生成できます。
- **ストレージ アカウント。** ストレージ アカウントは、ユーザーが BLOB、ファイル、テーブル エントリ、またはキュー メッセージを追加するときにイベントを生成します。 イベント ソースとして blob アカウントと汎用 V2 アカウントの両方を使用することができます。
- **Media Services。** Media Services は、動画および音声メディアをホストし、メディア ファイルの高度な管理機能を提供します。 Media Services では、エンコード ジョブが動画ファイルで開始されたときや完了したときに、イベントが生成されます。
- **Azure IoT Hub。** IoT Hub は、IoT デバイスと通信し、それらからテレメトリを収集します。 そのような通信を受信すると、イベントが生成されます。
- **カスタム イベント。** カスタム イベントは、REST API を使用するか、Java、GO、.NET、Node、Python および Ruby 上で Azure SDK を使用して生成されます。 たとえば、Azure App Service の Web Apps 機能で、カスタム イベントを作成できます。 これは、ストレージ キューからメッセージをピックアップ場合に、ワーカー ロールで発生できます。

この Azure 内のさまざまなイベント ソースとの統合により、Event Grid がほぼすべての Azure リソースに関連するイベントを配布できます。

## <a name="event-handlers"></a>イベント ハンドラー
Azure の次のオブジェクト型では、Event Grid からイベントを受け取ってそれを処理することができます。

- **Azure Functions。** Azure Function は、ホスト仮想サーバーやコンテナーなしで Azure で実行されるカスタム コードで構成されます。 イベントに対する応答をコードでカスタマイズする場合、Azure Function をイベント ハンドラーとして使用します。
- **Webhook。** Webhook は、web のプッシュ アーキテクチャを実装する API です。
- **Azure Logic Apps。** Azure Logic Apps は、ワークフローとして、ビジネス プロセスをホストします。
- **Microsoft Flow。** Flow でも、ワークフローがホストされます。技術スタッフ以外が簡単に使用できます。

## <a name="should-you-use-event-grid"></a>Event Grid を使用する場合
次の機能が必要な場合に、Event Grid を使用します。

- **簡単さ。** Event Grid サブスクリプション会員の皆様のソースの接続を簡単になります。
- **高度なフィルタリング。** サブスクリプションでは、トピックから受け取るイベントを厳しく制限できます。
- **展開。** 無制限の数と同じイベントとトピック エンドポイントを購読することができます。
- **信頼性。** Event Grid では、イベントの配信を、各サブスクリプションに対して最大で 24 時間再試行します。
- **イベントあたり従量課金。** 送信するイベント数のみに対して支払いが行われます。

## <a name="summary"></a>まとめ
Event Grid は、単純ですが、汎用的なイベント配信システムです。 これを使用すると、確実かつ迅速に個別のイベントをサブスクライバーに配信できます。 検討するメッセージング モデルはもう 1 つあります。大規模な_ストリーム_のイベントを配信するにはどうすればよいでしょうか。 このようなシナリオの場合、Event Grid は、一度の配信で 1 つのイベントを配信するように設計されているため、最適ではありません。 代わりに、別の Azure サービスである Event Hubs に目を向ける必要があります。