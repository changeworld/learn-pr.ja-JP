現在あなたのサイトは、Azure で実行されています。 しかし、毎日 24 時間、サイトが確実に稼働するようにするにはどうすればよいですか?

たとえば、毎週のメンテナンスを行う必要がある場合は、どうなりますか? メンテナンス期間中、サービスは使用できなくなります。 また、あなたのサイトのユーザーは世界中にいるため、メンテナンスのためにシステムを停止するのに都合のよい時間帯はありません。 同時に接続するユーザーが多すぎると、パフォーマンスの問題も発生します。

## <a name="what-are-availability-and-high-availability"></a>耐久性と高可用性とは何ですか?

:::row:::
  :::column:::
    ![高可用性を表す高速列車](../media/3-availability.png)
  :::column-end:::
    :::column span="3":::
_可用性_とは、サービスが中断なく稼働する長さを指します。 "_高可用性_" または "_可用性が高い_" とは、長期間稼働するサービスを指します。

必要な情報にアクセスできないことがどれほどいら立たしいことかはおわかりでしょう。 あなたが毎日アクセスしているソーシャル メディアやニュース サイトを考えてみてください。 そのサイトには常にアクセスできますか、それとも "503 サービス利用不可" などのエラー メッセージが頻繁に表示されますか?
  :::column-end:::
 :::row-end:::

"ファイブ ナインの可用性" などの言葉を聞いたことがあるかもしれません。 ファイブ ナインの可用性とは、サービスが 99.999% の時間実行されることを保証することを意味しています。 100% の可用性を実現するのは困難ですが、多くのチームが少なくともファイブ ナインの実現に努めています。

## <a name="what-is-resiliency"></a>回復性とは何ですか?

:::row:::
  :::column:::
    ![回復性を表す正常性グラフ](../media/3-resiliency.png)
  :::column-end:::
    :::column span="3":::
_回復性_は、異常な状態でシステムが機能を維持できる能力を指します。

異常な状態には次のようなものがあります。

- 自然災害。
- ソフトウェアの更新やセキュリティ パッチの適用を含む、計画的および計画外のシステム メンテナンス。
- サイトへのトラフィックの急増。
- 分散型サービス拒否 (DDoS) 攻撃など、悪意のある第三者による脅威。
  :::column-end:::
:::row-end:::

あなたが所属するマーケティング チームでは、ビタミン サプリメントの新製品の販売促進のためのフラッシュ セールを計画しているとします。 あなたはこの期間にトラフィックが急増することを予想しています。 この急増がシステムの処理能力を上回ると、システムが遅くなったり停止したりして、ユーザーを失望させる恐れがあります。 あなた自身、こうした失望を味わった経験があるでしょう。 オンライン ショップにアクセスしようとしたのに Web サイトが応答しなかったことはありませんか。

## <a name="what-is-a-load-balancer"></a>ロード バランサーとは

:::row:::
  :::column:::
    ![負荷分散を表すスケール](../media/3-lb.png)
  :::column-end:::
    :::column span="3":::
_ロード バランサー_は、プール内の各システムにトラフィックを均等に分散させます。 ロード バランサーは、高可用性と回復性の両方を実現するのに役立ちます。

たとえば、それぞれ同じように構成された VM を各階層に追加することから始めるとします。 この考えは、1 つがダウンした場合、または同時にサービスを提供するユーザーの数が多すぎる場合に、追加のシステムを準備することです。
  :::column-end:::
:::row-end:::

ここでの問題は、VM ごとに独自の IP アドレスがあることです。 さらに、1 つのシステムがダウンまたはビジー状態になったときに、トラフィックを分散させる方法がないことです。 ユーザーからは 1 つのシステムと見えるように VM を接続するにはどうすればよいですか?

答えは、ロード バランサーを使用してトラフィックを分散させることです。 ロード バランサーは、ユーザーへのエントリ ポイントになります。 ロード バランサーが要求を受信するのにどのシステムを選ぶかは、ユーザーにはわかりません (知る必要はありません)。

次の図は、ロード バランサーの役割を示したものです。

![3 層アーキテクチャの Web 層を示す図。 Web 層には、ユーザーの要求に対応する複数の仮想マシンがあります。 ユーザー要求を複数の仮想マシンに分散させるロード バランサーがあります。](../media/3-load-balancer.png)

ロード バランサーが、ユーザーの要求を受信しているのがわかります。 ロード バランサーは、要求を Web 層内のいずれかの VM に要求を送信します。 VM が使用できない、または応答を停止している場合は、ロード バランサーはその VM へのトラフィックの送信を停止します。 次にロード バランサーは、応答しているサーバーのいずれかにトラフィックを送信します。

負荷分散することで、サービスを中断せずにメンテナンス タスクを実行することができます。 たとえば、メンテナンス期間が重ならないように VM ごとに調整することができます。 メンテナンス期間中は、ロード バランサーが VM が応答していないことを検出して、プール内の他の VM にトラフィックを送信します。

この eコマース サイトの場合、アプリ層とデータ層にもロード バランサーを配置することができます。 これは提供するサービスの必要性に応じて決まります。

## <a name="what-is-azure-load-balancer"></a>Azure Load Balancer とは

Azure Load Balancer は Microsoft が提供するロード バランサー サービスで、ユーザーのためにメンテナンスの面倒を見ます。

ユーザーが仮想マシンに一般的なロード バランサー ソフトウェアを手動で構成すると、メンテナンスの必要なシステムが増えるという欠点があります。 ロード バランサーがダウンしたり定期的なメンテナンスが必要になったりすると、元の問題に戻ります。

しかし、代わりに Azure Load Balancer を使用すると、自分でメンテナンスする必要のあるインフラストラクチャやソフトウェアはありません。

次の図は、多層アーキテクチャでの Azure ロード バランサーの役割です。

![3 層アーキテクチャの Web 層を示す図。 Web 層には、ユーザーの要求に対応する複数の仮想マシンがあります。 ユーザー要求を複数の仮想マシンに分散させるロード バランサーがあります。](../media/3-azure-load-balancer.png)

## <a name="what-about-dns"></a>DNS とは

:::row:::
  :::column:::
    ![DNS を表す地図上のピン](../media/3-map-pin.png)
  :::column-end:::
    :::column span="3":::
ドメイン ネーム システム (DNS) は、わかりやすい名前をその IP アドレスにマップする方法です。 DNS は、インターネットの電話帳として考えることができます。

たとえば、ドメイン名 contoso.com を Web 層のロード バランサーの IP アドレス 40.65.106.192 にマップできます。

独自の DNS サーバーを導入することも、Azure DNS (Azure インフラストラクチャで実行される DNS ドメインのホスティング サービス) を使用することもできます。
  :::column-end:::
:::row-end:::

Azure DNS の図を次に示します。 ユーザーが contoso.com に移動すると、Azure DNS によってトラフィックがロード バランサーにルーティングされます。

![ロード バランサーの前に配置された Azure ドメイン ネーム システムを示す図。](../media/3-dns.png)

## <a name="summary"></a>まとめ

負荷分散を配置することで、あなたの e コマース サイトの可用性と回復力がさらに向上しました。 メンテナンスを実行したり、トラフィックが増加すると、ロード バランサーによってトラフィックを別の使用可能なシステムに分散させることができます。

VM に独自のロード バランサーを構成することもできますが、Azure Load Balancer を使用すると、メンテナンスするインフラストラクチャやソフトウェアがないため、維持費を削減できます。

DNS は、わかりやすい名前をその IP アドレスにマップします。これは、電話帳で人名または企業名を電話番号にマップする方法とよく似ています。 独自の DNS サーバーを導入することも、Azure DNS を使用することもできます。
