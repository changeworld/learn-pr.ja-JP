大抵の場合、最初の手順は、クラウドに自分のオンプレミス構成を再作成することです。

この基本的な構成により、ネットワークがどのように構成され、ネットワーク トラフィックが Azure をどのように出入りしているかについての感覚をつかむことができます。

## <a name="your-e-commerce-site-at-a-glance"></a>e コマース サイトの概要

[n 層アーキテクチャ](https://docs.microsoft.com/en-us/azure/architecture/guide/architecture-styles/n-tier)は、アプリケーションを 2 つ以上の論理層に分割します。 アーキテクチャ上は、上の階層は下の階層からのサービスにアクセスすることができますが、下の階層が上の階層にアクセスすることはできません。

階層は問題を切り離すのに役立ちます。再利用できるように設計するのが理想的です。 階層は個別に更新または置換することも、必要に応じて新しい階層を挿入することもできるため、階層型アーキテクチャを使用すると、メンテナンスも簡素化できます。

_3 層_とは、3 つの階層がある n 層アプリケーションを指します。 あなたの e コマース Web アプリケーションは、この 3 層アーキテクチャに沿っています。

* **Web 層**: ブラウザーを介してユーザーに Web インターフェイスを提供
* **アプリケーション層**: ビジネス ロジックを実行
* **データ層**: データベースと製品情報と顧客の注文を保持するその他のストレージが含まれる

ダイアグラムを次に示します。 ユーザーからデータ層へのフローをトレースします。

![基本的な 3 層 Web アプリ](../media-draft/three-tier.png)

ユーザーが発注ボタンをクリックすると、その要求がユーザーの住所と支払い情報と共に Web 層に送信されます。 Web 層は、この情報を支払い情報の検証と在庫チェックが行われるアプリケーション層に渡します。 アプリケーション層では、後で受注処理のために取得されるように、注文をデータ層に格納することができます。

## <a name="your-e-commerce-site-running-on-azure"></a>Azure で実行されているあなたの e コマース サイト

Azure では、コードをホストする完全に事前構成された環境から、自分で構成、カスタマイズ、管理を行う仮想マシンまで、Web アプリケーションをホストするためのさまざまな方法を提供しています。

たとえば、あなたは自分の e コマース サイトを仮想マシンで実行することを選択したとします。 Azure で実行されているテスト環境は、次のようになります。

![Azure で実行されている基本的な 3 層 Web アプリ](../media-draft/test-deployment.png)

これを分解してみましょう。

## <a name="what-is-an-azure-region"></a>Azure リージョンとは何ですか?

_リージョン_とは、特定の地理的な場所内にある Azure データ センターのことです。 米国東部、米国西部、北ヨーロッパなどがリージョンの例です。 アプリケーションが米国東部リージョンで実行されていることがわかります。

## <a name="what-is-a-virtual-network"></a>仮想ネットワークとは何ですか?

_仮想ネットワーク_とは、Azure 上で論理的に分離されたネットワークのことです。 Hyper-V、VMware、または他のパブリック クラウドでネットワークを設定したことがあれば、Azure 仮想ネットワークにすぐに慣れることができます。

Web 層、アプリケーション層、およびデータ層にはそれぞれ 1 つの VM があります。 各 VM は仮想ネットワークに属しています。

ユーザーは Web 層と直接やり取りするため、Web 層の VM にはパブリック IP アドレスがあります。 ユーザーがアプリケーション層とデータ層とやり取りすることはありません。 そのため、これらの VM にはそれぞれプライベート IP アドレスがあります。

物理ハードウェアは、Azure データ センターで管理されます。 仮想ネットワークは、ソフトウェアを通じて構成します。これにより、仮想ネットワークを独自のネットワークと同じように扱うことができます。 たとえば、ネットワークでの IP アドレスの割り当てをより細かく制御するため、仮想ネットワークをサブネットに分割することができます。 また、仮想ネットワークが到達できる他のネットワークを選択することもできます。それがパブリック インターネットであっても、プライベート IP アドレス空間内の他のネットワークであってもかまいません。

### <a name="whats-a-network-security-group"></a>ネットワーク セキュリティ グループとは何ですか?

_ネットワーク セキュリティ グループ_ (NSG) は、Azure リソースへの着信ネットワーク トラフィックを許可または拒否します。 ネットワーク セキュリティ グループを、自分のネットワークのクラウド レベルのファイアウォールとして考えてみましょう。

たとえば、Web 層の VM は、ポート 22 (SSH) と 80 (HTTP) で着信トラフィックを許可していることに注目してください。 ここでは、各ネットワーク セキュリティ グループがすべてのソースからのトラフィックを許可しています。 信頼できる IP アドレスなど、既知のソースからのみトラフィックを受け入れるようにネットワーク セキュリティ グループを構成することができます。

> [!NOTE]
> ポート 22 では、SSH 経由で Linux システムに直接接続することができます。 ここでは、学習目的のために、ポート 22 を開いています。 実際には、セキュリティを強化するために、仮想ネットワークに VPN アクセスを構成します。

## <a name="summary"></a>まとめ

あなたの 3 層アプリケーションは現在、米国東部リージョンの Azure で実行されています。 _リージョン_とは、特定の地理的な場所内にある Azure データ センターのことです。

各階層は、下の階層からのサービスにのみアクセスできます。 Web 層で実行されている VM は、インターネットからトラフィックを受信するため、パブリック IP アドレスがあります。 それより下の階層 (アプリケーション層とデータ層) の VM は、インターネット経由で直接通信することはないため、それぞれプライベート IP アドレスを持っています。

_仮想ネットワーク_を使用すると、関連するシステムをグループ化したり分離したりすることができます。 _ネットワーク セキュリティ グループ_を定義して、仮想ネットワーク内を流れることができるトラフィックを制御します。

ここで説明したこの構成は、出発点としては有効ですが、 あなたの e コマース サイトをクラウドで運用環境にデプロイするときに、オンプレミス デプロイで経験したのと同じ問題にぶつかる可能性があります。
