<span data-ttu-id="ad5f5-101">Azure IoT Hub が Raspberry Pi などの IoT デバイスからデータを収集する方法について理解したので、他の IoT デバイスをプロビジョニングしてデータを送信する段階に進むことができます。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-101">Now that you have an understanding of how Azure IoT Hub collects data from IoT devices such as the Raspberry Pi you can now move forward to provision other IoT devices to send their data as well.</span></span> <span data-ttu-id="ad5f5-102">小規模なプロジェクト (1 - 5 台のデバイス) であれば、IoT デバイスのセットアップを 1 つずつ完了することもできます。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-102">Completing setup of IoT devices in a small project (1-5 devices) can be done 1 to 1.</span></span> <span data-ttu-id="ad5f5-103">大規模なデプロイでは、プロビジョニングのためのより良い方法が必要になります。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-103">Larger deployments would require a better method for provisioning.</span></span>

<span data-ttu-id="ad5f5-104">Azure IoT Hub Device Provisioning Service により、顧客は Azure IoT Hub へのゼロタッチ デバイス プロビジョニングを構成できます。これは、従来は時間のかかる 1 台ずつの作業だったプロセスにクラウドのスケーラビリティをもたらします。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-104">Azure IoT Hub Device Provisioning Service enables customers to configure zero-touch device provisioning to Azure IoT Hub, and it brings the scalability of the cloud to what was once a lengthy one-at-a-time process.</span></span> <span data-ttu-id="ad5f5-105">このプロセスはサプライ チェーンの課題を念頭に置いて設計されており、何百万台ものデバイスを安全かつスケーラブルな方法でプロビジョニングするために必要なインフラストラクチャを提供します。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-105">The process was designed with the challenges of the supply chain in mind, providing the infrastructure needed to provision millions of devices in a secure and scalable manner.</span></span>

<span data-ttu-id="ad5f5-106">Device Provisioning Service による自動デバイス プロビジョニングでは、HTTP、AMQP、MQTT、WebSocket 経由の AMQP、WebSocket 経由の MQTT など、IoT Hub がサポートするすべてのプロトコルがサポートされるようになりました。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-106">Automatic device provisioning with the Device Provisioning Service now supports all protocols that IoT Hub supports including HTTP, AMQP, MQTT, AMQP over websockets, and MQTT over websockets.</span></span> <span data-ttu-id="ad5f5-107">このリリースは、デバイス側とクライアント側の両方での、拡張された SDK 言語のサポートにも対応しています。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-107">This release also corresponds to expanded SDK language support for both the device and client side.</span></span>

## <a name="link-the-device-provisioning-service-to-an-iot-hub"></a><span data-ttu-id="ad5f5-108">Device Provisioning Service を IoT ハブにリンクする</span><span class="sxs-lookup"><span data-stu-id="ad5f5-108">Link the Device Provisioning Service to an IoT hub</span></span>

<span data-ttu-id="ad5f5-109">次に、IoT Hub Device Provisioning Service と IoT ハブをリンクして、Device Provisioning Service がデバイスをそのハブに登録できるようにします。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-109">The next step is to link the Device Provisioning Service and IoT hub so that the IoT Hub Device Provisioning Service can register devices to that hub.</span></span> <span data-ttu-id="ad5f5-110">Device Provisioning Service は、このサービスにリンクされている IoT ハブにのみデバイスをプロビジョニングできます。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-110">The service can only provision devices to IoT hubs that have been linked to the Device Provisioning Service.</span></span> <span data-ttu-id="ad5f5-111">次の手順に従います。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-111">Follow these steps.</span></span>

1.  <span data-ttu-id="ad5f5-112">Azure portal の **[すべてのリソース]** ページで、先ほど作成した Device Provisioning Service インスタンスをクリックします。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-112">In the **All resources** page on the Azure portal, click the Device Provisioning Service instance you created previously.</span></span>

2.  <span data-ttu-id="ad5f5-113">Device Provisioning Service ページで、**[リンク済み IoT Hub]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-113">In the Device Provisioning Service page, click **Linked IoT hubs**.</span></span>

3.  <span data-ttu-id="ad5f5-114">**[追加]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-114">Click **Add**.</span></span>

4.  <span data-ttu-id="ad5f5-115">**[IoT Hub へのリンクを追加します]** ページで、以下の情報を入力して、**[保存]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-115">In the **Add link to IoT hub** page, provide the following information, and click **Save**:</span></span>

    - <span data-ttu-id="ad5f5-116">**[サブスクリプション]:** IoT ハブを含むサブスクリプションが選択されていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-116">**Subscription:** Make sure the subscription that contains the IoT hub is selected.</span></span> <span data-ttu-id="ad5f5-117">別のサブスクリプション内にある IoT ハブにリンクすることもできます。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-117">You can link to IoT hub that resides in a different subscription.</span></span>

    - <span data-ttu-id="ad5f5-118">**[IoT Hub]:** この Device Provisioning Service インスタンスとリンクする IoT ハブの名前を選択します。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-118">**IoT hub:** Choose the name of the IoT hub that you want to link with this Device Provisioning Service instance.</span></span>

    - <span data-ttu-id="ad5f5-119">**[アクセス ポリシー]:** IoT ハブとのリンクを確立するために使用する資格情報として **[iothubowner]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-119">**Access Policy:** Select **iothubowner** as the credentials to use for establishing the link to the IoT hub.</span></span>

![ポータルでハブ名を DPS にリンクする](../media-draft/ee6e78754a1d39d86de71fb6872723f3.png)

## <a name="set-the-allocation-policy-on-the-device-provisioning-service"></a><span data-ttu-id="ad5f5-121">Device Provisioning Service で割り当てポリシーを設定する</span><span class="sxs-lookup"><span data-stu-id="ad5f5-121">Set the allocation policy on the Device Provisioning Service</span></span>

<span data-ttu-id="ad5f5-122">割り当てポリシーは、デバイスを IoT ハブに割り当てる方法を決定する IoT Hub Device Provisioning Service 設定です。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-122">The allocation policy is a IoT Hub Device Provisioning Service setting that determines how devices are assigned to an IoT hub.</span></span> <span data-ttu-id="ad5f5-123">次の 3 つの割り当てポリシーがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-123">There are three supported allocation policies:</span></span>

1. <span data-ttu-id="ad5f5-124">**Lowest latency\(最も短い待機時間\)**: デバイスに対する待機時間が最も短いハブに基づいて、デバイスを IoT ハブにプロビジョニングします。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-124">**Lowest latency**: Devices are provisioned to an IoT hub based on the hub with the lowest latency to the device.</span></span>

2. <span data-ttu-id="ad5f5-125">**加重が均等に分布** (既定値): リンクされた各 IoT ハブにデバイスが同程度にプロビジョニングされます。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-125">**Evenly weighted distribution** (default): Linked IoT hubs are equally likely to have devices provisioned to them.</span></span> <span data-ttu-id="ad5f5-126">これは既定の設定です。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-126">This setting is the default.</span></span> <span data-ttu-id="ad5f5-127">デバイスを 1 つの IoT ハブにのみプロビジョニングする場合は、この設定のままでかまいません。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-127">If you are provisioning devices to only one IoT hub, you can keep this setting.</span></span>

3. <span data-ttu-id="ad5f5-128">**Static configuration via the enrollment list\(登録リストによる静的構成\)**: 登録リストの目的の IoT ハブの仕様が、Device Provisioning Service レベルの割り当てポリシーよりも優先されます。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-128">**Static configuration via the enrollment list**: Specification of the desired IoT hub in the enrollment list takes priority over the Device Provisioning Service-level allocation policy.</span></span>

<span data-ttu-id="ad5f5-129">割り当てポリシーを設定するには、Device Provisioning Service ページで **[Manage allocation policy]\(割り当てポリシーの管理\)** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-129">To set the allocation policy, in the Device Provisioning Service page click **Manage allocation policy**.</span></span> <span data-ttu-id="ad5f5-130">割り当てポリシーが **[Evenly weighted distribution]\(均等に重み付けされた分散\)** (既定値) に設定されていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-130">Make sure the allocation policy is set to **Evenly weighted distribution** (the default).</span></span> <span data-ttu-id="ad5f5-131">設定を変更した場合は、作業が終わったら **[保存]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-131">If you make any changes, click **Save** when you are done.</span></span>

![割り当てポリシーを管理する](../media-draft/0c5fa5193156f17b4f5d64aab65a414d.png)

## <a name="enroll-the-device"></a><span data-ttu-id="ad5f5-133">デバイスを登録する</span><span class="sxs-lookup"><span data-stu-id="ad5f5-133">Enroll the device</span></span>

<span data-ttu-id="ad5f5-134">この手順では、Device Provisioning Service にデバイスの一意のセキュリティ アーティファクトを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-134">This step involves adding the device's unique security artifacts to the Device Provisioning Service.</span></span> <span data-ttu-id="ad5f5-135">これらのセキュリティ アーティファクトは、デバイスの[構成証明メカニズム](https://docs.microsoft.com/azure/iot-dps/concepts-device#attestation-mechanism)をベースとしています。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-135">These security artifacts are based on the device's [Attestation mechanism](https://docs.microsoft.com/azure/iot-dps/concepts-device#attestation-mechanism) as follows:</span></span>

<span data-ttu-id="ad5f5-136">TPM ベースのデバイスの場合、次のものが必要となります。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-136">For TPM-based devices you need:</span></span>

- <span data-ttu-id="ad5f5-137">各 TPM チップまたはシミュレーションに固有の "*保証キー*"。保証キーは TPM チップの製造元から取得します。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-137">The *Endorsement Key* that is unique to each TPM chip or simulation, which is obtained from the TPM chip manufacturer.</span></span> <span data-ttu-id="ad5f5-138">詳細については、「[TPM 保証キーとは](https://docs.microsoft.com/windows-server/identity/ad-ds/manage/component-updates/tpm-key-attestation#terminology)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-138">Read the [Understand TPM Endorsement Key](https://docs.microsoft.com/windows-server/identity/ad-ds/manage/component-updates/tpm-key-attestation#terminology) for more information.</span></span>

- <span data-ttu-id="ad5f5-139">名前空間/スコープ内でデバイスを一意に識別するために使用する "*登録 ID*"。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-139">The *Registration ID* that is used to uniquely identify a device in the namespace/scope.</span></span> <span data-ttu-id="ad5f5-140">この ID はデバイス ID と同じである場合もあれば、異なる場合もあります。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-140">This ID may or may not be the same as the device ID.</span></span> <span data-ttu-id="ad5f5-141">この ID はすべてのデバイスで必須です。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-141">The ID is mandatory for every device.</span></span> <span data-ttu-id="ad5f5-142">TPM ベースのデバイスでは、登録 ID が TPM 自体から派生している場合があります (TPM 保証キーの SHA-256 ハッシュなど)。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-142">For TPM-based devices, the registration ID may be derived from the TPM itself, for example, an SHA-256 hash of the TPM Endorsement Key.</span></span>

![ポータルに表示された TPM の登録情報](../media-draft/11db90b7128e1cf222a4da45de7cbac8.png)

<span data-ttu-id="ad5f5-144">X.509 ベースのデバイスの場合、次のものが必要となります。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-144">For X.509 based devices you need:</span></span>

- <span data-ttu-id="ad5f5-145">*.pem* ファイルまたは *.cer* ファイルの形式で、[X.509 チップまたはシミュレーションに発行された証明書](https://docs.microsoft.com/windows/desktop/SecCertEnroll/about-x-509-public-key-certificates)。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-145">The [certificate issued to the X.509](https://docs.microsoft.com/windows/desktop/SecCertEnroll/about-x-509-public-key-certificates) chip or simulation, in the form of either a *.pem* or a *.cer* file.</span></span> <span data-ttu-id="ad5f5-146">個別登録では、X.509 システムのデバイスごとの "*署名者証明書*" を使用する必要があります。登録グループでは、"*ルート証明書*" を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-146">For individual enrollment, you need to use the per-device *signer         certificate* for your X.509 system, while for enrollment groups, you need to use the *root certificate*.</span></span>

   ![X.509 構成証明の個々の登録をポータルで追加](../media-draft/8d56752f453f27e55dd15b7c894ae406.png)

<span data-ttu-id="ad5f5-148">デバイスを Device Provisioning Service に登録するには、次の 2 つの方法があります。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-148">There are two ways to enroll the device to the Device Provisioning Service:</span></span>

- <span data-ttu-id="ad5f5-149">**Enrollment Groups\(登録グループ\)**: これは、特定の構成証明メカニズムを共有するデバイスのグループを表します。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-149">**Enrollment Groups** This represents a group of devices that share a specific attestation mechanism.</span></span> <span data-ttu-id="ad5f5-150">必要な初期構成を共有する多数のデバイスがある場合や、すべてのデバイスが同じテナントに配置される場合は、登録グループを使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-150">We recommend using an enrollment group for a large number of devices, which share a desired initial configuration, or for devices all going to the same tenant.</span></span> <span data-ttu-id="ad5f5-151">登録グループの ID 構成証明の詳細については、[セキュリティ](https://docs.microsoft.com/azure/iot-dps/concepts-security#controlling-device-access-to-the-provisioning-service-with-x509-certificates)に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-151">For more information on Identity attestation for enrollment groups, see [Security](https://docs.microsoft.com/azure/iot-dps/concepts-security#controlling-device-access-to-the-provisioning-service-with-x509-certificates).</span></span>

   ![X.509 構成証明のグループ登録をポータルで追加](../media-draft/4a9d9ea822887c70f1ff1e4b64b138f1.png)

- <span data-ttu-id="ad5f5-153">**個々の登録**: Device Provisioning Service に登録できる 1 つのデバイスのエントリを表します。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-153">**Individual Enrollments** This represents an entry for a single device that may register with the Device Provisioning Service.</span></span> <span data-ttu-id="ad5f5-154">個々の登録では、構成証明メカニズムとして X.509 証明書または (実際の TPM または仮想 TPM の) SAS トークンを使用できます。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-154">Individual enrollments may use either x509 certificates or SAS tokens (in a real or virtual TPM) as attestation mechanisms.</span></span> <span data-ttu-id="ad5f5-155">固有の初期構成を必要とするデバイスや、TPM または仮想 TPM を介した SAS トークンのみを構成証明メカニズムとして使用できるデバイスには、個別加入を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-155">We recommend using individual enrollments for devices that require unique initial configurations, and devices that can only use SAS tokens via TPM or virtual TPM as the attestation mechanism.</span></span> <span data-ttu-id="ad5f5-156">個別登録では、必要な IoT ハブ デバイス ID が指定されている場合があります。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-156">Individual enrollments may have the desired IoT hub device ID specified.</span></span>

<span data-ttu-id="ad5f5-157">今度は、デバイスの構成証明メカニズムに基づく必要なセキュリティ アーティファクトを使用し、Device Provisioning Service インスタンスにデバイスを登録します。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-157">Now you enroll the device with your Device Provisioning Service instance, using the required security artifacts based on the device's attestation mechanism:</span></span>

1. <span data-ttu-id="ad5f5-158">Azure portal にサインインし、左側のメニューの **[すべてのリソース]** をクリックして Device Provisioning Service を開きます。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-158">Sign in to the Azure portal, click on the **All resources** button on the left-hand menu and open your Device Provisioning service.</span></span>

2. <span data-ttu-id="ad5f5-159">Device Provisioning Service の概要ブレードで、**[登録を管理します]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-159">On the Device Provisioning Service summary blade, select **Manage enrollments**.</span></span> <span data-ttu-id="ad5f5-160">デバイスの設定に従って、**[Individual Enrollments]/(個別登録\)** タブまたは **[Enrollment Groups]\(登録グループ\)** タブを選択します。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-160">Select either **Individual Enrollments** tab or the **Enrollment Groups** tab as per your device setup.</span></span> <span data-ttu-id="ad5f5-161">上部にある **[追加]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-161">Click the **Add** button at the top.</span></span> <span data-ttu-id="ad5f5-162">ID 構成証明 "*メカニズム*" として **[TPM]** または **[X.509]** を選択し、前述の適切なセキュリティ アーティファクトを入力します。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-162">Select **TPM** or **X.509** as the identity attestation *Mechanism*, and enter the appropriate security artifacts as discussed     previously.</span></span> <span data-ttu-id="ad5f5-163">新しい **IoT Hub デバイス ID** を入力できます。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-163">You may enter a new **IoT Hub device ID**.</span></span> <span data-ttu-id="ad5f5-164">作業が完了したら、**[保存]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-164">Once complete, click the **Save** button.</span></span>

3. <span data-ttu-id="ad5f5-165">デバイスが正常に登録されると、ポータルに次のように表示されます。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-165">When the device is successfully enrolled, you should see it displayed in the portal as follows:</span></span>

![ポータルで正常に完了した TPM 登録](../media-draft/cb277b2e5bc21cd02669775d536e89c0.png)

<span data-ttu-id="ad5f5-167">登録後、プロビジョニング サービスは、デバイスが起動し、後でサービスに接続するまで待機します。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-167">After enrollment, the provisioning service then waits for the device to boot and connect with it at any later point in time.</span></span> <span data-ttu-id="ad5f5-168">デバイスの初回起動時に、クライアント SDK ライブラリはチップと対話してデバイスからセキュリティ アーティファクトを抽出し、Device Provisioning Service への登録を確認します。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-168">When your device boots for the first time, the client SDK library interacts with your chip to extract the security artifacts from the device, and verifies registration with your Device Provisioning service.</span></span>

## <a name="start-the-iot-device"></a><span data-ttu-id="ad5f5-169">IoT デバイスを起動する</span><span class="sxs-lookup"><span data-stu-id="ad5f5-169">Start the IoT device</span></span>

<span data-ttu-id="ad5f5-170">IoT デバイスは、実際のデバイスにすることも、シミュレートされたデバイスにすることもできます。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-170">Your IoT device can be a real device, or a simulated device.</span></span> <span data-ttu-id="ad5f5-171">IoT デバイスが Device Provisioning Service インスタンスに登録されたため、デバイスを起動し、プロビジョニング サービスを呼び出して、構成証明メカニズムを使用して認識されるようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-171">Since the IoT device has now been enrolled with a Device Provisioning Service instance, the device can now boot up, and call the provisioning service to be recognized using the attestation mechanism.</span></span> <span data-ttu-id="ad5f5-172">デバイスは、プロビジョニング サービスに認識されると、IoT ハブに割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-172">Once the provisioning service has recognized the device, it will be assigned to an IoT hub.</span></span>

<span data-ttu-id="ad5f5-173">TPM と X.509 の両方の構成証明を使用する、シミュレートされたデバイスの例として、C、Java、C\#、Node.js、Python などによるものがあります。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-173">Simulated device examples, using both TPM and X.509 attestation, are included for C, Java, C\#, Node.js, and Python.</span></span> <span data-ttu-id="ad5f5-174">たとえば、TPM と [Azure IoT C SDK](https://github.com/Azure/azure-iot-sdk-c) を使用するシミュレートされたデバイスは、「[デバイスの初回ブート シーケンスのシミュレーション](https://docs.microsoft.com/azure/iot-dps/quick-create-simulated-device#simulate-first-boot-sequence-for-the-device)」セクションで説明されているプロセスに従います。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-174">For example, a simulated device using TPM and the [Azure IoT C SDK](https://github.com/Azure/azure-iot-sdk-c) would follow the process covered in the [Simulate first boot sequence for a device](https://docs.microsoft.com/azure/iot-dps/quick-create-simulated-device#simulate-first-boot-sequence-for-the-device) section.</span></span> <span data-ttu-id="ad5f5-175">X.509 証明書構成証明を使用する同じデバイスの場合は、この[ブート シーケンス](https://docs.microsoft.com/azure/iot-dps/quick-create-simulated-device-x509#simulate-first-boot-sequence-for-the-device)についてのセクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-175">The same device using X.509 certificate attestation would refer to this [boot sequence](https://docs.microsoft.com/azure/iot-dps/quick-create-simulated-device-x509#simulate-first-boot-sequence-for-the-device) section.</span></span>

<span data-ttu-id="ad5f5-176">実際のデバイスの例については、[MXChip Iot DevKit のハウツー ガイド](https://docs.microsoft.com/azure/iot-dps/how-to-connect-mxchip-iot-devkit)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-176">Refer to the [How-to guide for the MXChip Iot DevKit](https://docs.microsoft.com/azure/iot-dps/how-to-connect-mxchip-iot-devkit) as an example for a real device.</span></span>

<span data-ttu-id="ad5f5-177">デバイスを起動して、デバイスのクライアント アプリケーションが Device Provisioning Service への登録を開始できるようにします。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-177">Start the device to allow your device's client application to start the registration with your Device Provisioning service.</span></span>

## <a name="verify-the-device-is-registered"></a><span data-ttu-id="ad5f5-178">デバイスが登録されていることを確認する</span><span class="sxs-lookup"><span data-stu-id="ad5f5-178">Verify the device is registered</span></span>

<span data-ttu-id="ad5f5-179">デバイスが起動すると、次のアクションが実行されます。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-179">Once your device boots, the following actions should take place:</span></span>

1. <span data-ttu-id="ad5f5-180">デバイスが Device Provisioning Service に登録要求を送信します。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-180">The device sends a registration request to your Device Provisioning service.</span></span>

2. <span data-ttu-id="ad5f5-181">TPM デバイスの場合、Device Provisioning Service が登録チャレンジを送信し、デバイスがこれに応答します。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-181">For TPM devices, the Device Provisioning Service sends back a registration challenge to which your device responds.</span></span>

3. <span data-ttu-id="ad5f5-182">登録が成功すると、Device Provisioning Service は、IoT ハブの URI、デバイス ID、暗号化されたキーをデバイスに送信します。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-182">On successful registration, the Device Provisioning Service sends the IoT hub URI, device ID, and the encrypted key back to the device.</span></span>

4. <span data-ttu-id="ad5f5-183">デバイス上の IoT Hub クライアント アプリケーションがハブに接続します。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-183">The IoT Hub client application on the device then connects to your hub.</span></span>

5. <span data-ttu-id="ad5f5-184">ハブに正常に接続されると、IoT ハブの **[IoT デバイス]** エクスプローラーにデバイスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="ad5f5-184">On successful connection to the hub, you should see the device appear in the IoT hub's **IoT Devices** explorer.</span></span>

![ハブに正常に接続できたことがポータルに表示されます](../media-draft/12ea6da6eef9bf96be6bd80aa1721173.png)

<!--Reference links

-   <https://docs.microsoft.com/azure/iot-dps/tutorial-set-up-cloud>

-   <https://docs.microsoft.com/azure/iot-dps/tutorial-provision-device-to-hub>-->