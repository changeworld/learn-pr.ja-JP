<span data-ttu-id="5bc85-101">アプリケーションを構築するときには、優れたユーザー エクスペリエンスの提供を目指します。その一部がデータの迅速な取得です。</span><span class="sxs-lookup"><span data-stu-id="5bc85-101">When building an application, you want to provide a great user experience, and a part of that is quick data retrieval.</span></span> <span data-ttu-id="5bc85-102">一般に、データベースからのデータの取得は時間のかかるプロセスです。データの読み取りが頻繁に行われると、ユーザー エクスペリエンスが低下する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="5bc85-102">Retrieving data from a database is typically a slow process, and if this data is read often, this could provide a poor user experience.</span></span> <span data-ttu-id="5bc85-103">キャッシュ アサイド パターンは、最も頻繁にアクセスされるデータをできるだけ迅速に返すために、データベースと共にキャッシュを実装する方法を表します。</span><span class="sxs-lookup"><span data-stu-id="5bc85-103">The cache-aside pattern describes how you can implement a cache in conjunction with a database, to return the most commonly accessed data as quickly as possible.</span></span>

<span data-ttu-id="5bc85-104">ここでは、キャッシュ アサイド パターンを使用して、重要なデータにすばやくアクセスできるようにする方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="5bc85-104">Here, you'll learn how the cache-aside pattern can be used to ensure your important data is quickly accessible.</span></span>

## <a name="what-is-the-cache-aside-pattern"></a><span data-ttu-id="5bc85-105">キャッシュ アサイド パターンとは何でしょうか。</span><span class="sxs-lookup"><span data-stu-id="5bc85-105">What is the cache-aside pattern?</span></span>

<span data-ttu-id="5bc85-106">キャッシュ アサイド パターンは、リレーショナル データベースなどのデータ ソースからデータを読み出す必要があるとき、キャッシュに入っているデータを最初に確認するように命令するものです。</span><span class="sxs-lookup"><span data-stu-id="5bc85-106">The cache-aside pattern dictates that when you need to retrieve data from a data source, like a relational database, you should first check for the data in your cache.</span></span> <span data-ttu-id="5bc85-107">データがキャッシュにある場合はそれを使用します。</span><span class="sxs-lookup"><span data-stu-id="5bc85-107">If the data is in your cache, use it.</span></span> <span data-ttu-id="5bc85-108">データがキャッシュにない場合は、データベースに問い合わせ、データをユーザーに返すときにキャッシュに追加します。</span><span class="sxs-lookup"><span data-stu-id="5bc85-108">If the data is not in your cache, then query the database, and when you're returning the data back to the user, add it to your cache.</span></span> <span data-ttu-id="5bc85-109">これにより、データが次回必要になったときに、キャッシュのデータにアクセスできるようになります。</span><span class="sxs-lookup"><span data-stu-id="5bc85-109">This will then allow you to access the data from your cache the next time it's needed.</span></span>

## <a name="when-to-implement-the-cache-aside-pattern"></a><span data-ttu-id="5bc85-110">キャッシュ アサイド パターンを実装する状況</span><span class="sxs-lookup"><span data-stu-id="5bc85-110">When to implement the cache-aside pattern?</span></span>

<span data-ttu-id="5bc85-111">通常、データベースからのデータの読み取りは時間のかかるプロセスです。</span><span class="sxs-lookup"><span data-stu-id="5bc85-111">Reading data from a database is usually a slow process.</span></span> <span data-ttu-id="5bc85-112">このプロセスには、複雑なクエリのコンパイル、クエリ実行プランの準備、クエリの実行、結果の準備が含まれます。</span><span class="sxs-lookup"><span data-stu-id="5bc85-112">It involves compilation of a complex query, preparation of a query execution plan, execution of the query, and then preparation of the result.</span></span> <span data-ttu-id="5bc85-113">ディスクからデータを読み出す場合もあります。</span><span class="sxs-lookup"><span data-stu-id="5bc85-113">In some cases, this process may read data from the disk as well.</span></span> <span data-ttu-id="5bc85-114">クエリの事前コンパイルや一部のデータのメモリへの読み込みなど、データベース レベルで実行できる最適化があります。</span><span class="sxs-lookup"><span data-stu-id="5bc85-114">There are optimizations that can be done on the database level, like pre-compiling the queries, and loading some of the data in memory.</span></span> <span data-ttu-id="5bc85-115">しかし、クエリの実行と結果の準備は、データベースからデータを取得するときに必ず行われます。</span><span class="sxs-lookup"><span data-stu-id="5bc85-115">However, execution of the query and preparation of the result will always happen when retrieving data from a database.</span></span>

<span data-ttu-id="5bc85-116">キャッシュ アサイド パターンを使用することで、この問題を解決できます。</span><span class="sxs-lookup"><span data-stu-id="5bc85-116">We can solve this problem by using the cache-aside pattern.</span></span> <span data-ttu-id="5bc85-117">キャッシュ アサイド パターンでは、アプリケーションとデータベースに加え、キャッシュも使用します。</span><span class="sxs-lookup"><span data-stu-id="5bc85-117">In the cache-aside pattern, we still have the application and the database, but now we also have a cache.</span></span> <span data-ttu-id="5bc85-118">キャッシュはメモリにそのデータを格納するため、ファイル システムとやりとりする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="5bc85-118">A cache stores its data in memory, so it doesn't have to interact with the file system.</span></span> <span data-ttu-id="5bc85-119">キャッシュではまた、キー/値のペアなど、非常に単純なデータ構造でデータが格納されます。そのため、データを集めるために複雑なクエリを実行したり、データを記述するときにインデックスを維持したりする必要がありません。</span><span class="sxs-lookup"><span data-stu-id="5bc85-119">Caches also store data in very simple data structures, like key value pairs, so they don't have to execute complex queries to gather data or maintain indexes when writing data.</span></span> <span data-ttu-id="5bc85-120">そのため、キャッシュは一般的にデータベースよりパフォーマンスに優れています。</span><span class="sxs-lookup"><span data-stu-id="5bc85-120">Because of this, a cache is typically more performant than a database.</span></span> <span data-ttu-id="5bc85-121">アプリケーションを使用すると、アプリケーションは最初にキャッシュからデータを読み出そうとします。</span><span class="sxs-lookup"><span data-stu-id="5bc85-121">When you use an application, it will try to read data from the cache first.</span></span> <span data-ttu-id="5bc85-122">要求されたデータがキャッシュにない場合、アプリケーションは通常どおりデータベースからデータを読み出します。</span><span class="sxs-lookup"><span data-stu-id="5bc85-122">If the requested data is not in the cache, the application will retrieve it from the database, like it always has done.</span></span> <span data-ttu-id="5bc85-123">ただし、後続の要求に備え、読み出したデータをキャッシュに保存します。</span><span class="sxs-lookup"><span data-stu-id="5bc85-123">However, then it stores the data in the cache for subsequent requests.</span></span> <span data-ttu-id="5bc85-124">ユーザーがそのデータを次回要求したときには、キャッシュから直接返されます。</span><span class="sxs-lookup"><span data-stu-id="5bc85-124">Next time when any user requests the data, it will return it from the cache directly.</span></span>

![キャッシュへのデータの読み込みを示す図](../media/8-cache-aside-set-cache.png)

### <a name="how-to-manage-updating-data"></a><span data-ttu-id="5bc85-126">データの更新を管理する方法</span><span class="sxs-lookup"><span data-stu-id="5bc85-126">How to manage updating data</span></span>

<span data-ttu-id="5bc85-127">キャッシュ アサイド パターンを実装すると、小さな問題が発生します。</span><span class="sxs-lookup"><span data-stu-id="5bc85-127">When you implement the cache-aside pattern, you introduce a small problem.</span></span> <span data-ttu-id="5bc85-128">データがキャッシュとデータ ストアに格納されるようになったため、更新時に問題が出ます。</span><span class="sxs-lookup"><span data-stu-id="5bc85-128">Since your data is now stored in a cache and a data store, you can run into problems when you try to make an update.</span></span> <span data-ttu-id="5bc85-129">たとえば、データを更新するには、キャッシュとデータ ストアの両方を更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5bc85-129">For example, to update your data, you would need to update both the cache and the data store.</span></span>

<span data-ttu-id="5bc85-130">キャッシュ アサイド パターンでのこの問題を解決するには、キャッシュのデータを無効にします。</span><span class="sxs-lookup"><span data-stu-id="5bc85-130">The solution to this problem in the cache-aside pattern is to invalidate the data in the cache.</span></span> <span data-ttu-id="5bc85-131">アプリケーションでデータを更新するときに、キャッシュのデータをまず削除してから、データ ソースを直接変更します。</span><span class="sxs-lookup"><span data-stu-id="5bc85-131">When you update data in your application, you should first delete the data in the cache and then make the changes to the data source directly.</span></span> <span data-ttu-id="5bc85-132">こうすることで、次回データが要求されたときに、データがキャッシュに存在しなくなり、プロセスが繰り返されます。</span><span class="sxs-lookup"><span data-stu-id="5bc85-132">By doing this, next time the data is requested, it won't be present in the cache, and the process will repeat.</span></span> 

![キャッシュ データの無効化を示す図](../media/8-cache-aside-invalidate.png)

## <a name="considerations-for-using-the-cache-aside-pattern"></a><span data-ttu-id="5bc85-134">キャッシュ アサイド パターンの使用に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="5bc85-134">Considerations for using the cache-aside pattern</span></span>

<span data-ttu-id="5bc85-135">キャッシュに入れるデータを慎重に検討します。</span><span class="sxs-lookup"><span data-stu-id="5bc85-135">Carefully consider which data to put in the cache.</span></span> <span data-ttu-id="5bc85-136">キャッシュに適していないデータもあります。</span><span class="sxs-lookup"><span data-stu-id="5bc85-136">Not all data is suitable to be cached.</span></span>

- <span data-ttu-id="5bc85-137">**有効期間**: キャッシュ アサイドを効果的に使用するには、有効期限ポリシーとデータのアクセス頻度を合わせます。</span><span class="sxs-lookup"><span data-stu-id="5bc85-137">**Lifetime**: For cache-aside to be effective, make sure that the expiration policy matches the access frequency of the data.</span></span> <span data-ttu-id="5bc85-138">有効期限が短すぎると、アプリケーションは絶えずデータ ストアからデータを取得してキャッシュに追加することになります。</span><span class="sxs-lookup"><span data-stu-id="5bc85-138">Making the expiration period too short can cause applications to continually retrieve data from the data store and add it to the cache.</span></span>

- <span data-ttu-id="5bc85-139">**削除**: キャッシュはデータ ストアに比べてサイズが限られており、必要に応じてデータが削除されます。</span><span class="sxs-lookup"><span data-stu-id="5bc85-139">**Evicting**: Caches have a limited size compared to typical data stores, and they'll evict data if necessary.</span></span> <span data-ttu-id="5bc85-140">データの適切な削除ポリシーを選択してください。</span><span class="sxs-lookup"><span data-stu-id="5bc85-140">Make sure you choose an appropriate eviction policy for your data.</span></span>

- <span data-ttu-id="5bc85-141">**準備**: キャッシュ アサイド パターンを効果的に使用するために、多くのソリューションでは、頻繁にアクセスされると考えられるデータがキャッシュに事前入力されます。</span><span class="sxs-lookup"><span data-stu-id="5bc85-141">**Priming**: To make the cache-aside pattern effective, many solutions will prepopulate the cache with data that they think will be accessed often.</span></span>

- <span data-ttu-id="5bc85-142">**整合性**: キャッシュ アサイド パターンの実装では、データ ストアとキャッシュ間の整合性が保証されるわけではありません。</span><span class="sxs-lookup"><span data-stu-id="5bc85-142">**Consistency**: Implementing the cache-aside pattern doesn't guarantee consistency between the data store and the cache.</span></span> <span data-ttu-id="5bc85-143">データ ストアのデータは、キャッシュへの通知なしに変更されることがあります。</span><span class="sxs-lookup"><span data-stu-id="5bc85-143">Data in a data store can be changed without notifying the cache.</span></span> <span data-ttu-id="5bc85-144">それが同期関連の重大な問題につながる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="5bc85-144">This can lead to serious synchronization issues.</span></span>

<span data-ttu-id="5bc85-145">キャッシュ アサイド パターンは、ディスクを使用するデータ ソースから頻繁にデータにアクセスするときに便利です。</span><span class="sxs-lookup"><span data-stu-id="5bc85-145">The cache-aside pattern is useful when you're required to access data frequently from a data source that uses a disk.</span></span> <span data-ttu-id="5bc85-146">キャッシュ アサイド パターンを使用し、重要なデータをキャッシュに保存すれば、読み出しが速くなります。</span><span class="sxs-lookup"><span data-stu-id="5bc85-146">Using the cache-aside pattern, you'll store important data in a cache to help increase the speed of retrieving it.</span></span> 