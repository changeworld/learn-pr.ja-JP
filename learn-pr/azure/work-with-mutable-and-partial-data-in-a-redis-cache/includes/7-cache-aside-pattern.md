アプリケーションを構築するときには、優れたユーザー エクスペリエンスの提供を目指します。その一部がデータの迅速な取得です。 一般に、データベースからのデータの取得は時間のかかるプロセスです。データの読み取りが頻繁に行われると、ユーザー エクスペリエンスが低下する可能性があります。 キャッシュ アサイド パターンは、最も頻繁にアクセスされるデータをできるだけ迅速に返すために、データベースと共にキャッシュを実装する方法を表します。

ここでは、キャッシュ アサイド パターンを使用して、重要なデータにすばやくアクセスできるようにする方法を説明します。

## <a name="what-is-the-cache-aside-pattern"></a>キャッシュ アサイド パターンとは何でしょうか。

キャッシュ アサイド パターンは、リレーショナル データベースなどのデータ ソースからデータを読み出す必要があるとき、キャッシュに入っているデータを最初に確認するように命令するものです。 データがキャッシュにある場合はそれを使用します。 データがキャッシュにない場合は、データベースに問い合わせ、データをユーザーに返すときにキャッシュに追加します。 これにより、データが次回必要になったときに、キャッシュのデータにアクセスできるようになります。

## <a name="when-to-implement-the-cache-aside-pattern"></a>キャッシュ アサイド パターンを実装する状況

通常、データベースからのデータの読み取りは時間のかかるプロセスです。 このプロセスには、複雑なクエリのコンパイル、クエリ実行プランの準備、クエリの実行、結果の準備が含まれます。 ディスクからデータを読み出す場合もあります。 クエリの事前コンパイルや一部のデータのメモリへの読み込みなど、データベース レベルで実行できる最適化があります。 しかし、クエリの実行と結果の準備は、データベースからデータを取得するときに必ず行われます。

キャッシュ アサイド パターンを使用することで、この問題を解決できます。 キャッシュ アサイド パターンでは、アプリケーションとデータベースに加え、キャッシュも使用します。 キャッシュはメモリにそのデータを格納するため、ファイル システムとやりとりする必要はありません。 キャッシュではまた、キー/値のペアなど、非常に単純なデータ構造でデータが格納されます。そのため、データを集めるために複雑なクエリを実行したり、データを記述するときにインデックスを維持したりする必要がありません。 そのため、キャッシュは一般的にデータベースよりパフォーマンスに優れています。 アプリケーションを使用すると、アプリケーションは最初にキャッシュからデータを読み出そうとします。 要求されたデータがキャッシュにない場合、アプリケーションは通常どおりデータベースからデータを読み出します。 ただし、後続の要求に備え、読み出したデータをキャッシュに保存します。 ユーザーがそのデータを次回要求したときには、キャッシュから直接返されます。

![キャッシュへのデータの読み込みを示す図](../media/8-cache-aside-set-cache.png)

### <a name="how-to-manage-updating-data"></a>データの更新を管理する方法

キャッシュ アサイド パターンを実装すると、小さな問題が発生します。 データがキャッシュとデータ ストアに格納されるようになったため、更新時に問題が出ます。 たとえば、データを更新するには、キャッシュとデータ ストアの両方を更新する必要があります。

キャッシュ アサイド パターンでのこの問題を解決するには、キャッシュのデータを無効にします。 アプリケーションでデータを更新するときに、キャッシュのデータをまず削除してから、データ ソースを直接変更します。 こうすることで、次回データが要求されたときに、データがキャッシュに存在しなくなり、プロセスが繰り返されます。 

![キャッシュ データの無効化を示す図](../media/8-cache-aside-invalidate.png)

## <a name="considerations-for-using-the-cache-aside-pattern"></a>キャッシュ アサイド パターンの使用に関する考慮事項

キャッシュに入れるデータを慎重に検討します。 キャッシュに適していないデータもあります。

- **有効期間**: キャッシュ アサイドを効果的に使用するには、有効期限ポリシーとデータのアクセス頻度を合わせます。 有効期限が短すぎると、アプリケーションは絶えずデータ ストアからデータを取得してキャッシュに追加することになります。

- **削除**: キャッシュはデータ ストアに比べてサイズが限られており、必要に応じてデータが削除されます。 データの適切な削除ポリシーを選択してください。

- **準備**: キャッシュ アサイド パターンを効果的に使用するために、多くのソリューションでは、頻繁にアクセスされると考えられるデータがキャッシュに事前入力されます。

- **整合性**: キャッシュ アサイド パターンの実装では、データ ストアとキャッシュ間の整合性が保証されるわけではありません。 データ ストアのデータは、キャッシュへの通知なしに変更されることがあります。 それが同期関連の重大な問題につながる可能性があります。

キャッシュ アサイド パターンは、ディスクを使用するデータ ソースから頻繁にデータにアクセスするときに便利です。 キャッシュ アサイド パターンを使用し、重要なデータをキャッシュに保存すれば、読み出しが速くなります。 