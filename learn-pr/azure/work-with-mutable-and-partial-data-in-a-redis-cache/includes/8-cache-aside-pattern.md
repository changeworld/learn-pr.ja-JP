アプリケーションをビルドするとき、データの取得が速いなど、使い勝手の良いアプリケーションを目指すとします。 データベースからデータを読み出すプロセスは一般的に遅く、データを頻繁に呼び出す場合、ユーザー エクスペリエンスが低下することがあります。 キャッシュ アサイド パターンは、データベースとの連動でキャッシュを実装し、最も頻繁にアクセスされるデータを可能な限り短時間で返す方法を表すものです。

今回、キャッシュ アサイド パターンを使用し、重要なデータにすばやくアクセスする方法を学習します。

## <a name="what-is-the-cache-aside-pattern"></a>キャッシュ アサイド パターンとは何でしょうか。

キャッシュ アサイド パターンは、リレーショナル データベースなどのデータ ソースからデータを読み出す必要があるとき、キャッシュに入っているデータを最初に確認するように命令するものです。 データがキャッシュに入っている場合、それを使用します。 データがキャッシュに入っていない場合はデータベースに問い合わせます。そしてユーザーにデータを返すとき、キャッシュにそれを追加します。 そうすることで、次回必要になったとき、キャッシュからデータにアクセスできます。

## <a name="when-to-implement-cache-aside-pattern"></a>キャッシュ アサイド パターンはどのような状況で実装しますか。

データベースからデータを読むという行為が一般的に遅いのは、複雑なクエリのコンパイル、クエリ実行プランの準備、クエリの実行、結果の準備が伴うからです。 このプロセスではディスクからデータを読み出すこともあります。 クエリを事前にコンパイルする、一部のデータをメモリにロードするなど、データベース レベルでの最適化は可能です。 しかしながら、クエリの実行と結果の準備は常に、データベースからデータを読み出すときに行われます。

キャッシュ アサイド パターンを使用することでこの問題を解決できます。 キャッシュ アサイド パターンでは、アプリケーションとデータベースにキャッシュが加わります。 キャッシュはメモリにそのデータを格納するため、ファイル システムとやりとりする必要はありません。 キャッシュではまた、キー/値のペアなど、非常に単純なデータ構造でデータが格納されます。そのため、データを集めるために複雑なクエリを実行したり、データを記述するときにインデックスを維持したりする必要がありません。 そのため、キャッシュは一般的にデータベースよりパフォーマンスに優れています。 アプリケーションを使用すると、アプリケーションは最初にキャッシュからデータを読み出そうとします。 要求されたデータがキャッシュにない場合、アプリケーションは通常どおりデータベースからデータを読み出します。 ただし、後続の要求に備え、読み出したデータをキャッシュに保存します。 そのデータが次回要求されたとき、キャッシュから直接返します。

![キャッシュにデータを読み込む](../media-draft/cache-aside-set-cache.png)

### <a name="how-to-manage-updating-data"></a>データ更新を管理する方法

キャッシュ アサイド パターンを実装すると、小さな問題が発生します。 データがキャッシュとデータ ストアに格納されるようになったため、更新時に問題が出ます。 たとえば、データを更新するには、キャッシュとデータ ストアの両方を更新する必要があります。

キャッシュ アサイド パターンでこの問題を解決するには、キャッシュのデータを無効にします。 アプリケーションのデータを更新するとき、最初にキャッシュのデータを削除し、その後、データ ソースを直接変更してください。 そうすることで、次回データが要求されたとき、データがキャッシュに入っておらず、プロセスが繰り返されます。 

![キャッシュされたデータを無効にする](../media-draft/cache-aside-invalidate.png)

## <a name="considerations-for-using-the-cache-aside-pattern"></a>キャッシュ アサイド パターンの使用に関する注意点

キャッシュに置くべきデータは慎重に決めてください。 キャッシュに置くべきではないデータもあります。

- **有効期間**: キャッシュ アサイドを効果的に使用するには、有効期限ポリシーとデータのアクセス頻度を合わせます。 有効期限が短すぎると、アプリケーションは絶えずデータ ストアからデータを取得してキャッシュに追加することになります。

- **削除**: キャッシュはデータ ストアに比べてサイズが限られており、必要に応じてデータが削除されます。 ご利用のデータにとって最適な削除ポリシーを選択してください。

- **初期化**: キャッシュ アサイド パターンを効果的に使用するために、多くのソリューションで、頻繁にアクセスされると考えられるデータがキャッシュに事前入力されます。

- **一貫性**: キャッシュ アサイド パターンを実装しても、データ ストアとキャッシュの間での整合性が保証されるわけではありません。 データ ストアのデータは、キャッシュに通知することなく変更されることがあります。 それが同期関連の重大な問題につながる可能性があります。

キャッシュ アサイド パターンは、ディスクを使用するデータ ソースから頻繁にデータにアクセスするときに便利です。 キャッシュ アサイド パターンを使用し、重要なデータをキャッシュに保存すれば、読み出しが速くなります。 