ご自分のデータベースを評価し、報告された任意のエラーを修正して、データベースを移行する準備ができました。 この演習では、ご使用の SQL データベースを Azure SQL Database に移行します。

## <a name="setup"></a>セットアップ

まだダウンロードしていない場合は、サンプル データをダウンロードします。

1. インターネット ブラウザーを起動して、 https://docs.microsoft.com/sql/samples/adventureworks-install-configure?view=sql-server-2017 に移動します。

1. 「**OLTP のダウンロード**」で、**AdventureWorks2008R2.bak** をクリックします。

1. Management Studio で、**AdventureWorks 2008R2** を既定のインスタンスに復元します。

## <a name="create-an-azure-sql-database"></a>Azure SQL Database の作成

1. ご自分の Azure portal アカウントにサインインします。

1. ポータルの左上隅にある **[リソースの作成]** をクリックします。

1. **[データベース]** > **[SQL Database]** をクリックします。

1. SQL Database フォームで、次のフィールドを入力します。

    |フィールド|説明|
    |-----|---|
    |データベース名|データベースの名前を入力します。 これは、移行する既存のデータベースの名前、または選択した新しい名前になります|
    |リソース グループ|リソース グループを選択するか、新しいリソース グループ名を入力します|
    |ソースの選択|*[空のデータベース]* を選択します|

1. **[サーバー]** の下で、既存のサーバーを選択するか、グローバルに一意の**サーバー名**、**サーバー管理者ログイン**、**パスワード** (確認する必要があります)、**場所**を入力します。

    > [!NOTE]
    > サーバー名、ログイン名、パスワードを使用して、ご利用のデータベースに接続します。

1. **[選択]** をクリックします。

1. **[価格レベル]** で、パフォーマンスの高いデータベースを選択できますが、このチュートリアルでは、既定値を選択します。

1. **[作成]** をクリックします。 チュートリアルを続行する前に、データベースがプロビジョニングされるまで待ちます。

    次のスクリーンショットは、考えられる新しい SQL データベースの構成を示しています。

    ![サンプルの構成を含む、Azure portal の [新しい SQL Database] ブレードのスクリーンショット。](../media-draft/5-create-azure-sql-db.png)

## <a name="create-a-new-migration-project"></a>新しい移行プロジェクトの作成

1. **Data Migration Assistant** を起動します。

1. **新規**アイコンをクリックして、次のオプションを指定します。

    - **プロジェクトの種類** - *[移行]* オプションを選択します。
    - **プロジェクト名** - プロジェクトに使いやすい名前を入力します。
    - **ソース サーバーの種類** - *[SQL Server]* を選択します。
    - **対象サーバーの種類** - *[Azure SQL Database]* を選択します。
    - **移行スコープ** - *[スキーマとデータ]* を選択します。

1. **[作成]** をクリックします。

## <a name="specify-the-source-server-and-database"></a>ソース サーバーとデータベースの指定

1. **[ソース サーバーに接続します]** の下で、**[サーバー名]** フィールドにソース SQL Server インスタンスの名前を入力します。

1. ソース SQL Server インスタンスによってサポートされる **[認証の種類]** を選択します。
    > [!TIP]
    > 接続プロパティの下にある **[暗号化接続]** チェック ボックスをオンにして、接続を暗号化することをお勧めします。

1. **[接続]** を選択します。

1. Azure SQL Database に移行する単一のソース データベースを選択し、**[次へ]** をクリックします。

## <a name="specify-the-target-server-and-database"></a>対象サーバーとデータベースの指定

1. **[対象サーバーに接続します]** の下で、**[サーバー名]** フィールドに Azure SQL Database インスタンスの名前を入力します。 **database.windows.net** をデータベース インスタンスに追加します。

1. 対象になる Azure SQL Database インスタンスによってサポートされる認証の種類を選択します。 このチュートリアルでは、**[SQL Server 認証]** を選択します。
    > [!TIP]
    > 接続プロパティの下にある **[暗号化接続]** チェック ボックスをオンにして、接続を暗号化することをお勧めします。

1. Azure SQL Database の作成時に定義した**ユーザー名**と**パスワード**を入力します。

1. **[接続]** をクリックします。

1. 移行先の単一の対象になるデータベースを選択します。
    > [メモ] Windows ユーザーを移行する場合は、ターゲット外部ユーザーのドメイン名のテキスト ボックスに、ターゲット外部ユーザーのドメイン名が正しく指定されていることを確認してください。

1. **[Next]\(次へ\)** をクリックします。

## <a name="select-schema-objects"></a>スキーマ オブジェクトの選択

1. Azure SQL Database に移行するソース データベースからスキーマ オブジェクトを選択します。

    > [!NOTE]
    > そのまま変換できないオブジェクトの一部が、自動修正の可能性と共に表示されます。 左側のウィンドウでこれらのオブジェクトをクリックすると、右側のウィンドウに提案された修正が表示されます。 修正を確認して、オブジェクトごとにすべての変更を適用するか、無視するかを選びます。 1 つのオブジェクトに対してすべての変更を適用するか、無視しても、他のデータベース オブジェクトには変更が適用されないことに注意してください。 変換できない、または自動修正できないというステートメントが、対象になるデータベースに対して再現され、コメントされます。

    !["ストアド プロシージャ: dbo.uspSearchCandidateResumes" の問題が選択され、その問題の詳細が示された、AdventureWorks SQL Server データに影響している移行の問題の一覧を示す Data Migration Assistant のスクリーンショット。](../media-draft/5-suggested-fix.png)

1. **[SQL スクリプトの生成]** をクリックします。

## <a name="deploy-schema"></a>スキーマの配置

1. **[スキーマの配置]** をクリックします。

1. スキーマの配置の結果を確認します。

## <a name="migrate-data"></a>データの移行

1. **[データの移行]** をクリックして、データの移行プロセスを開始します。

1. 移行するデータを含むテーブルを選択します。

1. **[Start data migration]\(データ移行の開始\)** をクリックします。

最後の画面に全体的な状態が表示されます。

## <a name="summary"></a>まとめ

この演習では、空の Azure SQL Database を作成して、ローカルの SQL Server データベースをこの新しいデータベースに移行しました。