前に説明したように、会社は Windows VM 上でビデオ コンテンツを処理しています。 ある都市と交通カメラの処理契約を新たに結びましたが、そのカメラはこれまでに扱ったことがないモデルです。 画像の処理と分析を始めるために、新しい Windows VM を作成し、専用コーデックをインストールする必要があります。

## <a name="create-a-new-windows-virtual-machine"></a>新しい Windows 仮想マシンを作成する

Windows VM の作成は、Azure portal、Azure CLI、または Azure PowerShell で行うことができます。 最も簡単な方法は、ポータルを使用することです。そうすれば、作成の間に、必要な情報が順番に示され、ヒントと有用なメッセージが提供されます。

1. [Azure portal](https://portal.azure.com?azure-portal=true) にサインインします。

1. Azure portal の左上隅にある **[リソースの作成]** をクリックします。

1. 検索ボックスに「**Windows Server 2016 Datacenter**」と入力し、表示された一覧の中から同じタイトルのリンクをクリックします。

1. **[作成]** ボタンをクリックして、VM の構成を始めます。

## <a name="configure-the-vm-settings"></a>VM 設定を構成する

ポータルでの VM 作成エクスペリエンスは "ウィザード" の形式で提示され、VM のすべての構成領域が順番に示されます。 [次へ] ボタンをクリックすると、次の構成可能なセクションに移動します。 ただし、上部に並んでいるタブで各セクションが示されており、自由にセクション間を移動できます。

![Azure portal で仮想マシンを作成する](../media-drafts/3-azure-portal-create-vm.png)

必須のオプション (赤い星で示されたもの) をすべて入力したら、残りのウィザード エクスペリエンスをスキップし、下部にある **[確認および作成]** ボタンをクリックして VM の作成を始めることができます。

最初は **[基本]** セクションです。

### <a name="configure-basic-vm-settings"></a>VM の基本設定を構成する

1. VM 時間の請求対象である **[サブスクリプション]** を選択します。

1. **[リソース グループ]** で **[新規作成]** を選択し、リソース グループに「**ExerciseResources**」という名前を付けます。

> [!NOTE]
> 設定を変更してフィールドから移動すると、各値が自動的に検証されて、問題がない場合は横に緑色のチェック マークが表示されます。 エラー インジケーターをポイントすると、検出された問題についての詳細が表示されます。

1. **[インスタンスの詳細]** セクションで、VM の名前を入力します (たとえば、Test Video Processor VM #2 を表す "test-vp-vm2")。
    - リソースの目的がすぐにわかるように、リソース名を標準化するのがベスト プラクティスです。 Windows VM の名前には制限があります。2 文字から 15 文字までの範囲で、数字、文字、ダッシュで構成されている必要があります。

1. 近くのリージョンを選択します。

1. **[Availability options]\(可用性オプション\)** は [なし] のままにします。 このオプションは、複数の VM をグループ化して計画的または計画外のメンテナンス イベントや停止に対処することで、VM を高可用性にするために使用されます。

1. イメージが "Windows Server 2016 Datacenter" に設定されていることを確認します。 ドロップダウン リストを開いて、使用可能なすべてのオプションを確認できます。

1. **[VM ディスクの種類]** フィールドで、ドロップダウン メニューをクリックしてオプションを表示します。 **[SSD]** が選択されていることを確認します。

1. **[サイズ]** フィールドは直接編集することはできず、DS1 の既定のサイズが設定されています。 他の VM サイズを確認するには、**[Change size]\(サイズの変更\)** のリンクをクリックします。 結果のダイアログでは、CPU の数、名前、ディスクの種類に基づいてフィルター処理できます。 終わったら、"Standard DS1 v2" (通常は既定値) を選択します。 これにより、VM に 1 個の CPU と 3.5 GB のメモリが設定されます。

    > [!TIP]
    > ビューを左側にスライドして新しいウィンドウが右に開いたときの VM 設定に戻し、ウィンドウをスライドしてそれを表示することもできます。

1. **[管理者アクセス]** セクションの **[ユーザー名]** フィールドに、VM へのサインインに使用するユーザー名に設定します。

1. **[パスワード]** フィールドには、少なくとも 12 文字の長さのパスワードを入力します。 このとき、1 個の小文字、1 個の大文字、1 個の数字、'\'' または '-' 以外の 1 個の特殊文字のうち、3 種類の文字を使用する必要があります。 覚えやすいものにするか、書き留めておいてください。後で必要になります。

1. **パスワード**を確認入力します。

1. **[受信ポートの規則]** セクションで一覧を開き、[なし] を "_オフにします_"。 これは Windows VM なので、RDP を使用してデスクトップにアクセスできるようにします。 必要に応じて一覧をスクロールし、RDP (3389) を見つけて選択します。 UI の注意事項が示すとおり、VM を作成した後でネットワーク ポートを調整することもできます。

    ![Windows VM で RDP アクセス用のポートを開く](../media-drafts/3-open-ports.png)

## <a name="configure-disks-for-the-vm"></a>VM 用にディスクを構成する

1. **[次へ]** をクリックして、[ディスク] セクションに移動します。

    ![VM 用にディスクを構成する](../media-drafts/3-configure-disks.png)

1. **[OS ディスクの種類]** で [Premium SSD] を選択します。

1. ストレージ アカウントを使用せずに済むように、マネージド ディスクを使用します。 GUI でスイッチを切り替えて、Azure で必要な情報の違いを確認できます。

### <a name="create-a-data-disk"></a>データ ディスクを作成する

OS ディスク (C:) と一時ディスク (D:) を使用することを思い出してください。 データ ディスクも追加してみましょう。

1. **[データ ディスク]** セクションで **[Create and attach a new disk]\(新しいディスクの作成とアタッチ\)** リンクをクリックします。

    ![ポータルで VM 用のデータ ディスクを作成する](../media-drafts/3-add-data-disk.png)

1. すべての既定値を使用できます (Premium SSD、1023 GB、および "なし" (空のディスク))。ただし、ここではスナップショットまたは Storage BLOB を使用して VHD を作成することに注意してください。

1. **[OK]** をクリックしてディスクを作成し、**[データ ディスク]** セクションに戻ります。

1. 最初の行に新しいディスクが表示されるはずです。

    ![VM の新しいディスク](../media-drafts/3-new-disk.png)

## <a name="configure-the-network"></a>ネットワークを構成する

1. **[次へ]** をクリックして、[ネットワーク] セクションに移動します。

1. 既に他のコンポーネントがある運用システムでは、"_既存の_" 仮想ネットワークを利用します。 そうすれば、VM はソリューション内の他のクラウド サービスと通信できます。 この場所でまだ定義されていない場合は、ここで作成して構成できます。
    - **[アドレス空間]**: このネットワークに使用できる IPV4 空間全域。
    - **[Subnet range]\(サブネット範囲\)**: アドレス空間を分割する最初のサブネット。定義されているアドレス空間内に収まる必要があります。 VNet が作成された後、別のサブネットを追加できます。

1. `172.xxx` IP アドレス空間を使用するように既定の範囲を変更してみましょう。
    - **[アドレス空間]** フィールドを `172.16.0.0/16` に変更して全アドレス範囲を指定します。
    - **[Subnet range]\(サブネット範囲\)** フィールドを `172.16.1.0/24` に変更して空間の 256 個の IP アドレスを指定します。

> [!NOTE]
> 既定では、Azure によって VM 用に仮想ネットワーク、ネットワーク インターフェイス、パブリック IP が作成されます。 VM が作成された後でネットワーク オプションを変更するのは簡単ではないので、Azure で作成するサービスでのネットワーク割り当てを常に再確認してください。

## <a name="finish-configuring-the-vm-and-create-the-image"></a>VM の構成を完了してイメージを作成する

残りのオプションは既定値で問題ないので、どれも変更する必要はありません。 そうしたければ、他のタブを調べてもかまいません。 個々のオプションの横には `(i)` アイコンがあり、オプションを説明するヘルプ バブルが表示されます。 これは、VM の構成に使用できるさまざまなオプションについて学習するのによい方法です。

1. パネルの下部にある **[確認および作成]** ボタンをクリックします。

1. システムによってオプションが検証され、作成される VM についての詳細が表示されます。

1. **[作成]** をクリックして VM を作成し、デプロイします。 Azure ダッシュボードにはデプロイされている VM が表示されます。 これには数分かかる場合があります。

デプロイが行われている間に、この VM でできることを見てみましょう。