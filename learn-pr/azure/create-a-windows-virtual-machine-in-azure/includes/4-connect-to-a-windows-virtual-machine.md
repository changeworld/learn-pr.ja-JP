データ分析企業のネットワーク管理者であるあなたは、Azure にある仮想マシンに接続し、仮想マシンが正しく構成されていることを確認する仕事を担当します。 この仕事は、リモート デスクトップ プロトコル クライアントを使用し、VM の Windows デスクトップ UI に接続することで行います。

## <a name="what-is-the-remote-desktop-protocol"></a>リモート デスクトップ プロトコルとは

リモート デスクトップ プロトコル (RDP) は、Windows ベース コンピューターの UI へのリモート接続を提供します。 RDP を使用すると、離れた場所にある物理または仮想 Windows コンピューターにサインインし、まるでコンソールで操作しているかのようにそのコンピューターを制御できます。

> [!Note]
> Windows Server 2016 と Windows 10 の Windows Hyper-V では RDP を利用し、ハイパーバイザーで実行されている仮想マシンに接続します。

RDP 接続を利用すると、電源とハードウェアに関連する一部の機能を除き、物理コンピューターのコンソールからできる作業のほとんどを実行できます。

RDP 接続には RDP クライアントが必要です。 Microsoft では、次のオペレーティング システム用の RDP クライアントを提供しています。

* Windows
* iOS
* MacOS
* Android

オープンソースの Linux クライアントもあり、たとえば、Remmina を利用すれば、Ubuntu ディストリビューションから Windows PC に接続できます。

Windows 10 には RDP クライアントが含まれています。

![Windows RDP クライアント](../images/2-rdp-client.PNG)

## <a name="what-functionality-does-an-rdp-connection-support"></a>RDP 接続ではどのような機能がサポートされていますか?

RDP 接続を利用すると、UI とやり取りできます。 もっとも、リモート コンピューター上の他のサービスにも接続できます。 次のようなサービスがあります。

* プリンター接続。リモート コンピューターからローカル印刷デバイスに出力できます。
* オーディオ再生。ローカル コンピューターかリモート デバイスでオーディオを再生できます。
* オーディオ録音。ローカル コンピューターからオーディオを録音し、そのサウンドをリモート デバイスに送ることができます。
* ポート。ローカル コンピューターのポートにリダイレクトできます。
* デバイス。マッピングされたネットワーク ドライブを含む。リモート コンピューターに接続されているものとしてドライブが表示されます。
* ビデオ キャプチャ デバイス。一体型の Web カメラなど。
* サポートされているその他のプラグ アンド プレイ デバイス。

Azure では以上のすべての機能がサポートされているわけではありません。Azure プラットフォームでは、利用できる物理アセットに制約があるためです。 たとえば、Azure がホストする VM から接続クライアントの印刷デバイスに RDP 接続経由でリダイレクトできるのはソフトウェア プリンターだけです。

## <a name="configure-network-settings-for-rdp-access-to-virtual-machines"></a>仮想マシンに RDP アクセスするためのネットワーク設定を構成する

Azure VM には 3 通りの方法で接続できます。

1. VM のパブリック IP アドレスに直接。
2. 仮想プライベート ネットワーク (VPN) 接続を通して。
3. ExpressRoute 接続を通して。

パブリック IP アドレスは固定で割り当てるか、動的に割り当てることができます。 ポート 3389 (RDP) で VM のパブリック アドレスにアクセスできることも確認しておく必要があります。 このプロビジョニングには、組織のファイアウォール セキュリティを管理し、ポート 3389 で VM のパブリック IP アドレスにルールを設定しているチームとの交渉が場合によっては必要になります。

VM が再起動するたびに、動的パブリック IP アドレスが再割り当てされます。 静的アドレスは固定ですが、コストが多くなります。

VPN 経由で接続するには、ローカル ネットワークに Microsoft Azure へのアクティブな VPN 接続を与える必要があります。

ExpressRoute リンクの手法では、VM への接続が管理されます。 この手法ではまた、待ち時間が最も短く、接続の帯域幅が最も広くなります。

> [!Note]
> Azure への接続に使用しているオプションに関係なく、RDP 経由で仮想マシンにアクセスできることを確認する必要があります。通常、既定のポート 3389 でアクセスします。 独自のクライアント IP アドレスからのみアクセスできるように VM を構成できます。 パブリック IP アドレスによるポート 3389 経由の VM 接続はテスト環境でのみ推奨されます。 運用環境では、オプション 2 または 3 を使用してください。

## <a name="how-do-you-connect-to-a-vm-in-azure-using-rdp"></a>RDP を使用して Azure の VM に接続するにはどうすればよいですか?

RDP を使用した Azure の VM への接続はシンプルなプロセスです。 Azure portal で、お使いの VM のプロパティに移動し、一番上にある **[接続]** をクリックします。 これで事前構成済みの .RDP ファイルがダウンロードされます。Windows により、このファイルが RDP クライアントで開きます。 RDP ファイルの VM のパブリック IP アドレス経由で接続するように選択できます。 あるいは、VPN または ExpressRoute 経由で接続する場合、内部 IP アドレスを選択できます。 接続のポート番号も選択できます。

VM の静的パブリック IP アドレスを使用している場合、.RDP ファイルをお使いのデスクトップに保存できます。 動的 IP アドレスを使用している場合、VM が実行されている間のみ、.RDP ファイルは有効となります。 VM を停止し、再起動する場合、別の .RDP ファイルをダウンロードする必要があります。

> [!Note]
> Windows RDP クライアントに VM のパブリック IP アドレスを入力し、**[接続]** をクリックすることもできます。

接続すると、通常、2 つの警告が表示されます。 次のとおりです。

* 発行元警告 - .RDP ファイルに公的な署名がないことが警告の原因です。
* 証明書警告 - コンピューター証明書が信頼されていないことが警告の原因です。

テスト環境では、これらの警告を無視できます。 運用環境では、.RDP ファイルに RDPSIGN.EXE を利用して署名し、コンピューター証明書をクライアントの**信頼されたルート証明機関**ストアに配置するということが可能です。

## <a name="summary"></a>まとめ

これで RDP を使用して Windows VM に接続できます。 次の演習では、RDP を使用して VM に接続し、そのコンピューターにサーバーの役割をインストールします。
