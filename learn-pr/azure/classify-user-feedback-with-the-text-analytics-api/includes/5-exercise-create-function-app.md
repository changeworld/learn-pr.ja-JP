ソリューションをビルドするには、コードをホストする必要があります。  Azure Functions の関数アプリは、ロジックをホストするのに適しています。 

## <a name="create-a-function-app-to-host-our-function"></a>関数をホストする関数アプリを作成する

[!INCLUDE [resource-group-note](./rg-notice.md)]

1. Azure アカウントを使用して Azure portal ([https://portal.azure.com](https://portal.azure.com?azure-portal=true)) にサインインしていることを確認します。

1. Azure portal の左上隅にある **[リソースの作成]** ボタンをクリックし、**[コンピューティング]** > **[Function App]** を選択します。

1. 次の表に示す関数アプリの設定を入力します。


    | 設定      | 推奨値  | 説明                                        |
    | ------------ |  ------- | -------------------------------------------------- |
    | **アプリ名** | グローバルに一意の名前 | 新しい関数アプリを識別する名前。 有効な文字は、`a-z`、`0-9`、および `-` です。  | 
    | **サブスクリプション** | お使いのサブスクリプション | この新しい関数アプリが作成されるサブスクリプション。 | 
    | **リソース グループ**|  [!INCLUDE [resource-group-name](./rg-name.md)] | 関数アプリを作成するリソース グループの名前。<br/><br/>必ず **[既存のものを使用]** を選択し、前回の演習で作成したリソース グループを使用します。 これにより、このモジュールで作成したすべてのリソースがまとめられます。 | 
    | **OS** | Windows | 関数アプリをホストするオペレーティング システム。  |
    | **ホスティング** |   従量課金プラン | Function App にどのようにリソースが割り当てられるかを定義するホスティング プラン。 既定の**従量課金プラン**では、関数での必要に応じてリソースが動的に追加されます。 この[サーバーレス](https://azure.microsoft.com/overview/serverless-computing/) ホスティングでは、関数が実行された時間にのみ課金されます。   |
    | **場所** | 米国西部 | ユーザーの最寄りの[リージョン](https://azure.microsoft.com/regions/)、または関数がアクセスする他のサービスの近くのリージョンを選択します。<br/><br/>前回の演習で Text Analytics API アカウントを作成したときに使用したリージョンを選択します。 |
    | **ストレージ アカウント** |  グローバルに一意の名前 |  関数アプリによって使用される新しいストレージ アカウントの名前。 ストレージ アカウント名の長さは 3 から 24 文字である必要があり、数字と小文字のみを使用できます。 このダイアログでは、アプリに指定した名前から派生した一意の名前がこのフィールドに入力されます。 ただし、別の名前や既存のアカウントを自由に使用できます。 |

3. **[作成]** を選択して、関数アプリをプロビジョニングし、デプロイします。

4. ポータルの右上隅の通知アイコンを選択し、**デプロイが進行中**であることを示す次のようなメッセージが表示されるまで待ちます。

![関数アプリのデプロイが進行中であることを示す通知](../media-draft/func-app-deploy-progress-small.PNG)

5. デプロイには時間がかかることがあります。 そのため、通知ハブを表示した状態で、**デプロイに成功**したことを示す次のようなメッセージが表示されるまで待ちます。

![関数アプリのデプロイが完了したことを示す通知](../media-draft/func-app-text-analytics-deploy-success.png)

6. お疲れさまでした。 関数アプリを作成し、デプロイしました。 **[リソースに移動]** を選択して、新しい関数アプリを確認します。

>[!TIP]
>ポータルで目的の関数アプリが見つからない場合は、[Azure portal でお気に入りに Function App を追加](https://docs.microsoft.com/en-us/azure/azure-functions/functions-how-to-use-azure-function-app-settings#favorite)してみてください。

## <a name="create-a-function-to-hold-our-logic"></a>ロジックを保持する関数を作成する

関数アプリを用意できたので、次に関数を作成します。 関数はトリガーによってアクティブ化されます。 このモジュールでは、キュー トリガーを使用します。 ランタイムによってキューがポーリングされ、新しいメッセージを処理するためにこの関数が起動されます。

1. 新しい関数アプリを展開し、**[関数]** コレクションをポイントします。 表示された追加 (**+**) ボタンをクリックして、関数作成プロセスを開始します。

![ユーザーが [関数] メニュー項目をポイントするとプラス記号が表示されることを示すアニメーション。](../media-draft/func-app-plus-hover-small.gif)

2. 表示された **[Get started quickly]\(すぐに使用を開始する\)** ページで、**[カスタム関数]** を選択します。これにより、使用可能な関数テンプレートのリストが読み込まれます。 

1. **[キュー トリガー]** テンプレート リスト エントリで **[JavaScript]** を選択します。

![[キュー トリガー] エントリで選択した JavaScript を使用した Azure Functions テンプレートのスクリーンショット。](../media-draft/quickstart-select-queue-trigger.png)

1. 表示された **[新しい関数]** ダイアログに次の値を入力します。


|プロパティ  |値  |
|---------|---------|
|言語     |   **JavaScript**      |
|名前     |   **discover-sentiment-function**      |
|キュー名     |   **new-feedback-q**      |
|ストレージ アカウント接続        |  **AzureWebJobsDashboard**       |

![[キュー トリガー] エントリで選択した JavaScript を使用した Azure Functions テンプレートのスクリーンショット。](../media-draft/new-function-dialog.png)

5. **[作成]** を選択して、関数作成プロセスを開始します。

1. キュー トリガー関数テンプレートを使用して、選択した言語で関数が作成されます。 このモジュールでは JavaScript で関数を実装しますが、[サポートされている任意の言語](https://docs.microsoft.com/azure/azure-functions/supported-languages)で関数を作成できます。

作成プロセスが完了すると、ポータルでコード エディターが開き、*index.js* ページが読み込まれます。 このファイルは、関数ロジックを記述するコード ファイルです。

## <a name="try-it-out"></a>試してみる

これまでの内容をテストしてみましょう。 コードはまだ記述していないので、このテストは、これまでに構成した内容を確認するために実行します。

1. コード エディターの上部にある **[実行]** をクリックします。

2. 画面の下部に表示される **[ログ]** タブを確認します。 すべてが計画どおりに動作していれば、次のようなメッセージが表示されます。
![関数の呼び出しが成功したことを示す応答メッセージのスクリーンショット。](../media-draft/func-default-run.PNG)

**[実行]** ボタンによって関数が起動され、*[テスト]* 要求ウィンドウから関数に、既定のテキストである**サンプル キュー データ**が渡されました。

お疲れさまでした。 キューによってトリガーされる関数を関数アプリに正常に追加し、テストを実行して想定どおりに動作することを確認しました。 次の演習では、関数にさらに多くの機能を追加します。

 では、関数のもう 1 つのファイルである *function.json* 構成ファイルを簡単に見てみましょう。 次の JSON リストに、このファイルの構成データが示されています。

```json
{
  "bindings": [
    {
      "name": "myQueueItem",
      "type": "queueTrigger",
      "direction": "in",
      "queueName": "new-feedback-q",
      "connection": "AzureWebJobsDashboard"
    }
  ],
  "disabled": false
}
```

ご覧のように、この関数には `queueTrigger` 型の **myQueueItem** という名前のトリガー バインディングがあります。 **new-feedback-q** という名前のキューに新しいメッセージが到着すると、関数が呼び出されます。 myQueueItem バインディング パラメーターを使用して、新しいメッセージを参照します。 このようにバインディングを使用すると、面倒な作業の一部が自動的に行われます。

次の手順では、Text Analytics API サービスを呼び出すコードを追加します。

>[!TIP]
>Azure portal で関数パネルの右側にある **[ファイルの表示]** メニューを展開すると、index.js と function.json を確認できます。 

この演習では、Azure Functions のインフラストラクチャを整えました。 [!INCLUDE [input-q](./q-name-input.md)] という名前を付けたキューに新しいメッセージが到着したときに実行される、関数アプリでホストされる作業関数を作成しました。 本当に楽しくなるのは、次の演習で Microsoft Cognitive Service を呼び出して感情分析を実行するコードを追加してからです。