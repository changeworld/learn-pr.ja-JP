 関数アプリでは、関数の管理と実行のためのコンテキストが提供されます。 関数アプリを作成し、それに関数を追加してみましょう。

## <a name="create-a-function-app-to-host-our-function"></a>関数をホストする関数アプリを作成する

1. サンドボックスをアクティブ化したときと同じアカウントを使用して、[Azure portal](https://portal.azure.com/learn.docs.microsoft.com?azure-portal=true) にサインインします。

1. Azure portal の左上隅にある **[リソースの作成]** ボタンを選び、**[コンピューティング]** > **[Function App]** の順に選択します。

1. 次の表に示す関数アプリの設定を入力します。

    | 設定      | 値  | 説明                                        |
    | ------------ |  ------- | -------------------------------------------------- |
    | **アプリ名** | グローバルに一意の名前 | 新しい関数アプリを識別する名前。 有効な文字は、`a-z`、`0-9`、および `-` です。  |
    | **サブスクリプション** | **コンシェルジェ サブスクリプション** | この新しい関数アプリが作成されるサブスクリプション。 |
    | **リソース グループ**|  **<rgn>[サンドボックス リソース グループ名]</rgn>** | 関数アプリを作成するリソース グループの名前。<br/><br/>必ず、**[既存のものを使用]** を選択し、前回の演習のリソース グループを使用してください。 これにより、このモジュールで作成するリソースがすべてまとめられます。 |
    | **OS** | Windows | 関数アプリをホストするオペレーティング システム。  |
    | **ホスティング プラン** |   従量課金プラン | Function App にどのようにリソースが割り当てられるかを定義するホスティング プラン。 既定の **[従量課金プラン]** では、リソースは関数の必要に応じて動的に追加されます。 この[サーバーなしの](https://azure.microsoft.com/overview/serverless-computing/)ホスティングでは、関数が実行された時間にのみ課金されます。   |
    | **場所** | 以前使用したのと同じ場所を選択します。 | ユーザーに近いリージョン、または関数によってアクセスされる他のサービスの近くのリージョンを選択します。<br/><br/>前回の演習で Text Analytics API アカウントを作成したときに使用したのと同じリージョンを選択します。 |
    | **ランタイム スタック** | JavaScript | このモジュールのサンプル コードは、JavaScript で記述されています。  |
    | **ストレージ** |  グローバルに一意の名前 |  関数アプリによって使用される新しいストレージ アカウントの名前。 ストレージ アカウント名の長さは 3 - 24 文字で、数字と小文字のみを使用できます。 このダイアログ ボックスでは、アプリに指定した名前から派生した一意の名前がフィールドに入力されます。 ただし、別の名前や既存のアカウントも自由に使用できます。 |

1. **[作成]** を選択して、関数アプリをプロビジョニングし、デプロイします。

1. ポータルの右上隅の通知アイコンを選択し、"**デプロイは進行中です**" というメッセージが表示されるまで待ちます。

1. デプロイには時間がかかることがあります。 そのため、通知ハブを表示した状態で、"**デプロイに成功しました**" メッセージが表示されるまで待ちます。

1. 関数アプリがデプロイされたら、ポータルの **[すべてのリソース]** に移動します。 関数アプリはタイプ **[App Service]** の一覧に表示され、指定した名前が付けられます。 リストで関数アプリを選択して開きます。

    お疲れさまでした。 関数アプリを作成し、デプロイしました。

> [!TIP]
> ポータルで目的の関数アプリが見つかりませんか?  見つからない場合は、[Azure portal でお気に入りに関数アプリを追加](https://docs.microsoft.com/azure/azure-functions/functions-how-to-use-azure-function-app-settings#favorite)してみてください。

## <a name="create-a-function-to-execute-our-logic"></a>ロジックを実行する関数を作成する

これで関数アプリを用意できたので、次は関数を作成します。 関数はトリガーによってアクティブ化されます。 このモジュールでは、キュー トリガーを使用します。 ランタイムによってキューがポーリングされ、新しいメッセージを処理するためにこの関数が起動されます。

<!-- Start temporary fix for issue #2498. -->
> [!IMPORTANT]
> 現時点では、このモジュールの演習は Azure Functions V1 を使用して行います。 以下の手順に慎重に従って、関数アプリで V1 ランタイム バージョンが使用されていることを確認してください。 

1. **[Function Apps]** リストで、関数アプリを選択します。
1. **[プラットフォーム機能]** を選択します。
1. **[プラットフォーム機能]** 画面の **[全般設定]** で、**[Function App の設定]** を選択します。
1. **[ランタイム バージョン]** で *[~1]* を選択します。
1. **[Function App の設定]** を閉じます。

これで、Azure Functions V1 ランタイムを使用するように関数アプリが構成されました。 最初の関数の作成を続行できます。
<!-- End temporary fix for issue #2498. -->  

1. **[関数]** の右側にある [追加] (__+__) ボタンを選択します。
 1. ここで表示された **[Get started quickly]\(すぐに使用を開始する\)** ページの下部にある **[カスタム関数]** を選択します。これにより、使用可能な関数テンプレートのリストが読み込まれます。

1. テンプレートのリストから **[キュー トリガー]** を選択します。

4. 表示された **[新しい関数]** ダイアログに、次の値を入力します。

    |プロパティ  |値  |
    |---------|---------|
    |名前     |   **discover-sentiment-function**      |
    |キュー名     |   **new-feedback-q**      |
    |ストレージ アカウント接続        |  **AzureWebJobsDashboard**       |

5. **[作成]** を選択して、関数作成プロセスを開始します。

1. キュー トリガー関数テンプレートを使用して、選択した言語で関数が作成されます。 このモジュールでは JavaScript で関数を実装しますが、[サポートされている任意の言語](https://docs.microsoft.com/azure/azure-functions/supported-languages)で関数を作成できます。

作成プロセスが完了すると、ポータルでコード エディターが開き、*index.js* ページが読み込まれます。 このファイルは、関数ロジックを記述するコード ファイルです。

## <a name="try-it-out"></a>試してみる

これまでの内容をテストしてみましょう。 コードはまだ記述していないので、このテストは、これまでに構成した内容を確認するために実行します。

1. コード エディターの上部にある **[実行]** をクリックします。

1. 画面の下部に表示される **[ログ]** タブを確認します。 すべてが計画どおりに動作していれば、次のようなメッセージが表示されます。
    ![関数の呼び出しが成功したことを示す応答メッセージのスクリーンショット。](../media/func-default-run.PNG)

    **[実行]** ボタンによって関数が起動され、*[テスト]* 要求ウィンドウから関数に、既定のテキストである**サンプル キュー データ**が渡されました。

お疲れさまでした。 キューによってトリガーされる関数を関数アプリに正常に追加し、テストを実行して想定どおりに動作することを確認しました。 次の演習では、関数にさらに多くの機能を追加します。

では、関数のもう 1 つのファイルである *function.json* 構成ファイルを簡単に見てみましょう。 次の JSON リストに、このファイルの構成データが示されています。

```json
{
  "bindings": [
    {
      "name": "myQueueItem",
      "type": "queueTrigger",
      "direction": "in",
      "queueName": "new-feedback-q",
      "connection": "AzureWebJobsDashboard"
    }
  ],
  "disabled": false
}
```

ご覧のように、この関数には `queueTrigger` 型の **myQueueItem** という名前のトリガー バインディングがあります。 **new-feedback-q** という名前のキューに新しいメッセージが到着すると、関数が呼び出されます。 myQueueItem バインディング パラメーターを使用して、新しいメッセージを参照します。 このようにバインディングを使用すると、面倒な作業の一部が自動的に行われます。

次の手順では、Text Analytics API サービスを呼び出すコードを追加します。

> [!TIP]
> Azure portal で関数パネルの右側にある **[ファイルの表示]** メニューを展開すると、index.js と function.json を確認できます。

この演習では、Azure Functions のインフラストラクチャを整えました。 [!INCLUDE [input-q](./q-name-input.md)] という名前を付けたキューに新しいメッセージが到着したときに実行される、関数アプリでホストされる作業関数を作成しました。 本当に楽しくなるのは、次の演習で Azure Cognitive Service を呼び出して感情分析を行うコードを追加してからです。