すべての関数がトリガーの 1 つだけ必要です。 実行するコードをトリガーする方法を定義します。 だけでなく、トリガー、データ ソースに接続するバインディングを定義できます。 ソリューションの図からわかる場合は、3 つのキューにメッセージを送信いたします。 そのため、関数でそれらの接続の出力バインドとして定義します。 これらのバインドを作成することも、**出力バインド**UI。 ただし、時間を節約することが構成ファイルを直接編集します。

1. この関数を選択します[!INCLUDE [func-name-discover](./func-name-discover.md)]、関数アプリのポータルでします。

1. 展開、**ファイルを表示**画面の右側のメニュー。

1. 下、**ファイルを表示**] タブで [ **function.json**をエディターで、構成ファイルを開きます。

1. 構成ファイルの内容全体を次の JSON に置き換えます。

[!code-json[](../code/function.json)]

構成、3 つの新しいバインドを追加しました。

- 型の新しい各バインドは、`queue`します。 これらのバインディングは、フィードバックのセンチメントを確認したら、フィードバック メッセージを設定しますが、3 つのキュー。
- 各バインドは、方向として定義されている`out`、ため、これらのキューにメッセージを掲載します。
- 各バインドでは、ストレージ アカウントと同じ接続を使用します。
- 各バインドに一意`queueName`と`name`します。

キューにメッセージを投稿など、同じくらい簡単は`context.bindings.negativeFeedbackQueueItem = "<message>"`します。

## <a name="update-implementation-to-sort-feedback-into-queues-based-on-sentiment-score"></a>更新プログラムをセンチメント スコアに基づいてキューへのフィードバックを並べ替える実装

フィードバック、並べ替えの目的は、正、中立、および負の値の 3 つのバケットにフィードバックを分類します。 これまでに、入力のキューに Text Analytics API を呼び出すコードがあり、定義したので、出力キュー。 このセクションでは、センチメントに基づいてこれらのキューにメッセージを移動するためのロジックを追加します。

1. 関数に移動します[!INCLUDE [func-name-discover](./func-name-discover.md)]、開き`index.js`コード エディターをもう一度でします。

1. 次の更新プログラムの実装に置き換えます。

[!code-javascript[](../code/discover-sentiment+sort.js?highlight=25-48)]

今回の実装を強調表示されたコードが追加されました。 コードでは、Text Analytics API cognitive service からの応答を解析します。 センチメント スコアに基づいて、メッセージを転送の 1 つに、または 3 つの出力キュー。 メッセージの投稿先のコードは、正しいバインド パラメーターを設定だけです。

## <a name="try-it-out"></a>試してみる

更新された実装をテストするには、ストレージ エクスプ ローラーにヘッドします。

1. リソース グループに移動し、**リソース グループ**ポータルのセクション。

1. このレッスンで使用されるリソース グループを選択します。

1. **リソース グループ**パネルが開きがストレージ アカウント エントリを検索して、選択します。
    ![リソース グループ ウィンドウで選択したストレージ アカウントをスクリーン ショット。](../media/select-storage-account.png)

1. 選択**ストレージ エクスプ ローラー (プレビュー)** ストレージ アカウントのメイン ウィンドウの左側のメニュー。  この操作は、ポータル内で Azure Storage Explorer を開きます。 この段階で画面に次のスクリーン ショットのようになります。
    ![現在、1 つのキューで、ストレージ アカウントを表示するストレージ エクスプ ローラーのスクリーン ショット。](../media/storage-explorer-menu-inputq.png)

下に表示する 1 つのキューがある、**キュー**コレクション。 このキューは[!INCLUDE [input-q](./q-name-input.md)]モジュールの前のテスト セクションで定義した入力キューです。

1. 選択[!INCLUDE [input-q](./q-name-input.md)]で、左側のメニューにこのキューのデータ エクスプ ローラーを参照してください。 予想どおり、キューのデータがありません。 使用してキューにメッセージを追加してみましょう、**メッセージの追加**ウィンドウの上部にあるコマンド。

1. **メッセージの追加**ダイアログ ボックスで、「がこの演習を楽しむ!」を入力します。 **メッセージ テキスト**フィールドし、をクリックして**OK**ダイアログの下部にあります。

1. [データ] ウィンドウで、メッセージが表示される[!INCLUDE [input-q](./q-name-input.md)]します。 数秒後に、後に次のようにクリックします。**更新**、キューのビューを更新するデータ ビューの上部にあります。 しばらくしてから、メッセージが消えることを確認します。 そのため、これはどこですか。

1. 右クリックし、**キュー**の左側のメニュー内のコレクション。 観察、*新しい*キューが表示されています。
    ![コレクション内では、新しいキューの表示と Storage Explorer のスクリーン ショットが用意されています。 キューでは、1 つのメッセージがあります。](../media/sa-new-output-q.png)

キュー[!INCLUDE [positive-q](./q-name-positive.md)]を最初にメッセージが投稿されたときに自動的に作成されました。 Azure Functions キューの出力バインドに投稿する前に、出力キューを手動で作成する必要はありません。 これで、関数ににより受信メッセージが並べ替えられていることがわかります[!INCLUDE [positive-q](./q-name-positive.md)]、land メッセージ、次の場所を見てみましょう。

1. 次のメッセージを追加して、上記と同じ手順を使用して[!INCLUDE [input-q](./q-name-input.md)]します。

- "ブロッコリーを like は!"
- 「Microsoft では、企業」

1. クリックして**更新**まで[!INCLUDE [input-q](./q-name-input.md)]がもう一度空です。 このプロセスは、しばらく時間がかかる場合がありますをいくつかの更新が必要です。

1. 右クリックし、**キュー**コレクションが表示される 2 つの複数のキューを確認します。 キューの名前は[!INCLUDE [neutral-q](./q-name-neutral.md)]と[!INCLUDE [negative-q](./q-name-negative.md)]します。 これまで数秒かかる場合、ため引き続き更新する可能性があります、**キュー**まで新しいキューのコレクション。 完了すると、キューの一覧は次のようになります。

![ストレージ エクスプ ローラーのスクリーン ショット メニューのキューのコレクション内の 4 つのキューを表示します。](../media/sa-final-q-list.png)

各キュー メッセージがあるかどうかを確認するリスト内をクリックします。 推奨されるメッセージを追加した場合で 1 つのメッセージが表示されます[!INCLUDE [positive-q](./q-name-positive.md)]、 [!INCLUDE [neutral-q](./q-name-neutral.md)]、および[!INCLUDE [negative-q](./q-name-negative.md)]します。

お疲れさまでした。 作業のフィードバックの並べ替えアイコンがあるようになりました。 入力キューにメッセージの着信時、関数は、Text Analytics API サービスを使用して、センチメント スコアを取得します。 関数はそのスコアに基づいて、適切なキューにメッセージを転送します。 ように思えます関数プロセス キュー項目が 1 つだけで、Azure Functions ランタイムは実際にキュー項目のバッチを読み取り、並列処理を行うための関数の他のインスタンスを起動します。