Text Analytics API の実際の動作を確認するために、オンライン リファレンス ドキュメントにある組み込みの API テスト コンソール ツールを使用して呼び出しを行いましょう。 その前に、それらの呼び出しを行うためのアクセス キーが必要です。

[!include[](../../../includes/azure-sandbox-activate.md)]

## <a name="create-an-access-key"></a>アクセス キーを作成する

Text Analytics API を呼び出すたびに、サブスクリプション キーが必要になります。 多くの場合、これはアクセス キーと呼ばれ、呼び出しを行うためのアクセス権があることを検証するために使用されます。 Azure portal を使用してキーを取得します。

1. サンドボックスをアクティブ化したときと同じアカウントを使用して、[Azure portal](https://portal.azure.com/learn.docs.microsoft.com?azure-portal=true) にサインインします。

1. **[リソースの作成]** をクリックします。

1. **[Marketplace を検索]** 検索ボックスに「*text analytics*」と入力して Enter キーを押します。

1. 検索結果で **Text Analytics** を選択し、画面の右下の **[作成]** ボタンをクリックします。

1. 表示された **[作成]** ページで、各フィールドに次の値を入力します。

    |プロパティ  | 値  | 説明  |
    |---------|---------|---------|
    |名前     |    MyTextAnalyticsAPIAccount     |  Cognitive Services アカウントの名前。 わかりやすい名前を使用することをお勧めします。 有効な文字は、`a-z`、`0-9`、および `-` です。    |
    |サブスクリプション     |  コンシェルジェ サブスクリプション    |   **Text Analytics API** のこの新しい Cognitive Services API アカウントが作成されるサブスクリプション。      |
    |場所     |  *ドロップダウンからリージョンを選択する*       |  無料のサンドボックスを使用しているため、ドロップダウンから場所を選択します。これは、以下に示されたサンドボックス リージョンの一覧に**も**あります。  |
    |価格レベル     | **F0 Free**     |   Cognitive Services アカウントのコストは、実際の使用量と選択したオプションによって異なります。 ここでは、Free レベルを選択することをお勧めします。      |
    |リソース グループ     |  **[既存のものを使用]** を選択し、<rgn>[サンドボックス リソース グループ名]</rgn> を選びます。       |  Cognitive Services Text Analytics API アカウントを作成する新しいリソース グループの名前。       |

    ### <a name="sandbox-region-list"></a>サンドボックス リージョンの一覧
    [!include[](../../../includes/azure-sandbox-regions-first-mention-note-friendly.md)]

    > [!TIP]
    > Text Analytics Cognitive Services アカウントの作成時に選択した場所を忘れないでください。 すぐに API 呼び出しを作成するために使用します。 

1. ページの下部にある **[作成]** を選択して、アカウントの作成プロセスを開始します。 デプロイが進行中であることを示す通知を監視します。 リソース グループにアカウントが正常にデプロイされたことを示す通知が表示されます。

    ![[リソースに移動] ボタンと [ダッシュボードにピン留めする] ボタンが含まれたデプロイの成功通知。](../media/deploy-resource-group-success.PNG)

## <a name="get-the-access-key"></a>アクセス キーを取得する

Cognitive Services アカウントを用意できたので、API の呼び出しを開始できるようにアクセス キーを見つけましょう。

1. "*デプロイメントに成功しました*" という通知の **[リソースに移動]** ボタンをクリックします。 この操作により、アカウントのクイック スタートが開きます。

1. 左側のメニューまたはクイック スタートの *[Grab your keys]\(キーの取得\)* セクションで、**[キー]** メニュー項目を選択します。 この操作により、**[キーの管理]** ページが開きます。

1. コピー ボタンを使用して、いずれかのキーをコピーします。

    ![Cognitive Services アカウントの名前とキー 1 およびキー 2 エントリが表示された [キーの管理] ユーザー インターフェイス。](../media/manage-keys.PNG)

    > [!IMPORTANT]
    > アクセス キーは必ず保存し、共有しないでください。

1. このモジュールの残りの部分で使用できるように、このキーを保存します。 これ以降、テスト コンソールから API 呼び出しを行うときにこのキーを使用します。

## <a name="call-the-api-from-the-testing-console"></a>テスト コンソールから API を呼び出す

キーを用意できたので、テスト コンソールに移動し、API を試してみることができます。

1. お好みのブラウザーで次の URL に移動します。 このユニットで前に Text Analytics Cognitive Services アカウントを作成したときに選択した場所に、`[location]` を置き換えます。 たとえば、*米国東部*でアカウントを作成した場合は、URL の `[location]` を `eastus` に置き換えます。

    ```bash
    https://[location].dev.cognitive.microsoft.com/docs/services/TextAnalytics.V2.0
    ```

    ランディング ページでは、左側にメニューが表示され、右側にコンテンツが表示されます。 メニューには、Text Analytics API で呼び出すことができる POST メソッドが表示されます。 これらのエンドポイントは、**言語の検出**、**エンティティ**、**キー フレーズ**、**Sentiment\(センチメント\)** です。 これらの操作のいずれかを呼び出すには、いくつかの操作を行う必要があります。

    - 呼び出すメソッドを選択します。
    - レッスンで先ほど保存したアクセス キーを各呼び出しに追加します。

1. 左側のメニューで **[Sentiment]\(センチメント\)** を選択します。 これにより、右側にセンチメントのドキュメントが表示されます。 ドキュメントに示されているように、次の形式で REST 呼び出しを行います。  

    `https://[location].api.cognitive.microsoft.com/text/analytics/v2.0/sentiment`

     `[location]` は、Text Analytics アカウントで作成したときに選択した場所に置き換えられます。  
**ocp-Apim-Subscription-Key** ヘッダーでサブスクリプション キー (アクセス キー) を渡します。

## <a name="make-some-api-calls"></a>API 呼び出しを行う

1. **[Open API Testing Console]\(Open API テスト コンソール\)** ボタンを選択して、ライブのインタラクティブな API コンソールを開きます。

1. **[Ocp-Apim-Subscription-Key]** というラベルが付けられたフィールドに、以前に保存したアクセス キーを貼り付けます。 このキーは、ヘッダー値として HTTP 要求ウィンドウに自動的に書き込まれることに留意してください。

1. ページの下部までスクロールし、**[送信]** をクリックします。

    さらに詳しくこの画面のセクションを調べてみましょう。

    ユーザー インターフェイスのヘッダー セクションでは、要求のヘッダーにアクセス (サブスクリプション) キーを設定します。

    ![ヘッダー セクションのスクリーンショット。](../media/2-marker.PNG)

    次に、**documents** 配列を保持する要求本文セクションがあります。 配列の各ドキュメントには 3 つのプロパティがあります。 これらのプロパティは、*"language"*、*"id"*、*"text"* です。 この例では *"id"* は数値ですが、documents 配列内で一意であれば何でも構いません。 この例では、3 つの異なる言語で記述されたドキュメントも渡しています。 Text Analytics API のセンチメント機能では、15 種類以上の言語がサポートされています。 詳細については、「[Text Analytics API でサポートされている言語](https://docs.microsoft.com//azure/cognitive-services/text-analytics/text-analytics-supported-languages)」をご覧ください。 1 つのドキュメントの最大サイズは 5,000 文字であり、1 つの要求に最大 1,000 個のドキュメントを含めることができます。

    ![要求本文セクションのスクリーンショット。](../media/3-marker.PNG)

    次のセクションには、ヘッダーと要求 URL を含む完全な要求が表示されています。 この例では、`westus` で始まる URL に要求がルーティングされることがわかります。 この URL は、Text Analytics アカウントの作成時に選択した場所によって異なります。

    ![セクション番号 4。](../media/4-marker.PNG)
    ![セクション番号 5。](../media/5-marker.PNG)

    次に、応答に関する情報があります。 この例では、要求が成功し、コード `200` が返されています。 また、ラウンド トリップに 38 ミリ秒かかったこともわかります。

    ![セクション番号 5。](../media/6-marker.PNG)

    最後に、要求に対する応答を確認しましょう。 応答には、ドキュメントに関する Text Analytics API による分析情報が保持されています。 元のテキストなしで、ドキュメントの配列が返されています。 各ドキュメントの *"id"* と *"score"* に戻ります。 この API は 0 から 1 の数値スコアを返します。 1 に近いスコアは肯定的センチメントを示し、0 に近いスコアは否定的センチメントを示します。 スコア 0.5 は、センチメントの欠如、つまり中立的な意見を示します。 この例では、非常に肯定的なドキュメントが 2 つと、否定的なドキュメントが 1 つあります。

    ![セクション番号 5。](../media/7-marker.PNG)

お疲れさまでした。 ここでは、コード行を記述せずに、Text Analytics API の最初の呼び出しを行いました。 コンソールを引き続き使用して、さらに多くの呼び出しを自由に試してみてください。 推奨事項を次に示します。

- セクション番号 2 のドキュメントを変更し、API から返される内容を確認します。
- 同じサブスクリプション キーを使用して、他のメソッド **[言語の検出]**、**[エンティティ]**、**[キー フレーズ]** を試してみます。
- お使いのサブスクリプションで別のリージョンから呼び出しを行い、動作を確認します。

API テスト コンソールは、この API の機能を詳しく調べるための優れた方法です。 自分で機能を調べたら、次に、このインテリジェンスを実際のシナリオに取り入れてみましょう。