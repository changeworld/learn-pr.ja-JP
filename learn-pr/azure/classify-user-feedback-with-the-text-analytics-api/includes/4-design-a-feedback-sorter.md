実際のソリューションで Text Analytics に関する私たちの知識が活用するようにしましょう。 私たちのソリューションは、テキスト ドキュメントの感情分析に着目します。 取り組みたい問題を記述して、コンテキストを設定しましょう。

## <a name="manage-customer-feedback-more-efficiently"></a>お客様からのフィードバックをより効率的に管理します。

会社の製品の話題にはソーシャル メディアが有効です｡ お客様が会社の製品に関する意見を共有したがっている場合は､フィードバック電子メール エイリアスも有効です｡

新規参入者がそうであるように､お客様の声に耳を傾けるというマントラに従っています｡ しかしながら、会社の製品の成功によって､この約束は言うは易く行うは難しになっています｡ 大切な問題ですが､それでも問題です｡

チームはフィードバックの量に対応できなくなっています｡ できる限り効率的に管理できるよう、フィードバックの仕分けに何らかの助けが必要です｡ 組織の開発責任者として、あなたはソリューションを構築するよう依頼されました。

いくつかの高次の要件を見ててみましょう。

|要件  | 詳細  |
|---------|---------|
|フィードバックに対応できるよう分類する。     |   すべてのフィードバックが等価値であるわけではありません｡ 生き生きとした証言のこともあれば､ 欲求不満のお客様からの痛烈な批判のことあります｡ お客様が何を望んでいるのか､判断できないケースもあります｡ <br/><br/>少なくとも、フィードバックの感情あるいは調子の指標があれば､フィードバックを分類するのに役立ちます｡     |
|ソリューションは要求に応じてスケールアップしたり､スケールダウンしたりします｡    |   私たちはスタートアップ企業です。 固定費として計上することは難しく、フィードバック トラフィックのパターンを正確には把握していません。 アクティビティのバーストに対処しつつ、アクティビティが少ない時にはできるかぎりコストを抑えられるソリューションが必要です。 <br/><br/> この場合は､従量課金制のサーバーレス アーキテクチャが選択肢になります｡     |
| MVP (Minimal Viable Product) でありながら、柔軟性に優れたソリューションになります。    | 現在、私たちは限られたリソースを重要なフィードバックに適用できるよう、フィードバックを分類したいと考えています。 不満をお持ちのお客様を、すぐに把握し、チャットしたいと考えています。 将来はこのソリューションを強化して、もっと多くのことをできるようにするつもりです。 新機能として､フィードバック内の鍵となる語句を調べて､お客様が限界点に達する前に問題点を発見するというアイデアがあります｡ 別のアイデアは、肯定的か中立的なお客様への応答を自動化することです｡ お客様が会社を気に入ってくれているとしても､私たちがお客様のフィードバックに耳を傾けていることを知っておいていただきたいのです｡ <br/><br/>ここでは､プラグ アンド プレイ式のアーキテクチャを提供するソリューションがピッタリです｡ 例えば､工場の製造ラインの一形態として､私たちはキュー方式を採用できます｡ 1 つのタスクを実行したら、キューにその結果を入れることで､システムの次の工程でその結果を受け取って処理できるようにします｡   |
|配送は迅速です｡     |   これは前にも聞いています。 ただし、このソリューションは MVP であることを思い出してください。私たちのシナリオですぐにテストをしたいと思っています。 高品質のものを迅速に実現するということは、コードを少なくすることを意味します。 <br/><br/> Text Analytics API を利用するいうことは、感情を検出するための訓練をモデルに施す必要がないことを意味します｡ Azure Functions を利用し､キューにバインドすることによって､記述しなければならないコードの量が少なくなることは明らかです｡ また､サーバーレスであることは、サーバーの管理の心配もいらないことを意味します。   |

上記表の各要件に対した私たちが提案するソリューションは、要件をソリューションに対応付ける方法の一端にすぎません。 Azure に基づくソリューションがどのようになるのか見てみましょう。

## <a name="a-solution-based-on-azure-functions-azure-queue-storage-and-text-analytics-api"></a>Azure Functions、Azure Queue Storage、Text Analytics API に基づくソリューション

次の図は、ソリューションの設計案です。 Azure の 3 つのコア コンポーネント、Azure Queue Storage と Azure Functions、Azure Cognitive Services を利用しています。

![フィードバックの分類アーキテクチャの概念図。](../media/proposed-solution.PNG)

考え方としては、ユーザーからのフィードバックを含むテキスト ドキュメントがキューに送られます。このキューは、前の図で *new-feedback-q* と名付けました。 キューにテキスト ドキュメントを含むメッセージが到着すると、関数の実行がトリガーされるか開始されます。 この関数は、入力キューから新しいドキュメントを含むメッセージを読み取り、分析のために Text Analytics API に送信します。 この API が返す結果に基づいて、そのドキュメントを含む新しいメッセージが出力キューに入れられて、さらに処理されます。

各ドキュメントで私たちが受け取る結果は、センチメント スコアです。 各出力キューはフィードバックの格納に使用され、肯定的、中立的、否定的に仕分けされます。 望ましいのは、否定的のキューがいつでも空であることです。 受信した各フィードバックを、センチメントに基づいて出力キューに入れたとしましょう。各キュー内のメッセージに対して適切な処理をするロジックを追加したいと思うに違いありません。

隣のフローチャートを見てみましょう。関数のロジックが行う必要があることを確認できます。

![感情別にテキスト ドキュメントを出力キューに仕分ける Azure 関数の内部ロジックフローチャート。](../media/flow.PNG)

このロジックは、ルーターに似ています。 テキスト入力を受け取り、テキストの感情点数に基づいて出力キューにルーティングします。 私たちは Text Analytics API に依存しています｡ ロジックは平凡に見えますが､この関数によって、チームのメンバーがフィードバックを手作業で分析する作業が不要になります｡

## <a name="steps-to-implement-our-solution"></a>ソリューションの実現手順

このユニットで説明したソリューションを実現するには､次の手順に従う必要になります。

1. ソリューションをホストするための関数アプリを作成します。

1. Text Analytics API を使用して､受信するフィードバック メッセージの感情を求めます｡ 前の課題のアクセス キーを使用して､リクエストを送信するコードを記述します。

1. センチメントに基づく処理キューにフィードバックを移します。

関数アプリの作成に進みましょう。