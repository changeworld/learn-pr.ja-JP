<span data-ttu-id="ca273-101">Azure Load Balancer がエンタープライズ リソース プラニング (ERP) に対応しているかどうかを、あなたが所属している会社が知りたいとします。</span><span class="sxs-lookup"><span data-stu-id="ca273-101">Suppose your company wants to see if the Azure Load Balancer will support your Enterprise Resource Planning (ERP) application.</span></span> <span data-ttu-id="ca273-102">アプリケーションにはユーザーのための Web インターフェイスがあり、複数のサーバーで実行されます。</span><span class="sxs-lookup"><span data-stu-id="ca273-102">Your application has a web interface for users and runs on multiple servers.</span></span> <span data-ttu-id="ca273-103">各サーバーには ERP データベースのローカル コピーが含まれます。ERP データベースはすべてのサーバーの間で同期されています。</span><span class="sxs-lookup"><span data-stu-id="ca273-103">Each server has a local copy of the ERP database which is synced across all servers.</span></span>

<span data-ttu-id="ca273-104">ここで、サービスの高可用性に対してロード バランサーがどのように貢献できるか確認します。</span><span class="sxs-lookup"><span data-stu-id="ca273-104">Here, you will look at how a load balancer can help provide high availability of services.</span></span> <span data-ttu-id="ca273-105">ロード バランサー オプションの基本と標準の違いを特定し、Azure Virtual Machines 向けのロード バランサーを作成する方法を確認します。</span><span class="sxs-lookup"><span data-stu-id="ca273-105">You will identify the difference between the basic and standard load balancer options and see how to create a load balancer for Azure Virtual Machines.</span></span>

## <a name="what-is-load-balancing"></a><span data-ttu-id="ca273-106">負荷分散とは</span><span class="sxs-lookup"><span data-stu-id="ca273-106">What is load balancing?</span></span>

<span data-ttu-id="ca273-107">_負荷分散_とは、計算、保管、ネットワークなどの作業負荷を複数のデバイスに分散するさまざまな手法を言い表したものです。</span><span class="sxs-lookup"><span data-stu-id="ca273-107">_Load balancing_ describes various techniques for distributing workloads across multiple devices, such as compute, storage, and networking.</span></span> <span data-ttu-id="ca273-108">負荷分散の目的は、さまざまなリソースを最適な方法で活用すること、インフラストラクチャの拡張に合わせ、リソースを最も効率的に活用すること、一部の構成要素が利用不可になった場合でもサービスを維持することです。</span><span class="sxs-lookup"><span data-stu-id="ca273-108">The goal of load balancing is to optimize the use of multiple resources, to make the most efficient use these resources as an infrastructure is scaled out, and to ensure services are maintained if some components are unavailable.</span></span>

<span data-ttu-id="ca273-109">ここでは、仮想マシン (VM) 向けの Azure の負荷分散サポートを確認します。</span><span class="sxs-lookup"><span data-stu-id="ca273-109">Here, will look at Azure's load balancing support for virtual machines (VMs).</span></span>

### <a name="what-is-high-availability"></a><span data-ttu-id="ca273-110">高可用性とは</span><span class="sxs-lookup"><span data-stu-id="ca273-110">What is High Availability?</span></span>

<span data-ttu-id="ca273-111">高可用性 (HA) とは、システムの一部の構成要素に故障が発生しても、アプリケーションまたはサービスを引き続き利用できる能力を計る指標です。</span><span class="sxs-lookup"><span data-stu-id="ca273-111">High availability (HA) measures the ability of an application or service to remain accessible despite a failure in any system component.</span></span> <span data-ttu-id="ca273-112">サービスの停止が目に付かないことが理想です。</span><span class="sxs-lookup"><span data-stu-id="ca273-112">Ideally, there will be not be any noticeable loss of service.</span></span>

<span data-ttu-id="ca273-113">負荷分散は複数の VM がサーバー プールとして機能するため、HA 実現の基礎となります。</span><span class="sxs-lookup"><span data-stu-id="ca273-113">Load balancing is fundamental to the delivery of HA because it allows multiple VMs to act as a pool of servers.</span></span> <span data-ttu-id="ca273-114">一部の VM がクラッシュしたり、保守管理のためにオンラインになったりしても、このプールは引き続き要求に応答できます。</span><span class="sxs-lookup"><span data-stu-id="ca273-114">The pool can continue to service requests even if some VMs crash or are taken offline for maintenance.</span></span>

## <a name="what-is-the-azure-load-balancer"></a><span data-ttu-id="ca273-115">Azure Load Balancer とは</span><span class="sxs-lookup"><span data-stu-id="ca273-115">What is the Azure Load Balancer?</span></span>

<span data-ttu-id="ca273-116">**Azure Load Balancer** とは、あるプールに含まれる複数の VM 間で受信した要求を分散する Azure サービスです。</span><span class="sxs-lookup"><span data-stu-id="ca273-116">The **Azure Load Balancer** is an Azure service that distributes incoming requests across multiple VMs in a pool.</span></span> <span data-ttu-id="ca273-117">入ってくるネットワーク トラフィックを正常な一連の VM 間で分散し、応答できない VM があれば、その VM を回避します。</span><span class="sxs-lookup"><span data-stu-id="ca273-117">It distributes incoming network traffic across a set of healthy VMs and avoids any VM that is not able to respond.</span></span>

<span data-ttu-id="ca273-118">Azure Load Balancer は OSI 7 層モデルの Layer-4 (TCP、UDP) で動作します。</span><span class="sxs-lookup"><span data-stu-id="ca273-118">The Azure Load Balancer operates at Layer-4 (TCP, UDP) of the OSI 7-layer model.</span></span> <span data-ttu-id="ca273-119">トラフィックが Azure VM に入ってくる TCP/UDP アプリケーション シナリオと、他の Azure サービスにより、Azure VM 経由で外部エンドポイントに TCP/UDP トラフィックが渡されるアウトバウンド シナリオをサポートするように構成できます。</span><span class="sxs-lookup"><span data-stu-id="ca273-119">It can be configured to support TCP and UDP application scenarios where the traffic is inbound to Azure VMs, as well as outbound scenarios where other Azure services are passing TCP and UDP traffic out through Azure VMs to external endpoints.</span></span>

## <a name="public-vs-internal-load-balancers"></a><span data-ttu-id="ca273-120">パブリック ロード バランサーと内部ロード バランサー</span><span class="sxs-lookup"><span data-stu-id="ca273-120">Public vs. internal load balancers</span></span>

<span data-ttu-id="ca273-121">Azure Load Balancer は、入ってくる要求の源に基づき、_パブリック_または_内部_になります。</span><span class="sxs-lookup"><span data-stu-id="ca273-121">An Azure Load Balancer can be either _public_ or _internal_ depending on the source of incoming requests.</span></span>

<span data-ttu-id="ca273-122">**パブリック ロード バランサー**では、Azure インフラストラクチャの外から入ってきたクライアント要求が処理されます。</span><span class="sxs-lookup"><span data-stu-id="ca273-122">A **public load balancer** handles client requests from outside of your Azure infrastructure.</span></span> <span data-ttu-id="ca273-123">パブリック IP とロード バランサー リソースを作成するとき、ロード バランサーのパブリック IP アドレスはロード バランサーのフロント エンドとして自動的に構成されます。</span><span class="sxs-lookup"><span data-stu-id="ca273-123">The public IP address of the load balancer is automatically configured as the load balancer's front end when you create the public IP and the load balancer resource.</span></span> <span data-ttu-id="ca273-124">パブリック ロード バランサーを次の図に示します。</span><span class="sxs-lookup"><span data-stu-id="ca273-124">The following illustration shows a public load balancer.</span></span>

![パブリック ロード バランサーが内部から仮想ネットワーク上の 3 つの VM にクライアント要求を分散する図。](../media-draft/2-public-load-balancer.png)

<span data-ttu-id="ca273-126">**内部ロード バランサー**では、仮想ネットワーク内からの要求が処理されます (あるいは VPN を介して)。</span><span class="sxs-lookup"><span data-stu-id="ca273-126">An **internal load balancer** processes requests from within a virtual network (or through a VPN).</span></span> <span data-ttu-id="ca273-127">その vNet 内でリソースに要求が分散されます。</span><span class="sxs-lookup"><span data-stu-id="ca273-127">It distributes requests to resources within that vNet.</span></span> <span data-ttu-id="ca273-128">ロード バランサー、フロント エンド IP アドレス、仮想ネットワークにはインターネットから直接アクセスできません。</span><span class="sxs-lookup"><span data-stu-id="ca273-128">The load balancer, frontend IP addresses, and virtual networks are not directly accessible from the internet.</span></span> <span data-ttu-id="ca273-129">次は、パブリック ロード バランサーと内部ロード バランサーの両方を含むアーキテクチャの図です。</span><span class="sxs-lookup"><span data-stu-id="ca273-129">The following illustration shows an architecture containing both a public and internal load balancer.</span></span> <span data-ttu-id="ca273-130">パブリック ロード バランサーでは外部要求が処理されますが、内部ロード バランサーでは処理のために内部の VM とデータベースに要求が転送されます。</span><span class="sxs-lookup"><span data-stu-id="ca273-130">The public load balancer handles external requests while the internal load balancer forwards the requests to the internal VMs and databases for processing.</span></span>

![パブリック ロード バランサーがクライアント要求を内部ロード バランサーに転送する図。](../media-draft/2-internal-load-balancer.png)

## <a name="how-does-the-azure-load-balancer-work"></a><span data-ttu-id="ca273-134">Azure Load Balancer のしくみとは</span><span class="sxs-lookup"><span data-stu-id="ca273-134">How does the Azure Load Balancer work?</span></span>

<span data-ttu-id="ca273-135">Azure Load Balancer では**規則**と**正常性プローブ**に構成されている情報が使用され、ロード バランサーの**フロントエンド**で受信されたインバウンド トラフィックを**バックエンド プール**の VM インスタンスに分散する方法が決定されます。</span><span class="sxs-lookup"><span data-stu-id="ca273-135">The Azure Load Balancer uses information configured in **rules** and **health probes** to determine how new inbound traffic that is received on the Load Balancer's **frontend** is distributed to VM instances in a **backend pool**.</span></span>

### <a name="frontend"></a><span data-ttu-id="ca273-136">フロントエンド</span><span class="sxs-lookup"><span data-stu-id="ca273-136">Frontend</span></span>

<span data-ttu-id="ca273-137">ロード バランサー フロントエンドは IP 構成であり、パブリック IP アドレスが 1 つまたは複数含まれ、インターネットを経由してロード バランサーとそのアプリケーションにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="ca273-137">The load balancer frontend is an IP configuration, containing one or more public IP addresses, that enables access to the load balancer and its applications over the Internet.</span></span>

### <a name="backend-address-pool"></a><span data-ttu-id="ca273-138">バックエンド アドレス プール</span><span class="sxs-lookup"><span data-stu-id="ca273-138">Backend address pool</span></span>

<span data-ttu-id="ca273-139">仮想マシンは、仮想ネットワーク インターフェイス カード (vNIC) を使用してロード バランサーに接続されます。</span><span class="sxs-lookup"><span data-stu-id="ca273-139">Virtual machines connect to a load balancer using their virtual network interface card (vNIC).</span></span> <span data-ttu-id="ca273-140">バックエンド アドレス プールには、ロード バランサーに接続される vNIC の IP アドレスが含まれます。</span><span class="sxs-lookup"><span data-stu-id="ca273-140">The back-end address pool contains the IP addresses of the vNICs that are connected to the load balancer.</span></span> <span data-ttu-id="ca273-141">可用性セットにすべての VM を配置した場合、これを利用し、ロード バランサーの構成時、バックエンド プールに VM を簡単に追加できます。</span><span class="sxs-lookup"><span data-stu-id="ca273-141">If you place all your VMs in an availability set, you can use this to easily add your VMs to a backend pool when configuring the load balancer.</span></span>

### <a name="health-probe"></a><span data-ttu-id="ca273-142">正常性プローブ</span><span class="sxs-lookup"><span data-stu-id="ca273-142">Health probe</span></span>

<span data-ttu-id="ca273-143">ロード バランサーでは_正常性プローブ_が使用され、要求に対応する仮想マシンが決定されます。</span><span class="sxs-lookup"><span data-stu-id="ca273-143">Load balancers use _health probes_ to determine which virtual machines can service requests.</span></span> <span data-ttu-id="ca273-144">ロード バランサーでは、作動中で利用可能な VM にのみトラフィックが分配されます。</span><span class="sxs-lookup"><span data-stu-id="ca273-144">The load balancer will only distribute traffic to VMs that are available and operational.</span></span> 

<span data-ttu-id="ca273-145">正常性プローブによって、各 VM の特定のポートが監視されます。</span><span class="sxs-lookup"><span data-stu-id="ca273-145">A health probe monitors specific ports on each VM.</span></span> <span data-ttu-id="ca273-146">どのような種類の応答が "正常" に相当するか定義できます。たとえば、Web アプリケーションから `HTTP 200 Available` 応答を要求することがあります。</span><span class="sxs-lookup"><span data-stu-id="ca273-146">You can define what type of response corresponds to "health"; for example, you might require an `HTTP 200 Available` response from a web application.</span></span> <span data-ttu-id="ca273-147">VM では既定で、15 秒の間隔をおいて 2 回連続で失敗すると "利用不可" と見なされます。</span><span class="sxs-lookup"><span data-stu-id="ca273-147">By default, a VM will be marked as "unavailable" after two consecutive failures at 15-second intervals.</span></span>

### <a name="load-balancer-rules"></a><span data-ttu-id="ca273-148">ロード バランサーの規則</span><span class="sxs-lookup"><span data-stu-id="ca273-148">Load balancer rules</span></span>

<span data-ttu-id="ca273-149">ロード バランサーの_規則_により、バックエンド VM にトラフィックを分配する方法が定義されます。</span><span class="sxs-lookup"><span data-stu-id="ca273-149">Load balancer _rules_ define how traffic is distributed to backend VMs.</span></span> <span data-ttu-id="ca273-150">その目的は、バックエンド プールにある正常な VM 間で等しく要求を分配することにあります。</span><span class="sxs-lookup"><span data-stu-id="ca273-150">The goal is to distribute request fairly across the healthy VMs in the backend pool.</span></span>

<span data-ttu-id="ca273-151">Azure Load Balancer では、ハッシュベースのアルゴリズムが使用され、インバウンド パケットのヘッダーが書き換えられます。</span><span class="sxs-lookup"><span data-stu-id="ca273-151">The Azure Load Balancer uses a hash-based algorithm to rewrite the headers of inbound packets.</span></span> <span data-ttu-id="ca273-152">ロード バランサーでは既定で、以下からハッシュが作成されます。</span><span class="sxs-lookup"><span data-stu-id="ca273-152">By default, the Load Balancer creates a hash from:</span></span>

- <span data-ttu-id="ca273-153">発信元 IP アドレス</span><span class="sxs-lookup"><span data-stu-id="ca273-153">source IP address</span></span>
- <span data-ttu-id="ca273-154">送信元ポート</span><span class="sxs-lookup"><span data-stu-id="ca273-154">source port</span></span>
- <span data-ttu-id="ca273-155">送信先 IP アドレス</span><span class="sxs-lookup"><span data-stu-id="ca273-155">destination IP address</span></span>
- <span data-ttu-id="ca273-156">送信先ポート</span><span class="sxs-lookup"><span data-stu-id="ca273-156">destination port</span></span>
- <span data-ttu-id="ca273-157">IP プロトコル番号</span><span class="sxs-lookup"><span data-stu-id="ca273-157">IP protocol number</span></span>

<span data-ttu-id="ca273-158">このメカニズムにより、あるパケット クライアント フロー内のすべてのパケットが同じバックエンド VM インスタンスに送信されます。</span><span class="sxs-lookup"><span data-stu-id="ca273-158">This mechanism ensures that all packets within a packet client flow are sent to the same backend VM instance.</span></span> <span data-ttu-id="ca273-159">クライアントからの新しいフローではランダムに割り当てられた別の送信元ポートが使用されます。そのため、ハッシュが変わり、ロード バランサーでは、このフローが別のバックエンド エンドポイントに送信されることがあります。</span><span class="sxs-lookup"><span data-stu-id="ca273-159">A new flow from a client will use a different randomly allocated source port, so the hash will change, and the load balancer may send this flow to a different backend endpoint.</span></span>

## <a name="basic-vs-standard-load-balancer-skus"></a><span data-ttu-id="ca273-160">Basic とStandard のロード バランサー SKU</span><span class="sxs-lookup"><span data-stu-id="ca273-160">Basic vs. Standard load balancer SKUs</span></span>

<span data-ttu-id="ca273-161">Azure Load Balancer には **Basic** と **Standard** という 2 つの種類があります。</span><span class="sxs-lookup"><span data-stu-id="ca273-161">There are two types of Azure Load Balancers: **Basic** and **Standard**.</span></span> <span data-ttu-id="ca273-162">両者の間には、スケール、機能、料金の違いがあります。</span><span class="sxs-lookup"><span data-stu-id="ca273-162">They differ in scale, features, and pricing.</span></span> <span data-ttu-id="ca273-163">例:</span><span class="sxs-lookup"><span data-stu-id="ca273-163">For example:</span></span>

- <span data-ttu-id="ca273-164">Standard では HTTPS に対応していますが、Basic では対応していません。</span><span class="sxs-lookup"><span data-stu-id="ca273-164">Standard supports HTTPS while Basic does not</span></span>
- <span data-ttu-id="ca273-165">プール サイズは Standard の方がはるかに大きくなります。</span><span class="sxs-lookup"><span data-stu-id="ca273-165">Pool size can be much larger in Standard</span></span>
- <span data-ttu-id="ca273-166">Basic は無料ですが、Standard の場合、規則とスループットに基づいて課金されます。</span><span class="sxs-lookup"><span data-stu-id="ca273-166">Basic is no-cost while Standard is charged based on rules and throughput.</span></span>

<span data-ttu-id="ca273-167">Standard は Basic の上位集合です。そのため、Basic に適したシナリオは Standard でも機能します。</span><span class="sxs-lookup"><span data-stu-id="ca273-167">Standard is a superset of Basic, so any scenario suitable for Basic should also work on Standard.</span></span> <span data-ttu-id="ca273-168">Basic SKU は一般的に試作品の作成と試験に利用され、運用には Standard が推奨されます。</span><span class="sxs-lookup"><span data-stu-id="ca273-168">The Basic SKU is generally intended for prototyping and testing while Standard is recommended for production.</span></span>

## <a name="start-the-deployment-of-a-basic-public-load-balancer"></a><span data-ttu-id="ca273-169">Basic Public Load Balancer のデプロイを始める</span><span class="sxs-lookup"><span data-stu-id="ca273-169">Start the deployment of a Basic Public Load Balancer</span></span>

<span data-ttu-id="ca273-170">負荷分散された VM システムを構築するには、ロード バランサー自体を構築し、VM を含める仮想ネットワークを構築し、仮想ネットワークに VM を追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ca273-170">To create a load-balanced VM system, you need to create the load balancer itself, create a virtual network to contain your virtual machines, and then add VMs to the virtual network.</span></span>

<span data-ttu-id="ca273-171">Azure Portal を使用してロード バランサーを構築するには、以下を定義します。</span><span class="sxs-lookup"><span data-stu-id="ca273-171">To create the load balancer using the Azure portal, you define:</span></span>

- <span data-ttu-id="ca273-172">ロード バランサー名</span><span class="sxs-lookup"><span data-stu-id="ca273-172">Load balancer name</span></span>
- <span data-ttu-id="ca273-173">種類: パブリックまたは内部</span><span class="sxs-lookup"><span data-stu-id="ca273-173">Type: Public or Internal</span></span>
- <span data-ttu-id="ca273-174">SKU: Basic または Standard</span><span class="sxs-lookup"><span data-stu-id="ca273-174">SKU: Basic or Standard</span></span>
- <span data-ttu-id="ca273-175">パブリック IP アドレス: 動的または静的</span><span class="sxs-lookup"><span data-stu-id="ca273-175">Public IP address: Dynamic or Static</span></span>
- <span data-ttu-id="ca273-176">リソース グループと場所</span><span class="sxs-lookup"><span data-stu-id="ca273-176">Resource group and Location</span></span>

<span data-ttu-id="ca273-177">バックエンド VM はすべて同じ仮想ネットワーク (vNET) に接続されます。そのため、次にこのリソースを構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ca273-177">Your backend VMs will all be connected to the same virtual network (vNET), so you next need to configure this resource:</span></span>

- <span data-ttu-id="ca273-178">VNet 名</span><span class="sxs-lookup"><span data-stu-id="ca273-178">vNET name</span></span>
- <span data-ttu-id="ca273-179">172.20.0.0/16 など、使用するアドレス空間</span><span class="sxs-lookup"><span data-stu-id="ca273-179">Address space to use, such as 172.20.0.0/16</span></span>
- <span data-ttu-id="ca273-180">リソース グループ</span><span class="sxs-lookup"><span data-stu-id="ca273-180">Resource group</span></span>
- <span data-ttu-id="ca273-181">使用するサブネットの名前</span><span class="sxs-lookup"><span data-stu-id="ca273-181">Name for the subnet to use</span></span>
- <span data-ttu-id="ca273-182">172.20.0.0/24 など、サブネットのアドレス空間 (メイン空間内に存在する必要があります)</span><span class="sxs-lookup"><span data-stu-id="ca273-182">Address space for the subnet (must be within the main space), such as 172.20.0.0/24</span></span>

<span data-ttu-id="ca273-183">次に、バックエンド VM を構築してデプロイし、vNET を使用するように構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ca273-183">You then need to create and deploy your backend VMs and configure them to use your vNET.</span></span> <span data-ttu-id="ca273-184">また、同じ可用性セットに VM を配置してください。</span><span class="sxs-lookup"><span data-stu-id="ca273-184">You should also place your VMs into the same availability set.</span></span> <span data-ttu-id="ca273-185">可用性セットにより、VM のグループ全体でフォールト トレランスのレベルが定義されます。ただし、負荷分散については、VM をバックエンド プールに割り当てる際にも役立ちます。</span><span class="sxs-lookup"><span data-stu-id="ca273-185">Availability sets define the level of fault tolerance across a group of VMs, but for load balancing, they also help you assign your VMs to backend pools.</span></span>

<span data-ttu-id="ca273-186">今回、高可用性ソリューションの一部として Azure Load Balancer を使用する方法をご覧いただきました。</span><span class="sxs-lookup"><span data-stu-id="ca273-186">You have now seen how to use an Azure Load Balancer as part of a high-availability solution.</span></span> <span data-ttu-id="ca273-187">次はここで学習した手順で独自のロード バランサーをデプロイします。</span><span class="sxs-lookup"><span data-stu-id="ca273-187">Next, you will use these steps to deploy your own load balancer.</span></span>