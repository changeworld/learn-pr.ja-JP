Azure、およびキャッシュに役立てる方法のパフォーマンスを最適化でディスクのパフォーマンスに影響する要因を見ていきます。

### <a name="disk-caching"></a>ディスク キャッシュ

キャッシュは、データを格納するため、高速でアクセスできる通常メモリでコンピューターに特殊なコンポーネントです。 キャッシュ内のデータは、多くの場合、以前は、読み取られた、または以前の計算の結果として生じたデータ データです。 目標は、データにアクセスすることをディスクから取得するよりも高速です。

特殊化されたキャッシュの使用とも高価な一時的な記憶域を持つ高速読み取りまたは書き込みのパフォーマンスをより永続的なストレージ。 このキャッシュ ストレージが多くの場合、制限されているため、意思決定をどのようなデータ操作が最も大きいメリット キャッシュしたりできるようにする必要があります。 でも、キャッシュが広く利用できるなど、Azure を使用するどのようなキャッシュの種類を決定する前に各ディスクのワークロード パターンを確認することも重要です。

**読み取りキャッシュ**高速化するデータの取得を試みます。 永続的なストレージから読み取りではなく、データは高速のキャッシュから読み取られます。 データの読み取りには、次の条件下で、キャッシュがヒットします。

- データは、前に読み取られ、キャッシュ内に存在します。
- キャッシュはすべてのデータを保持するのに十分な大きさです。

いくつかを使用する必要がある場合に、読み取りキャッシュことに注意してください。_予測可能性_を一連の順次読み取りなどの読み取りキュー。 場所にアクセスして、データは、ストレージに分散しているが、ランダムの I/O のキャッシュはほとんどまたはまったくの特典のなりディスク パフォーマンスが低下することもできます。

**書き込みキャッシュ**ストレージへのデータの書き込みを高速化を試みます。 書き込みキャッシュを使用すると、アプリ データを保存することもできます。 実際には、データがキューに入れ、キャッシュで永続的なストレージに書き込むを待機しています。 ご想像のとおり、このメカニズムは、潜在的な障害点を指定できますなど、システムのシャット ダウン前に、このキャッシュされたデータがフラッシュされるディスクにします。 SQL Server など、一部のシステムでは、永続的なディスク ストレージへのキャッシュされたデータの書き込みは自体を処理します。

### <a name="azure-disk-caching"></a>Azure ディスク キャッシュ

その問題のディスク記憶域のキャッシュ ディスクの 2 種類あります。

- Azure storage のキャッシュ
- Azure の仮想マシン (VM) ディスクのキャッシュ

Azure storage のキャッシュには、Azure Blob storage、Azure Files、および Azure 内の他のコンテンツのキャッシュ サービスが提供します。 これらの種類のキャッシュの構成では、このモジュールの範囲外です。

Azure 仮想マシン ディスクのキャッシュは、読み取りおよび書き込みアクセスを Azure Vm にアタッチされている仮想ハード_ディスク (VHD) ファイルを最適化する方法です。 このモジュールでディスクのキャッシュに注目します。

### <a name="azure-virtual-machine-disk-types"></a>Azure 仮想マシン ディスクの種類

Azure Vm で使用されるディスクの 3 つの種類があります。

- **OS ディスク**: Azure VM を作成するときに Azure に自動的にオペレーティング システム (OS) の VHD をアタッチします。 VHD は、Azure storage にページ blob として格納されます。
- **一時ディスク**: Azure VM を作成するときに Azure も自動的に一時ディスクを追加します。 このディスクは、ページとスワップ ファイルなどのデータに使用されます。 このディスク上のデータは、メンテナンスまたは VM の再デプロイ中に失われる可能性があります。 そのため、使用しないでください、データベース ファイルまたはトランザクション ログなどの永続的なデータを格納するため。
- **データ ディスク**: データ ディスクはアプリケーション データまたは保持する必要があるその他のデータを格納する仮想マシンにアタッチされている VHD です。

OS ディスクとデータ ディスクを Azure VM ディスクのキャッシュの活用します。 VM ディスクのキャッシュ サイズは、VM インスタンスのサイズと、VM にマウントされているディスクの数によって異なります。 最大 4 つだけのデータ ディスクのキャッシュを有効にすることができます。

## <a name="cache-options-for-azure-vms"></a>Azure Vm のキャッシュ オプション

VM ディスクのキャッシュに 3 つの一般的なオプションがあります。

- **読み取り/書き込み**– ライト バック キャッシュします。 必要なときに、永続ディスクにキャッシュされたデータの書き込みアプリケーションを正しく処理する場合にのみ、このオプションを使用します。
- **読み取り専用**-読み取りはキャッシュから実行されます。
- **None** -キャッシュはありません。 書き込み専用、書き込み負荷の高いディスクは、このオプションを選択します。 書き込み負荷の高い操作になるために、ログ ファイルは適切な候補が。

すべてのキャッシュ オプションは、各種類のディスク使用できます。 次の表では、各ディスクの種類のキャッシュ オプションを示します。

| |**読み取り専用**  |**読み取り/書き込み**  |**なし**  |
|---------|---------|---------|---------|
|OS ディスク     |   はい      |   [はい] (既定値)     |   はい      |
|データ ディスク     |   [はい] (既定値)      |  はい       |  はい       |
|一時ディスク     |  ×       |   ×      |   ×      |

> [!NOTE]
> L シリーズと B シリーズ仮想マシンのディスクのキャッシュ オプションを変更できません。

## <a name="performance-considerations-for-azure-vm-disk-caching"></a>Azure VM ディスクのキャッシュのパフォーマンスに関する考慮事項

そのため、キャッシュの設定、Azure Vm で実行されているワークロードのパフォーマンスにする方法でしょうか。

### <a name="os-disk"></a>OS ディスク

VM の OS ディスクの場合は、既定の動作は、読み取り/書き込みモードでキャッシュを使用するのには。 OS ディスク上のデータ ファイルを保存するアプリケーションがあり、アプリケーションは、多くのデータ ファイルへのランダム読み取り/書き込み操作を行う場合を検討してくださいを持つ、キャッシュのデータ ディスクにそれらのファイルを移動をオフになっています。 なぜですか? 読み取りのキューに順次読み取りが含まれていない場合がほとんどまたはまったくない特典になりますキャッシュします。 データが、連続したかのように、キャッシュを維持するためのオーバーヘッドがディスク パフォーマンスが低下することができます。

### <a name="data-disks"></a>データ ディスク

パフォーマンス重視のアプリケーションでは、OS ディスクではなく、データ ディスクを使用する必要があります。 別のディスクを使用するディスクごとに適切なキャッシュの設定を構成することができます。

たとえば、Azure Vm で SQL Server を実行して、有効にする**読み取り専用**大幅なパフォーマンス向上につながる (標準モードと TempDB データ) のデータ ディスクにキャッシュします。 ログ ファイルには、キャッシュなしのデータ ディスクに適した候補一方でです。

> [!WARNING]
> Azure ディスクのキャッシュ設定を変更して、デタッチ、ターゲット ディスクを再アタッチされます。 オペレーティング システム ディスクである場合、VM が再起動します。 ディスク キャッシュの設定を変更する前に、この中断の影響を受ける可能性があるすべてのアプリケーションまたはサービスを停止します。
