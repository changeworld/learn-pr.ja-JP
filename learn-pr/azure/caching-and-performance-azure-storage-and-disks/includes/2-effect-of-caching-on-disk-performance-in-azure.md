ローカル コンピューターと同じように、仮想マシンのパフォーマンスは多くの場合、データをいかに速く読み取りおよび書き込みできるかということに直接関連しています。 そのパフォーマンスを向上させる方法を理解するには、まずパフォーマンスの測定方法と、それに影響を与える設定と選択内容を理解する必要があります。

VM に使用される、基になるディスクとストレージを具体的に見て行きましょう。 パフォーマンスを調べる場合は、アプリケーション層も検討する必要があることに留意してください。 たとえば、VM でデータベースを実行している場合、データベース固有のパフォーマンス設定を調べて、それが VM と VM で実行しているストレージに確実に最適化されているようにします。

いくつかの条件と、それらについての Azure の保証を定義することから始めましょう。

## <a name="io-operations-per-second"></a>1 秒あたりの I/O

選択するストレージの種類 (Standard または Premium) によって、ディスクの速度が決まります。 このパフォーマンスは、1 秒あたりの I/O 操作 (IOPS ("アイオプス" と発音)) で測定されます。

IOPS は、ディスクが 1 秒間に処理できる要求の数です。 1 つの要求は、読み取り操作または書き込み操作です。 この測定はストレージに直接適用されます。 たとえば、**5000 IOPS** を処理できるディスクがある場合、理論的には、1 秒あたり 5,000 の読み取り操作または書き込み操作が処理できることになります。

IOPS は、アプリケーションのパフォーマンスに直接影響します。 小売 Web サイトなどの一部のアプリケーションでは、サイトの応答性を維持するために、迅速に処理する必要がある小さいランダムな IO 要求すべてを処理する高い IOPS が必要です。

### <a name="iops-in-azure"></a>Azure での IOPS

Premium Storage ディスクを高スケール VM に接続すると、そのディスクの仕様どおりに、保証された数の IOPS がプロビジョニングされます。 たとえば、**P50** ディスクでは **7,500 IOPS** がプロビジョニングされます。 また、高スケール VM の各サイズにも、維持できる IOPS の上限が設けられています。 たとえば、**Standard GS5** VM の上限は **80,000 IOPS** です。

IOPS はストレージ ディスクの測定ですが、それは_理論上_の制限です。実際のアプリケーションのパフォーマンスに影響を与える他の 2 つの要因は、**スループット**と**待機時間**です。

### <a name="what-is-throughput"></a>スループットとは
スループット (帯域幅とも呼ばれます) は、アプリケーションが指定された間隔 (通常は 1 秒) でストレージ ディスクに送信するデータの量です。 アプリケーションが大量のデータ ブロックで I/O を実行している場合は、高スループットが必要です。

Azure では、Premium Storage ディスクの仕様に基づいて、そのディスクのスループットがプロビジョニングされます。 たとえば、**P50** ディスクでは **250 MB/秒**のディスク スループットがプロビジョニングされます。 また、高スケール VM の各サイズにも、維持できる_スループットの上限_が設けられています。 たとえば、**Standard GS5** VM の最大スループットは **2,000 MB/秒**です。

#### <a name="iops-vs-throughput"></a>IOPS とスループット

スループットと IOPS には、直接的なリレーションシップがあり、一方が変化すると、もう一方に直接影響します。 スループットの理論上の制限を取得するには、`IOPS x I/O size = throughput` の数式を使用することができます。 アプリケーションを計画するときには、これらの両方の値を考慮することが重要です。

### <a name="what-is-latency"></a>待機時間とは

データの読み取りと書き込みには時間がかかります。 ここに_待機時間_が発生します。 待機時間は、アプリが要求をディスクに送信し、応答を受け取るのにかかる時間です。 基本的には、待機時間によって 1 つの読み取りまたは書き込みの I/O 要求を_処理_するのにどのくらいの時間を要するかがわかります。

待機時間により IOPS が制限されます。 たとえば、5000 IOPS を処理できるディスクがあっても、各操作の処理に 10 ミリ秒かかる場合、この処理時間によりアプリは 1 秒あたり 100 操作に制限されます。 これはシンプルな例で、ほとんどの待機時間はこれよりもっと短くなります。 最終的には、待機時間とスループットによって、アプリがストレージからデータを処理する速度が決まります。 

Premium Storage では、常に短い待機時間が提供され、必要な場合には_キャッシュ_を使用してさらに短い待機時間を実現できます。 

## <a name="testing-your-disk-performance"></a>ディスク パフォーマンスのテスト

適切な VM サイズとストレージの種類を選択することで、VM ディスクの IOPS、スループット、および待機時間を調整してバランスを取ることができます。 通常、VM のサイズが大きいほど、または VM の価格が高いほど、保証される最大 IOPS とスループットもより高くなります。 その方程式に、Standard Storage とPremium Storage、および HDD とSSD の選択肢を追加します。使用できるパラメーターがいくつかあります。

適切な組み合わせを選択するには、アプリケーションの要件を理解する必要があります。 データベース サーバーやオンライン トランザクション処理システムなどの高 I/O アプリケーションには、より高い IOPS が必要になるのに対して、より演算ベースのアプリケーションはさらに低い要件で取得できる場合があります。 さらに、アプリケーションで実行される操作の_種類_もスループットに影響します。 高いランダム アクセス I/O は、長い順次読み取りよりも遅くなる傾向があります。

構成を選択すると、[Iometer](http://iometer.org/) などのツールを使用して、Linux VM および Windows VM のディスク パフォーマンスをテストできます。 これにより、どのようなパフォーマンスが期待できるかについて、より現実に即した感覚がもたらされます。 これは、アプリのストレージ使用を改善する方法を特定することにも役立ちます。たとえば、シングル スレッドの I/O を処理するアプリケーションでは、待機時間により I/O パフォーマンスが低下してしまう恐れがあります。

ディスク パフォーマンスを向上させるためにできる他の方法をいくつか見てみましょう。

