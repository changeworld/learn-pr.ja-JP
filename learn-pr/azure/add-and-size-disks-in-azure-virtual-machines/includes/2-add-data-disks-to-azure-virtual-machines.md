Azure の仮想マシンでは、他のコンピューターと同じように、オペレーティング システム、アプリケーション、およびデータを格納する場所としてディスクが使用されます。 これらのディスクは、仮想ハード ディスク (VHD) と呼ばれます。

Azure で仮想マシン (VM) を作成し、その VM で法律事務所が使用している案件履歴データベースをホストするとします。 SQL Server で良好なパフォーマンスと回復力を実現するための基盤となるのは、適切なディスク構成です。

このユニットでは、ご利用のディスクに対して適切な構成値を選択する方法と、それらのディスクを VM に接続する方法について説明します。

## <a name="how-disks-are-used-by-vms"></a>VM でのディスクの使用方法

VM では、3 つの異なる目的でディスクが使用されます。

- **オペレーティング システム ストレージ**。 すべての VM に 1 つ含まれるディスクで、ここにはオペレーティング システムが格納されています。 このドライブは SATA ドライブとして登録され、Windows では C: ドライブとしてラベル付けされます。また、Unix 系オペレーティング システムでは "/" としてマウントされます。 最大容量は 2,048 ギガバイト (GB) で、そのコンテンツは、VM を作成するときに使用した VM イメージから取得されます。
- **一時ストレージ**。 各 VM には、ページ ファイルおよびスワップ ファイルに使用される一時 VHD も含まれています。 このドライブのデータは、メンテナンス イベントまたは再デプロイ中に失われる可能性があります。 このドライブは、Windows VM では既定で D: のラベルが付けられます。 失いたくない重要データは、このドライブに格納しないでください。
- **データ ストレージ**。 VM に接続されている他のディスクはすべて、データ ディスクです。 データ ディスクを使用して、再起動後も保持する必要があるファイル、データベース、およびその他のデータを格納します。 一部の VM イメージには、既定でデータ ディスクが含まれています。 独自のデータ ディスクを、VM のサイズで指定された最大数まで追加することもできます。 各データ ディスクは SCSI ドライブとして登録され、最大容量は 4,095 GB です。 ご使用のデータ ドライブ用にドライブ文字またはマウント ポイントを選択できます。

## <a name="storing-vhd-files"></a>VHD ファイルの格納

Azure では、Azure ストレージ アカウントに VHD が**ページ BLOB** として格納されます。

次の表は、各種ストレージ アカウントと、それぞれのストレージ アカウントで使用できるオブジェクトを示しています。

|**ストレージ アカウントの種類**|**汎用 (Standard)**|**汎用 (Premium)**|**Blob Storage (ホット アクセス層とクール アクセス層)**|
|-----|-----|-----|-----|
|**サポートされるサービス**| Azure Blob Storage、Azure Files、Azure Queue Storage | Blob Storage | Blob Storage|
|**サポートされる BLOB の種類**|ブロック BLOB、ページ BLOB、追加 BLOB | ページ BLOB | ブロック BLOB と追加 BLOB|

VHD はページ BLOB として格納され、ページ BLOB をサポートするのは Standard Storage だけであるため、VHD を格納するには、Standard Storage アカウントが必要です。

## <a name="attach-data-disks-to-vms"></a>データ ディスクを VM に接続する

データ ディスクは仮想マシンに接続することで、いつでも VM に追加できます。 ディスクを接続すると、VHD ファイルが VM に関連付けられます。 

VHD が接続されている間は、その VHD をストレージから削除することはできません。

### <a name="attach-an-existing-data-disk-to-an-azure-vm"></a>既存のデータ ディスクを Azure VM に接続する

Azure VM で使用したいデータが格納されている VHD が、既に存在する場合があります。 法律事務所のシナリオでは、たとえば、お使いの物理ディスクをローカルで既に VHD に変換していることがあります。 この場合は、PowerShell `Add-AzureRmVhd` コマンドレットを使用して、それをストレージ アカウントにアップロードできます。 このコマンドレットは、VHD ファイルの転送用に最適化されており、他の方法よりも迅速にアップロードを完了できます。 この転送で最適なパフォーマンスを実現するには、複数のスレッドを使用します。 VHD のアップロードが完了したら、それをデータ ディスクとして既存の VM に接続します。 このアプローチは、あらゆる種類のデータを Azure VM にデプロイするために使用できる優れた方法です。 データは VM に自動的に存在します。新しいディスクをパーティション分割したりフォーマットしたりする必要はありません。

### <a name="attach-a-new-data-disk-to-an-azure-vm"></a>新しいデータ ディスクを Azure VM に接続する

Azure portal を使用すると、新しい空のデータ ディスクを VM に追加できます。 

これにより **.vhd** ファイルが、指定したストレージ アカウントにページ BLOB として作成され、その .vhd ファイルはデータ ディスクとして VM に接続されます。 

新しい VHD を使用してデータを格納するには、新しいディスクを初期化、パーティション分割、およびフォーマットしておく必要があります。 これらの手順は、次の演習で練習します。

物理的なオンプレミス サーバーでは、物理ハード ディスクにデータを格納します。 Azure 仮想マシン (VM) のデータは、仮想ハード ディスク (VHD) に格納します。 これらの VHD は、Azure ストレージ アカウントにページ BLOB として格納されます。 たとえば、法律事務所の案件履歴のデータベースを Azure に移行する場合は、データベース ファイルが保存される VHD を作成する必要があります。
