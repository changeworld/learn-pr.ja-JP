<span data-ttu-id="4aa04-101">Azure の仮想マシンでは、他のコンピューターと同じように、オペレーティング システム、アプリケーション、およびデータを格納する場所としてディスクが使用されます。</span><span class="sxs-lookup"><span data-stu-id="4aa04-101">Just like any other computer, virtual machines in Azure use disks as a place to store an operating system, applications, and data.</span></span> <span data-ttu-id="4aa04-102">これらのディスクは、仮想ハード ディスク (VHD) と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="4aa04-102">These disks are called virtual hard disks (VHDs).</span></span>

<span data-ttu-id="4aa04-103">Azure で仮想マシン (VM) を作成し、その VM で法律事務所が使用している案件履歴データベースをホストするとします。</span><span class="sxs-lookup"><span data-stu-id="4aa04-103">Suppose you have created a virtual machine (VM) in Azure, which will host the database of case histories that your law firm relies on.</span></span> <span data-ttu-id="4aa04-104">SQL Server で良好なパフォーマンスと回復力を実現するための基盤となるのは、適切なディスク構成です。</span><span class="sxs-lookup"><span data-stu-id="4aa04-104">A well-designed disk configuration is fundamental to good performance and resilience for SQL Server.</span></span>

<span data-ttu-id="4aa04-105">このユニットでは、ご利用のディスクに対して適切な構成値を選択する方法と、それらのディスクを VM に接続する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="4aa04-105">In this unit, you'll learn how to choose the right configuration values for your disks and how to attach those disks to a VM.</span></span>

## <a name="how-disks-are-used-by-vms"></a><span data-ttu-id="4aa04-106">VM でのディスクの使用方法</span><span class="sxs-lookup"><span data-stu-id="4aa04-106">How disks are used by VMs</span></span>

<span data-ttu-id="4aa04-107">VM では、3 つの異なる目的でディスクが使用されます。</span><span class="sxs-lookup"><span data-stu-id="4aa04-107">VMs use disks for three different purposes:</span></span>

- <span data-ttu-id="4aa04-108">**オペレーティング システム ストレージ**。</span><span class="sxs-lookup"><span data-stu-id="4aa04-108">**Operating system storage**.</span></span> <span data-ttu-id="4aa04-109">すべての VM に 1 つ含まれるディスクで、ここにはオペレーティング システムが格納されています。</span><span class="sxs-lookup"><span data-stu-id="4aa04-109">Every VM includes one disk that stores the operating system.</span></span> <span data-ttu-id="4aa04-110">このドライブは SATA ドライブとして登録され、Windows では C: ドライブとしてラベル付けされます。また、Unix 系オペレーティング システムでは "/" としてマウントされます。</span><span class="sxs-lookup"><span data-stu-id="4aa04-110">This drive is registered as a SATA drive and labeled as the C: drive in Windows and mounted at "/" in Unix-like operating systems.</span></span> <span data-ttu-id="4aa04-111">最大容量は 2,048 ギガバイト (GB) で、そのコンテンツは、VM を作成するときに使用した VM イメージから取得されます。</span><span class="sxs-lookup"><span data-stu-id="4aa04-111">It has a maximum capacity of 2048 gigabytes (GB), and its content is taken from the VM image you used to create the VM.</span></span>
- <span data-ttu-id="4aa04-112">**一時ストレージ**。</span><span class="sxs-lookup"><span data-stu-id="4aa04-112">**Temporary storage**.</span></span> <span data-ttu-id="4aa04-113">各 VM には、ページ ファイルおよびスワップ ファイルに使用される一時 VHD が含まれています。</span><span class="sxs-lookup"><span data-stu-id="4aa04-113">Every VM includes a temporary VHD that is used for page and swap files.</span></span> <span data-ttu-id="4aa04-114">このドライブのデータは、メンテナンス イベントまたは再デプロイ中に失われる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="4aa04-114">Data on this drive may be lost during a maintenance event or redeployment.</span></span> <span data-ttu-id="4aa04-115">このドライブは、Windows VM では既定で D: のラベルが付けられます。</span><span class="sxs-lookup"><span data-stu-id="4aa04-115">The drive is labeled as D: on a Windows VM by default.</span></span> <span data-ttu-id="4aa04-116">失いたくない重要データは、このドライブに格納しないでください。</span><span class="sxs-lookup"><span data-stu-id="4aa04-116">Do not use this drive to store important data that you do not want to lose.</span></span>
- <span data-ttu-id="4aa04-117">**データ ストレージ**。</span><span class="sxs-lookup"><span data-stu-id="4aa04-117">**Data storage**.</span></span> <span data-ttu-id="4aa04-118">VM に接続されている他のディスクはすべて、データ ディスクです。</span><span class="sxs-lookup"><span data-stu-id="4aa04-118">A data disk is any other disk attached to a VM.</span></span> <span data-ttu-id="4aa04-119">データ ディスクを使用して、再起動後も保持する必要があるファイル、データベース、およびその他のデータを格納します。</span><span class="sxs-lookup"><span data-stu-id="4aa04-119">You use data disks to store files, databases, and any other data that you need to persist across reboots.</span></span> <span data-ttu-id="4aa04-120">一部の VM イメージには、既定でデータ ディスクが含まれています。</span><span class="sxs-lookup"><span data-stu-id="4aa04-120">Some VM images include data disks by default.</span></span> <span data-ttu-id="4aa04-121">別のデータ ディスクを、VM のサイズで指定された最大数まで追加することもできます。</span><span class="sxs-lookup"><span data-stu-id="4aa04-121">You can also add additional data disks up to the maximum number specified by the size of the VM.</span></span> <span data-ttu-id="4aa04-122">各データ ディスクは SCSI ドライブとして登録され、最大容量は 4,095 GB です。</span><span class="sxs-lookup"><span data-stu-id="4aa04-122">Each data disk is registered as a SCSI drive and has a max capacity of 4095 GB.</span></span> <span data-ttu-id="4aa04-123">ご使用のデータ ドライブ用にドライブ文字またはマウント ポイントを選択できます。</span><span class="sxs-lookup"><span data-stu-id="4aa04-123">You can choose drive letters or mount points for your data drives.</span></span>

## <a name="storing-vhd-files"></a><span data-ttu-id="4aa04-124">VHD ファイルの格納</span><span class="sxs-lookup"><span data-stu-id="4aa04-124">Storing VHD files</span></span>

<span data-ttu-id="4aa04-125">Azure では、Azure ストレージ アカウントに VHD が**ページ BLOB** として格納されます。</span><span class="sxs-lookup"><span data-stu-id="4aa04-125">In Azure, VHDs are stored in an Azure storage account as **page blobs**.</span></span>

<span data-ttu-id="4aa04-126">次の表は、各種ストレージ アカウントと、それぞれのストレージ アカウントで使用できるオブジェクトを示しています。</span><span class="sxs-lookup"><span data-stu-id="4aa04-126">This table shows the various kinds of storage accounts and which objects can be used with each.</span></span>

|<span data-ttu-id="4aa04-127">**ストレージ アカウントの種類**</span><span class="sxs-lookup"><span data-stu-id="4aa04-127">**Type of storage account**</span></span>|<span data-ttu-id="4aa04-128">**汎用 (Standard)**</span><span class="sxs-lookup"><span data-stu-id="4aa04-128">**General-purpose standard**</span></span>|<span data-ttu-id="4aa04-129">**汎用 (Premium)**</span><span class="sxs-lookup"><span data-stu-id="4aa04-129">**General-purpose premium**</span></span>|<span data-ttu-id="4aa04-130">**Blob Storage (ホット アクセス層とクール アクセス層)**</span><span class="sxs-lookup"><span data-stu-id="4aa04-130">**Blob storage, hot and cool access tiers**</span></span>|
|-----|-----|-----|-----|
|<span data-ttu-id="4aa04-131">**サポートされるサービス**</span><span class="sxs-lookup"><span data-stu-id="4aa04-131">**Services supported**</span></span>| <span data-ttu-id="4aa04-132">Azure Blob Storage、Azure Files、Azure Queue Storage</span><span class="sxs-lookup"><span data-stu-id="4aa04-132">Azure Blob storage, Azure Files, Azure Queue storage</span></span> | <span data-ttu-id="4aa04-133">Blob Storage</span><span class="sxs-lookup"><span data-stu-id="4aa04-133">Blob storage</span></span> | <span data-ttu-id="4aa04-134">Blob Storage</span><span class="sxs-lookup"><span data-stu-id="4aa04-134">Blob storage</span></span>|
|<span data-ttu-id="4aa04-135">**サポートされる BLOB の種類**</span><span class="sxs-lookup"><span data-stu-id="4aa04-135">**Types of blobs supported**</span></span>|<span data-ttu-id="4aa04-136">ブロック BLOB、ページ BLOB、追加 BLOB</span><span class="sxs-lookup"><span data-stu-id="4aa04-136">Block blobs, page blobs, and append blobs</span></span> | <span data-ttu-id="4aa04-137">ページ BLOB</span><span class="sxs-lookup"><span data-stu-id="4aa04-137">Page blobs</span></span> | <span data-ttu-id="4aa04-138">ブロック BLOB と追加 BLOB</span><span class="sxs-lookup"><span data-stu-id="4aa04-138">Block blobs and append blobs</span></span>|

<span data-ttu-id="4aa04-139">汎用の Standard Storage と Premium Storage は、両方ともページ BLOB をサポートします。</span><span class="sxs-lookup"><span data-stu-id="4aa04-139">Both General-purpose standard and premium storage support page blobs.</span></span> <span data-ttu-id="4aa04-140">コストを最も重視する場合は、Standard Storage アカウントを選択します。</span><span class="sxs-lookup"><span data-stu-id="4aa04-140">Choose a standard storage account if cost is your primary concern.</span></span> <span data-ttu-id="4aa04-141">Premium Storage は、さらにコストがかかりますが、I/O 操作数/秒 (IOPS) が大幅に高くなります。</span><span class="sxs-lookup"><span data-stu-id="4aa04-141">Premium storage will cost more, but will also deliver much higher I/O operations/sec (IOPS).</span></span> <span data-ttu-id="4aa04-142">VM の要件がデータのパフォーマンスの場合は、Premium Storage をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="4aa04-142">If data performance is a requirement for your VM, prefer premium storage.</span></span>

## <a name="attach-data-disks-to-vms"></a><span data-ttu-id="4aa04-143">データ ディスクを VM に接続する</span><span class="sxs-lookup"><span data-stu-id="4aa04-143">Attach data disks to VMs</span></span>

<span data-ttu-id="4aa04-144">データ ディスクは仮想マシンに接続することで、いつでも VM に追加できます。</span><span class="sxs-lookup"><span data-stu-id="4aa04-144">You can add data disks to a virtual machine at any time by attaching them to the VM.</span></span> <span data-ttu-id="4aa04-145">ディスクを接続すると、VHD ファイルが VM に関連付けられます。</span><span class="sxs-lookup"><span data-stu-id="4aa04-145">Attaching a disk associates the VHD file with the VM.</span></span> 

<span data-ttu-id="4aa04-146">VHD が接続されている間は、その VHD をストレージから削除することはできません。</span><span class="sxs-lookup"><span data-stu-id="4aa04-146">The VHD can't be deleted from storage while it's attached.</span></span>

### <a name="attach-an-existing-data-disk-to-an-azure-vm"></a><span data-ttu-id="4aa04-147">既存のデータ ディスクを Azure VM に接続する</span><span class="sxs-lookup"><span data-stu-id="4aa04-147">Attach an existing data disk to an Azure VM</span></span>

<span data-ttu-id="4aa04-148">Azure VM で使用したいデータが格納されている VHD が、既に存在する場合があります。</span><span class="sxs-lookup"><span data-stu-id="4aa04-148">You may already have a VHD that stores the data you want to use in your Azure VM.</span></span> <span data-ttu-id="4aa04-149">法律事務所のシナリオでは、たとえば、お使いの物理ディスクをローカルで既に VHD に変換していることがあります。</span><span class="sxs-lookup"><span data-stu-id="4aa04-149">In our law firm scenario, for example,  perhaps you've already converted your physical disks to VHDs locally.</span></span> <span data-ttu-id="4aa04-150">この場合は、PowerShell `Add-AzureRmVhd` コマンドレットを使用して、それをストレージ アカウントにアップロードできます。</span><span class="sxs-lookup"><span data-stu-id="4aa04-150">In this case, you can use the PowerShell `Add-AzureRmVhd` cmdlet to upload it to the storage account.</span></span> <span data-ttu-id="4aa04-151">このコマンドレットは、VHD ファイルの転送用に最適化されており、他の方法よりも迅速にアップロードを完了できます。</span><span class="sxs-lookup"><span data-stu-id="4aa04-151">This cmdlet is optimized for transferring VHD files and may complete the upload faster than other methods.</span></span> <span data-ttu-id="4aa04-152">この転送で最適なパフォーマンスを実現するには、複数のスレッドを使用します。</span><span class="sxs-lookup"><span data-stu-id="4aa04-152">The transfer is completed by using multiple threads for best performance.</span></span> <span data-ttu-id="4aa04-153">VHD のアップロードが完了したら、それをデータ ディスクとして既存の VM に接続します。</span><span class="sxs-lookup"><span data-stu-id="4aa04-153">Once the VHD has been uploaded, attach it to an existing VM as a data disk.</span></span> <span data-ttu-id="4aa04-154">このアプローチは、あらゆる種類のデータを Azure VM にデプロイするために使用できる優れた方法です。</span><span class="sxs-lookup"><span data-stu-id="4aa04-154">This approach an excellent way to deploy data of all types to Azure VMs.</span></span> <span data-ttu-id="4aa04-155">データは VM に自動的に存在します。新しいディスクをパーティション分割したりフォーマットしたりする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="4aa04-155">The data is automatically present in the VM, and there's no need to partition or format the new disk.</span></span>

### <a name="attach-a-new-data-disk-to-an-azure-vm"></a><span data-ttu-id="4aa04-156">新しいデータ ディスクを Azure VM に接続する</span><span class="sxs-lookup"><span data-stu-id="4aa04-156">Attach a new data disk to an Azure VM</span></span>

<span data-ttu-id="4aa04-157">Azure portal を使用して、新しい空のデータ ディスクを VM に追加できます。</span><span class="sxs-lookup"><span data-stu-id="4aa04-157">You can use the Azure portal to add a new, empty data disk to a VM.</span></span> 

<span data-ttu-id="4aa04-158">この処理により、**.vhd** ファイルが、指定したストレージ アカウントにページ BLOB として作成され、その .vhd ファイルがデータ ディスクとして VM に接続されます。</span><span class="sxs-lookup"><span data-stu-id="4aa04-158">This process will create a **.vhd** file as a page blob in the storage account that you specify, and attach that .vhd file as a data disk to the VM.</span></span>

<span data-ttu-id="4aa04-159">新しい VHD を使用してデータを格納するには、新しいディスクの初期化、パーティション分割、およびフォーマットを実行しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="4aa04-159">Before you can use the new VHD to store data, you have to initialize, partition, and format the new disk.</span></span> <span data-ttu-id="4aa04-160">これらの手順は、次の演習で練習します。</span><span class="sxs-lookup"><span data-stu-id="4aa04-160">We'll practice these steps in the next exercise.</span></span>

<span data-ttu-id="4aa04-161">物理的なオンプレミス サーバーでは、物理ハード ディスクにデータを格納します。</span><span class="sxs-lookup"><span data-stu-id="4aa04-161">In physical on-premises servers, you store data on physical hard disks.</span></span> <span data-ttu-id="4aa04-162">Azure 仮想マシン (VM) のデータは、仮想ハード ディスク (VHD) に格納します。</span><span class="sxs-lookup"><span data-stu-id="4aa04-162">You store data in an Azure virtual machine (VM) on virtual hard disks (VHDs).</span></span> <span data-ttu-id="4aa04-163">これらの VHD は、Azure ストレージ アカウントにページ BLOB として格納されます。</span><span class="sxs-lookup"><span data-stu-id="4aa04-163">These VHDs are stored as page blobs in Azure storage accounts.</span></span> <span data-ttu-id="4aa04-164">たとえば、法律事務所の案件履歴のデータベースを Azure に移行する場合は、データベース ファイルが保存される VHD を作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4aa04-164">For example, when you migrate your law firm's database of case histories to Azure, you must create VHDs where the database files will be saved.</span></span>
