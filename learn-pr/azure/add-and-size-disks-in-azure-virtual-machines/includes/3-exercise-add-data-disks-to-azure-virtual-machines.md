この演習では、会社で簡易メール転送プロトコル (SMTP) メール サーバーを実行していると想定します。 このサーバーを Azure に移行したいと考えています。 また、SMTP サーバーで、自社ドメインの受信メッセージを、専用の VHD 上にある "Drop" というフォルダーに保存したいと考えています。

この演習の目標は、Windows 仮想マシン (VM) を作成し、"Drop" ディレクトリを保存する "Incoming" という新しい仮想ハード ディスク (VHD) を接続することです。

## <a name="sign-in-to-azure"></a>Azure へのサインイン
<!---TODO: Need update for sanbox?--->

1. [Azure portal](https://portal.azure.com/?azure-portal=true) にサインインします。

## <a name="create-a-windows-vm-in-the-azure-portal"></a>Azure portal で Windows VM を作成する

データ ドライブで SMTP サーバーをホストする VM を作成するには、次の手順を行います。

1. Azure portal の左上にある **[リソースの作成]** を選択します。

1. Azure Marketplace リソースの一覧の上にある検索ボックスで **Windows Server 2016 Datacenter** を検索して選択し、**[作成]** を選択します。

1. 右側に表示される **[Basics]** ウィンドウで、次のプロパティ値を入力します。 


|プロパティ  |値  |メモ  |
|---------|---------|---------|
|名前     |   **MailSenderVM**      |         |
|VM ディスクの種類     |  **Standard HDD**       |   ドロップダウン リストからこの値を選択します。      |
|ユーザー名     |  **mailmaster**       |         |
|パスワード     |  パスワードは 12 文字以上で、[定義された複雑さの要件](https://docs.microsoft.com/azure/virtual-machines/windows/faq#what-are-the-password-requirements-when-creating-a-vm)を満たす必要があります。       | このユーザー名とパスワードはモジュール全体で使用するため、記憶しておいてください。         |
|サブスクリプション     |  サブスクリプションを選択します。       |  ドロップダウン リストからこの値を選択します。       |
|リソース グループ     |  **[新規作成]** を選択して、「**MailInfrastructure**」と入力します。       |  このモジュールで使用されるすべてのリソースを 1 つのリソース グループに集めます。       |
|場所     |   お近くの場所を選択します。      | ドロップダウン リストからこの値を選択します。        |

4. **[Basics]** ページの下部にある **[OK]** を選択して、**[サイズ]** 構成パネルに進みます。

1. **[サイズ]** 構成ウィンドウで、**B1ms** を検索して選択し、**[選択]** をクリックします。

1. **[設定]** ウィンドウの **[マネージド ディスクの使用]** で **[いいえ]** をクリックします。 マネージド ディスクについては、このモジュールで後述します。

1. **[パブリック受信ポートを選択]** で **[RDP (3389)]** を選択します。 作成後、このポートを使用して VM にリモート接続します。

1. 他のすべての設定を既定値のままにして、**[OK]** をクリックします。

1. **[作成]** ウィンドウで、構成を確認します。

1. 構成を確認したら、**[作成]** を選択します。 Azure で新しい VM を作成して起動します。

> [!TIP]
> VM を作成して Azure にデプロイするには、数分かかることがあります。 進行状況は、**[通知]** ハブで見ることができます。 Azure では、終了時に通知ダイアログが表示されます。

## <a name="add-an-empty-data-disk-to-our-vm"></a>空のデータ ディスクを VM に追加する

SMTP サーバーの "受信" 用のディスク ストアに "Drop" ディレクトリと名前を付けます。 次の手順で新しい空のディスクをサーバーに追加してみましょう。

1. 左側のナビゲーションの **[お気に入り]** で、**[Virtual Machines]** を選択します。

1. VM の一覧で、**[MailSenderVM]** を選択します。

1. 左側の **[MailSenderVM]** 構成メニューの **[設定]** で、**[ディスク]** を選択します。

1. **[データ ディスク]** で、**[データ ディスクの追加]** を選択します。

1. **[アンマネージド ディスクの接続]** ウィンドウで、次のプロパティを設定します。


|プロパティ  |値  |メモ  |
|---------|---------|---------|
|名前     |   **MailSenderVMIncoming**      |         |
|ソースの種類     |  **新規 (空のディスク)**       |   ドロップダウン リストからこの値を選択します。       |
|アカウントの種類     |  **Standard HDD**       |  ドロップダウン リストからこの値を選択します。        |


6. **[ストレージ コンテナー]** フィールドの左で、**[参照]** を選択します。

1. ストレージ アカウントの一覧で、**mailinfrastructure** から始まる名前のストレージ アカウントを検索して選択します。

1. コンテナーの一覧で **[vhd]** をクリックし、**[選択]** を選択します。

1. **[アンマネージド ディスクの接続]** 画面に戻り、**[OK]** を選択します。

1. **[MailSenderVM - ディスク]** 画面に戻り、**[保存]** を選択します。

ここでは、**MainSenderVMIncoming** というディスクを定義しました。 ディスクを使用するには、まず VM にログインするときにディスクをパーティション分割してフォーマットする必要があります。 

## <a name="partition-and-format-a-data-disk"></a>データ ディスクのパーティション分割とフォーマット

物理ディスクと同様に、使用する前に VHD 上のパーティションを初期化してフォーマットします。

### <a name="log-into-our-windows-vm-using-rdp"></a>RDP を使用して Windows VM にログインする

1. **MailSenderVM** 仮想マシンのメイン画面で、**[概要]** を選択します。

1. 概要画面の左上から **[接続]** を選択します。

1. 右側に表示される **[仮想マシンに接続する]** ダイアログで、**[Download to RDP File]\(RDP ファイルにダウンロード\)** を選択します。

   ![[Download to RDP File]\(RDP ファイルにダウンロード\) ボタンが強調表示された [仮想マシンに接続する] ダイアログのスクリーンショット。](../media-draft/download-rdp.png)

4. **MailSenderVM.rdp** というファイルがローカルの `Downloads` フォルダーにダウンロードされます。 このファイルは、MailSenderVM 仮想マシンのリモート デスクトップ構成ファイルです。 ファイルを開き、接続プロセスを開始します。

1. **[リモート デスクトップ接続]** ダイアログで、**[接続]** をクリックします。

1. **[Windows セキュリティ]** ダイアログで、**[別のアカウントを使用]** をクリックします。

1. **[ユーザー名]** ボックスに、「**mailmaster**」と入力します。

1. **[パスワード]** ボックスに、この演習でこのユーザー名に入力したパスワードを入力します。 

1. **[リモート デスクトップ接続]** ダイアログで、**[はい]** をクリックします。

仮想マシンへのリモート デスクトップ セッションが開始されます。 初めてサインインするには数分かかる場合があります。 サインインが完了すると、**サーバー マネージャー** ツールが画面に表示されます。

### <a name="partition-and-format-our-data-disk-using-server-manager"></a>サーバー マネージャーを使用してデータ ディスクをパーティション分割してフォーマットする

1. **サーバー マネージャー**が表示されたら、左側のナビゲーションで **[ファイル サービスと記憶域サービス]** を選択します。

1. **[ボリューム]** で **[ディスク]** を選択します。

1. ディスクの一覧で、ディスク **0** はオペレーティング システムのディスク、ディスク **1** は一時ディスクです。 追加したばかりの新しい VHD であるディスク **2** を選択します。

1. **[ボリューム]** ウィンドウの上部で、**[タスク]**、**[新しいボリューム]** の順に選択します。次のように、メニューは画面の右上に表示されます。

   ![展開され、3 つのメニュー項目が表示された [タスク] メニューのスクリーンショット。 [新しいボリューム]、[記憶域の再スキャン]、[更新] という項目があります。](../media-draft/tasks-menu.png)


1. **[新しいボリューム]** ウィザードで **[次へ]** をクリックします。

1. **[サーバーとディスクの選択]** ページで **[MailSenderVM]** と **[ディスク 2]** を選択し、**[次へ]** をクリックします。

1. **[オフラインまたは未初期化のディスク]** ダイアログで **[OK]** をクリックします。

1. **[ボリュームのサイズの指定]** ページで、**[次へ]** をクリックします。

1. **[ドライブ文字を割り当てる]** ページで **[F:]**、**[次へ]** の順に選択します。

1. **[ファイル システム形式の選択]** ページで、**[ボリューム ラベル]** ボックスに「**Incoming**」と入力し、**[次へ]** を選択します。

1. **[選択内容の確認]** ページで、**[作成]** を選択します。 Windows でディスクを初期化し、新しいパーティションをフォーマットします。

1. **[完了]** ページで **[閉じる]** を選択します。

エクスプローラーで新しいディスク ボリュームを見てみましょう。 
1. **エクスプローラー**を開きます。

1. 左側のナビゲーションで **[PC]** をクリックし、**[Incoming (F:)]** をダブル クリックします。

1. **[ホーム]** を選択し、**[新しいフォルダー]** を選択します。

1. 「**Drop**」と入力し、Enter キーを押します。

VHD 上に **Incoming** という新しいボリュームが作成され、そのボリュームに **Drop** という名前のフォルダーが作成されました。  

1. Windows のエクスプローラーを閉じます。

1. **タスク バー** の **[スタート]** ボタンをクリックし、**[電源]** ボタンをクリックして **[切断]** をクリックします。

お疲れさまでした。 Windows VM を作成し、新しい VHD を接続し、その VHD にボリュームを作成し、そのボリュームにフォルダーを追加しました。 前述のように、新しい VHD に使用したディスクの種類は **Standard HDD** でした。 次のユニットでは、Standard Storage と Premium Storage の違いについて学習します。 
