Azure では、Azure Storage アカウントにページ BLOB として VHD イメージが格納されます。 マネージド ディスクの場合、ストレージの管理は Azure で自動的に行われます。これが、マネージド ディスクを選ぶ最大の理由の 1 つです。

VM を作成するときに、OS ディスクのサイズが選択されます。 特定のサイズは、選択するイメージに基づきます。 Linux では、多くの場合、30 GB 前後で、Windows では約 127 GB となります。

データ ディスクを追加して記憶域スペースを増やすことはできますが、既存のディスクを拡張する必要がある場合もあります。レガシ アプリケーションではそのデータを複数のドライブに分割できないか、あるいは物理 PC のドライブを Azure に移行し、より大きな OS ドライブが必要になる可能性が高くなります。

> [!NOTE]
> _より大きい_サイズへのディスクのサイズ変更のみを行うことができます。 現在、マネージド ディスクの縮小はサポートされていません。

ディスクのサイズを変更することで、ディスクのレベルを (たとえば、P10 から P20 に) 変更することもできます。 注意点 - これはパフォーマンスのアップグレードには役立ちますが、Premium レベルを上げると、コストも上がります。

## <a name="vm-size-vs-disk-size"></a>VM サイズとディスク サイズ

VM の作成時に選択する VM サイズによって、割り当てることができるリソースの数が決まります。 ストレージの場合、サイズによって、VM に追加できるディスクの数と各ディスクの最大サイズが制御されます。 

前のユニットで説明したとおり、一部の VM サイズでは (I/O のパフォーマンスが制限される) Standard Storage ドライブのみがサポートされます。

ご利用の VM サイズで許容される量より多いストレージが必要と思われる場合は、VM サイズを変更できます。 そのトピックは「**Azure Virtual Machines の概要**」モジュールに含まれています。

## <a name="expanding-a-disk-using-the-azure-cli"></a>Azure CLI を使用するディスクの拡張

> [!WARNING]
> ディスクのサイズ変更操作を実行する前に、常にデータをバックアップしていることを確認してください。

VHD に対する操作は、実行中の VM で行うことはできません。 まず、`az vm deallocate` を使用して VM の名前とリソース グループの名前を指定し、VM を停止して割り当てを解除します。

VM を単に_停止する_場合とは異なり、VM の割り当てを解除すると、関連付けられているコンピューティング リソースが解放され、仮想化されたハードウェアの構成変更を Azure でできるようになります。

```azurecli
az vm deallocate --resource-group <resource-group-name> --name <vm-name>
```

次に、ディスクのサイズを変更するために、`az disk update` を使用して、ディスク名、リソース グループ名、新たに要求されたサイズを渡します。 マネージド ディスクを拡張すると、指定されたサイズがマネージド ディスクの最も近いサイズにマップされます。

```azurecli
az disk update \
    --resource-group <resource-group-name> \
    --name <disk-name> \
    --size-gb 200
```

最後に、`az vm start` を使用して、再度 VM を起動します。

```azurecli
az vm start --resource-group <resource-group-name> --name <vm-name>
```

## <a name="expanding-a-disk-using-the-azure-portal"></a>Azure portal を使用するディスクの拡張

Azure portal を使用するディスクの拡張はさらに簡単です。

1. VM の **[概要]** ビューのツール バーにある **[停止]** ボタンを使用して、VM を停止します。

1. **[設定]** セクションで **[ディスク]** をクリックします。

1. サイズを変更するデータ ディスクを選択します。

    ![編集する VHD が強調表示された VM のディスク セクションを示すスクリーンショット](../media/5-portal-disks.png)

1. ディスクの詳細で、現在のサイズより_大きい_サイズを入力します。 ここで Premium から Standard (またはその逆) に変更することもできます。 予測される IOPS のセクションで示すように、これらの設定でパフォーマンスが調整されます。

    ![新しいサイズ フィールドが強調表示されている VHD 編集画面を示すスクリーンショット](../media/5-resize-disk.png)

1. **[保存]** をクリックして変更を保存します。

1. VM を再起動します。


### <a name="expanding-the-partition"></a>パーティションの拡張

新しいデータ ディスクを追加する場合と同じように、パーティションとファイルシステムを拡張するまで、拡張ディスクでは使用可能なスペースが追加されません。 これは、VM で利用可能な OS ツールを使用して行う必要があります。 

Windows では、ディスク マネージャー ツールまたは `diskpart` コマンド ライン ツールを使用します。

Linux では、`parted` と `resize2fs` を使用します。

これらのコマンドのいくつかを試してみましょう。