Azure では、Azure ＠Storage アカウントにページ BLOB として VHD イメージが格納されます。 マネージド ディスクの場合、ストレージの管理はユーザーの代わりに Azure ＠で行われます。これが、マネージド ディスクを選ぶ最大の理由の 1 つです。

VM を作成するときに、OS ディスクのサイズが選択されます。 ＠特定のサイズは、選択するイメージに基づきます。 Linux では、＠多くの場合、約 30 GB で、Windows では約 127 GB となります。

データ ディスクを追加してストレージ容量を＠増やすことはできますが、既存のディスクを拡張する必要がある場合もあります。＠おそらく、レガシ アプリケーションではそのデータを複数のドライブに分割できず、物理 PC のドライブを Azure に移行して、より大きな OS ドライブが必要になります。

> [!NOTE]
> ＠_より大きい_サイズへのディスクの変更のみを行うことができます。 現在、マネージド ディスクの縮小はサポートされていません。

＠ディスクのサイズを変更することで、ディクスのレベルも (たとえば、P10 から P20 に) 変更できます。 注意点 - これはパフォーマンスのアップグレードには＠適していますが、Premium レベルが上がると共にコストも上がります。

## <a name="vm-size-vs-disk-size"></a>VM サイズとディスク サイズ

＠VＭ の作成時に選択する VM サイズによって、割り当てることができるリソースの数が決まります。 ストレージの場合、＠サイズによって、VM に追加できるディスクの数と各ディスクの最大サイズが制御されます。 

前のユニットで説明したとおり、一部の VM サイズでは (＠I/O のパフォーマンスが制限される) Standard ストレージ ドライブのみがサポートされます。

VM サイズで許容される＠サイズよりも大きいストレージが必要と思われる場合は、VM サイズを変更できます。 そのトピックは「**Azure Virtual Machines モジュールの概要**」＠モジュールにあります。

## <a name="expanding-a-disk-using-the-azure-cli"></a>Azure CLI を使用するディスクの＠拡張

> [!WARNING]
> ＠ディスクのサイズ変更操作を実行する前に、常にデータをバックアップしていることを確認してください。

＠VHD に対する操作は、実行中の VM で行うことはできません。 まず、`az vm deallocate` ＠で VM を停止して割り当てを解除し、VM の名前とリソース グループの名前を指定します。

＠VM を単に_停止する_場合とは異なり、VM の割り当てを解除すると、関連付けられているコンピューティング リソースが解放され、Azure で仮想化されたハードウェアの構成変更が可能にになります。

```azurecli
az vm deallocate --resource-group <resource-group-name> --name <vm-name>
```

＠次に、ディスクのサイズを変更するために、`az disk update` を使用して、ディスク名、リソース グループ名、新たに要求されたサイズを渡します。 マネージド ディスクを拡張すると、指定されたサイズがマネージド ディスクの最も近いサイズにマップされます。

```azurecli
az disk update \
    --resource-group <resource-group-name> \
    --name <disk-name> \
    --size-gb 200
```

最後に、`az vm start` を使用して、＠もう一度 VM を起動します。

```azurecli
az vm start --resource-group <resource-group-name> --name <vm-name>
```

## <a name="expanding-a-disk-using-the-azure-portal"></a>Azure portal を使用するディスクの＠拡張

Azure portal を使用するディスクの拡張の＠方が簡単です。

1. ＠VM の **[概要]** ビューのツール バーにある **[停止]** ボタンを使用して、VM を停止します。

1. **[設定]** セクションで **[ディスク]** をクリックします。

1. サイズを変更するデータ ディスクを選択します。

    ![＠編集する VHD が強調表示された VM のディスク セクションを示すスクリーンショット](../media/5-portal-disks.png)

1. ＠ディスクの詳細で、現在のサイズより_大きい_サイズを入力します。 ＠ここで Premium から Standard (またはその逆) に変更することもできます。 ＠予測される IOPS セクションで示すように、これらの設定でパフォーマンスが調整されます。

    ![新しいサイズ フィールドが＠強調表示されている VHD 編集画面を示すスクリーンショット](../media/5-resize-disk.png)

1. **[保存]** をクリックして変更を保存します。

1. VM を再起動します。


### <a name="expanding-the-partition"></a>パーティションの＠拡張

新しいデータ ディスクを追加する場合と同じように、パーティションとファイルシステムを拡張するまで、拡張ディスクでは＠使用可能な領域が追加されません。 ＠これは、VM で利用可能な OS ツールを使用しておこう必要があります。 

Windows では、＠Disk Manager ツールまたは `diskpart` コマンド ライン ツールを使用します。

Linux では、`parted` と `resize2fs` を使用します。

これらのコマンドのいくつかを試してみましょう。