ある輸送会社は、他の会社と差別化したいと考えていますが、コストはあまりかけたくありません。 コストを管理しながら、最善のサービスを提供するようにデータベースを設定する方法を理解する必要があります。

ここでは、次のことを学習します。

- 次のような、Azure SQL Database を作成するときに考慮する必要がある内容。
  - データベースの管理コンテナーとしての論理サーバーの動作。
  - 購入するモデルの相違。
  - エラスティック プールを使用してデータベース間で処理能力を共有する方法。
  - データの比較と並べ替えの方法に対する照合順序規則の影響。
- ポータルから Azure SQL Database を起動する方法。
- 信頼できるソースからのみデータベースにアクセスできるようにファイアウォール規則を追加する方法。

Azure SQL Database を作成するときに考慮する必要があることを簡単に見てみましょう。

## <a name="one-server-many-databases"></a>1 つのサーバー、多くのデータベース

最初の Azure SQL Database を作成するときは、_Azure SQL 論理サーバー_ も作成します。 論理サーバーはデータベース用の管理コンテナーと考えることができます。 論理サーバーを使用して、ログイン、ファイアウォール規則、セキュリティ ポリシーを制御できます。 また、論理サーバー内の各データベースでこれらのポリシーをオーバーライドすることもできます。

ここで必要なデータベースは 1 つだけです。 ただし、論理サーバーを使用すると、後でさらにデータベースを追加し、すべてのデータベース間でパフォーマンスを調整することができます。

## <a name="choose-performance-dtus-versus-vcores"></a>パフォーマンスの選択: DTU か仮想コアか

Azure SQL Database には、DTU と仮想コアの 2 種類の購入モデルがあります。

### <a name="what-are-dtus"></a>DTU とは

DTU はデータベース トランザクション ユニットの略語であり、コンピューティング、ストレージ、IO リソースの結合されたメジャーです。 DTU モデルは、シンプルな事前構成済みの購入オプションと考えることができます。

論理サーバーでは複数のデータベースを保持できるため、eDTU、つまり、エラスティック データベース トランザクション ユニットの概念もあります。 このオプションで選択できる価格は 1 つですが、プール内の各データベースは、現在の負荷に応じて消費するリソースを増やしたり減らしたりすることができます。

### <a name="what-are-vcores"></a>仮想コアとは

仮想コアでは、作成して支払うコンピューティング リソースとストレージ リソースをきめ細かく制御できます。

DTU モデルではコンピューティング、ストレージ、IO リソースの組み合わせは固定ですが、仮想コア モデルではリソースを個別に構成することができます。 たとえば、仮想コア モデルでは、ストレージ容量だけを増やし、コンピューティングと IO のスループットは既存の量のままにすることができます。

この輸送と物流のプロトタイプで必要なのは、1 つの Azure SQL Database インスタンスだけです。 コンピューティング、ストレージ、IO のパフォーマンスのバランスが取れていて、低コストで開始できるため、DTU オプションを使うことに決定します。

## <a name="what-are-sql-elastic-pools"></a>SQL エラスティック プールとは

Azure SQL Database を作成するときに、_SQL エラスティック プール_ を作成することができます。

SQL エラスティック プールは eDTU と関連があります。 SQL エラスティック プールでは、プール内のすべてのデータベース間で共有されるコンピューティング リソースとストレージ リソースのセットを購入できます。 各データベースでは、現在の負荷に応じて、設定された制限内で必要なリソースを使用できます。

このプロトタイプでは、必要な SQL Database は 1 つだけなので、SQL エラスティック プールは必要ありません。

## <a name="what-is-collation"></a>照合順序とは

照合順序とは、データを並べ替えたり比較したりする規則のことです。 大文字小文字の区別、アクセント記号、その他の言語の特性が重要なときに並べ替え規則を定義する場合に、照合順序が役立ちます。

既定の照合順序 **SQL_Latin1_General_CP1_CI_AS** が意味することについて考えます。

- **Latin1_General** は、西ヨーロッパ言語のファミリを示します。
- **CP1** は、ラテン アルファベットの人気のある文字エンコーディングであるコード ページ 1252 を示します。
- **CI** は、比較で大文字と小文字が区別されないことを意味します。 たとえば、"HELLO" と "hello" は同じです。
- **AS** は、比較でアクセントが区別されることを意味します。 たとえば、"résumé" と "resume" は同じではありません。

データの並べ替えと比較の方法に関して特定の要件はないので、既定の照合順序を選択します。

## <a name="create-your-azure-sql-database"></a>Azure SQL Database を作成する

ここではデータベースを設定します。これには論理サーバーの作成が含まれます。 輸送物流アプリケーションをサポートする設定を選択します。 実際には、構築しているアプリの種類をサポートしている設定を選択します。

時間が経って需要に対応するためにコンピューティング能力の増強が必要であるとわかった場合は、パフォーマンス オプションを調整することができ、DTU と仮想コアのパフォーマンス モデルを切り替えることさえできます。 

1. [Azure portal](https://portal.azure.com?azure-portal=true) にサインインします。


1. ポータルの左上隅にある **[リソースの作成]** をクリックします。 **[Databases]** を選択し、**[SQL Database]** を選択します。

   ![[リソースの作成] ブレードと [Databases] セクションが表示され、[リソースの作成]、[Databases]、[SQL Database] ボタンが強調されている、Azure portal の スクリーンショット。](../media-draft/create-db.png)

1. **[サーバー]** の **[必要な設定の構成]** をクリックし、フォームに入力して、**[選択]** をクリックします。 フォームに入力する方法の詳細を以下に示します。

    | 設定      | 値 |
    | ------------ | ----- |
    | **サーバー名** | グローバルに一意の[サーバー名](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions)です。 |
    | **サーバー管理者ログイン** | プライマリ管理者ログイン名として機能する[データベース識別子](https://docs.microsoft.com/sql/relational-databases/databases/database-identifiers)です。 |
    | **パスワード** | 8 文字以上が使用され、大文字、小文字、数字、英数字以外の文字のうち、3 つのカテゴリの文字が含まれている有効なパスワード。 |
    | **場所** | 有効な場所です。 |
    > [!IMPORTANT]
    > 後で使用するので、サーバー名、管理者ログイン、パスワードを書き留めておきます。

1. **[価格レベル]** をクリックして、サービス レベルを指定します。 **[Basic]** サービス レベルを選択し、**[適用]** をクリックします。

1. フォームの残りの部分を設定するには、次の値を使用します。

    | 設定      | 値 |
    | ------------ | ----- |
    | **データベース名** | **Logistics** |
    | **サブスクリプション** | お使いのサブスクリプション |
    | **[リソース グループ]** | **logistics-db-rg** |
    | **ソースの選択** | **空のデータベース** |
    | **SQL エラスティック プールを使用しますか?** | **後で** |
    | **照合順序** | **SQL_Latin1_General_CP1_CI_AS** |

1. **[作成]** をクリックして Azure SQL Database を作成します。

1. ツール バーの **[通知]** をクリックして、デプロイ プロセスを監視します。

プロセスが完了したら、**[ダッシュボードにピン留めする]** をクリックして、後で必要なときにすばやくアクセスできるように、データベース サーバーをダッシュボードにピン留めします。

   ![強調表示された最近の展開成功メッセージから [通知] メニューと [ダッシュボードにピン留めする] が表示されている Azure portal のスクリーンショット。](../media-draft/notifications-complete.png)

## <a name="set-the-server-firewall"></a>サーバーのファイアウォールを設定する

Azure SQL Database が稼働状態になりました。 新しいデータベースをさらに構成、セキュリティ保護、監視、トラブルシューティングするための多くのオプションがあります。

また、ファイアウォール経由でデータベースにアクセスできるシステムを指定することもできます。 初期状態のファイアウォールでは、Azure の外部からデータベース サーバーへのアクセスはすべて禁止されます。

このプロトタイプでは、ユーザーのノート パソコンからのみデータベースにアクセスする必要があります。 後で、モバイル アプリなどのシステムをホワイトリストに追加できます。

それでは、開発用コンピューターがファイアウォール経由でデータベースにアクセスできるようにしましょう。

1. Logistics データベースの概要ブレードに移動します。 前にデータベースをピン留めした場合は、ダッシュボードの **Logistics** タイルをクリックして移動できます。

1. **[サーバー ファイアウォールの設定]** をクリックします。

    ![[サーバー ファイアウォールの設定] ボタンが強調表示されている SQL データベース概要ブレードを示す Azure portal のスクリーンショット。](../media-draft/set-server-firewall.png)

1. **[クライアント IP の追加]**、**[保存]** の順にクリックします。

    ![[クライアント IP の追加] ボタンが強調表示されている SQL データベース ファイアウォール設定ブレードを示す Azure portal のスクリーンショット。](../media-draft/add-client-ip.png)

次のパートでは、新しいデータベースと Azure Cloud Shell に関する実習をいくつか行います。 データベースに接続し、テーブルを作成し、サンプル データをいくつか追加して、いくつかの SQL ステートメントを実行します。