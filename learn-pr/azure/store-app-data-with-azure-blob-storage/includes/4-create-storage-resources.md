<span data-ttu-id="aaa57-101">ストレージ アカウント、コンテナー、BLOB 間でデータをどのように保管するかについてアイデアが固まったら、アプリをサポートするために作成する必要がある Azure リソースについて検討することができます。</span><span class="sxs-lookup"><span data-stu-id="aaa57-101">Once we have an idea of how we're going to store data across storage accounts, containers and blobs, we can think about the Azure resources we need to create to support the app.</span></span>

### <a name="storage-accounts"></a><span data-ttu-id="aaa57-102">ストレージ アカウント</span><span class="sxs-lookup"><span data-stu-id="aaa57-102">Storage accounts</span></span>

<span data-ttu-id="aaa57-103">ストレージ アカウントの作成は、アプリのデプロイと実行の前に、管理者またはマネージャーがあらかじめ行う作業です。</span><span class="sxs-lookup"><span data-stu-id="aaa57-103">Storage account creation is an administrative/management activity that takes place prior to deploying and running your app.</span></span> <span data-ttu-id="aaa57-104">アカウントは通常、デプロイまたは環境セットアップ用のスクリプトや Azure Resource Manager テンプレートによって作成するか、管理者が手動で作成します。</span><span class="sxs-lookup"><span data-stu-id="aaa57-104">Accounts are usually created by a deployment or environment setup script, an Azure Resource Manager template, or manually by an administrator.</span></span> <span data-ttu-id="aaa57-105">通常、管理ツール以外のアプリケーションには、ストレージ アカウントを作成するアクセス許可を与えないようにします。</span><span class="sxs-lookup"><span data-stu-id="aaa57-105">Applications other than administrative tools generally should not have permissions to create storage accounts.</span></span>

### <a name="containers"></a><span data-ttu-id="aaa57-106">Containers</span><span class="sxs-lookup"><span data-stu-id="aaa57-106">Containers</span></span>

<span data-ttu-id="aaa57-107">ストレージ アカウントの作成とは異なり、コンテナーの作成は、アプリ内から実行するのに適した簡単な作業です。</span><span class="sxs-lookup"><span data-stu-id="aaa57-107">Unlike storage account creation, container creation is a lightweight activity that makes sense to perform from within an app.</span></span> <span data-ttu-id="aaa57-108">アプリの作業の一部としてコンテナーの作成と削除を行うことは、珍しくありません。</span><span class="sxs-lookup"><span data-stu-id="aaa57-108">It's not uncommon for apps to create and delete containers as part of their work.</span></span>

<span data-ttu-id="aaa57-109">ハードコードまたは事前に構成された名前を持つ既知のコンテナー セットに依存するアプリの場合、一般的な処理方法として、アプリを起動した時点または必要なコンテナーを初めて使用する時点でコンテナーがまだ存在していない場合は、アプリでコンテナーを作成します。</span><span class="sxs-lookup"><span data-stu-id="aaa57-109">For apps that rely on a known set of containers with hard-coded or preconfigured names, typical practice is to let the app create the containers it needs on startup or first usage if they don't already exist.</span></span> <span data-ttu-id="aaa57-110">コンテナーをアプリのデプロイ過程で作成せず、アプリで作成できるようにすると、アプリケーションとデプロイ プロセスの両方について、アプリで使用するコンテナーの名前を知る必要がなくなります。</span><span class="sxs-lookup"><span data-stu-id="aaa57-110">Letting your app create containers instead of doing it as part of your app's deployment eliminates the need for both your application and your deployment process to know the names of the containers the app uses.</span></span>

## <a name="exercise"></a><span data-ttu-id="aaa57-111">演習</span><span class="sxs-lookup"><span data-stu-id="aaa57-111">Exercise</span></span>

<span data-ttu-id="aaa57-112">Azure Blob Storage を使用するコードを追加して、未完成の ASP.NET Core アプリを完成させます。</span><span class="sxs-lookup"><span data-stu-id="aaa57-112">We're going to complete an unfinished ASP.NET Core app by adding code to use Azure Blob storage.</span></span> <span data-ttu-id="aaa57-113">この演習は、組織と名前付けスキームの設計についてよりも、Blob Storage API の活用方法について学習することを目的にしていますが、アプリおよびアプリでのデータ格納方法の簡単な概要を次に示します。</span><span class="sxs-lookup"><span data-stu-id="aaa57-113">This exercise is more about exploring the Blob storage API than it is about designing an organization and naming scheme, but here's a quick overview of the app and how it stores data.</span></span>

![FileUploader Web アプリのスクリーンショット](../media/4-fileuploader-with-files.PNG)

<span data-ttu-id="aaa57-115">ここで使用するアプリは共有フォルダーのように機能し、ファイルのアップロードを受け入れて、ファイルをダウンロードできるようにします。</span><span class="sxs-lookup"><span data-stu-id="aaa57-115">Our app works like a shared folder that accepts file uploads and makes them available for download.</span></span> <span data-ttu-id="aaa57-116">データベースを BLOB の整理に使用することはしません。そうではなく、アップロードされたファイルの名前をサニタイズしたうえで、BLOB 名として直接使用します。</span><span class="sxs-lookup"><span data-stu-id="aaa57-116">It doesn't use a database for organizing blobs &mdash; instead, it sanitizes the names of uploaded files and uses them as blob names directly.</span></span> <span data-ttu-id="aaa57-117">アップロードされたすべてのファイルを単一のコンテナーに格納します。</span><span class="sxs-lookup"><span data-stu-id="aaa57-117">All uploaded files are stored in a single container.</span></span>

<span data-ttu-id="aaa57-118">最初のコードはコンパイルされて実行されますが、データの格納と読み込みに関する部分は空です。</span><span class="sxs-lookup"><span data-stu-id="aaa57-118">The code we'll start with compiles and runs, but the parts responsible for storing and loading data are empty.</span></span> <span data-ttu-id="aaa57-119">コードが完了したら、アプリを Azure App Service にデプロイし、テストします。</span><span class="sxs-lookup"><span data-stu-id="aaa57-119">After we complete the code, we'll deploy the app to Azure App Service and test it.</span></span>

<span data-ttu-id="aaa57-120">アプリのストレージ インフラストラクチャを設定してみましょう。</span><span class="sxs-lookup"><span data-stu-id="aaa57-120">Let's set up the storage infrastructure for our app.</span></span>

### <a name="resource-group-and-storage-account"></a><span data-ttu-id="aaa57-121">リソース グループとストレージ アカウント</span><span class="sxs-lookup"><span data-stu-id="aaa57-121">Resource group and storage account</span></span>

<span data-ttu-id="aaa57-122">このユニットで使うすべてのリソースを格納するために、リソース グループを作成します。</span><span class="sxs-lookup"><span data-stu-id="aaa57-122">First, we'll create a resource group to contain all the resources In this unit.</span></span> <span data-ttu-id="aaa57-123">最後にそれを削除して、作成したすべてのものをクリーンアップします。</span><span class="sxs-lookup"><span data-stu-id="aaa57-123">We'll delete it at the end to cleanup everything we create.</span></span> <span data-ttu-id="aaa57-124">また、BLOB を格納するためにアプリで使用するストレージ アカウントを作成します。</span><span class="sxs-lookup"><span data-stu-id="aaa57-124">We'll also create the storage account our app will use to store blobs.</span></span>

<span data-ttu-id="aaa57-125">Azure Cloud Shell 端末を使用してリソース グループとストレージ アカウントを作成します。そのためには、次の Azure CLI コマンドを実行します。</span><span class="sxs-lookup"><span data-stu-id="aaa57-125">Use the Azure Cloud Shell terminal to create the resource group and storage account by running the following Azure CLI commands.</span></span> <span data-ttu-id="aaa57-126">ストレージ アカウントには一意の名前を付ける必要があります。後で必要になるため、名前をメモしておいてください。</span><span class="sxs-lookup"><span data-stu-id="aaa57-126">You'll need to provide a unique name for the storage account &mdash; make a note of it for later.</span></span> <span data-ttu-id="aaa57-127">場所に `eastus` を選択することは任意です。</span><span class="sxs-lookup"><span data-stu-id="aaa57-127">The choice of `eastus` for the location is arbitrary.</span></span>

```console
az group create --name blob-exercise-group --location eastus
az storage account create --name <your-unique-storage-account-name> --resource-group blob-exercise-group --location eastus --kind StorageV2
```

> [!NOTE]
> <span data-ttu-id="aaa57-128">なぜ `--kind StorageV2` なのか</span><span class="sxs-lookup"><span data-stu-id="aaa57-128">Why `--kind StorageV2`?</span></span> <span data-ttu-id="aaa57-129">ストレージ アカウントにはいくつかの異なる種類があります。</span><span class="sxs-lookup"><span data-stu-id="aaa57-129">There are a few different kinds of storage accounts.</span></span> <span data-ttu-id="aaa57-130">ほとんどのシナリオでは、汎用 v2 アカウントを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="aaa57-130">For most scenarios, you should use general-purpose v2 accounts.</span></span> <span data-ttu-id="aaa57-131">`--kind StorageV2` を明示的に指定する必要がある唯一の理由は、汎用 v2 アカウントはかなり新しく、まだ Azure Portal または Azure CLI で既定となっていないためです。</span><span class="sxs-lookup"><span data-stu-id="aaa57-131">The only reason you need to explicitly specify `--kind StorageV2` is that general-purpose v2 accounts are still fairly new and have not yet been made the default in the Azure Portal or the Azure CLI.</span></span>

### <a name="container"></a><span data-ttu-id="aaa57-132">コンテナー</span><span class="sxs-lookup"><span data-stu-id="aaa57-132">Container</span></span>

<span data-ttu-id="aaa57-133">このモジュールで操作するアプリでは、単一のコンテナーを使用しています。</span><span class="sxs-lookup"><span data-stu-id="aaa57-133">The app we'll be working with in this module uses a single container.</span></span> <span data-ttu-id="aaa57-134">ベスト プラクティスに従い、起動時にアプリでコンテナーを作成できるようにします。</span><span class="sxs-lookup"><span data-stu-id="aaa57-134">We're going to follow the best practice of letting the app create the container at startup.</span></span> <span data-ttu-id="aaa57-135">ただし、コンテナーの作成は Azure CLI から行うこともできます。マニュアルを表示するには、Cloud Shell 端末で「`az storage container create -h`」を実行します。</span><span class="sxs-lookup"><span data-stu-id="aaa57-135">However, container creation can be done from the Azure CLI: run `az storage container create -h` in the Cloud Shell terminal if you'd like to see the documentation.</span></span>