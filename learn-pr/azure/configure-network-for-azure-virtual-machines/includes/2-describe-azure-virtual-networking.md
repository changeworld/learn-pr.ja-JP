オンプレミスのデータ センターを維持する予定があるが、Azure でホストされる仮想マシン (Vm) を使用して、ピーク時のトラフィックの負荷を軽減する Azure を使用します。 すべてのデータ転送が安全であることを確認中にスキームおよびネットワーク アプライアンスをアドレス指定、既存の IP を保持するには。

## <a name="what-is-azure-virtual-networking"></a>Azure の仮想ネットワークとは何ですか。

**Azure 仮想ネットワーク**仮想マシン、web アプリ、およびとの通信に、データベースなどの Azure リソースを有効にする: インターネット、およびオンプレミスのクライアント コンピューターで、他の各ユーザーです。 Azure ネットワークは、他の Azure リソースとリンクするリソースのセットと見なすことができます。

Azure 仮想ネットワークは、主なネットワーク機能を提供します。

- 分離とセグメント化
- インターネット通信
- Azure リソース間の通信
- オンプレミス リソースとの通信
- ネットワーク トラフィックのルーティング
- ネットワーク トラフィックのフィルター処理
- 仮想ネットワークの接続

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE2yEve]

### <a name="isolation-and-segmentation"></a>分離とセグメント化

Azure では、分離された仮想ネットワークを複数作成できます。 仮想ネットワークを設定するときは、パブリックまたはプライベート IP アドレスの範囲を使用して、プライベートのインターネット プロトコル (IP) アドレス空間が定義します。 次に、その IP アドレス空間をサブネットに分割し、定義されたアドレス空間の一部をそれぞれの名前付きサブネットに割り当てることができます。

名前解決を Azure に組み込まれている名前解決サービスを使用することができます。 または内部または外部のドメイン ネーム システム (DNS) サーバーを使用して仮想ネットワークを構成することができます。

### <a name="internet-communications"></a>インターネット通信

Azure での VM は、既定では、インターネットに接続できます。 ただしに接続し、Azure CLI、リモート デスクトップ プロトコル (RDP) または Secure Shell (SSH) でその VM を制御する必要があります。 パブリック IP アドレスまたはパブリック ロード バランサーを定義することで、受信の通信を有効にできます。

### <a name="communicate-between-azure-resources"></a>Azure リソース間の通信

Azure リソースを安全に相互に通信を有効にします。 次の 2 つの方法のいずれかでこれを実現します。

- **仮想ネットワーク**
    
    だけでなく、Vm、App Service Environment、Azure の Kubernetes サービスなどの他の Azure リソースの仮想ネットワークを接続できるし、Azure の仮想マシン スケール セットします。

- **サービス エンドポイント**
     
     サービス エンドポイントは、Azure SQL データベース、ストレージ アカウントなど、他の Azure リソースの種類への接続に使用できます。 この方法を使用すると、複数の Azure リソースを仮想ネットワークにリンクすることが可能になり、セキュリティの向上とリソース間の最適なルーティングを実現できます。

### <a name="communicate-with-on-premises-resources"></a>オンプレミス リソースとの通信

Azure 仮想ネットワークでは、オンプレミス環境内と、両方のローカルにわたるネットワークを作成して Azure のサブスクリプションでリソースを相互にリンクすることを有効にして、クラウド環境。 この接続を実現するためのメカニズムが 3 つあります。

- **ポイント対サイト仮想プライベート ネットワーク**

   この方法は、それが逆の方向で動作する点を除いて、組織外のコンピューターが企業ネットワークに、仮想プライベート ネットワーク (VPN) 接続などです。 この場合、クライアント コンピューターが、そのコンピューターを Azure 仮想ネットワークに接続して、Azure への暗号化された VPN 接続を開始します。

- **サイト対サイト仮想プライベート ネットワーク**サイト対サイト VPN が、オンプレミス VPN デバイスまたは仮想ネットワークで Azure VPN ゲートウェイにゲートウェイをリンクします。 実際には、Azure 内のデバイスはローカル ネットワーク上にあるものとして表示できます。 接続が暗号化されており、インターネット経由での動作します。

- **Azure ExpressRoute**

    帯域幅が大きいとより高いレベルのセキュリティの必要がある環境では、Azure ExpressRoute は、最適なアプローチです。 Azure ExpressRoute は、インターネット経由で送信されない azure 専用プライベート接続を提供します。

### <a name="route-network-traffic"></a>ネットワーク トラフィックのルーティング

既定では、Azure のルーティングのいずれかのサブネット間のトラフィックは、仮想ネットワーク、オンプレミスのネットワークおよびインターネット接続されています。 ただし、次のようにルーティングを制御して各設定をオーバーライドできます。

- **ルート テーブル**

    ルート テーブルを使用して、トラフィックが送られるに関するルールを定義できます。 サブネット間でパケットがルーティングされる方法を制御する、カスタム ルート テーブルを作成できます。

- **ボーダー ゲートウェイ プロトコル**

    Azure VPN ゲートウェイとボーダー ゲートウェイ プロトコル (BGP) が動作するか、ExpressRoute を伝達するオンプレミスの Azure 仮想ネットワークを BGP のルート。

### <a name="filter-network-traffic"></a>ネットワーク トラフィックのフィルター処理

Azure 仮想ネットワークでは、次の方法を使用してサブネット間のトラフィックをフィルター処理できます。

- **ネットワーク セキュリティ グループ**

    ネットワーク セキュリティ グループは、複数の受信と送信セキュリティ規則を含むことのできる Azure リソースです。 送信元と送信先の IP アドレス、ポート、プロトコルなどの要素に基づいて、トラフィックを許可またはブロックする各規則を定義できます。

- **ネットワーク仮想アプライアンス**
    
    ネットワーク仮想アプライアンスは、セキュリティ強化のネットワーク アプライアンスに比較できる特殊な VM です。 ネットワーク仮想アプライアンスは、ファイアウォールを実行して、WAN の最適化を実行するなどの特定のネットワーク機能を実行します。

## <a name="connect-virtual-networks"></a>仮想ネットワークの接続

仮想ネットワークの _ピアリング_ を使用して、仮想ネットワークをリンクできます。 ピアリングを使用すると、各仮想ネットワーク内のリソースを相互に通信させることができます。 異なるリージョンに各仮想ネットワークを配置し、Azure を通じてグローバルに相互接続されたネットワークを作成できます。

## <a name="azure-virtual-network-settings"></a>Azure の仮想ネットワークの設定

作成し、ローカル コンピューター上の Azure PowerShell または Azure Cloud Shell は、Azure portal から Azure の仮想ネットワークを構成します。

### <a name="create-a-virtual-network"></a>仮想ネットワークの作成

Azure の仮想ネットワークを作成するときに、いくつかの基本的な設定を構成します。 複数のサブネット、分散型の拒否 (DDoS) のサービスの保護、およびサービス エンドポイントのなどの高度な設定を構成するオプションがあります。

![仮想ネットワークの作成の例 ブレードのフィールドを示す Azure portal のスクリーン ショット。](../media/2-create-virtual-network.PNG)

基本的な仮想ネットワークの次の設定を構成します。

- **ネットワーク名**

    ネットワーク名は、サブスクリプション内で一意である必要がありますが、全体で一意にする必要はありません。 名前は覚えやすいと他の仮想ネットワークから特定されたわかりやすいものを作成します。

- **アドレス空間**
    
    仮想ネットワークを設定するときは、Classless Inter-domain Routing (CIDR) 形式で、内部アドレス空間を定義します。 このアドレス空間は、サブスクリプションに接続する他のネットワーク内で一意である必要があります。
    
    仮定、最初の仮想ネットワークの 10.0.0.0/24 のアドレス空間を選択します。 10.0.0.1 ~ からこのアドレス空間の範囲で定義されているアドレス 10.0.0.254 します。 作成する 2 つ目の仮想ネットワークし、10.1.0.0./8 のアドレス空間を選択します。 このアドレス空間内のアドレスの範囲 10.0.0.1 ~ 10.255.255.254 までです。 アドレスの一部が重複し、2 つの仮想ネットワークは使用できません。

    ただし、アドレス 10.0.0.1 からまでの範囲を持つ、10.0.0.0/16 を使用することができます - 10.0.255.254、および 10.1.0.1 からアドレスを持つ、10.1.0.0/16 で 10.1.255.254 します。 アドレスの重複がないために、virtual network にこれらのアドレス空間を割り当てることができます。

    > [!NOTE] 
    > 仮想ネットワークを作成した後は、アドレス空間を追加できます。

- **サブスクリプション**

    複数のサブスクリプションがある場合にのみ適用されます。

- **[リソース グループ]**
    
    他の Azure リソースと同様に、仮想ネットワークは、リソース グループに存在する必要があります。 既存のリソース グループを選択するか、新しく作成できます。
    
- **場所**

    仮想ネットワークが存在する場所を選択します。

- **サブネット**
    
    各仮想ネットワークのアドレス範囲内を仮想ネットワークのアドレス空間をパーティション分割する 1 つまたは複数のサブネットを作成できます。 次に、サブネット間のルーティングは既定のトラフィックのルーティングに依存するか、またはカスタム ルートを定義できます。 または、すべての仮想ネットワークのアドレス範囲を含む 1 つのサブネットを定義できます。

    > [!NOTE]
    > サブネット名は、先頭にはアルファベットまたは数字、末尾にはアルファベット、数字、またはアンダースコアを使用する必要があります。また、使用できるのは、アルファベット、数字、アンダースコア、ピリオド、ハイフンのみです。

- **分散型サービス拒否 (DDoS) protection**

    Basic または Standard の DDoS 保護を選択することができます。 Standard の DDoS Protection はプレミアム サービスです。 [Azure DDoS Protection Standard](https://docs.microsoft.com/azure/virtual-network/ddos-protection-overview)標準の DDoS protection で詳細情報を提供します。 

- **サービス エンドポイント**
    
    ここでは、有効にするサービス エンドポイント、および有効にする Azure サービス エンドポイントの一覧から選択します。 オプションは、Azure Cosmos DB では、Azure Service Bus では、Azure Key Vault を含めるし、具合です。

これらの設定を構成したら、**[作成]** ボタンをクリックします。

### <a name="define-additional-settings"></a>追加の設定を定義します。

仮想ネットワークを作成したら、さらに追加設定を定義できます。 次に例を示します。

- **ネットワーク セキュリティ グループ**
    
    ネットワーク セキュリティ グループでは、仮想ネットワーク サブネットとネットワーク インターフェイスに出入りできるネットワーク トラフィックの種類をフィルター処理するためのセキュリティ規則があります。 別に、ネットワーク セキュリティ グループを作成してから、仮想ネットワークと関連付けること。

- **ルート テーブル**

    Azure では、Azure 仮想ネットワークのサブネットごとにルート テーブルが自動的に作成され、既定のシステム ルートがテーブルに追加されます。 ただし、カスタム ルート テーブルを追加して、仮想ネットワーク間のトラフィックを変更できます。

また、サービス エンドポイントを修正することもできます。

![仮想ネットワークの設定を編集するため、例のブレードを表示する Azure ポータルのスクリーン ショット。](../media/2-virtual-network-additional-settings.PNG)

### <a name="configure-virtual-networks"></a>仮想ネットワークを構成する

仮想ネットワークを作成したら、さらなる設定はすべて Azure Portal の [仮想ネットワーク] ブレードから変更できます。 または、変更を加える Cloud Shell で PowerShell コマンドやコマンドを使用できます。

![仮想ネットワークを構成するため、例のブレードを表示する Azure ポータルのスクリーン ショット。](../media/2-configure-virtual-network.PNG)

次に、さらなるサブ ブレードで設定の確認と変更を行うことができます。
これらの設定には、以下が含まれます。

- アドレス空間

    追加できますさらにアドレス空間、初期定義

- 接続されているデバイス

    仮想ネットワークを使用して、マシンを接続するには

- サブネット

    さらにサブネットを追加します。

- ピアリング

    配置のピアリングで仮想ネットワークをリンク

また、仮想ネットワークの監視やトラブルシューティングを行ったり、現在の仮想ネットワークを生成するために自動化スクリプトを作成したりすることもできます。

## <a name="summary"></a>まとめ

仮想ネットワークは、Azure 内のエンティティを接続するための強力なメカニズムであり、自由に構成することができます。 Azure リソースを相互に接続したり、またはオンプレミスのリソースに接続したりできます。 分離、フィルター処理して、ネットワーク トラフィックをルーティングすることができ、Azure で必要があると感じるするセキュリティを向上することができます。
