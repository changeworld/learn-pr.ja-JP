<span data-ttu-id="ae9d8-101">システムの負荷を正確に予測できることはほとんどありません。公開されているアプリケーションの負荷が急に増えたり、ビジネスの成長に伴い内部アプリケーションでサポートする必要のあるユーザー ベースが大きくなったりする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-101">It's rare that we can exactly predict the load on our system: public facing applications might grow rapidly or an internal application might need to support a larger user base as the business grows.</span></span> <span data-ttu-id="ae9d8-102">負荷を予測できる場合でも、フラットになることはあまりありません。小売りサイトは休日には需要が増え、スポーツ Web サイトはプレーオフの間にピークになります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-102">Even when we can predict load, it's rarely flat: retailers have more demand during the holidays and sports websites peak during playoffs.</span></span> <span data-ttu-id="ae9d8-103">ここでは、"_スケールアップ/スケールダウン_" と "_スケールアウト/スケールイン_" を定義し、Azure でスケーリング機能を向上させる方法を説明した後、サーバーレス技術とコンテナー技術でお使いのアーキテクチャのスケーリング機能を向上させる方法を見ていきます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-103">Here, we'll define _scaling up/down_ and _scaling out/in_, cover some ways Azure can improve your scaling capabilities, and look at how serverless and container technologies can improve your architecture's ability to scale.</span></span>

## <a name="what-is-scaling"></a><span data-ttu-id="ae9d8-104">スケーリングの対象</span><span class="sxs-lookup"><span data-stu-id="ae9d8-104">What is scaling?</span></span>

<span data-ttu-id="ae9d8-105">"_スケーリング_" とは、アプリケーションが一連のパフォーマンス要件を満たすようにリソースを管理するプロセスです。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-105">_Scaling_ is the process of managing your resources to help your application meet a set of performance requirements.</span></span>  <span data-ttu-id="ae9d8-106">ユーザーに提供するリソースが多すぎると、リソースを効率的に使用できず、コストが無駄になります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-106">When we have too many resources serving users, we won't be using it efficiently and we'll be wasting money.</span></span> <span data-ttu-id="ae9d8-107">使用できるリソースが少なすぎると、アプリケーションのパフォーマンスが低下することを意味します。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-107">Too few available resources means that the performance of our application could be impacted.</span></span> <span data-ttu-id="ae9d8-108">目標は、コストを最適化しながら、定義されているパフォーマンス要件を満たすことです。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-108">The goal is to meet our defined performance requirements while optimizing for cost.</span></span> 

<span data-ttu-id="ae9d8-109">"_リソース_" とは、アプリケーションを実行するために管理する必要のあるすべてのもののことです。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-109">"_Resources_" can refer to anything we need to manage to run our applications.</span></span> <span data-ttu-id="ae9d8-110">仮想マシンのメモリと CPU は最も明らかなリソースですが、一部の Azure サービスでは帯域幅または Cosmos DB 要求ユニットのような抽象化の考慮が必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-110">Memory and CPU for virtual machines are the most obvious resources, but some Azure services might be require you to consider bandwidth or abstractions like Cosmos DB Request Units.</span></span>

<span data-ttu-id="ae9d8-111">アプリケーションの需要が一定の世界では、必要なリソースのレベルを簡単に予測できます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-111">In a world where application demand is constant, it's easy to predict the needed level of resource.</span></span> <span data-ttu-id="ae9d8-112">現実の世界では、アプリケーションの需要は時間と共に変化するので、予測するのが困難な場合があります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-112">In the real world, the demands of our applications change over time, so it can be harder to predict.</span></span> <span data-ttu-id="ae9d8-113">運がよければその変化は予測可能であったり季節的であったりしますが、すべてのアプリケーションでそれが一般的なわけではありません。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-113">If you're lucky, then that change will be predictable or seasonal, but that is not typical of all applications.</span></span> <span data-ttu-id="ae9d8-114">需要に見合った適切な量のリソースをプロビジョニングし、需要の変化に応じて調整するのが理想的です。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-114">Ideally, you want to provision the right amount of resources to meet demand and adjust as demand changes.</span></span>

<span data-ttu-id="ae9d8-115">ユーザーが独自にサーバーを購入して管理するオンプレミスのシナリオでは、スケーリングは困難です。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-115">Scaling is difficult in an on-premises scenario, where you purchase and manage your own servers.</span></span> <span data-ttu-id="ae9d8-116">リソースを追加すると、コストがかかる場合があり、オンラインにするまでに時間がかかりすぎ、場合によっては増えた容量に対して実際に必要な時間より長くなることもあります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-116">Adding resources can be costly and often takes too much time to bring online, sometimes longer than your actual need for the increased capacity.</span></span> <span data-ttu-id="ae9d8-117">システムの需要が低下しているときに容量を減らすのが困難な場合があり、コストが増加したままの状態になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-117">It can be just as difficult to then reduce capacity during times of low-demand on the system, so you may be stuck with the increased cost.</span></span>

<span data-ttu-id="ae9d8-118">スケーリングの容易さは Azure の重要な利点です。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-118">Easy scaling is a key benefit of Azure.</span></span> <span data-ttu-id="ae9d8-119">ほとんどの Azure リソースについては需要の変化に応じてリソースを簡単に追加または削除でき、多くのサービスには要求を自動的に監視して調整するオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-119">Most Azure resources let you easily add or remove resources as demand changes, and many services have automated options so they monitor demand and adjust for you.</span></span> <span data-ttu-id="ae9d8-120">この自動的なスケーリング機能は自動スケーリングと呼ばれ、使用できる必要があるインスタンスの最小レベルと最大レベルのしきい値を設定でき、パフォーマンス メトリック (CPU 使用率など) に基づいてインスタンスが追加または削除されます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-120">This automatic scaling capability, commonly known as autoscaling, lets you set thresholds for the minimum and maximum level of instances that should be available, and will add or remove instances based upon a performance metric (for example, CPU utilization).</span></span>

## <a name="what-is-scaling-up-and-down"></a><span data-ttu-id="ae9d8-121">スケールアップおよびスケールダウンとは</span><span class="sxs-lookup"><span data-stu-id="ae9d8-121">What is scaling up and down?</span></span>

<span data-ttu-id="ae9d8-122">スケールアップとは、特定のインスタンスの容量を増やすプロセスのことです。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-122">Scaling up is the process where we increase the capacity of a given instance.</span></span> <span data-ttu-id="ae9d8-123">仮想マシンでは、1 vCPU と 3.5 GB の RAM を、2 vCPU と 7 GB の RAM に増やして、より多くの処理能力を提供することができます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-123">A virtual machine could be increased from 1 vCPU and 3.5 GB of RAM to 2 vCPUs and 7 GB of RAM to provide more processing capacity.</span></span> <span data-ttu-id="ae9d8-124">一方、スケールダウンとは、特定のインスタンスの容量を減らすプロセスのことです。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-124">On the other hand, scaling down is the process where we lower the capacity of a given instance.</span></span> <span data-ttu-id="ae9d8-125">たとえば、仮想マシンの容量を 2 vCPU と 7 GB の RAM から 1 vCPU と 3.5 GB の RAM に減らすと、容量とコストの両方が減ります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-125">For example, reducing a virtual machine's capacity from 2 vCPUs and 7 GB of RAM to 1 vCPU and 3.5 GB of RAM, reducing both capacity and cost.</span></span>

![scale-up-down](../media/ScaleUpDown.png)

<span data-ttu-id="ae9d8-127">Azure リソースのコンテキストでスケールアップ/スケールダウンがどのような意味を持つかを見ていきましょう。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-127">Let's take a look at what scaling up/down means in the context of Azure resources:</span></span>

* <span data-ttu-id="ae9d8-128">Azure 仮想マシンでは、仮想マシンのサイズに基づいてスケーリングします。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-128">In Azure virtual machines, you scale based upon a virtual machine size.</span></span> <span data-ttu-id="ae9d8-129">仮想マシンのサイズでは、一定の量の vCPU、RAM、ローカル ストレージが仮想マシンに関連付けられています。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-129">That size has a certain amount of vCPUs, RAM, and local storage associated with it.</span></span> <span data-ttu-id="ae9d8-130">たとえば、Standard_DS1_v2 の仮想マシン (1 vCPU、3.5 GB の RAM) から Standard_DS2_v2 の仮想マシン (2 vCPU、7 GB の RAM) にスケールアップできます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-130">For example, we could scale up from a Standard_DS1_v2 virtual machine (1 vCPU and 3.5 GB of RAM) to a Standard_DS2_v2 virtual machine (2 vCPUs and 7 GB of RAM).</span></span>
* <span data-ttu-id="ae9d8-131">Azure SQL Database は、Microsoft SQL Server のサービスとしてのプラットフォーム (PaaS) の実装です。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-131">Azure SQL Database is a platform as a service (PaaS) implementation of Microsoft SQL Server.</span></span>  <span data-ttu-id="ae9d8-132">データベース トランザクション ユニット (DTU) または vCPU の数に基づいて、データベースをスケールアップできます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-132">You can scale up a database based upon the number of database transaction units (DTUs) or vCPUs.</span></span> <span data-ttu-id="ae9d8-133">基になっているリソースを抽象化したものが DTU であり、CPU、IO、メモリの組み合わせです。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-133">DTUs are an abstraction of underlying resources and are a blend of CPU, IO, and memory.</span></span> <span data-ttu-id="ae9d8-134">データベース インスタンスは 500 DTU から 250 DTU にスケーリングできます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-134">You could scale your database instance from 500 DTUs to 250 DTUs.</span></span>
* <span data-ttu-id="ae9d8-135">Azure App Service は、Azure 上のサービスをホストする PaaS の Web サイトです。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-135">Azure App Service is a PaaS website hosting service on Azure.</span></span> <span data-ttu-id="ae9d8-136">Web サイトは、App Service プランとも呼ばれる仮想サーバー ファーム上で実行されます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-136">Web sites run on a virtual server farm, also known as an App Service Plan.</span></span> <span data-ttu-id="ae9d8-137">App Service プランはレベル間でスケールアップまたはスケールダウンでき、レベル内には容量のオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-137">You can scale the App Service Plan up or down between tiers and have capacity options within tiers.</span></span> <span data-ttu-id="ae9d8-138">たとえば、S1 App Service プランでは、インスタンスごとに 1 vCPU と 1.75 GB RAM です。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-138">For example, an S1 app service plan has 1 vCPU and 1.75 GB of RAM per instance.</span></span> <span data-ttu-id="ae9d8-139">これを、インスタンスごとに 2 vCPU と 3 GB RAM の S2 App Service プランにスケールアップできます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-139">We could scale up to an S2 app service plan, which has 2 vCPUs and 3 GB of RAM per instance.</span></span>

<span data-ttu-id="ae9d8-140">オンプレミス環境でこれらの機能を利用するには、通常、必要なハードウェアを購入してインストールするまで待ってからでないと、新しいレベルのスケールを使用できません。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-140">To have these capabilities in an on-premises environment you would typically have to wait for procurement of the needed hardware and installation before you can start using the new level of scale.</span></span> <span data-ttu-id="ae9d8-141">Azure では、物理リソースは既にデプロイされて利用できるようになっているので、必要なのは使用する代わりのスケール レベルを選択することだけです。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-141">In Azure, the physical resources are already deployed and available for you, you simply need to select the alternate level of scale that you are looking to use.</span></span>

<span data-ttu-id="ae9d8-142">選択したクラウド サービスによっては、お使いのソリューションでのスケールアップの影響を考慮することが必要になります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-142">You may need to consider the impact of scaling up in your solution, depending upon the cloud services that you have chosen.</span></span>

<span data-ttu-id="ae9d8-143">たとえば、Azure SQL Database でのスケールアップを選択した場合、サービスによって個々のノードのスケールアップが処理され、サービスの操作は続行されます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-143">For example, if you choose to scale up in Azure SQL Database, then the service deals with scaling up individual nodes and continues the operation of your service.</span></span> <span data-ttu-id="ae9d8-144">データベースのサービス レベルやパフォーマンス レベルを変更すると、新しいパフォーマンス レベルで元のデータベースのレプリカが作成され、接続先がそのレプリカに切り替えられます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-144">Changing the service tier and/or performance level of a database creates a replica of the original database at the new performance level, and then switches connections over to the replica.</span></span> <span data-ttu-id="ae9d8-145">このプロセスの間にデータが失われることはなく、サービスがレプリカに切り替わるときに短い中断 (通常は 4 秒未満) があるだけです。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-145">No data is lost during this process and there's only a brief interruption (typically less than four seconds) when the service switches over to the replica.</span></span>

<span data-ttu-id="ae9d8-146">代わりに、仮想マシンをスケールアップまたはスケールダウンする場合は、異なるインスタンス サイズを選択することで行います。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-146">Alternatively, if you choose to scale up or down a virtual machine, you do so by selecting a different instance size.</span></span> <span data-ttu-id="ae9d8-147">ほとんどの場合、これには VM の再起動が必要なので、再起動が必要なものと想定するのが最善であり、この作業を行うときはそれを見込んでおく必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-147">In most cases this requires a restart of the VM, so best to have the expectation that a reboot will be required and you'll need to account for when performing this activity.</span></span>

<span data-ttu-id="ae9d8-148">最後に、スケールダウンが可能な場所を常に探すようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-148">Finally, you should always look for places where scaling down is an option.</span></span> <span data-ttu-id="ae9d8-149">もっと低い価格レベルでもアプリケーションが十分なパフォーマンスを提供できる場合、Azure の料金を大幅に削減できる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-149">If your application can provide adequate performance at a lower price tier, your Azure bill could be significantly reduced.</span></span>

## <a name="what-is-scaling-out-and-in"></a><span data-ttu-id="ae9d8-150">スケールアウトおよびスケールインとは</span><span class="sxs-lookup"><span data-stu-id="ae9d8-150">What is scaling out and in?</span></span>

<span data-ttu-id="ae9d8-151">スケールアップとスケールダウンが 1 つのインスタンスで使用可能なリソースの量を調整することであるのに対し、スケールアウトとスケールインはインスタンスの総数を調整することです。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-151">Where scaling up and down adjusts the amount of resources a single instance has available, scaling out and in adjusts the total number of instances.</span></span>

<span data-ttu-id="ae9d8-152">"_スケール アウト_" とは、ソリューションの負荷をサポートするためにインスタンスを追加するプロセスです。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-152">_Scaling out_ is the process of adding more instances to support the load of your solution.</span></span> <span data-ttu-id="ae9d8-153">たとえば、Web サイトのフロントエンドが仮想マシンでホストされている場合、負荷のレベルが上がった場合は仮想マシンの数を増やすことができます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-153">For example, if our website frontend was hosted on virtual machines, then we could increase the number of virtual machines if the level of load increased.</span></span>

<span data-ttu-id="ae9d8-154">"_スケールイン_" とは、ソリューションの負荷をサポートするために必要なくなったインスタンスを削除するプロセスです。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-154">_Scaling in_ is the process of removing instances that are no longer needed to support the load of your solution.</span></span> <span data-ttu-id="ae9d8-155">Web サイトのフロントエンドの使用率が低い場合は、インスタンスの数を減らしてコストを削減できます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-155">If the website front ends have low usage, then we may want to lower the number of instances to save cost.</span></span>


![scale-in-out](../media/ScaleInOut.png)

<span data-ttu-id="ae9d8-157">Azure リソースのコンテキストでのスケールアウト/スケールインの意味についていくつかの例を示します。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-157">Here are some examples of what scaling out/in means in the context of Azure resources:</span></span>

* <span data-ttu-id="ae9d8-158">インフラストラクチャ レイヤーでは、仮想マシン スケール セットを使用してインスタンスの追加と削除を自動化できます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-158">For the infrastructure layer, you would likely use virtual machine scale sets to automate the addition and removal of extra instances.</span></span>
  * <span data-ttu-id="ae9d8-159">仮想マシン スケール セットでは、同一の負荷分散された VM のグループを作成して管理できます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-159">Virtual machine scale sets let you create and manage a group of identical, load balanced VMs.</span></span>
  * <span data-ttu-id="ae9d8-160">需要または定義されたスケジュールに応じて、VM インスタンスの数を自動的に増減させることができます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-160">The number of VM instances can automatically increase or decrease in response to demand or a defined schedule.</span></span>
* <span data-ttu-id="ae9d8-161">Azure SQL Database の実装では、シャーディングによってデータベース インスタンス間に負荷を分散させることができます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-161">In an Azure SQL Database implementation, you could share the load across database instances by sharding.</span></span> <span data-ttu-id="ae9d8-162">"_シャーディング_" とは、同じ構造を持つ大量のデータを複数の独立したデータベースに分散する手法です。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-162">_Sharding_ is a technique to distribute large amounts of identically structured data across a number of independent databases.</span></span>
* <span data-ttu-id="ae9d8-163">Azure App Service では、App Service プランはコンテンツをホストする仮想 Web サーバー ファームです。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-163">In Azure App Service, the App Service Plan is the virtual web server farm hosting your content.</span></span> <span data-ttu-id="ae9d8-164">この方法でのスケールアウトは、ファーム内の仮想マシンの数を増やすことを意味します。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-164">Scaling out in this way means that you're increasing the number of virtual machines in the farm.</span></span> <span data-ttu-id="ae9d8-165">仮想マシン スケール セットと同様に、メトリックまたはスケジュールに応じてインスタンスの数を自動的に増減できます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-165">As with virtual machine scale sets, the number of instances can be automatically raised or lowered in response to certain metrics or a schedule.</span></span>

<span data-ttu-id="ae9d8-166">通常は、Azure portal、コマンド ライン ツール、または Resource Manager テンプレートを使用してスケールアウトを簡単に実行でき、ほとんどの場合はエンド ユーザーが気付くことはありません。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-166">Scaling out is typically easily performed in the Azure portal, command-line tools or Resource Manager templates, and in most cases is seamless to the end user.</span></span>

### <a name="autoscale"></a><span data-ttu-id="ae9d8-167">自動スケーリング</span><span class="sxs-lookup"><span data-stu-id="ae9d8-167">Autoscale</span></span>

<span data-ttu-id="ae9d8-168">自動スケーリングと呼ばれる機能を使用するように、これらのサービスの一部を構成できます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-168">You can configure some of these services to use a feature called autoscale.</span></span> <span data-ttu-id="ae9d8-169">自動スケーリングを使用すると、サービスを手動でスケーリングする必要はなくなります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-169">With autoscale you no longer have to worry about scaling services manually.</span></span> <span data-ttu-id="ae9d8-170">代わりに、インスタンス数の最小と最大のしきい値を設定し、特定のメトリック (キューの長さ、CPU 使用率など) またはスケジュール (平日午後 5 時から午後 7 時の間など) に基づいてスケーリングできます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-170">Instead, you can set a minimum and maximum threshold of instances and scale based upon specific metrics (queue length, CPU utilization) or schedules (weekdays between 5:00 PM and 7:00 PM).</span></span>

![自動スケーリング](../media/autoscale.png)

### <a name="considerations-when-scaling-in-and-out"></a><span data-ttu-id="ae9d8-172">スケールインおよびスケールアウトを行うときの考慮事項</span><span class="sxs-lookup"><span data-stu-id="ae9d8-172">Considerations when scaling in and out</span></span>

<span data-ttu-id="ae9d8-173">スケールアウトでは、アプリケーションの起動時間がアプリケーションをスケーリングできる速さに影響する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-173">When scaling out, the startup time of your application can impact how quickly your application can scale.</span></span> <span data-ttu-id="ae9d8-174">Web アプリを起動してからユーザーが使用できるようになるまでに 2 分かかる場合は、ユーザーが各インスタンスを使用できるようになるのに 2 分かかることを意味します。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-174">If your web app takes two minutes to start up and be available for users, that means each of your instances will take two minutes until they are available to your users.</span></span> <span data-ttu-id="ae9d8-175">スケーリングの速さを決めるときは、この起動時間を考慮します。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-175">You'll want to take this startup time into consideration when determining how fast you want to scale.</span></span>

<span data-ttu-id="ae9d8-176">また、アプリケーションが状態を処理する方法についても考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-176">You'll also need to think about how your application handles state.</span></span> <span data-ttu-id="ae9d8-177">アプリケーションをスケールインすると、マシンに格納されているすべての状態は使用できなくなります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-177">When the application scales in, any state stored on the machine is no longer available.</span></span> <span data-ttu-id="ae9d8-178">状態を持たないインスタンスにユーザーが接続する場合、サインインまたはデータの再選択を強制され、ユーザー エクスペリエンスが低下する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-178">If a user connects to an instance that doesn't have its state, it could force them to sign in, or re-select data, leading to a poor user experience.</span></span> <span data-ttu-id="ae9d8-179">一般的なパターンでは、Redis Cache や SQL Database などの別のサービスに状態を外部化し、Web サーバーをステートレスにします。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-179">A common pattern is to externalize state to another service like Redis Cache or SQL Database, making your web servers stateless.</span></span> <span data-ttu-id="ae9d8-180">これで Web フロントエンドはステートレスになり、個々のインスタンスが使用可能であることを心配する必要はなくなります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-180">Now that our web front ends are stateless we don't need to worry about which individual instances are available.</span></span> <span data-ttu-id="ae9d8-181">すべてのインスタンスは同じジョブを実行し、同じ方法で展開されます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-181">They are all doing the same job and are deployed in the same way.</span></span>

## <a name="throttling"></a><span data-ttu-id="ae9d8-182">調整</span><span class="sxs-lookup"><span data-stu-id="ae9d8-182">Throttling</span></span>

<span data-ttu-id="ae9d8-183">アプリケーションの負荷は時間と共に変わることを示しました。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-183">We've established that the load on an application will vary over time.</span></span> <span data-ttu-id="ae9d8-184">その原因は、アクティブなユーザーや同時実行ユーザーおよび実行されているアクティビティの数である場合があります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-184">This may be due to the number of active or concurrent users and the activities being performed.</span></span> <span data-ttu-id="ae9d8-185">自動スケーリングを使用して容量を追加できますが、調整メカニズムを使用してソースからの要求の数を制限することもできます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-185">While we could use autoscaling to add capacity, we could also use a throttling mechanism to limit the number of requests from a source.</span></span> <span data-ttu-id="ae9d8-186">アプリケーション レベルで既知の制限を設定することによってパフォーマンスの限界を保護し、アプリケーションが壊れるのを防ぐことができます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-186">We can safeguard performance limits by putting known limits into place at the application level, preventing the application from breaking.</span></span> <span data-ttu-id="ae9d8-187">調整が最もよく使用されるのは、API エンドポイントを公開しているアプリケーションです。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-187">Throttling is most frequently used in applications exposing API endpoints.</span></span>

<span data-ttu-id="ae9d8-188">アプリケーションが制限を超えることがわかったら、調整を開始して、システムの全体的な SLA が確実に損なわれないようにすることができます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-188">Once the application has identified that it would breach a limit, throttling could begin and ensure the overall system SLA isn't breached.</span></span> <span data-ttu-id="ae9d8-189">たとえば、顧客がデータを取得するための API を公開する場合は、1 分あたり 100 個の要求に制限するといったことができます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-189">For example, if we exposed an API for customers to get data, we could limit the number of requests to 100 per minute.</span></span> <span data-ttu-id="ae9d8-190">ある 1 人の顧客がこの制限を超えた場合、HTTP 429 状態コードで応答し、別の要求を正常に送信できるようになるまでに待機時間を設けることができます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-190">If any single customer exceeded this limit, we could respond with an HTTP 429 status code, including the wait time before another request can successfully be submitted.</span></span>

## <a name="serverless"></a><span data-ttu-id="ae9d8-191">サーバーレス</span><span class="sxs-lookup"><span data-stu-id="ae9d8-191">Serverless</span></span>

<span data-ttu-id="ae9d8-192">サーバーレス コンピューティングとは、ユーザーのアプリを実行するクラウドでホストされた実行環境ですが、基になる環境が完全に抽象化されています。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-192">Serverless computing provides a cloud-hosted execution environment that runs your apps but completely abstracts the underlying environment.</span></span> <span data-ttu-id="ae9d8-193">サービスのインスタンスを作成して、コードを追加します。インフラストラクチャを管理またはメンテナンスする必要はありませんが、許可されていることもあります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-193">You create an instance of the service, and you add your code; no infrastructure management or maintenance is required, or even allowed.</span></span>

<span data-ttu-id="ae9d8-194">イベントに応答するようにサーバーレス アプリを構成します。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-194">You configure your serverless apps to respond to events.</span></span> <span data-ttu-id="ae9d8-195">REST エンド ポイント、タイマー、別の Azure サービスから受信したメッセージなどのイベントがあります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-195">This could be a REST end point, a timer, or a message received from another Azure service.</span></span> <span data-ttu-id="ae9d8-196">イベントでトリガーされた場合にのみ、サーバーレス アプリが実行されます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-196">The serverless app runs only when it's triggered by an event.</span></span>

<span data-ttu-id="ae9d8-197">ユーザーにはインフラストラクチャに関する責任はありません。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-197">Infrastructure isn't your responsibly.</span></span> <span data-ttu-id="ae9d8-198">スケーリングとパフォーマンスは自動的に処理され、使用した正確なリソースに対してのみ課金されます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-198">Scaling and performance are handled automatically, and you are billed only for the exact resources you use.</span></span> <span data-ttu-id="ae9d8-199">容量を予約する必要さえありません。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-199">There's no need to even reserve capacity.</span></span> <span data-ttu-id="ae9d8-200">Azure で利用できるサーバーレス コンピューティングの例としては、Azure Functions、Azure Container Instances、Logic Apps などがあります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-200">Azure Functions, Azure Container Instances, and Logic Apps are examples of serverless computing available on Azure.</span></span>

<span data-ttu-id="ae9d8-201">Lamna Healthcare の例を再び見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-201">Let's revisit the Lamna Healthcare example.</span></span> <span data-ttu-id="ae9d8-202">コストを削減して管理を容易にできる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-202">There could be some potential for cost saving and ease of management.</span></span> <span data-ttu-id="ae9d8-203">API エンドポイントについて検討します。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-203">Consider an API endpoint.</span></span> <span data-ttu-id="ae9d8-204">予約された容量に対して支払う必要がある Azure App Service で API をホストするのではなく、HTTP 要求によってトリガーされる Azure 関数アプリを使用できます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-204">Instead of hosting the API in Azure App Service where they must pay for reserved capacity, they could use an Azure Function App triggered by an HTTP request.</span></span> <span data-ttu-id="ae9d8-205">Azure 関数を使用すると、チームは各トランザクションの処理に必要なリソースに対して支払うだけで済みます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-205">Azure functions would enable the team to only pay for the resources required to process each transactions.</span></span> <span data-ttu-id="ae9d8-206">コストとスケールは、システム内のトランザクションの数に直接対応するようになります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-206">The cost and scale would be directly in line with the number of transactions in the system.</span></span>

## <a name="containers"></a><span data-ttu-id="ae9d8-207">コンテナー</span><span class="sxs-lookup"><span data-stu-id="ae9d8-207">Containers</span></span>

<span data-ttu-id="ae9d8-208">コンテナーとは、仮想化された環境でアプリケーションを実行する方法です。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-208">A container is a method running applications in a virtualized environment.</span></span> <span data-ttu-id="ae9d8-209">仮想マシンはハードウェア レベルで仮想化されており、ハイパーバイザーによって 1 台の物理サーバーで複数の仮想化されたオペレーティング システムを実行できます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-209">A virtual machine is virtualized at the hardware level, where a hypervisor makes it possible to run multiple virtualized operating systems on a single physical server.</span></span> <span data-ttu-id="ae9d8-210">コンテナーによって仮想化はレベルアップされて OS レベルで行われるようになり、同じ OS 内で複数の同じアプリケーション インスタンスを実行できます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-210">Containers take the virtualization up a level, the virtualization is done at the OS level, making it possible to run multiple identical application instances within the same OS.</span></span>

<span data-ttu-id="ae9d8-211">コンテナーは、スケールアウトのシナリオに適してします。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-211">Containers are well suited to scale out scenarios.</span></span> <span data-ttu-id="ae9d8-212">コンテナーは軽量になるように意図され、環境や需要の変化に応じて動的に作成、スケールアウト、停止されるように設計されています。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-212">They are meant to be lightweight and are designed to be created, scaled out, and stopped dynamically as environment and demand change.</span></span>

<span data-ttu-id="ae9d8-213">コンテナーを使用する利点は、複数の独立したアプリケーションを各仮想マシンで実行できることです。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-213">A benefit of using containers is the ability to run multiple isolated applications on each virtual machine.</span></span> <span data-ttu-id="ae9d8-214">コンテナー自体がカーネル レベルでセキュリティ保護されて分離されるため、異なるワークロードごとに VM を分ける必要は必ずしもありません。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-214">Since containers themselves are secured and isolated at a kernel level, you don't necessarily need separate VMs for separate workloads.</span></span>

<span data-ttu-id="ae9d8-215">仮想マシンでコンテナーを実行できますが、コンテナーの管理とスケーリングを容易にすることを目的とする 2 つの Azure サービスがあります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-215">While you can run containers on virtual machines, there are a couple of Azure services that focus on easing the management and scaling of containers:</span></span>

* <span data-ttu-id="ae9d8-216">**Azure Kubernetes Service (AKS)**</span><span class="sxs-lookup"><span data-stu-id="ae9d8-216">**Azure Kubernetes Service (AKS)**</span></span>

  <span data-ttu-id="ae9d8-217">Azure Kubernetes Service を使用すると、ノードとして機能するように仮想マシンを設定できます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-217">Azure Kubernetes Service allows you to set up virtual machines to act as your nodes.</span></span> <span data-ttu-id="ae9d8-218">Azure によって Kubernetes の管理プレーンがホストされ、コンテナーをホストする実行している worker ノードに対してのみ課金されます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-218">Azure hosts the Kubernetes management plane and only bills for the running worker nodes that host your containers.</span></span>

  <span data-ttu-id="ae9d8-219">Azure 内の worker ノードの数は、Azure CLI を使用して手動で増やすことができます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-219">To increase the number of your worker nodes in Azure, you could use the Azure CLI to increase that manually.</span></span> <span data-ttu-id="ae9d8-220">この記事を書いている時点で、worker ノードの自動スケーリングを可能にするプレビュー機能の Cluster Autoscaler を AKS で使用できます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-220">At time of writing, there is a preview of Cluster Autoscaler on AKS available that enables autoscaling of your worker nodes.</span></span> <span data-ttu-id="ae9d8-221">Kubernetes クラスターでは、Horizontal Pod Autoscaler を使用して、展開されるコンテナーのインスタンスの数をスケールアウトできます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-221">On your Kubernetes cluster, you could use the Horizontal Pod Autoscaler to scale out the number of instances of the container to be deployed.</span></span>

  <span data-ttu-id="ae9d8-222">次に説明する Virtual Kubelet を使用して AKS をスケーリングすることもできます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-222">AKS can also scale with the Virtual Kubelet described below.</span></span>

* <span data-ttu-id="ae9d8-223">**Azure Container Instances (ACI)**</span><span class="sxs-lookup"><span data-stu-id="ae9d8-223">**Azure Container Instances (ACI)**</span></span>
  
  <span data-ttu-id="ae9d8-224">Azure Container Instances はサーバーレス アプローチであり、オンデマンドでコンテナーを作成して実行できます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-224">Azure Container Instances is a serverless approach that lets you create and execute containers on-demand.</span></span> <span data-ttu-id="ae9d8-225">1 秒あたりの実行時間に対してのみ課金されます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-225">You're charged only for the execution time per second.</span></span>

  <span data-ttu-id="ae9d8-226">Virtual Kubelet を使用して、AKS などの Kubernetes 環境に Azure Container Instances を接続できます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-226">You can use Virtual Kubelet to connect Azure Container Instances into your Kubernetes environment, including AKS.</span></span> <span data-ttu-id="ae9d8-227">Virtual Kubelet では、Kubernetes クラスターでさらに多くのコンテナー インスタンスが必要になったときは、ACI で要求を満たすことができます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-227">With Virtual Kubelet, when your Kubernetes cluster demands additional container instances, those demands can be met from ACI.</span></span> <span data-ttu-id="ae9d8-228">ACI はサーバーレスであるため、容量を予約する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-228">Since ACI is serverless, there is no need to have reserved capacity.</span></span> <span data-ttu-id="ae9d8-229">そのため、サーバーレスの 1 秒あたりの課金で、Kubernetes の制御と柔軟性を利用できます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-229">You can therefore take advantage of the control and flexibility of Kubernetes scaling with the per-second-billing of serverless.</span></span> <span data-ttu-id="ae9d8-230">この記事を書いている時点では、Virtual Kubelet は実験的なソフトウェアと説明されており、運用シナリオでは使用できません。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-230">At time of writing, the Virtual Kubelet is described as experimental software and should not be used in production scenarios.</span></span>

## <a name="scaling-at-lamna-healthcare"></a><span data-ttu-id="ae9d8-231">Lamna Healthcare でのスケーリング</span><span class="sxs-lookup"><span data-stu-id="ae9d8-231">Scaling at Lamna Healthcare</span></span>

<span data-ttu-id="ae9d8-232">Lamna Healthcare では患者管理および予約システムが運用されています。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-232">Lamna Healthcare operates a patient management and booking system.</span></span> <span data-ttu-id="ae9d8-233">管理システムでは、数十の病院および医療施設における予定の予約と患者のレコードが処理されます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-233">The management system handles appointment bookings and patient records across dozens of hospitals and medical facilities.</span></span> <span data-ttu-id="ae9d8-234">ローカル ヘルス サービスは最大能力で実行されており、現時点で拡張は予定されていません。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-234">The local health service is running at full capacity and no growth is expected at the moment.</span></span> <span data-ttu-id="ae9d8-235">システムは、Azure App Service でホストされる PHP Web サイトで実行されています。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-235">The system is running on a PHP Website hosted in Azure App Service.</span></span>

<span data-ttu-id="ae9d8-236">主に使用されるのは月曜日から金曜日までの 9 時から 5 時の間であるため、アプリケーションの負荷パターンは予測可能です。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-236">The load pattern of the application is predictable, as they primarily operate Monday to Friday between the hours of 9 to 5.</span></span>  <span data-ttu-id="ae9d8-237">火曜日から金曜日までは、システム全体で平均して 1 時間あたり 1,200 トランザクションを処理します。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-237">From Tuesday through to Friday, the system averages at 1,200 transactions per hour across the entire system.</span></span> <span data-ttu-id="ae9d8-238">週末は、1 時間あたり 500 件のトランザクションを処理します。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-238">During the weekend, it handles 500 transactions per hour.</span></span> <span data-ttu-id="ae9d8-239">処理量が少ない週末の後、月曜日には 1 時間あたりのトランザクション数が平均 2,000 に増えます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-239">After the quiet of the weekend, Mondays are busy with an average of 2,000 transactions per hour.</span></span>

<span data-ttu-id="ae9d8-240">アプリケーションは S1 App Service プランでホストされていますが、運用チームはすべてのインスタンスで CPU 使用率が高レベル (95% 以上) であることに気付いています。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-240">The application is hosted on an S1 App Service Plan, but the operations team have noticed a high level of CPU utilization (over 95%) across all instances.</span></span> <span data-ttu-id="ae9d8-241">高い使用率により、アプリケーションの処理と読み込みの時間が影響を受けています。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-241">The high usage is having an impact on the processing and loading times of the application.</span></span> <span data-ttu-id="ae9d8-242">クラウド環境では、リソースの使用率が高いのは必ずしも悪いことではありません。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-242">In a cloud environment, having highly utilized resources is not necessarily a bad thing.</span></span> <span data-ttu-id="ae9d8-243">展開されているリソースが十分に使用されているので、コストに見合う価値を得ていることを意味します。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-243">It means that they are getting value for their money, as the resources deployed are being well used.</span></span> 

<span data-ttu-id="ae9d8-244">チームは、展開されているインスタンスの App Service プランのレベルを S1 (1 vCPU、1.75 GB の RAM) から S2 (2 vCPU、3 GB の RAM) に "_スケールアップ_" することを決定しています。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-244">The team decide to _scale up_ the App Service Plan level for the deployed instances from S1 (1 vCPU and 1.75 GB of RAM) to S2 (2 vCPUs and 3 GB of RAM).</span></span> <span data-ttu-id="ae9d8-245">Azure portal を使用してこれを簡単に実現できますが、Azure CLI の 1 つのコマンド、Azure PowerShell、または Resource Manager テンプレートを使用して、同じことを実現することもできます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-245">They easily achieve this using the Azure portal, but could have achieved the same thing using a single command in the Azure CLI, Azure PowerShell, or using Resource Manager templates.</span></span>

<span data-ttu-id="ae9d8-246">チームは、負荷プロファイルが予測可能であるため、展開されるインスタンスの数をスケジュールに基づいて自動化することにします。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-246">The team decide that they want to automate the number of instances deployed based upon a schedule, as their load profile is predictable.</span></span> <span data-ttu-id="ae9d8-247">チームは、App Service プランの自動スケーリングのスケジュールを構成します。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-247">They configure the app service plan's autoscale schedule.</span></span> <span data-ttu-id="ae9d8-248">1 時間あたり 500 件のトランザクションを処理するには 2 つのインスタンスで十分であるものと仮定します。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-248">Let's assume two instances sufficiently handle 500 transactions per hour.</span></span> <span data-ttu-id="ae9d8-249">そうすると、火曜日から金曜日までは 6 インスタンス、月曜日は 8 インスタンスにスケーリングすると要件を満たすことができます (分析情報とロード テストの監視に基づきます)。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-249">The team could then scale to six instances for Tuesday - Friday and eight instances for a Monday to meet the requirements (based upon insight and monitoring from load tests).</span></span>

<span data-ttu-id="ae9d8-250">自動スケーリングには、次のような予測できないシナリオに対応できるメリットもあります。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-250">Autoscale also gives them an added benefit, preparing for those unforeseen scenarios.</span></span> <span data-ttu-id="ae9d8-251">週末にサイトの負荷が予想以上に急増する可能性があります (冬期の風邪やインフルエンザによる予約の増加)。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-251">The site may suddenly take higher than expected load on the weekend (more appointments in the winter season because of colds and flu).</span></span> <span data-ttu-id="ae9d8-252">チームは、CPU 使用率が 90% を超えたらインスタンスを 1 つ増やし、使用率が 15% を下回ったらインスタンスを 1 つ減らすように、自動スケーリングを設定できます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-252">The team can set up autoscale to increase by one instance when CPU percentage is above 90% and reduce by one instance when usage is below 15%.</span></span>

<span data-ttu-id="ae9d8-253">チームは、Azure API Management インスタンスの背後で公開している患者予約 API の内部で調整パターンを使用しています。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-253">The team have used the throttling pattern inside of the patient booking API they have exposed behind an Azure API Management instance.</span></span> <span data-ttu-id="ae9d8-254">これにより、一定の量のスループットだけがシステムを通過できるようにすることで、システムのパフォーマンス低下を防ぐことができます。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-254">This helps prevent the system from performing poorly by only allowing a certain volume of throughput through the system.</span></span>

## <a name="summary"></a><span data-ttu-id="ae9d8-255">まとめ</span><span class="sxs-lookup"><span data-stu-id="ae9d8-255">Summary</span></span>

<span data-ttu-id="ae9d8-256">スケールアップとスケールダウン、スケールインとスケールアウト、そしてアーキテクチャでこれらのオプションを使用する方法について説明しました。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-256">We've talked about scaling up and down and scaling in and out, and how you can leverage these options in your architecture.</span></span> <span data-ttu-id="ae9d8-257">また、サーバーレス テクノロジとコンテナーがスケーリング機能の向上にどのように役立つかについても説明しました。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-257">We've also looked at how serverless technologies and containers can help evolve your scaling capabilities.</span></span> <span data-ttu-id="ae9d8-258">次に、ネットワークのパフォーマンスがアプリケーションに与える影響と、ネットワークを最適化できるさまざまな方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="ae9d8-258">Next, we'll take a look at how network performance can impact your application, and different ways we can optimize the network.</span></span>