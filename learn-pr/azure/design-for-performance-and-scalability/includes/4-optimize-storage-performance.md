<span data-ttu-id="c4ebf-101">アーキテクチャにストレージのパフォーマンスに関する考慮事項を含めることが重要です。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-101">It's important to include storage performance considerations in your architecture.</span></span> <span data-ttu-id="c4ebf-102">ネットワーク待ち時間と同じように、ストレージ レイヤーでのパフォーマンスの低下は、エンドユーザー エクスペリエンスに影響します。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-102">Just like network latency, poor performance at the storage layer can impact your end-users experience.</span></span> <span data-ttu-id="c4ebf-103">データ ストレージを最適化するには、どうすればよいでしょうか。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-103">How would you optimize your data storage?</span></span> <span data-ttu-id="c4ebf-104">アーキテクチャ内でストレージのボトルネックが発生しないことを確保するために、考慮する必要があることは何でしょうか?</span><span class="sxs-lookup"><span data-stu-id="c4ebf-104">What things do you need to consider to ensure that you're not introducing storage bottlenecks into your architecture?</span></span> <span data-ttu-id="c4ebf-105">ここでは、使用するアーキテクチャにおけるストレージのパフォーマンスを最適化する方法を考えます。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-105">Here, we'll take a look at how to optimize your storage performance in your architecture.</span></span>

## <a name="optimize-virtual-machine-storage-performance"></a><span data-ttu-id="c4ebf-106">仮想マシンのストレージのパフォーマンスを最適化する</span><span class="sxs-lookup"><span data-stu-id="c4ebf-106">Optimize virtual machine storage performance</span></span>

<span data-ttu-id="c4ebf-107">最初に仮想マシンのストレージの最適化を見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-107">Let's first take a look at optimizing storage for virtual machines.</span></span> <span data-ttu-id="c4ebf-108">ディスク ストレージは、仮想マシンのパフォーマンスにおいて重要な役割を果たします。そのため、アプリケーションに適したディスクの種類を選択することが、重要な決定事項になります。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-108">Disk storage plays a critical role in the performance of your virtual machines, and selecting the right disk type for your application in an important decision.</span></span>

<span data-ttu-id="c4ebf-109">アプリケーションが異なれば、ストレージの要件も異なります。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-109">Different applications are going to have different storage requirements.</span></span> <span data-ttu-id="c4ebf-110">アプリケーションで読み取りと書き込みの待ち時間が重視される場合もあれば、高い数値の IOPS (1 秒あたりの入力/出力操作回数) を処理する能力が求められたり、全体的なスループットを上げることが求められたりする場合もあります。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-110">Your application may be sensitive to latency of disk reads and writes or it may require the ability to handle a large number of input/output operations per second (IOPS) or greater overall disk throughput.</span></span>

<span data-ttu-id="c4ebf-111">IaaS のワークロードを構築する場合、どの種類のディスクを使用する必要がありますか。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-111">When building an IaaS workload, which type of disk should you use?</span></span> <span data-ttu-id="c4ebf-112">4 つのオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-112">There are four options:</span></span>

* <span data-ttu-id="c4ebf-113">**ローカル SSD ストレージ** - 各 VM には、ローカル SSD ストレージを使用した一時ディスクがあります。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-113">**Local SSD storage** - Each VM has a temporary disk that is backed by local SSD storage.</span></span> <span data-ttu-id="c4ebf-114">このサイズは、仮想マシンのサイズによって異なります。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-114">The size of this varies depending on the size of the virtual machine.</span></span> <span data-ttu-id="c4ebf-115">このディスクはローカル SSD であるため高パフォーマンスですが、メンテナンス イベントや VM の再デプロイ時にデータが失われる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-115">Since this disk is local SSD, the performance is high, but data may be lost during a maintenance event or a redeployment of the VM.</span></span> <span data-ttu-id="c4ebf-116">このディスクは、永続的に必要なデータではないデータの一時的なストレージとしての用途にのみ、適しています。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-116">This disk is only suitable for temporary storage of data that you do not need permanently.</span></span> <span data-ttu-id="c4ebf-117">このディスクは、ページ ファイル、スワップ ファイル、SQL Server 内の tempdb のような用途に適しています。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-117">This disk is great for the page or swap file, and for things like tempdb in SQL Server.</span></span> <span data-ttu-id="c4ebf-118">このストレージに対する料金は発生しません。VM の料金に含まれています。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-118">There is no charge for this storage, it's included in the cost of the VM.</span></span>

* <span data-ttu-id="c4ebf-119">**Standard Storage HDD** - これはスピンドル ディスク ストレージであり、一貫しない待ち時間や低水準のスループットによってアプリケーションが制約されない場合に、高い適合性があります。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-119">**Standard storage HDD** - This is spindle disk storage and may fit well where your application is not bound by inconsistent latency or lower levels of throughput.</span></span> <span data-ttu-id="c4ebf-120">パフォーマンスを保証する必要がない開発/テスト ワークロードは、このディスクの種類に適した用途です。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-120">A dev/test workload where guaranteed performance isn't needed is a great use case for this disk type.</span></span>

* <span data-ttu-id="c4ebf-121">**Standard Storage SSD** - これは SSD を使用したストレージであり、SSD と同じで待ち時間が少ない一方、スループットは低水準です。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-121">**Standard storage SSD** - This is SSD backed storage and has the low latency of SSD but lower levels of throughput.</span></span> <span data-ttu-id="c4ebf-122">非運用環境の Web サーバーは、このディスクの種類に適したユース ケースです。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-122">A non-production webserver would be good use case for this disk type.</span></span>

* <span data-ttu-id="c4ebf-123">**Premium Storage SSD** - SSD を使用したこのストレージは、運用環境に発生するワークロード、最大限の信頼性と需要に対する一貫した短い待ち時間が要求されるワークロード、または高水準のスループットと IOPS が要求されるワークロードに適しています。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-123">**Premium storage SSD** - This SSD backed storage is well-suited for those workloads that are going into production, require the greatest reliability and demand consistent low latency or need high levels of throughput and IOPS.</span></span> <span data-ttu-id="c4ebf-124">パフォーマンスと信頼性の高い機能を備えているため、すべての運用ワークロード用にお勧めします。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-124">Since these have greater performance and reliability capabilities, these are recommended for all production workloads.</span></span>

<span data-ttu-id="c4ebf-125">Premium Storage は、特定のサイズの仮想マシン (VM) にのみアタッチできます。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-125">Premium storage can only attach to specific Virtual Machine (VM) sizes.</span></span> <span data-ttu-id="c4ebf-126">それらの VM は、たとえば D2s_v3 や Standard_F2s_v2 のように、名前に S が付いています。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-126">Those VMs are the ones that have an S in the name, for example D2s_v3 or Standard_F2s_v2.</span></span> <span data-ttu-id="c4ebf-127">Standard Storage HDD または Standard Storage SSD ドライブを任意の種類の仮想マシン (名前に s が付いているかどうかにかかわらず) にアタッチできます。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-127">Any virtual machine type (with or without an s in the name) can attach standard storage HDD or SSD drives.</span></span>

<span data-ttu-id="c4ebf-128">ストライプ化テクノロジ (Windows の記憶域スペース ダイレクトや Linux の mdadm) を使用してディスクをストライプ化し、複数のディスク間にディスク アクティビティを分散することによって、スループットと IOPS を高めることができます。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-128">Disks can be striped using a striping technology (such as Storage Spaces Direct on Windows or mdadm on Linux) to increase the throughput and IOPS by spreading disk activity across multiple disks.</span></span> <span data-ttu-id="c4ebf-129">ディスク ストライプ化を使用すると、ディスクのパフォーマンスの限界を押し上げることができ、多くの場合は、高パフォーマンスのデータベース システムやストレージ要件の厳しいその他のシステムで見られます。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-129">Using disk striping allows you to really push the limits of performance for disks, and is often seen in high-performance database systems and other systems with intensive storage requirements.</span></span>

<span data-ttu-id="c4ebf-130">仮想マシンのワークロードに依存している場合は、アプリケーションのパフォーマンス要件を評価して、仮想マシンに対してプロビジョニングする基盤のストレージを決定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-130">When relying on virtual machine workloads, you'll need to evaluate the performance requirements of your application to determine the underlying storage you'll provision for your virtual machines.</span></span>

## <a name="optimize-storage-performance-for-your-application"></a><span data-ttu-id="c4ebf-131">アプリケーションに使用するストレージのパフォーマンスを最適化する</span><span class="sxs-lookup"><span data-stu-id="c4ebf-131">Optimize storage performance for your application</span></span>

<span data-ttu-id="c4ebf-132">さまざまなストレージ テクノロジを使用して RAW ディスクのパフォーマンスを向上させることができますが、データへのアクセスのパフォーマンスについて、アプリケーション レイヤーにおいて対処することもできます。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-132">While you can use differing storage technologies to improve the raw disk performance, you can also address the performance of access to data at the application layer.</span></span> <span data-ttu-id="c4ebf-133">これを行ういくつかの方法を見ていきましょう。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-133">Let's take a look at a few ways you can do this.</span></span>

### <a name="caching"></a><span data-ttu-id="c4ebf-134">キャッシュ</span><span class="sxs-lookup"><span data-stu-id="c4ebf-134">Caching</span></span>

<span data-ttu-id="c4ebf-135">アプリケーションのパフォーマンス向上のための一般的なアプローチは、アプリケーションとデータ ストアとの間にキャッシュ レイヤーを統合することです。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-135">A common approach to improve application performance is to integrate a caching layer between your application and your data store.</span></span> <span data-ttu-id="c4ebf-136">通常、キャッシュはメモリにデータを格納して、迅速に取得できるようにします。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-136">A cache typically stores data in memory and allows for fast retrieval.</span></span> <span data-ttu-id="c4ebf-137">このデータは、頻繁にアクセスされるデータ、データベースから指定したデータ、ユーザーの状態などの一時的なデータであることが考えられます。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-137">This data can be frequently accessed data, data you specify from a database, or temporary data such as user state.</span></span> <span data-ttu-id="c4ebf-138">格納データの種類、情報の更新頻度と有効期限を自分で制御できます。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-138">You'll have control over the type of data stored, how often it refreshes and when it expires.</span></span> <span data-ttu-id="c4ebf-139">このキャッシュをアプリケーションおよびデータベースと同じリージョンに併置することによって、アプリケーションとデータベースの間の全体的な待ち時間を削減できます。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-139">By co-locating this cache in the same region as your application and database, you'll reduce the overall latency between the two.</span></span> <span data-ttu-id="c4ebf-140">キャッシュからのデータのプルは、ほぼ常に、同じデータをデータベースから取得するよりも高速です。したがって、キャッシュ レイヤーを使用することで、アプリケーションの全体的なパフォーマンスを大幅に高めることができます。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-140">Pulling data out of the cache will almost always be faster than retrieving the same data from a database, so by using a caching layer you can substantially improve the overall performance of your application.</span></span>

![キャッシュ](../media/cache.png)

<span data-ttu-id="c4ebf-142">Azure Redis Cache は、Azure のキャッシュ サービスです。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-142">Azure Redis Cache is a caching service on Azure.</span></span> <span data-ttu-id="c4ebf-143">これは、オープン ソースの Redis Cache に基づいています。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-143">It's based upon the open-source Redis Cache.</span></span> <span data-ttu-id="c4ebf-144">Azure Redis Cache は、Microsoft による完全なマネージド サービス オファリングです。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-144">Azure Redis Cache is a fully managed service offering by Microsoft.</span></span> <span data-ttu-id="c4ebf-145">必要なパフォーマンス レベルを選択し、このサービスを使用するようにアプリケーションを構成します。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-145">You select the performance tier that you require and configure your application to use the service.</span></span>

### <a name="polyglot-persistence"></a><span data-ttu-id="c4ebf-146">ポリグロットな永続化</span><span class="sxs-lookup"><span data-stu-id="c4ebf-146">Polyglot persistence</span></span>

<span data-ttu-id="c4ebf-147">ポリグロットな永続化は、異なる複数のデータ ストレージ テクノロジによってストレージ要件を処理するための使用法です。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-147">Polyglot persistence is the usage different data storage technologies to handle your storage requirements.</span></span>

<span data-ttu-id="c4ebf-148">e コマースの例を考えてみます。アプリケーション資産を BLOB ストアに、製品レビューとレコメンデーションを NoSQL ストアに、ユーザー プロファイル/アカウントのデータを SQL データベースに保存できます。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-148">Consider an e-commerce example, you may store application assets in a blob store, product reviews, and recommendations in a NoSQL store and user profile/account data in a SQL database.</span></span>

![polyglotPersistence](../media/polyglotpersistence.png)

<span data-ttu-id="c4ebf-150">異なるデータ ストアが特定のユース ケース用に設計されているか、コストを理由にもっとアクセスできる可能性があるため、これは重要です。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-150">This is important as different data stores are designed for certain use cases, or may be more accessible because of cost.</span></span> <span data-ttu-id="c4ebf-151">例として、BLOB を SQL Database に保存することは、BLOB ストアから直接アクセスするよりもコストがかかり、アクセスも低速になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-151">As an example, storing blobs in a SQL Database may be costly and slower to access than directly from a blob store.</span></span>

<span data-ttu-id="c4ebf-152">多数のバッキング ストアを使用すると、ソリューションの複雑さが増します。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-152">Using many backing stores increases solution complexity.</span></span> <span data-ttu-id="c4ebf-153">これらのデータ ストア間で機能以外の要件を満たす方法と、サービスの低下がアプリケーション全体に与える影響を検討してください。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-153">Consider how you meet your non-functional requirements across those data stores, and how service degradation impacts your overall application.</span></span> <span data-ttu-id="c4ebf-154">また、これらのデータ ストア間でデータの一貫性を維持する方法も検討してください。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-154">Also consider how data is kept consistent between those data stores.</span></span> 

<span data-ttu-id="c4ebf-155">**最終的な一貫性**: 多くの場合は適切なバランスが提供されますが、サービスに応じて複数の異なる一貫性モデルが利用可能です。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-155">**Eventual Consistency** often provides a good balance, but several different consistency models are available, depending on the service.</span></span>

<span data-ttu-id="c4ebf-156">最終的な一貫性とは、それ以上の書き込みがなかった場合、レプリカのデータ ストアが最終的に収束することを意味します。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-156">Eventual consistency means that replica data stores will eventually converge if there are no further writes.</span></span> <span data-ttu-id="c4ebf-157">いずれかのデータ ストアに書き込みが行われた場合、別のデータ ストアからの読み取り時に、わずかに古いデータが提供される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-157">If a write is made to one of the data stores, then reads from another may provide slightly out-of-date data.</span></span> <span data-ttu-id="c4ebf-158">最終的な一貫性により、上位のスケールが利用可能になります。理由は、情報がすべてのストアで一貫しているかどうかの確認待ちがなく、読み取りと書き込みの待ち時間が少ないためです。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-158">Eventual consistency enables higher scale because there is a low latency for reads and writes, rather than waiting to check if information is consistent across all stores.</span></span>

## <a name="lamna-healthcare-example"></a><span data-ttu-id="c4ebf-159">Lamna Healthcare の例</span><span class="sxs-lookup"><span data-stu-id="c4ebf-159">Lamna Healthcare example</span></span>

<span data-ttu-id="c4ebf-160">Lamna Healthcare の患者予約システムは、西ヨーロッパとオーストラリア東部という 2 つの Azure リージョンにまたがってホストされます。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-160">Lamna Healthcare's patient booking system is hosted across two Azure regions, West Europe and Australia East.</span></span> <span data-ttu-id="c4ebf-161">仮想マシンをフロントエンド ノードとして使用して Web サイトをデプロイし、西ヨーロッパにデプロイした Azure SQL DB をプライマリに設定し、オーストラリア東部を読み取り可能なセカンダリに設定します。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-161">They're using virtual machines as the front-end nodes to deploy their website, and have Azure SQL DB deployed in West Europe as primary and Australia East as a readable secondary.</span></span> <span data-ttu-id="c4ebf-162">フロントエンド ノードでは、高レベルのディスク スループットは必要ありませんが、一貫した待ち時間のパフォーマンス、運用の信頼性が必要であり、Premium SSD を使用したストレージを利用しています。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-162">Their front-end nodes don't require high levels of disk throughput, but do require consistent latency performance, production reliability and have used Premium SSD backed storage.</span></span>

<span data-ttu-id="c4ebf-163">各 Azure リージョン内に Azure Redis Cache をローカルにホストし、一般的なユーザー要求と医師の空き時間を保存します。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-163">They are hosting an Azure redis cache locally in each Azure region to store the common user requests and availability of doctors.</span></span> <span data-ttu-id="c4ebf-164">アプリケーションで認められる最も一般的なデータ読み取りアクティビティのパフォーマンスを最適化するために、キャッシュが実装されています。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-164">Caching has been implemented to optimize the performance of the most common data read activities observed on the application.</span></span>

## <a name="summary"></a><span data-ttu-id="c4ebf-165">まとめ</span><span class="sxs-lookup"><span data-stu-id="c4ebf-165">Summary</span></span>

<span data-ttu-id="c4ebf-166">インフラストラクチャ レイヤーにおいて適切なディスク アーキテクチャを選択し、また、アプリケーション レベルにおいてキャッシュを使用し、自分のデータに適したデータ プラットフォームを選択することにより、ストレージのパフォーマンスを高める方法の例をいくつか示しました。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-166">We've covered a few examples on how you can improve storage performance in your infrastructure layer by choosing the right disk architecture and at the application level through the use of caching and selecting the right data platform for your data.</span></span> <span data-ttu-id="c4ebf-167">ソリューションを適切に設計することで、データへのアクセスをできる限り確実に効率よく実行できるようになります。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-167">A properly architected solution will ensure that access to data performs as well as possible.</span></span> <span data-ttu-id="c4ebf-168">次に、アーキテクチャにおけるパフォーマンスの問題を特定する方法を見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="c4ebf-168">Now let's take a look at how we can identify performance issues in an architecture.</span></span>