Azure IoT Central では、デバイスでアプリケーションと交換できるデータは、デバイス (ここではコーヒー マシン) の動作と機能を定義するデバイス テンプレートで指定されます。 デバイス テンプレートを作成すると、テンプレートからシミュレートされたデバイスが生成されます。

シミュレートされたデバイスでは、物理的な/実際のデバイスが接続される前にアプリケーションの動作をテストできるように、テレメトリが生成されます。 

このユニットでは、コーヒー マシンのデバイス テンプレートを作成し、次の機能と動作を指定します。

### <a name="measurements"></a>測定

測定値は、デバイスから取得されるデータです。 デバイスの機能と一致するように、複数の測定値をデバイス テンプレートに追加できます。

* **テレメトリ測定**: デバイスで経時的に収集された数値データ ポイントです。 連続するストリームとして表されます。 このシナリオでは、テレメトリ測定値は空気湿度と水温になります。 

* **状態測定**: 一定期間にわたるデバイスまたはそのコンポーネントの状態。 このシナリオでは、抽出している/抽出していない、カップあり/カップなしの状態を設定します。

### <a name="settings"></a>設定

設定は、アプリケーションからデバイスに構成データを送信するために使用します。 このシナリオでは、設定で最適な水温を調整し、コーヒー マシンに送信します。 設定が更新されると、デバイスで設定変更に対する応答が確認されるまで、設定は UI で保留中としてマークされます。

### <a name="properties"></a>プロパティ

デバイスに関連付けられているデバイスのメタデータ。 2 種類のプロパティがあります。

* *アプリケーション プロパティ*は、アプリケーションでデバイスに関する情報を記録するために使用します。 このシナリオでは、コーヒー マシンの理想的な水温の範囲を設定するためにアプリケーション プロパティを使用します。 アプリケーション プロパティはアプリケーションに格納され、デバイスとは同期しません。 

* *デバイス プロパティ*は、デバイスがプロパティ値をアプリケーションに送信できるようにするために使用します。 これらのプロパティはデバイスでのみ変更できます。 このシナリオでは、IoT Central でデバイスの保証期限切れというデバイス プロパティを構成します。 IoT Central にコーヒー マシンが接続されるまで、デバイスの保証期限切れフィールドは空のままです。 接続されると、コーヒー マシンからアプリケーションに保証状態が送信されます。 

### <a name="commands"></a>コマンド

コマンドは、アプリケーションからデバイスをリモートで管理するために使用します。 クラウドから直接デバイス上でコマンドを実行して、デバイスを制御できます。 このシナリオでは、コーヒー マシンでコマンドを実行して、メンテナンスに設定するか抽出を開始します。 

## <a name="create-a-device-template-for-the-coffee-maker"></a>コーヒー メーカーのデバイス テンプレートを作成する
デバイス テンプレートで、デバイス (ここではコーヒー メーカー) の動作と機能を定義します。

1. Azure IoT Central ポータルで該当するアプリケーションの **[ホーム]** ページに移動して、**[Create Device Templates]\(デバイス テンプレートの作成\)** を選択します。

> [!TIP]
> 左側のメニューにあるホーム アイコンをクリックして、ホーム ページにアクセスできます。

1. カスタム デバイス テンプレートとして、「*接続されているコーヒー メーカー*」と入力します。 
 
1. **[作成]** を選択します。 コーヒー メーカー用に空のデバイス テンプレートを作成しました。ここで、マシンの動作と機能を定義します。 

## <a name="define-telemetry-measurements-of-temperature-and-humidity"></a>温度と湿度のテレメトリ測定を定義する
1. **[接続されているコーヒー メーカー]** デバイス テンプレートで、テレメトリを定義する **[測定]** ページを表示していることを確認します。 

1. 温度テレメトリ測定を追加するには、**[テンプレートの編集]**、**[+ 新しい測定]** の順に選択します。 次に、測定の種類として **[テレメトリ]** を選択します。

1. デバイス テンプレートに対して定義するテレメトリの各種類には、次のような構成オプションが含まれます。
    * 表示オプション
    * テレメトリの詳細
    * シミュレーションのパラメーター

    温度と湿度のテレメトリを構成するには、次の表の情報を使用します。 テレメトリ項目を作成するときに、表の項目ごとに **[+ 新しい測定]** を選択して、新しい測定を追加する必要があります。
    
    |表示名|フィールド名|単位|最小|最大|小数点以下の桁数|
    |---|---|---|---|---|---|
    |水温|waterTemperature|摂氏|86|100|1|
    |空気湿度|airHumidity|%|20|100|0|
   
    テレメトリの表示色を選択することもできます。 テレメトリの定義を保存するには、**[保存]** を選択します。 他の単位で測定、設定、プロパティ、コマンドの定義をさらに作成するため、完了したら必ず保存するようにしてください。  

    > [!NOTE]
    > デバイス テンプレートで、表に示されているとおりにフィールド名を入力します。 フィールド名が対応するデバイス コードのプロパティ名と一致しない場合は、テレメトリをアプリケーションに表示できません。 設定とプロパティ情報を入力する場合も同じようにします。

    ![デバイス テンプレートを作成する](../media/2-device-template-a.png)

## <a name="define-state-measurement-for-brewingnot-brewing-and-cup-detectedcup-not-detected"></a>状態測定 (抽出している/抽出していない、カップあり/カップなし) を定義する
**[テンプレートの編集]**、**[+ 新しい測定]** の順に選択して、**[測定]** ページで次の状態を追加します。 次に、測定の種類として **[状態]** を選択します。

**[状態]** > **[抽出している]** ページで、true として値を追加します。 **[値]** の横にある **[+]** をクリックして、省略可能な表示名を [抽出していない] と指定し、false としてその他の値を追加します。 必ず、**[保存]** を選択して編集内容を保存してください。

   |表示名|フィールド名|値 1|表示名 1|値 2|表示名 2|
   |---|---|---|---|---|---|
   |抽出している|stateBrewing|true|抽出している|false|抽出していない|
   |カップあり|stateCupDetected|true|カップあり|false|カップなし|

> [!NOTE]
> テレメトリと状態を定義した後、デバイス画面にはデバイス テンプレートから生成されたシミュレート データが表示されます。 シミュレートされたデータを使用して、IoT Central に物理デバイスを接続する前に、アプリケーションの動作をテストすることができます。 

## <a name="set-the-optimal-temperature-of-the-coffee-machine"></a>コーヒー マシンの最適温度を設定する
**[設定]** ページ、**[測定]** の横にあるタブの順に移動します。 **[テンプレートの編集]** をクリックします。 **[設定]** ページの **[ライブラリ]** の下で、次の**数値**の設定を追加します。

|表示名|フィールド名|単位|小数点以下の桁数|最小|最大|初期|
|---|---|---|---|---|---|---|---|
|適温|setTemperature|摂氏|1|86|100|95|

## <a name="use-properties-to-store-warranty-info-and-water-temperature-range"></a>プロパティを使用して保証情報と水温範囲を格納する

**[テンプレートの編集]** を選択して、**[プロパティ]** ページで次の**数値**プロパティを追加します。

|表示名|フィールド名|単位|小数点以下の桁数|最小|最大|初期
|---|---|---|---|---|---|---|
|コーヒー メーカーの最低温度|propertyMinTemperature|摂氏|1|88|92|90|
|コーヒー メーカーの最高温度|propertyMaxTemperature|摂氏|1|96|99|98| 

**[プロパティ]** ページで次の**デバイス プロパティ**を追加します。

   |表示名|フィールド名|データ型|
   |---|---|---|
   |デバイスの保証期限切れ|propertyWarrantyExpired|数値|

> [!NOTE]
> デバイス プロパティがデバイス (ここではコーヒー マシン) によって送信されます。 いったんコーヒー マシンを Azure IoT Central に接続すると、デバイスの保証期限プロパティがアプリケーションに送信され、[デバイスの保証期限切れ] フィールドに表示されます。 

## <a name="use-commands-to-set-maintenance-mode-and-start-brewing"></a>コマンドを使用してメンテナンス モードを設定し抽出を開始する

**[テンプレートの編集]** を選択して、**[コマンド]** ページで次のコマンドを追加します。

|表示名|フィールド名|既定のタイムアウト|データ型|
|---|---|---|---|---|---|---|
|メンテナンス モードを設定する|cmdSetMaintenance|30|テキスト| 
|抽出開始|cmdStartBrewing|30|テキスト|