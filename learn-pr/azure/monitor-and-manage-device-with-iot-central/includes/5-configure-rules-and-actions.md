<span data-ttu-id="ce30a-101">コーヒー マシンを Azure IoT Central アプリケーションに接続し、コーヒー マシンを監視して管理できるようにするデータの交換を有効にしました。</span><span class="sxs-lookup"><span data-stu-id="ce30a-101">You have connected your coffee machine to the Azure IoT Central application, enabling the exchange of data that allows you to monitor and manage your coffee machine.</span></span> <span data-ttu-id="ce30a-102">このユニットでは、コーヒー マシンの水の温度が通常の範囲外にあるときにアクションをトリガーするルールを作成します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-102">In this unit, you create rules that trigger actions when the water temperature of the coffee machine is outside the normal range.</span></span> <span data-ttu-id="ce30a-103">アクションは、マシンが保証期間内かどうかに応じて、メールまたはモバイル通知のどちらかとなります。</span><span class="sxs-lookup"><span data-stu-id="ce30a-103">The actions are either emails or mobile notifications depending on whether or not the machine is under warranty.</span></span> <span data-ttu-id="ce30a-104">アクションとして Microsoft Flow を追加するには、Azure サブスクリプションが必要です。</span><span class="sxs-lookup"><span data-stu-id="ce30a-104">To add Microsoft Flow as an action, you need an Azure subscription.</span></span> <span data-ttu-id="ce30a-105">Azure サブスクリプションがない場合は、アクションとしての Microsoft Flow の追加は省略可能です。</span><span class="sxs-lookup"><span data-stu-id="ce30a-105">If you do not have an Azure subscription, adding Microsoft Flow as an action is optional.</span></span>

## <a name="create-rules-in-iot-central-with-email-as-the-action"></a><span data-ttu-id="ce30a-106">電子メールをアクションとして IoT Central でルールを作成する</span><span class="sxs-lookup"><span data-stu-id="ce30a-106">Create rules in IoT Central with Email as the action</span></span>
<span data-ttu-id="ce30a-107">Azure IoT Central には、通知を送信するネイティブなメール機能があります。</span><span class="sxs-lookup"><span data-stu-id="ce30a-107">Azure IoT Central has its native email capabilities to send notifications.</span></span> <span data-ttu-id="ce30a-108">このシナリオでは、コーヒー マシンが最適温度の範囲外にあり、保証で保護されていない場合、IoT Central によってクライアントのメンテナンス部門にメールが送信されます。</span><span class="sxs-lookup"><span data-stu-id="ce30a-108">In this scenario, if the coffee machine is outside the optimal temperature range and is not protected by the warranty, an email is sent by IoT Central to the client’s maintenance department.</span></span>

<span data-ttu-id="ce30a-109">このユニットの演習では、**[ルール]** ページに移動します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-109">Navigate to the **Rules** page for the exercises in this unit.</span></span> <span data-ttu-id="ce30a-110">**[+ 新しいルール]**、**[テレメトリ]** の順に選択します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-110">Select **+ New Rule**, then **Telemetry**.</span></span> <span data-ttu-id="ce30a-111">コーヒー マシンの保証期限が切れていて、水の温度が最適範囲外になったときの、次の 2 つのルールを追加します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-111">Add the following two rules when the coffee machine warranty has expired and the water temperature is outside the optimal range.</span></span> <span data-ttu-id="ce30a-112">完了したら、**[保存]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-112">When you're finished, choose **Save**.</span></span> 

> [!NOTE]
> <span data-ttu-id="ce30a-113">条件が適用されている場合、実行されるルールに対して、すべてのステートメントが true である必要があります。</span><span class="sxs-lookup"><span data-stu-id="ce30a-113">When conditions are applied, all statements have to be true for the rules to be executed.</span></span> <span data-ttu-id="ce30a-114">条件がこのシナリオのように "or" ステートメントの場合 (たとえば、保証期限が切れて、最適温度が定義済みの値より小さいか大きい)、ここで示すように 2 つのルールにステートメントを分割します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-114">If your condition is an "or" statement as in this scenario (e.g. the optimal temperature is less or greater than the predefined values while the warranty has expired), split the statement into two rules as shown here.</span></span>

1. <span data-ttu-id="ce30a-115">ルールの名前: コーヒー メーカーの水温が低すぎ (期限切れ)</span><span class="sxs-lookup"><span data-stu-id="ce30a-115">Name the rule: Coffee Maker Water Too Cold (Expired)</span></span>

    <span data-ttu-id="ce30a-116">条件の追加:</span><span class="sxs-lookup"><span data-stu-id="ce30a-116">Add the conditions:</span></span>      
    * <span data-ttu-id="ce30a-117">デバイスの保証期限切れは 1 に等しい</span><span class="sxs-lookup"><span data-stu-id="ce30a-117">Device Warranty Expired equals 1</span></span>
    * <span data-ttu-id="ce30a-118">水温がコーヒー メーカー最低温度未満である</span><span class="sxs-lookup"><span data-stu-id="ce30a-118">Water Temperature is less than Coffee Makers Min Temperature</span></span>

    ![ルールの使用](../images/5-flow-a.png)

1. <span data-ttu-id="ce30a-120">ルールの名前: コーヒー メーカーの水温が高すぎ (期限切れ)</span><span class="sxs-lookup"><span data-stu-id="ce30a-120">Name the rule: Coffee Maker Water Too Hot (Expired)</span></span>

    <span data-ttu-id="ce30a-121">条件の追加:</span><span class="sxs-lookup"><span data-stu-id="ce30a-121">Add the conditions:</span></span>      
    * <span data-ttu-id="ce30a-122">デバイスの保証期限切れは 1 に等しい</span><span class="sxs-lookup"><span data-stu-id="ce30a-122">Device Warranty Expired equals 1</span></span>
    * <span data-ttu-id="ce30a-123">水温がコーヒー メーカー最高温度を超えている</span><span class="sxs-lookup"><span data-stu-id="ce30a-123">Water Temperature is greater than Coffee Makers Max Temperature</span></span>

1. <span data-ttu-id="ce30a-124">**アクション**を追加するには、[Configure Telemetry Rule]\(テレメトリ ルールの構成\) パネルで下にスクロールし、[アクション] の横にある **[+]** を選択してから **[メール]** を選びます。</span><span class="sxs-lookup"><span data-stu-id="ce30a-124">To add an **Action**, scroll down on the Configure Telemetry Rule panel and choose **+** next to Actions, then choose **Email**.</span></span>

1. <span data-ttu-id="ce30a-125">アクションを定義するには、IoT Central アプリケーションへのサインインに使用したメール アドレスを追加します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-125">To define the action, add the email address that you used to sign in to the IoT Central application.</span></span> <span data-ttu-id="ce30a-126">水温度が暑すぎるときの通知メッセージを追加します。"コーヒー メーカーの水が熱すぎます。</span><span class="sxs-lookup"><span data-stu-id="ce30a-126">Add the notification message when the water temperature is too hot: "Coffee maker's water is too hot.</span></span> <span data-ttu-id="ce30a-127">メンテナンスが必要です。</span><span class="sxs-lookup"><span data-stu-id="ce30a-127">Maintenance is required.</span></span>  <span data-ttu-id="ce30a-128">保証は終了しています。"</span><span class="sxs-lookup"><span data-stu-id="ce30a-128">Warranty has expired."</span></span> <span data-ttu-id="ce30a-129">水温が低すぎる場合について同じ手順を繰り返します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-129">Repeat the same steps for when the water temperature is too cold.</span></span> <span data-ttu-id="ce30a-130">メッセージを追加します。"コーヒー メーカーの水が冷たすぎます。</span><span class="sxs-lookup"><span data-stu-id="ce30a-130">Add the message: "Coffee maker's water is too cold.</span></span> <span data-ttu-id="ce30a-131">メンテナンスが必要です。</span><span class="sxs-lookup"><span data-stu-id="ce30a-131">Maintenance is required.</span></span>  <span data-ttu-id="ce30a-132">保証は終了しています。"</span><span class="sxs-lookup"><span data-stu-id="ce30a-132">Warranty has expired."</span></span>

1. <span data-ttu-id="ce30a-133">**[保存]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-133">Choose **Save**.</span></span> <span data-ttu-id="ce30a-134">ルールが [ルール] ページに一覧表示されます。</span><span class="sxs-lookup"><span data-stu-id="ce30a-134">Your rule is listed on the Rules page.</span></span>

1. <span data-ttu-id="ce30a-135">ルールをトリガーするには、[設定] の最適温度を、[プロパティ] で指定した範囲外の値に設定します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-135">To trigger the rule, set the optimal temperature in Settings outside the range that you specified under Properties.</span></span> <span data-ttu-id="ce30a-136">検証が終わったら、メールで受信トレイがいっぱいにならないようにルールを無効にします。</span><span class="sxs-lookup"><span data-stu-id="ce30a-136">Once you are done with the validation, turn off the rules to avoid flooding your Inbox with emails.</span></span> 

## <a name="create-rules-in-iot-central-with-microsoft-flow-as-the-action"></a><span data-ttu-id="ce30a-137">Microsoft Flow をアクションとして IoT Central でルールを作成する</span><span class="sxs-lookup"><span data-stu-id="ce30a-137">Create rules in IoT Central with Microsoft Flow as the action</span></span>

<span data-ttu-id="ce30a-138">Microsoft Flow は、多くのアプリケーション間のワークフローを自動化します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-138">Microsoft Flow automates workflows across many applications.</span></span> <span data-ttu-id="ce30a-139">IoT Central でルールが発動したときにトリガーできるアクションの 1 つです。</span><span class="sxs-lookup"><span data-stu-id="ce30a-139">It’s one of the actions that can be triggered when a rule is fired in IoT Central.</span></span> <span data-ttu-id="ce30a-140">このシナリオでは、コーヒー マシンが特定の温度しきい値に達して、保証が有効なときは、Microsoft Flow は地域の担当者にモバイル通知を送信します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-140">In this scenario, Microsoft Flow sends a mobile notification to a local technician when the coffee machine reaches certain temperature threshold and is under warranty.</span></span> <span data-ttu-id="ce30a-141">**[ルール]** に移動して、条件を構成し、ルールが発動したときのアクションとしてフローを追加します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-141">Navigate to **Rules** to configure conditions and add a Flow as an action when the rule is fired.</span></span> 
 
> [!NOTE]
> <span data-ttu-id="ce30a-142">Microsoft Flow を有効にするための Azure サブスクリプションがない場合、この演習は省略してかまいません。</span><span class="sxs-lookup"><span data-stu-id="ce30a-142">This exercise is optional if you do not have an Azure subscription to turn on Microsoft Flow.</span></span>


### <a name="extend-your-iot-central-trial-to-30-days"></a><span data-ttu-id="ce30a-143">IoT Central の試用版の期間を 30 日に延長する</span><span class="sxs-lookup"><span data-stu-id="ce30a-143">Extend your IoT Central trial to 30 days</span></span>

1. <span data-ttu-id="ce30a-144">Microsoft Flow を有効にするには、試用版の期間を 30 日に延長する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ce30a-144">To turn on Microsoft Flow, you need to extend your trial to 30 days.</span></span> <span data-ttu-id="ce30a-145">そのためには、[課金] ページで **[Extend Trial to 30 days]\(試用版の期間を 30 日に延長する\)** を選択し、Azure Active Directory と Azure サブスクリプションを選びます。</span><span class="sxs-lookup"><span data-stu-id="ce30a-145">To do so, select **Extend Trial to 30 days** on the Billing page, choose an Azure Active Directory and Azure subscription.</span></span> <span data-ttu-id="ce30a-146">Azure サブスクリプションを使用すると、Azure サービスのインスタンスを作成できます。</span><span class="sxs-lookup"><span data-stu-id="ce30a-146">An Azure subscription enables you to create instances of Azure services.</span></span> <span data-ttu-id="ce30a-147">Azure IoT Central では、ユーザーがアクセスできるすべての Azure サブスクリプションが自動的に検索され、ドロップダウンに表示されます。</span><span class="sxs-lookup"><span data-stu-id="ce30a-147">Azure IoT Central automatically finds all the Azure Subscriptions you have access to, and displays them in the drop-down.</span></span>
    
1. <span data-ttu-id="ce30a-148">Azure サブスクリプションがない場合は、[Azure サインアップ ページ](https://aka.ms/createazuresubscription)で作成できます。</span><span class="sxs-lookup"><span data-stu-id="ce30a-148">If you don’t have an Azure subscription, you can create one on the [Azure sign-up page](https://aka.ms/createazuresubscription).</span></span> <span data-ttu-id="ce30a-149">Azure サブスクリプションを作成したら、**[Application Manager]\(アプリケーション マネージャー\)** ページに戻ります。</span><span class="sxs-lookup"><span data-stu-id="ce30a-149">After you create the Azure subscription, navigate back to the **Application Manager** page.</span></span> <span data-ttu-id="ce30a-150">新しいサブスクリプションが **[Azure サブスクリプション]** ドロップダウンに表示されます。</span><span class="sxs-lookup"><span data-stu-id="ce30a-150">Your new subscription appears in the **Azure Subscription** drop-down.</span></span>
        

### <a name="add-the-following-rules-when-the-coffee-machine-is-under-warranty"></a><span data-ttu-id="ce30a-151">コーヒー マシンが保証期間内のときの次のルールを追加します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-151">Add the following rules when the coffee machine is under warranty.</span></span> 

1. <span data-ttu-id="ce30a-152">ルールの名前: コーヒー メーカーの水温が低すぎ (保証)</span><span class="sxs-lookup"><span data-stu-id="ce30a-152">Name the rule: Coffee Maker Water Too Cold (Warranty)</span></span>

    <span data-ttu-id="ce30a-153">条件の追加:</span><span class="sxs-lookup"><span data-stu-id="ce30a-153">Add the conditions:</span></span>      
    * <span data-ttu-id="ce30a-154">デバイスの保証期限切れは 0 に等しい</span><span class="sxs-lookup"><span data-stu-id="ce30a-154">Device Warranty Expired equals 0</span></span>
    * <span data-ttu-id="ce30a-155">水温がコーヒー メーカー最低温度未満である</span><span class="sxs-lookup"><span data-stu-id="ce30a-155">Water Temperature is less than Coffee Makers Min Temperature</span></span>

1. <span data-ttu-id="ce30a-156">ルールの名前: コーヒー メーカーの水温が高すぎ (保証)</span><span class="sxs-lookup"><span data-stu-id="ce30a-156">Name the rule: Coffee Maker Water Too Hot (Warranty)</span></span>

    <span data-ttu-id="ce30a-157">条件の追加:</span><span class="sxs-lookup"><span data-stu-id="ce30a-157">Add the conditions:</span></span>      
    * <span data-ttu-id="ce30a-158">デバイスの保証期限切れは 0 に等しい</span><span class="sxs-lookup"><span data-stu-id="ce30a-158">Device Warranty Expired equals 0</span></span>
    * <span data-ttu-id="ce30a-159">水温がコーヒー メーカー最高温度を超えている</span><span class="sxs-lookup"><span data-stu-id="ce30a-159">Water Temperature is greater than Coffee Makers Max Temperature</span></span>

1. <span data-ttu-id="ce30a-160">ルールの条件を保存した後、コーヒー メーカーが保証期間内のときの新しいアクションとして Microsoft Flow を選択します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-160">After you save the rule conditions, choose Microsoft Flow as a new action when the coffee maker is under warranty.</span></span> <span data-ttu-id="ce30a-161">ブラウザー内に新しいタブまたはウィンドウが開き、Microsoft Flow が表示されます。</span><span class="sxs-lookup"><span data-stu-id="ce30a-161">A new tab or window should open in your browser, taking you to Microsoft Flow.</span></span> <span data-ttu-id="ce30a-162">概要ページが開き、カスタム アクションに接続している IoT Central コネクタが表示されます。</span><span class="sxs-lookup"><span data-stu-id="ce30a-162">You land on an overview page showing an IoT Central connector connecting to a custom action.</span></span> <span data-ttu-id="ce30a-163">**[続行]** を選択します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-163">Choose **Continue**.</span></span> 

    <span data-ttu-id="ce30a-164">ワークフローを作成するための Microsoft Flow デザイナーが表示されます。</span><span class="sxs-lookup"><span data-stu-id="ce30a-164">You are taken to the Microsoft Flow designer to build your workflow.</span></span> <span data-ttu-id="ce30a-165">ワークフローには、アプリケーションとルールが既に入力されている IoT Central トリガーが含まれています。</span><span class="sxs-lookup"><span data-stu-id="ce30a-165">The workflow has an IoT Central trigger that has your Application and Rule already filled in.</span></span>

    <span data-ttu-id="ce30a-166">ここでは、必要なすべてのアクションをワークフローに追加できます。</span><span class="sxs-lookup"><span data-stu-id="ce30a-166">At this point, you can add any action you want to your workflow.</span></span> <span data-ttu-id="ce30a-167">例として、モバイル通知を送信してみましょう。</span><span class="sxs-lookup"><span data-stu-id="ce30a-167">As an example, let's send a mobile notification.</span></span> <span data-ttu-id="ce30a-168">通知を検索し、[通知] > [Send me a mobile notification]\(モバイル通知を自分に送信する\) を選択します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-168">Search for notification, and choose Notifications - Send me a mobile notification.</span></span>

    <span data-ttu-id="ce30a-169">このアクションの [テキスト] フィールドに通知の内容を入力します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-169">In the action, fill in the Text field with what you want your notification to say.</span></span> <span data-ttu-id="ce30a-170">IoT Central ルールからの動的なコンテンツを含めて、デバイスの ID や名前などの重要な情報を渡すことができます。</span><span class="sxs-lookup"><span data-stu-id="ce30a-170">You can include Dynamic content from your IoT Central rule, passing along important information such as device ID and name.</span></span>
    
    ![アクションとしての Microsoft Flow の使用](../images/5-flow-b.png)

1. <span data-ttu-id="ce30a-172">Microsoft Flow でのワークフローの設定が済んだら、Microsoft Store からモバイル デバイスに [Flow アプリ](https://www.microsoft.com/en-us/p/microsoft-flow/9nkn0p5l9n84?activetab=pivot%3aoverviewtab)をダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="ce30a-172">Once you've set up the workflow in Microsoft Flow, download the [Flow app](https://www.microsoft.com/en-us/p/microsoft-flow/9nkn0p5l9n84?activetab=pivot%3aoverviewtab) from Microsoft Store to your mobile device.</span></span> <span data-ttu-id="ce30a-173">Flow Web アプリでフローを設定するために使用したものと同じアカウントを使用してサインインします。</span><span class="sxs-lookup"><span data-stu-id="ce30a-173">Sign in using the same account that you used to set up the flow in the Flow web app.</span></span> <span data-ttu-id="ce30a-174">テストのため、範囲外の最適温度を設定してルールをトリガーします。</span><span class="sxs-lookup"><span data-stu-id="ce30a-174">For testing purposes, set the optimal temperature out of range to trigger the rule.</span></span> 

    > [!NOTE]
    > <span data-ttu-id="ce30a-175">デバイスのプロパティ: デバイスの保証期限切れ (デバイス コードで 1 は保証期限切れ、0 は保証期間内) は、デバイスによってランダムに生成され、デバイスによって Azure IoT Central アプリケーションに送信されます。</span><span class="sxs-lookup"><span data-stu-id="ce30a-175">Device Property: Device Warranty Expired (1 for expired or 0 for under warranty in the device code) is randomly generated by the device and then sent by the device to the Azure IoT Central application.</span></span> <span data-ttu-id="ce30a-176">テストのため、デバイスの保証期限切れ (1 または 0) を制御したい場合は、テストするアクションをトリガーする目的の保証状態を受信するまで、コーヒー マシンを再起動します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-176">For testing purposes, if you'd like to control Device Warranty Expired (1 or 0), reboot your coffee machine until you receive the intended warranty state to trigger the action that you're testing.</span></span> <span data-ttu-id="ce30a-177">モバイル通知を受信するには、コンソール ログでデバイスの保証期限切れが 0 と表示されるまで、コーヒー マシンを再起動します。</span><span class="sxs-lookup"><span data-stu-id="ce30a-177">To receive a mobile notification, reboot your coffee machine until you see that Device Warranty Expired is 0 in the console log.</span></span> 

    <span data-ttu-id="ce30a-178">数分後、Flow モバイル アプリに通知が表示されます。</span><span class="sxs-lookup"><span data-stu-id="ce30a-178">After several minutes, notifications appear in the Flow mobile app.</span></span>

    ![アクションとしての Microsoft Flow の使用](../images/5-flow-c.png)

## <a name="summary"></a><span data-ttu-id="ce30a-180">まとめ</span><span class="sxs-lookup"><span data-stu-id="ce30a-180">Summary</span></span>
<span data-ttu-id="ce30a-181">IoT Central でルールを作成する方法を学習し、ルールが実行されたときに Microsoft Flow を介してメールやモバイル通知などのアクションをトリガーしました。</span><span class="sxs-lookup"><span data-stu-id="ce30a-181">You’ve learned to create rules in IoT Central and triggered actions such as an email or a mobile notification through Microsoft Flow when the rule is fired.</span></span> <span data-ttu-id="ce30a-182">この例では、コーヒー マシンの水温が最適範囲から外れると、保証の状態に応じて、通知が修理技術者またはクライアントに送信されます。</span><span class="sxs-lookup"><span data-stu-id="ce30a-182">In this case, when the water temperature of the coffee machine is out of the optimal range, notifications are sent to either a repair technician or the client depending on the status of the warranty.</span></span> 


