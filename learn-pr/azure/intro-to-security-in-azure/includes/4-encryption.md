ほとんどの組織にとって、データは最も重要でかけがえのない資産です。 暗号化は、階層型セキュリティ戦略における最強の最終防御線として機能します。 

Contoso Shipping は、データがデータ センターからモバイル アプリに転送される間は暗号化のみがデータを保護する手段であることを認識しています。

## <a name="what-is-encryption"></a>暗号化とは

暗号化は、承認されていない閲覧者がデータの読み取りと使用を実行できなくするプロセスです。 暗号化されたデータを使用または読み取るには、*復号化*する必要があります。その場合、秘密鍵を使用する必要があります。 暗号化には、**対称**と**非対称**という最上位レベルの 2 つの種類があります。

対称暗号化では、データの暗号化と復号化で同じキーが使用されます。 たとえば、デスクトップのパスワード マネージャー アプリケーションがあるとします。 パスワードを入力すると、そのパスワードは自分の個人キーで暗号化されます (多くの場合、キーはマスター キーワードから派生します)。 データを取得する必要がある場合、同じキーが使用され、データが復号化されます。

非対称暗号化では公開鍵と秘密鍵のペアが使用されます。 いずれのキーでも暗号化できますが、その暗号化されたデータは、単一のキーで復号できません。 復号するには、ペアになっているキーが必要です。 非対称暗号化は、トランスポート層セキュリティ (TLS) (HTTPS で使用) やデータの署名などで使用されます。

対称と非対称の両方の暗号化は、データを適切に保護する役割を果たします。 

暗号化は通常、保存時の暗号化と転送中の暗号化という 2 つの方法で行われます。

## <a name="encryption-in-transit"></a>転送中の暗号化

転送中のデータとは、インターネット上やプライベート ネットワーク経由などで、ある場所から別の場所に頻繁に移動されるデータのことです。 セキュリティで保護された転送は、いくつかの異なる層で処理できます。 これは、ネットワーク上に送信する前に、データをアプリケーション層で暗号化することで実現できます。 HTTPS は、アプリケーション層の転送中の暗号化の一例です。 

また、仮想プライベート ネットワーク (VPN) など、セキュリティで保護されたチャネルをネットワーク層に設定して、2 つのシステム間でデータを送信することもできます。 

転送中のデータを暗号化することで、外部のオブザーバーからデータが保護され、露出のリスクを制限しながらデータを転送するためのメカニズムが提供されます。 

![転送中の暗号化](../media/encryption-in-transit.png)


## <a name="encryption-at-rest"></a>保存時の暗号化

保存データは、物理メディアに格納されているデータです。 サーバーのディスク上に格納されているデータ、データベース内に格納されているデータ、ストレージ アカウントに格納されているデータなどがあります。 ストレージ メカニズムに関係なく、保存データの暗号化により、復号化に必要なキーとシークレットなしでは格納されているデータを読み取れなくなります。 攻撃者は、暗号化されたデータが保存されているハード ドライブにアクセスできても、暗号化キーにはアクセスできなかった場合、データのセキュリティを侵害することが難しくなります。

暗号化されている実際のデータは、その内容、使用状況、組織での重要性によって異なる場合があります。 企業に欠かせない財務情報、企業が発展させた知的財産、企業で格納されている顧客や従業員に関する個人データ、さらにはデータ自体の暗号化に使用されるキーやシークレットである場合があります。

![保存時の暗号化](../media/encryption-at-rest.png)

## <a name="encryption-on-azure"></a>Azure での暗号化

Azure で複数のサービスにまたがるデータを暗号化できる方法をいくつか見ていきましょう。

:::row:::
  :::column:::
    ![暗号化されたストレージを表す画像](../media/4-encrypt-raw-storage.png)
  :::column-end:::
    :::column span="3"::: **生のストレージの暗号化**

保存データ用の Azure Storage Service Encryption は、組織のセキュリティとコンプライアンス コミットメントを満たすためにデータを保護するのに役立ちます。 この機能を使用すると、Azure Storage プラットフォームではデータが Azure Managed Disks、Azure Blob Storage、Azure Files、または Azure Queue Storage に保存される前に自動的に暗号化され、データは取得される前に復号化されます。 Storage Service Encryption での暗号化、保存時の暗号化、キー管理の処理は、サービスを使用するアプリケーションに対して透過的に行われます。
  :::column-end:::
:::row-end:::

:::row:::
  :::column:::
    ![暗号化された仮想マシンを表す画像](../media/4-encrypt-virtual-machines.png)
  :::column-end:::
    :::column span="3"::: **仮想マシンの暗号化**

Storage Service Encryption では、物理ディスクに書き込まれたデータに対する低レベルの暗号化保護が提供されますが、仮想マシンの仮想ハード ディスク (VHD) はどのように保護するのでしょうか? 悪意のある攻撃者が Azure サブスクリプションアクセスし、仮想マシンの VHD を抜き取った場合、攻撃者が VHD に格納されているデータにアクセスすることを確実に防ぐにはどうすればよいでしょうか?

Azure Disk Encryption は、Windows と Linux の IaaS 仮想マシン ディスクを暗号化するのに役立つ機能です。 Azure Disk Encryption では、Windows の業界標準である BitLocker 機能と Linux の dm-crypt 機能を利用して、OS とデータ ディスクのボリュームの暗号化を提供します。 このソリューションは Azure Key Vault と統合されており、ディスクの暗号化キーとシークレットを制御および管理するのに役立ちます (また、Key Vault へのアクセスにマネージド サービス ID を使用することができます)。

Contoso Shipping の場合、VM を使用することはクラウドに移行する最初の動きの 1 つでした。 すべての VHD を暗号化することは、会社のデータをセキュリティで保護するために実行可能なすべてのことを行っていることを確保できる、非常に簡単で影響の少ない方法です。
  :::column-end:::
:::row-end:::

:::row:::
  :::column:::
    ![暗号化されたデータベースを表す画像](../media/4-encrypt-databases.png)
  :::column-end:::
    :::column span="3"::: **暗号化されたデータベース**

透過的なデータ暗号化 (TDE) は、悪意のあるアクティビティの脅威から Azure SQL Database と Azure Data Warehouse を保護するのに役立ちます。 アプリケーションに変更を加えることなく、データベース、関連付けられているバックアップ、保存されているトランザクション ログ ファイルがリアルタイムに暗号化および復号化されます。 既定では、新しくデプロイされるすべての Azure SQL Database インスタンスで TDE が有効になります。

TDE では、データベース暗号化キーと呼ばれる対称キーを使用して、データベース全体のストレージが暗号化されます。 既定では、Azure で論理 SQL Server インスタンスごとに一意の暗号化キーが提供され、すべての詳細が処理されます。 Azure Key Vault に格納されているキーと共に、Bring Your Own Key (BYOK) もサポートされます。

TDE は既定で有効になるため、Contoso Shipping では、データベース内に格納されているデータに適切な保護を確実に適用することができます。
  :::column-end:::
:::row-end:::

:::row:::
  :::column:::
    ![暗号化されたシークレットを表す画像](../media/4-encrypt-secrets.png)
  :::column-end:::
    :::column span="3"::: **シークレットの暗号化**

暗号化サービスではすべてキーを使用してデータの暗号化と復号化が行われることがわかりましたが、キー自体を確実に安全なものにするにはどうすればよいのでしょうか? 企業には、パスワード、接続文字列、または安全に格納する必要があるその他の機密情報がある可能性もあります。

Azure Key Vault は、セキュリティで保護されたシークレット ストアとして機能するクラウド サービスです。 Key Vault を使用すると、コンテナーと呼ばれるセキュリティで保護されたコンテナーを複数作成できます。 これらのコンテナーは、ハードウェア セキュリティ モジュール (HSM) によってサポートされています。 コンテナーでは、アプリケーション シークレットを一元的に保管することで、セキュリティ情報が過って失われる可能性が低くなります。 また、キー コンテナーでは、その中に格納されているすべての情報へのアクセスを制御し、記録します。 Azure Key Vault では、TLS 証明書の要求と更新を処理でき、堅牢な証明書ライフサイクル管理ソリューションに必要な機能が提供されます。 Key Vault は、あらゆる種類のシークレットをサポートするよう設計されています。 これらのシークレットには、パスワード、データベース資格情報、API キー、証明書などがあります。

Azure AD の ID には Azure Key Vault のシークレットを使用するためのアクセス許可が付与できるため、マネージド サービス ID が有効なアプリケーションでは必要なシークレットを自動的にシームレスに取得することができます。
  :::column-end:::
:::row-end:::

## <a name="summary"></a>まとめ

ご存知のように、暗号化は、多くの場合攻撃者からの防御として最後の層であり、システムをセキュリティで保護するための階層型アプローチの重要な部分です。 Azure では、データを暗号化し、意図しない露出からデータを保護するための組み込みの機能とサービスが提供されます。 Azure サービス内に格納される顧客データの保護は、Microsoft にとってきわめて重要であり、あらゆる設計に組み込む必要があります。 Azure Storage、Azure Virtual Machines、Azure SQL Database、Azure Key Vault などの基礎となるサービスは、暗号化を使用して環境をセキュリティで保護するのに役立ちます。