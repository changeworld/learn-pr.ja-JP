このユニットでは、Azure portal を使用して、南カリフォルニアの架空のサーフィン レポート Web App に適したストレージ アカウントを作成します。

このサーフィン レポート サイトでは、ユーザーは現地のビーチの状態に関する写真とビデオをアップロードすることができます。 ビューアーはそのコンテンツを使って、サーフィンに最適な状態のビーチを選ぶことができます。 デザインと機能の目標のリストは次のとおりです。

- ビデオ コンテンツはすばやく読み込まれる必要がある。
- サイトでアップロード ボリュームの予期しない急増に対応する必要がある。
- サーフィンの状態が変わったときに古くなったコンテンツを削除する必要があるため、サイトで常に現在の状態を示すようにする。

これらの要件を満たすため、アップロードされたコンテンツを Azure Queue でバッファー処理してから、Azure Blob に転送して永続的に保管することにします。 キューと BLOB の両方を保持でき、コンテンツにアクセスする際の待機時間が短いストレージ アカウントが必要です。

[!include[](../../../includes/azure-sandbox-activate.md)]

## <a name="use-the-azure-portal-to-create-a-storage-account"></a>Azure portal を使用してストレージ アカウントを作成する

1. サンドボックスをアクティブ化したときと同じアカウントを使用して、[Azure portal](https://portal.azure.com/triplecrownlabs.onmicrosoft.com?azure-portal=true) にサインインします。

1. Azure portal の左上にある **[リソースの作成]** を選択します。

1. 選択パネルが表示されたら、**[ストレージ]** を選択します。

1. そのパネルの右側にある **[ストレージ アカウント - Blob、File、テーブル、キュー]** を選択します。

    ![Azure portal のスクリーンショット。[リソースの作成] ブレードで [ストレージ カテゴリ] と [ストレージ アカウント] オプションが強調表示されています。](..\media\5-portal-storage-select.png)

### <a name="configure-the-basic-options"></a>基本的なオプションを構成する

[!include[](../../../includes/azure-sandbox-regions-first-mention-note-friendly.md)]

**[プロジェクトの詳細]** の下で:

1. 適切な**サブスクリプション**を選択します。

1. ドロップダウン リストから既存のリソース グループ ("**<rgn>[サンドボックス リソース グループ名]</rgn>**") を選択します。

    > [!NOTE]
    > この無料のリソース グループは演習の一部として Microsoft が提供するものです。 実際のアプリケーションのためにアカウントを作成するときは、アプリのリソースをすべて保持する目的で、自分のサブスクリプションで新しいリソース グループを作成することになるでしょう。

**[インスタンスの詳細]** で:

1. **[ストレージ アカウント名]** を入力します。 名前は、アカウントのデータにアクセスするためのパブリック URL を生成するときに使用されます。 名前は、Azure 内の既存のすべてのストレージ アカウントを通して一意である必要があります。 名前は 3 から 24 文字の長さにする必要があり、小文字と数字のみを含めることができます。

1. 上のリストからご自分の所在地に近い **[場所]** を選択します。 

1. **[デプロイ モデル]** は _[Resource Manager]_ のままにしておきます。 これは Azure においてすべてのリソース デプロイに推奨されるモデルであり、自分のアプリに関連するリソースをすべて_リソース グループ_に入れることで管理が簡単になります。

1. **[パフォーマンス]** オプションには _[Standard]_ を選択します。 これで、ストレージ アカウントのデータ保持に使用されるディスク ストレージの種類が決定されます。 Standard では従来のハード ディスクが使用されます。Premium ではソリッドステート ドライブ (SSD) が使用されてアクセスが速くなります。 ただし、Premium では_ページ BLOB_ のみがサポートされることに注意してください。 ビデオ用の_ブロック BLOB_ とバッファリング用のキューが必要です。どちらも _[Standard]_ オプションでのみ利用できます。

1. **[アカウントの種類]** には _[StorageV2 (汎用 v2)]_ を選択します。 これで最新の機能や価格にアクセスできます。 具体的には、BLOB ストレージ アカウントでは、この種類のアカウントで利用できるオプションが増えます。 BLOB とキューを組み合わせる必要があるため、_[BLOB ストレージ]_ オプションは使用できません。 このアプリケーションでは、アクセスできる機能が制限され、予想されるワークロードのコストを削減できる可能性が低いため、_[Storage (汎用 v1)]_ アカウントを選択してもメリットはありません。

1. **[レプリケーション]** オプションでは _[ローカル冗長ストレージ (LRS)]_ 選択します。 高可用性を確保するために、Azure ストレージ アカウントのデータは常にレプリケートされます。このオプションでは、持続性要件を満たすためにどの程度レプリケーションを行うかを選択できます。 この例では、イメージとビデオはすぐに古くなり、サイトから削除されます。 その結果、グローバルな冗長性のために追加料金を払う価値がほとんどなくなります。 致命的な障害でデータを失った場合は、ユーザーからの最新コンテンツでサイトを再開することができます。

1. **[アクセス層]** を _[ホット]_ に設定します。 この設定は BLOB ストレージでのみ使用されます。 **ホット アクセス層**は頻繁にアクセスされるデータに最適です。**クール アクセス層**はアクセス頻度の低いデータに適しています。 これによって設定されるのは_既定_値のみであることに注意してください。BLOB を作成する場合は、データに対して異なる値を設定できます。 今回のケースでは、ビデオをすばやく読み込む必要があるため、BLOB に高パフォーマンス オプションを使用します。

次のスクリーンショットは、**[基本]** タブの設定が完了したことを示しています。リソース グループ、サブスクリプション、名前に異なる値が与えられていることに注意してください。

![[ストレージ アカウントを作成する] ブレードのスクリーンショット。**[基本]** タブが選択されています。](../media/5-create-storage-account-basics.png)

### <a name="configure-the-advanced-options"></a>詳細オプションを構成する

1. **[次: 詳細 >]** ボタンをクリックして **[詳細]** タブに移動するか、画面上部にある **[詳細]** タブを選択します。

1. **[安全な転送が必須]** を _[有効]_ に設定します。 **[安全な転送が必須]** 設定により、ストレージ アカウントのデータにアクセスするための REST API で **HTTP** を使用できるかどうかが制御されます。 このオプションを _[有効]_ に設定すると、すべてのクライアントで強制的に SSL (**HTTPS**) が使用されます。 ネットワーク経由の HTTPS がベスト プラクティスと見なされているため、ほとんどの場合、これを _[有効]_ に設定することになります。 

    > [!WARNING]
    > このオプションが有効な場合、追加の制約がいくつか強制されます。 Linux で SMB 2.1 または 3.0 を使用するシナリオも含め、暗号化のない Azure ファイル サービス接続は失敗します。 Azure ストレージではカスタム ドメイン名に対して HTTPS がサポートされないため、カスタム ドメイン名ではこのオプションを使用できません。

1. **[仮想ネットワーク]** オプションを _[なし]_ に設定します。 このオプションでは、Azure 仮想ネットワークでストレージ アカウントを分離できます。 今回、公共のインターネット アクセスを使用します。 今回のコンテンツは一般向けであり、パブリック コンテンツからのアクセスを許可する必要があります。

1. **[Data Lake Storage Gen2]** オプションは _[無効]_ のままにします。 これはこのモジュールには関係のないビッグデータ アプリケーション向けです。

次のスクリーンショットは、**[詳細]** タブの設定が完了したことを示しています。

![**詳細** タブが選択されている [ストレージ アカウントを作成する] ブレードのスクリーンショット。](../media/5-create-storage-account-advanced.png)

### <a name="create"></a>作成

1. 必要であれば、**[タグ]** 設定をいろいろ試すことができます。 これはあらゆる Azure リソースで利用できる機能であり、キー/値のペアを組織のアカウントに関連付けることができます。

1. **[レビュー + 作成]** をクリックし、設定を見直します。 オプションがすばやく検証され、必須フィールドがすべて選択されていることが確認されます。 問題があれば、ここで報告されます。 設定を見直したら **[作成]** をクリックし、ストレージ アカウントをプロビジョニングします。

アカウントがデプロイされるまで数分かかります。 Azure がそれに対して動作している間、このアカウントで使用する API について見てみましょう。

### <a name="verify"></a>確認

1. 左サイドバーで **[ストレージ アカウント]** リンクを選択します。

1. 一覧で新しいストレージ アカウントを見つけて、作成が成功したことを確認します。

<!-- Cleanup sandbox -->
[!include[](../../../includes/azure-sandbox-cleanup.md)]

自分のサブスクリプションで作業している場合は、Azure portal で次の手順を実行し、リソース グループと、関連付けられているすべてのリソースを削除できます。

1. 左サイドバーで **[リソース グループ]** リンクを選択します。

1. 作成したリソース グループを一覧から見つけます。

1. リソース グループ エントリを右クリックして、コンテキスト メニューから **[リソース グループの削除]** を選択します。 エントリの右側にある [...] をクリックした場合も同じコンテキスト メニューが表示されます。

1. 確認フィールドにリソース グループ名を入力します。

1. **[削除]** ボタンをクリックします。 これには数分かかる場合があります。

自分のビジネス要件に合わせた設定でストレージ アカウントを作成しました。 顧客の所在地が主に南カリフォルニアであれば、米国西部のデータセンターを選択したことでしょう。 これが一般的なフローです。まず、自分のデータと目標を分析し、条件に合うストレージ アカウントのオプションを構成します。