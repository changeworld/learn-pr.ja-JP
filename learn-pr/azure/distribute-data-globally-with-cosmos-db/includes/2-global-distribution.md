<span data-ttu-id="99bb8-101">オンラインの衣料品サイトで顧客に製品への迅速なアクセスを提供することは、その顧客にとっても、事業の成功にとっても極めて重要です。</span><span class="sxs-lookup"><span data-stu-id="99bb8-101">Providing your customers the fastest access to the products on your online clothing site is paramount to your customers, and your businesses success.</span></span> <span data-ttu-id="99bb8-102">データがユーザーに届くまでに移動する距離を短くすることで、コンテンツの配信をより高速化できます。</span><span class="sxs-lookup"><span data-stu-id="99bb8-102">By decreasing the distance data has to travel to your users, you can deliver more content faster.</span></span> <span data-ttu-id="99bb8-103">データが Azure Cosmos DB に格納されている場合、ポイント アンド クリック操作で世界中の複数のリージョンにサイトのデータがレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="99bb8-103">If your data is stored in Azure Cosmos DB, replicating your site's data to multiple regions around the world is a point and click operation.</span></span>

<!-- Activate the sandbox -->
[!include[](../../../includes/azure-sandbox-activate.md)]

<span data-ttu-id="99bb8-104">このユニットでは、グローバル配布と、ネイティブのマルチ マスター データベース サービスの利点について理解し、3 つの追加のリージョンにアカウントをレプリケートします。</span><span class="sxs-lookup"><span data-stu-id="99bb8-104">In this unit you'll learn the benefits of global distribution and a natively multi-mastered database service, and then replicate your account into three additional regions.</span></span>

## <a name="global-distribution-basics"></a><span data-ttu-id="99bb8-105">グローバル配布の基本</span><span class="sxs-lookup"><span data-stu-id="99bb8-105">Global distribution basics</span></span>

<span data-ttu-id="99bb8-106">グローバル配布を使用すると、1 つのリージョンから複数の Azure リージョンにデータをレプリケートできます。</span><span class="sxs-lookup"><span data-stu-id="99bb8-106">Global distribution enables you to replicate data from one region into multiple Azure regions.</span></span> <span data-ttu-id="99bb8-107">データベースがレプリケートされるリージョンは、いつでも追加または削除でき、Azure Cosmos DB では追加のリージョンが付け加えられた場合に、データが 100 TB 以下であることを前提とし、30 分以内にそのデータを利用可能にすることを保証しています。</span><span class="sxs-lookup"><span data-stu-id="99bb8-107">You can add or remove regions in which your database is replicated at any time, and Azure Cosmos DB ensures that when you add an additional region, your data is available for operations within 30 minutes, assuming your data is 100 TBs or less.</span></span>

<span data-ttu-id="99bb8-108">複数のリージョンにデータをレプリケートする場合、一般的なシナリオとして次の 2 つがあります。</span><span class="sxs-lookup"><span data-stu-id="99bb8-108">There are two common scenarios for replicating data in two or more regions:</span></span>

1. <span data-ttu-id="99bb8-109">エンド ユーザーが世界中のどこにいても、短い待機時間でのデータ アクセスを実現する</span><span class="sxs-lookup"><span data-stu-id="99bb8-109">Delivering low-latency data access to end users no matter where they are located around the globe</span></span>
2. <span data-ttu-id="99bb8-110">ビジネス継続性とディザスター リカバリー (BCDR) のためにリージョンの回復性を追加する</span><span class="sxs-lookup"><span data-stu-id="99bb8-110">Adding regional resiliency for business continuity and disaster recovery (BCDR)</span></span>

<span data-ttu-id="99bb8-111">顧客に短い待機時間でのアクセスを提供するために、ユーザーの所在地に最も近いリージョンにデータをレプリケートすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="99bb8-111">To deliver low-latency access to customers, it is recommended that you replicate the data to regions closest to where your users are.</span></span> <span data-ttu-id="99bb8-112">オンラインで衣料品を扱う会社で、ロサンゼルス、ニューヨーク、および東京に顧客がいるとします。</span><span class="sxs-lookup"><span data-stu-id="99bb8-112">For your online clothing company, you have customers in Los Angeles, New York, and Tokyo.</span></span> <span data-ttu-id="99bb8-113">[Azure リージョン](https://azure.microsoft.com/global-infrastructure/regions/)のページを確認して、これらの顧客に最も近いリージョンを特定します。それらのリージョンが、ユーザーをレプリケートする場所になります。</span><span class="sxs-lookup"><span data-stu-id="99bb8-113">Take a look at the [Azure regions](https://azure.microsoft.com/global-infrastructure/regions/) page, and determine the closest regions to those sets of customers, as those are the locations you'll replicate users to.</span></span>

<span data-ttu-id="99bb8-114">BCDR ソリューションを提供するには、「[ビジネス継続性とディザスター リカバリー (BCDR): Azure のペアになっているリージョン](https://azure.microsoft.com/documentation/articles/best-practices-availability-paired-regions/)」に記載されているリージョン ペアに基づいてリージョンを追加することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="99bb8-114">To provide a BCDR solution, it is recommended to add regions based on the region pairs described in the [Business continuity and disaster recovery (BCDR): Azure Paired Regions](https://azure.microsoft.com/documentation/articles/best-practices-availability-paired-regions/) article.</span></span>

<span data-ttu-id="99bb8-115">データベースがレプリケートされるときに、スループットとストレージも同等にレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="99bb8-115">When a database is replicated, the throughput and storage are replicated equally as well.</span></span> <span data-ttu-id="99bb8-116">そのため、元のデータベースが 10 GB のストレージと 1,000 RU/秒のスループットを備えており、3 つの追加のリージョンにそのデータベースをレプリケートした場合、各リージョンは 10 GB のデータと 1,000 RU/秒のスループットを備えることになります。</span><span class="sxs-lookup"><span data-stu-id="99bb8-116">So if your original database had 10GB of storage, and throughput of 1,000 RU/s, and if you replicated that to three additional regions, each region would have 10GB of data and 1,000 RU/s of throughput.</span></span> <span data-ttu-id="99bb8-117">ストレージとスループットが各リージョンにレプリケートされるので、リージョンへのレプリケート コストは、元のリージョンと同じになります。そのため、3 つの追加のリージョンにレプリケートした場合、レプリケートされていない元のデータベースの約 4 倍のコストが生じます。</span><span class="sxs-lookup"><span data-stu-id="99bb8-117">Because the storage and throughput is replicated in each region, the cost of replicating to a region is the same as the original region, so replicating to 3 additional regions, would cost approximately four times the original non-replicated database.</span></span>

## <a name="creating-an-azure-cosmos-db-account-in-the-portal"></a><span data-ttu-id="99bb8-118">ポータルで Azure Cosmos DB アカウントを作成する</span><span class="sxs-lookup"><span data-stu-id="99bb8-118">Creating an Azure Cosmos DB account in the portal</span></span>

1. <span data-ttu-id="99bb8-119">サンドボックスのアクティブ化に使用したものと同じアカウントを使って、[Azure portal](https://portal.azure.com/learn.docs.microsoft.com?azure-portal=true) にサインインします。</span><span class="sxs-lookup"><span data-stu-id="99bb8-119">Sign in to the [Azure portal](https://portal.azure.com/learn.docs.microsoft.com?azure-portal=true) using the same account you used to activate the sandbox.</span></span>

    > [!IMPORTANT]
    > <span data-ttu-id="99bb8-120">同じアカウントを使って、Azure portal とサンドボックスにログインします。</span><span class="sxs-lookup"><span data-stu-id="99bb8-120">Login to the Azure portal and the sandbox with the same account.</span></span>
    >
    > <span data-ttu-id="99bb8-121">サンドボックスに確実に接続されるように、上記のリンクを使用して Azure portal にログインします。コンシェルジェ サブスクリプションへのアクセスが提供されます。</span><span class="sxs-lookup"><span data-stu-id="99bb8-121">Login to the Azure portal using the link above to ensure you are connected to the sandbox, which provides access to a Concierge Subscription.</span></span>

1. <span data-ttu-id="99bb8-122">**[リソースの作成]** > **[データベース]** > **[Azure Cosmos DB]** の順にクリックします。</span><span class="sxs-lookup"><span data-stu-id="99bb8-122">Click **Create a resource** > **Databases** > **Azure Cosmos DB**.</span></span>

   ![Azure Portal の [データベース] ウィンドウ](../media/2-global-distribution/2-create-nosql-db-databases-json-tutorial.png)

1. <span data-ttu-id="99bb8-124">**[Azure Cosmos DB アカウントを作成します]** ページで、場所などの新しい Azure Cosmos DB アカウントの設定を入力します。</span><span class="sxs-lookup"><span data-stu-id="99bb8-124">On the **Create Azure Cosmos DB Account** page, enter the settings for the new Azure Cosmos DB account, including the location.</span></span>

    <span data-ttu-id="99bb8-125"><!-- Resource selection --> [!include[](../../../includes/azure-sandbox-regions-first-mention-note-friendly.md)]</span><span class="sxs-lookup"><span data-stu-id="99bb8-125"><!-- Resource selection --> [!include[](../../../includes/azure-sandbox-regions-first-mention-note-friendly.md)]</span></span>

    <span data-ttu-id="99bb8-126">設定</span><span class="sxs-lookup"><span data-stu-id="99bb8-126">Setting</span></span>|<span data-ttu-id="99bb8-127">値</span><span class="sxs-lookup"><span data-stu-id="99bb8-127">Value</span></span>|<span data-ttu-id="99bb8-128">説明</span><span class="sxs-lookup"><span data-stu-id="99bb8-128">Description</span></span>
    ---|---|---
    <span data-ttu-id="99bb8-129">ID</span><span class="sxs-lookup"><span data-stu-id="99bb8-129">ID</span></span>|<span data-ttu-id="99bb8-130"><*一意の名前を入力*></span><span class="sxs-lookup"><span data-stu-id="99bb8-130">*Enter a unique name*</span></span>|<span data-ttu-id="99bb8-131">この Azure Cosmos DB アカウントを識別するための一意の名前を入力します。</span><span class="sxs-lookup"><span data-stu-id="99bb8-131">Enter a unique name to identify this Azure Cosmos DB account.</span></span> <span data-ttu-id="99bb8-132">指定した ID に *documents.azure.com* が付加されて URI が作成されるので、ID は一意であっても識別可能なものを使用してください。</span><span class="sxs-lookup"><span data-stu-id="99bb8-132">Because *documents.azure.com* is appended to the ID that you provide to create your URI, use a unique but identifiable ID.</span></span><br><br><span data-ttu-id="99bb8-133">ID に含めることができるのは英小文字、数字、ハイフン (-) のみ、3 文字以上で 50 文字以内にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="99bb8-133">The ID can contain only lowercase letters, numbers, and the hyphen (-) character, and it must contain 3 to 50 characters.</span></span>
    <span data-ttu-id="99bb8-134">API</span><span class="sxs-lookup"><span data-stu-id="99bb8-134">API</span></span>|<span data-ttu-id="99bb8-135">SQL</span><span class="sxs-lookup"><span data-stu-id="99bb8-135">SQL</span></span>|<span data-ttu-id="99bb8-136">API によって、作成するアカウントの種類が決まります。</span><span class="sxs-lookup"><span data-stu-id="99bb8-136">The API determines the type of account to create.</span></span> <span data-ttu-id="99bb8-137">Azure Cosmos DB には、アプリケーションのニーズに応じて、SQL (ドキュメント データベース)、Gremlin (グラフ データベース)、MongoDB (ドキュメント データベース)、Azure Table、および Cassandra の 5 つの API が用意されています。現時点では、それぞれ別個のアカウントが必要です。</span><span class="sxs-lookup"><span data-stu-id="99bb8-137">Azure Cosmos DB provides five APIs to suit the needs of your application: SQL (document database), Gremlin (graph database), MongoDB (document database), Azure Table, and Cassandra, each of which currently requires a separate account.</span></span> <br><br><span data-ttu-id="99bb8-138">このモジュールでは、SQL 構文を使ってクエリを実行し、SQL API でアクセスできるドキュメント データベースを作成しているので、**[SQL]** を選びます。</span><span class="sxs-lookup"><span data-stu-id="99bb8-138">Select **SQL** because in this module you are creating a document database that is queryable using SQL syntax and accessible with the SQL API.</span></span>|
    <span data-ttu-id="99bb8-139">サブスクリプション</span><span class="sxs-lookup"><span data-stu-id="99bb8-139">Subscription</span></span>|<span data-ttu-id="99bb8-140">*コンシェルジェ サブスクリプション*</span><span class="sxs-lookup"><span data-stu-id="99bb8-140">*Concierge Subscription*</span></span>|<span data-ttu-id="99bb8-141">使用しているコンシェルジェ サブスクリプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="99bb8-141">Select your Concierge Subscription.</span></span> <span data-ttu-id="99bb8-142">コンシェルジェ サブスクリプションが一覧に表示されない場合は、サブスクリプション上で複数のテナントを有効な状態にすると共に、テナントを変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="99bb8-142">If you do not see the Concierge Subscription listed, you have multiple tenants enabled on your subscription, and you need to change tenants.</span></span> <span data-ttu-id="99bb8-143">そのためには、ポータル リンク ([サンドボックスの Azure portal](https://portal.azure.com/learn.docs.microsoft.com?azure-portal=true)) を使用して、もう一度ログインします。</span><span class="sxs-lookup"><span data-stu-id="99bb8-143">To do so, login again using the following portal link: [Azure portal for sandbox](https://portal.azure.com/learn.docs.microsoft.com?azure-portal=true).</span></span>
    <span data-ttu-id="99bb8-144">リソース グループ</span><span class="sxs-lookup"><span data-stu-id="99bb8-144">Resource Group</span></span>|<span data-ttu-id="99bb8-145">既存のものを使用</span><span class="sxs-lookup"><span data-stu-id="99bb8-145">Use existing</span></span><br><br><span data-ttu-id="99bb8-146"><rgn>[サンドボックス リソース グループ名]</rgn></span><span class="sxs-lookup"><span data-stu-id="99bb8-146"><rgn>[sandbox resource group name]</rgn></span></span>|<span data-ttu-id="99bb8-147">**[既存のものを使用]** を選択して、<rgn>[サンドボックス リソース グループ名]</rgn> を入力します。</span><span class="sxs-lookup"><span data-stu-id="99bb8-147">Select **Use existing**, and then enter <rgn>[sandbox resource group name]</rgn>.</span></span>
    <span data-ttu-id="99bb8-148">場所</span><span class="sxs-lookup"><span data-stu-id="99bb8-148">Location</span></span>|<span data-ttu-id="99bb8-149"><*最も近いリージョンを選択*></span><span class="sxs-lookup"><span data-stu-id="99bb8-149">*Select the region closest to you*</span></span>|<span data-ttu-id="99bb8-150">上記のリージョンの一覧から最も近いリージョンを選択します。</span><span class="sxs-lookup"><span data-stu-id="99bb8-150">Select the region closest to you from the list of regions above.</span></span>
    <span data-ttu-id="99bb8-151">geo 冗長</span><span class="sxs-lookup"><span data-stu-id="99bb8-151">Geo-Redundancy</span></span>| <span data-ttu-id="99bb8-152">無効化</span><span class="sxs-lookup"><span data-stu-id="99bb8-152">Disable</span></span> | <span data-ttu-id="99bb8-153">この設定によって、データベースのレプリケート バージョンが 2 番目 (ペア) のリージョンに作成されます。</span><span class="sxs-lookup"><span data-stu-id="99bb8-153">This setting creates a replicated version of your database in a second (paired) region.</span></span> <span data-ttu-id="99bb8-154">後でデータベースをレプリケートするので、ここでは、この設定を無効のままにしておきます。</span><span class="sxs-lookup"><span data-stu-id="99bb8-154">Leave this set to disabled for now, as you will replicate the database later.</span></span>
    <span data-ttu-id="99bb8-155">マルチ マスター</span><span class="sxs-lookup"><span data-stu-id="99bb8-155">Multi Master</span></span> | <span data-ttu-id="99bb8-156">有効化</span><span class="sxs-lookup"><span data-stu-id="99bb8-156">Enable</span></span> | <span data-ttu-id="99bb8-157">この設定によって、同時に複数のリージョンに書き込むことが可能になります。</span><span class="sxs-lookup"><span data-stu-id="99bb8-157">This setting enables you to write to multiple regions at the same time.</span></span> <span data-ttu-id="99bb8-158">この設定は、アカウントの作成時にのみ構成できます。</span><span class="sxs-lookup"><span data-stu-id="99bb8-158">This setting can only be configured during account creation.</span></span>
    <span data-ttu-id="99bb8-159">仮想ネットワーク</span><span class="sxs-lookup"><span data-stu-id="99bb8-159">Virtual Network</span></span>|<span data-ttu-id="99bb8-160">空白のまま</span><span class="sxs-lookup"><span data-stu-id="99bb8-160">Leave blank</span></span>|<span data-ttu-id="99bb8-161">ここでは、仮想ネットワークを空白のままにします。</span><span class="sxs-lookup"><span data-stu-id="99bb8-161">Leave virtual networks blank for now.</span></span> <span data-ttu-id="99bb8-162">これは、後で構成できます。</span><span class="sxs-lookup"><span data-stu-id="99bb8-162">This can be configured later.</span></span>

1. <span data-ttu-id="99bb8-163">**[Review + Create]\(レビュー + 作成\)** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="99bb8-163">Click **Review + Create**.</span></span>

    ![Azure Cosmos DB の新しいアカウント ページ](../media/2-global-distribution/2-azure-cosmos-db-create-new-account.png)

1. <span data-ttu-id="99bb8-165">設定の確認を終えたら、**[作成]** をクリックしてアカウントを作成します。</span><span class="sxs-lookup"><span data-stu-id="99bb8-165">After the settings are validated, click **Create** to create the account.</span></span>

1. <span data-ttu-id="99bb8-166">アカウントの作成には数分かかります。</span><span class="sxs-lookup"><span data-stu-id="99bb8-166">The account creation takes a few minutes.</span></span> <span data-ttu-id="99bb8-167">ポータルにデプロイ成功の通知が表示されるまで待ち、その通知をクリックします。</span><span class="sxs-lookup"><span data-stu-id="99bb8-167">Wait for the portal to display the notification that the deployment succeeded and click the notification.</span></span>

    ![通知アラート](../media/2-global-distribution/2-azure-cosmos-db-notification.png)

1. <span data-ttu-id="99bb8-169">通知ウィンドウで、**[リソースに移動]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="99bb8-169">In the notification window, click **Go to resource**.</span></span>

    ![リソースに移動](../media/2-global-distribution/2-azure-cosmos-db-go-to-resource.png)

    <span data-ttu-id="99bb8-171">ポータルに、"**ご利用ありがとうございます。Azure Cosmos DB アカウントが作成されました**" ページが表示されるまで待機します。</span><span class="sxs-lookup"><span data-stu-id="99bb8-171">The portal displays the **Congratulations! Your Azure Cosmos DB account was created** page.</span></span>

    ![Azure portal の [通知] ウィンドウ](../media/2-global-distribution/2-azure-cosmos-db-account-created.png)

## <a name="replicate-data-in-multiple-regions"></a><span data-ttu-id="99bb8-173">複数のリージョン内にデータをレプリケートする</span><span class="sxs-lookup"><span data-stu-id="99bb8-173">Replicate data in multiple regions</span></span>

<span data-ttu-id="99bb8-174">ロスアンゼルス、ニューヨーク、および東京のグローバルなユーザーの最も近くにデータベースをレプリケートしましょう。</span><span class="sxs-lookup"><span data-stu-id="99bb8-174">Let's now replicate your database closest to your global users in Los Angeles, New York, and Tokyo.</span></span>

1. <span data-ttu-id="99bb8-175">アカウントのページで、メニューから **[データをグローバルにレプリケートする]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="99bb8-175">In the account page, click **Replicate data globally** from the menu.</span></span>
1. <span data-ttu-id="99bb8-176">**[データをグローバルにレプリケートする]** ページで、[米国西部 2]、[米国東部]、および [東日本] のリージョンを選択して、**[保存]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="99bb8-176">In the **Replicate data globally** page, select the West US 2, East US, and Japan East regions, and then click **Save**.</span></span>

    <span data-ttu-id="99bb8-177">Azure portal にマップが表示されていない場合は、画面の左側のメニューを最小化して、マップを表示します。</span><span class="sxs-lookup"><span data-stu-id="99bb8-177">If you don't see the map in the Azure portal, minimize the menus of the left side of the screen to display it.</span></span>

    <span data-ttu-id="99bb8-178">データが新しいリージョンに書き込まれている間、ページには **[更新しています]** のメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="99bb8-178">The page will display an **Updating** message while the data is written to the new regions.</span></span> <span data-ttu-id="99bb8-179">新しいリージョンのデータは、30 分以内に利用可能になります。</span><span class="sxs-lookup"><span data-stu-id="99bb8-179">Data in the new regions will be available within 30 minutes.</span></span>

    ![マップ内でリージョンをクリックして追加する](../media/2-global-distribution/2-global-replication.gif)

## <a name="summary"></a><span data-ttu-id="99bb8-181">まとめ</span><span class="sxs-lookup"><span data-stu-id="99bb8-181">Summary</span></span>

<span data-ttu-id="99bb8-182">このユニットでは、世界各地のユーザーが最も集中しているリージョンにデータベースをレプリケートして、サイト上のデータに短い待機時間でアクセスできるようにしました。</span><span class="sxs-lookup"><span data-stu-id="99bb8-182">In this unit, you replicated your database to the regions of the world in which your users are most concentrated, providing them lower-latency access to the data on your site.</span></span>
