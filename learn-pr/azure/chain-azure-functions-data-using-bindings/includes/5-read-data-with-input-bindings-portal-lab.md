単純なブックマーク参照サービスを作成することを想像してください。 最初に、サービスでは readonly です。 ユーザーのエントリを検索する場合、エントリの ID を持つ要求を送信して、URL が返されます。 次の図では、フローについて説明します。

![バック エンド、Cosmos DB でのブックマークの検索のプロセスを示すフロー図](../media-draft/find-bookmark-flow-small.png)

キーまたは id としてこのテキストを含むバック エンド データベースでエントリを検索しようと、ユーザーは私たちにテキストが要求を送信します。ここには、かどうか、エントリがわかりましたかどうかを示す結果が返されます。

どこかにデータを格納する必要があります。 このフローチャートに、データ ストアは、Azure Cosmos DB として表示されます。 しかし、方法は関数からそのデータベースに接続し、データを読み取るでしょうか。 関数の世界中で構成します、*入力バインド*ジョブ。  Azure Portal でバインドの構成は簡単です。 間もなく表示されるようは、記憶域の接続を開くなどのタスクのコードを記述する必要はありません。 Azure Functions ランタイムとバインドをそれらのタスクの処理できます。

> [!IMPORTANT]
> ここで、次の実習で作成されるリソース (データベース、関数、バインディング、コード) を参照していきます。 少なくとも、これらのリソースの周囲を留意してくださいこのコースを完了するまでです。

前のモジュールの場合と、Azure portal 内のすべてを実行します。

## <a name="create-an-azure-cosmos-db"></a>Azure Cosmos DB を作成します。 

### <a name="create-a-database-account"></a>データベース アカウントの作成

データベース アカウントは、1 つまたは複数のデータベースを管理するためのコンテナーです。 データベースを作成する前に、データベース アカウントを作成する必要があります。

1. [Azure portal](https://portal.azure.com/?azure-portal=true) にサインインします。

2. 選択、**リソースの作成**ボタンで検出された、Azure portal の左上隅から選択**データベース** > **Azure Cosmos DB**します。

3. **[新しいアカウント]** ページで、新しい Azure Cosmos DB アカウントの設定を入力します。

    設定|値|説明
    ---|---|---
    ID|<*一意の名前を入力*>|この Azure Cosmos DB アカウントを識別するための一意の名前を入力します。 指定した ID に *documents.azure.com* が付加されて URI が作成されるので、ID は一意であっても識別可能なものを使用してください。<br><br>ID に含めることができるのは英小文字、数字、ハイフン (-) のみ、3 文字以上で 50 文字以内にする必要があります。
    API|SQL|API によって、作成するアカウントの種類が決まります。 Azure Cosmos DB は、アプリケーションのニーズに合わせて 5 つの Api を提供します。 SQL (ドキュメント データベース)、Gremlin (グラフ データベース)、MongoDB (ドキュメント データベース)、Azure テーブル、および Cassandra、各現在別のアカウントが必要です。 <br><br>選択**SQL**します。 Azure Cosmos DB トリガー、入力バインディング、および出力バインドはこの時点で、のみ SQL API および Graph API のアカウントを使って作業します。 
    サブスクリプション|*該当するサブスクリプション*|この Azure Cosmos DB アカウントに使用する Azure サブスクリプションを選択します。
    リソース グループ|既存のものを使用<br><br>*選び<rgn>[サンド ボックス リソース グループ名]</rgn>、このモジュールのリソースの以前の単位で作成したリソース グループ。*| 選択**既存を使用して、** 同じリソース グループの下には、このモジュール用に作成されたすべてのリソースをグループ化するため、します。
    場所|自動入力される 1 回**既存を使用して、** 設定されます。 | Azure Cosmos DB アカウントをホストする地理的な場所を選択します。 データに最も高速にアクセスできる、ユーザーに最も近い場所を使用します。 この演習では、場所は事前の既存のリソース グループの設定の場所として決まります。

他のすべてのフィールドのままに、**新しいアカウント**ブレードで、既定の値をこのモジュールでそれらを使用しているためです。  含む**geo 冗長を有効にする**、**を有効にするマルチ マスター**、**仮想ネットワーク**します。

4. 選択**作成**をプロビジョニングして、データベース アカウントをデプロイします。

5. 展開時間がかかることができます。 そのため、待機、**デプロイメントに成功しました**続行する前に、次のメッセージのようなメッセージ。

<!-- TODO figure out how to center these image -->

![データベース アカウントのデプロイが完了したことを示す通知](../media-draft/db-deploy-success.PNG)

6. お疲れさまでした。 作成し、データベース アカウントをデプロイします。

7. 選択**リソースに移動**portal でデータベース アカウントに移動します。 次に、データベースにコレクションを追加します。

### <a name="add-a-collection"></a>コレクションの追加

Cosmos DB で、*コンテナー*任意のユーザーが生成したエンティティを保持します。 ドキュメント指向の API では、データベース、サポートする SQL API では、コンテナーは、*コレクション*します。 コレクション内では、ドキュメントを格納します。 うまくいけばすべてより明確になりますコレクションを作成し、いくつかのドキュメントを追加します。

データベースとコレクションを作成するのには、Azure portal でのデータ エクスプ ローラー ツールを使用してみましょう。

1. **[データ エクスプローラー]** > **[新しいコレクション]** をクリックします。

2. **コレクションの追加**、新しいコレクションの設定を入力します。

    >[!TIP]
    >**[コレクションの追加]** 領域が右端に表示されます。表示するには、右にスクロールする必要がある場合があります。

    設定|推奨値|説明
    ---|---|---
    データベース ID|[!INCLUDE [cosmos-db-name](./cosmos-db-name.md)]| データベース名は 1 文字以上 255 文字以内にする必要があります。/、\\、#、? は使えず、末尾にスペースを入れることもできません。<br><br>ここでは、希望の入力しますが、お勧めします[!INCLUDE [cosmos-db-name](./cosmos-db-name.md)]と、新しいデータベースの名前としては、何に言及しますこのユニット内。 |
    コレクション ID|[!INCLUDE [cosmos-coll-name](./cosmos-coll-name.md)]|入力[!INCLUDE [cosmos-coll-name](./cosmos-coll-name.md)]として、新しいコレクションの名前。 コレクション Id には、データベース名と同じ文字要件があります。
    ストレージの容量| 固定 (10 GB)|既定値の **[固定 (10 GB)]** を使用します。 この値は、データベースの記憶域容量です。
    Throughput|400 RU|スループットを 400 要求ユニット (RU/秒) に変更します。 スループットを 400 RU/秒に設定するには、記憶域容量を**固定 (10 GB)** に設定する必要があります。 待ち時間を短縮する場合、後でスループットをスケールアップできます。
    
3. **[OK]** をクリックします。 データ エクスプ ローラーでは、新しいデータベースとコレクションが表示されます。 そのためがあるため、データベース。 データベース内でコレクションを定義しました。 次のドキュメントとも呼ばれる一部のデータを追加します。

### <a name="add-test-data"></a>テスト データを追加します。

コレクションと呼ばれる、データベースで定義した[!INCLUDE [cosmos-coll-name](./cosmos-coll-name.md)]、そのためどのようなつもり、コレクションに格納するでしょうか。 そう、考え方は、web ページのブックマークのリストのように、各ドキュメントの URL と ID を格納します。 

データは、データ エクスプ ローラーを使用して、新しいコレクションに追加します。

1. データ エクスプローラーで新しいデータベースが [コレクション] ウィンドウに表示されます。 展開、[!INCLUDE [cosmos-db-name](./cosmos-db-name.md)]データベースを展開し、[!INCLUDE [cosmos-coll-name](./cosmos-coll-name.md)]コレクション、 をクリックして**ドキュメント**、順にクリックします**新しいドキュメント**します。
  
2. ここで、次の構造のドキュメントをコレクションに追加します。 各ドキュメントは、スキーマレスの JSON ファイルです。

     ```json
     {
         "id": "docs",
         "URL": "https://docs.microsoft.com/azure"
     }
     ```

3. JSON を **[ドキュメント]** タブに追加したら、**[保存]** をクリックします。

ドキュメントを保存すると、私たちが追加されたものより多くのプロパティがあることに注意してください。 これらはすべて、下線 (_rid、_self、_etag、_attachments、_ts など) で始まります。 これらは、ドキュメントを管理するためにシステムによって生成されるプロパティです。 次の表は何かについて簡単に説明します。

|プロパティ  |説明  |
|---------|---------|
|_rid     |     リソース ID (_rid) は、階層、リソース モデルのリソース スタックごとになっている一意の識別子です。 配置およびナビゲーションのドキュメント リソースの内部で使用されます。    |
|_self     |   リソースの一意のアドレス指定可能な URI です。      |
|_etag     |   オプティミスティック同時実行制御が必要です。     |
|_attachments     |  添付ファイル リソースのアドレス指定可能なパス。       |
|_ts     |    このリソースの最終更新タイムスタンプです。    |
 
4. さらに、いくつかのドキュメントをコレクションに追加してみましょう。 次のそれぞれについて、使用、**新しいドキュメント**ごとにエントリを作成するには、もう一度コマンド。 忘れずに # Save * *、追加機能をキャプチャする をクリックします。

|id  |value  |
|---------|---------|
|ポータル     |  https://portal.azure.com       |
|について説明します     |   https://docs.microsoft.com/learn |
|Marketplace     |    https://azuremarketplace.microsoft.com/marketplace/apps  |
|ブログ | https://azure.microsoft.com/blog |

確認が完了したら、コレクションのようになります次のスクリーン ショット。

![UI のスクリーン ショット、SQL API をポータルで、ブックマークのコレクションに追加するエントリの一覧が表示されます。](../media-draft/db-bookmark-coll.PNG)

ブックマーク コレクションにいくつかのエントリがあるようになりました。 ここではとおり動作します。 要求を使用すると、たとえば、受信した場合"id = docs"、ブックマーク コレクションでその ID を検索し、URL を返す https://docs.microsoft.com/azureします。 このコレクション内の値である Azure function を作成します。

## <a name="create-our-function"></a>この関数を作成します。

1. 上記の単位で作成した関数アプリに移動します。

2. 関数アプリを展開し、関数のコレクションをポイントし、追加を選択します (**+**) ボタンの横に**関数**します。 このアクションは、関数の作成プロセスを開始します。 次のアニメーションは、この操作を示しています。

![プラス記号が表示される、ユーザーが関数のメニュー項目を置いたときのアニメーション。](../media-draft/func-app-plus-hover-small.gif)

3. ページのサポートされているトリガーの完全なセットが表示されます。 選択**HTTP トリガー**、これは、次のスクリーン ショットの最初のエントリ。

![上で最初に、表示される TTP トリガーでトリガー テンプレートの選択、UI の一部のスクリーン ショットは、イメージの左。](../media-draft/trigger-templates-small.PNG)

4. 記入、**新しい関数**次の値を使用して、右側に表示されるダイアログ ボックス。

|フィールド  |値  |
|---------|---------|
|言語     | **JavaScript**        |
|名前     |   [!INCLUDE [func-name-find](./func-name-find.md)]     |
| 承認レベル | **Function** |

5. 選択**作成**、コード エディターで、index.js ファイルを開き、HTTP によってトリガーされる関数の既定の実装が表示される関数を作成します。

何がここまでの処理、新しい関数を次のようにテストして確認できます。

1. 新しい関数で、右上の **[</> 関数の URL の取得]** をクリックし、**[既定値 (関数キー)]** を選択して、**[コピー]** をクリックします。

2. ブラウザーのアドレス バーにコピーしておいた関数の URL を貼り付けます。 この URL の末尾にクエリ文字列 `&name=<yourname>` を追加し、キーボードで`Enter` キーを押して要求を実行します。 次に、ブラウザーに表示される関数によって返される応答のような応答が表示されます。  

Azure Cosmos DB、またはここでは、データの読み取りに注目してみましょう、ベア ボーン関数が動作したら、[!INCLUDE [cosmos-coll-name](./cosmos-coll-name.md)]コレクション。

## <a name="add-a-cosmos-db-input-binding"></a>Cosmos DB 入力バインドを追加します。

作成したデータベースからデータを読み取り、ように入力バインドを入力します。 後ほど説明するように、いくつかの手順で、データベースと通信できるバインディングを構成できます。

1. 選択**統合**関数 メニューの 統合 タブを開き、左側にします。

使用して、テンプレートの作成、HTTP トリガーと HTTP 出力をバインドします。 新しい Azure Cosmos DB 入力バインディングを追加してみましょう。 

2. 選択 **+ 新しい入力**下、**入力**列。 すべての可能な入力バインドの種類の一覧が表示されます。

3. をクリックして**Azure Cosmos DB**一覧からをクリックし、**選択**ボタンをクリックします。 この操作は、Azure Cosmos DB の入力の構成 ページを開きます。

次に、データベースに接続を設定します。

4. という名前のフィールドで**Azure Cosmos DB アカウント接続**このページで、クリックして*新しい*空のフィールドの右側にします。 このアクションが表示されます、**接続**ダイアログ ボックスで、既に**Azure Cosmos DB アカウント**と Azure サブスクリプションを選択します。 唯一の残りの作業では、データベース アカウントの id を選択します。

5. セクションで、**データベース アカウントの作成**ID 値を指定する必要がありました。 その値を検索、*データベース アカウント*ドロップダウン順にクリックします**選択**します。

データベースへの新しい接続が構成されているしに示した、 **Azure Cosmos DB アカウント接続**フィールド。 実際にこの抽象名前の背後にあるについて調べる場合は、クリックして*値を表示する*を接続文字列を表示します。

では、バインディングにお客様の ID を関連付ける特定の ID を持つブックマークを検索します。

7. **ドキュメント ID (省略可能)** フィールドに、入力`{id}`します。 これと呼ばれますが、*バインド式*します。 関数は、クエリ文字列を使用して検索のための ID を指定する HTTP 要求によってトリガーされます。 Id は、コレクション内で一意であるため、バインドで (見つかりません) 0 または 1 (見つかった) ドキュメントのいずれかを返します。

8. 慎重に次の表に、値を使用してこのページの残りのフィールドに記入します。 いつでもには、各フィールドの目的に関する詳細は各フィールド名の右側に情報アイコンをクリックすることができます。

|設定  |値  |説明  |
|---------|---------|---------|
|ドキュメント パラメーター名     |  **ブックマーク**       |  コードでは、このバインディングを識別するために使用する名前。      |
|データベース名     |  [!INCLUDE [cosmos-db-name](./cosmos-db-name.md)]       | データが読み取られるデータベースです。 これは、データベース名がこのレッスンの前半で設定します。        |
|コレクション名     |  [!INCLUDE [cosmos-db-name](./cosmos-coll-name.md)]        | データを読み取り元のコレクション。 この設定は、前のレッスンで定義されました。 |
|(省略可能) SQL クエリ    |   空白のままに       |   1 つのドキュメント ID に基づいて一度に取得のみ そのため、ドキュメント ID フィールドでフィルター処理をより詳しくは、このインスタンスで SQL クエリを使用するよりもします。 1 つのエントリを返す SQL クエリを作成する可能性があります (`SELECT * from b where b.ID = {id}`)。 クエリを実行すると、ドキュメントを実際に返すが、ドキュメント コレクションが返されます。 コードは、不必要にコレクションを操作する必要があります。 複数のドキュメントを取得する場合は、SQL クエリの手法を使用します。   |
|パーティション キー (省略可能)     |   空白のままに      |  ここで、既定値に使用を許可します。       |

9. クリックして**保存**をこのバインド構成をすべての変更を保存します。 バインディングを定義したら、関数で使用する時間を勧めします。

## <a name="update-function-implementation"></a>Update 関数の実装

1. この関数では、をクリックして[!INCLUDE [func-name-find](./func-name-find.md)]を開くには、 *index.js*コード エディターでします。 データベースから読み取り、このバインディングを使用するためのロジックを更新しましょうへの入力バインディングが追加されました。

2. Index.js 内のすべてのコードを次のスニペットをコードに置き換えます。

[!code-javascript[](../code/find-bookmark-single.js)]

HTTP 要求により、関数をトリガーするときに、`id`クエリ パラメーターは、Cosmos DB 入力バインドに渡されます。 この ID に一致するドキュメントが見つかった場合、`bookmark`パラメーターに設定されます。 その場合は、ブックマーク、ドキュメントの URL 値を含む応答を構築します。 このキーに一致するドキュメントが見つかりませんでした場合、ペイロードと悪い知らせをユーザーに通知の状態コードに対応します。

## <a name="try-it-out"></a>試してみる

1. 通常どおり、 をクリックして **<>/Get 関数の URL**右側の上部にある次のように選択します。**既定 (関数キー)**、 をクリックし、**コピー** copy、関数の URL。

2. ブラウザーのアドレス バーにコピーしておいた関数の URL を貼り付けます。 この URL の末尾にクエリ文字列 `&id=docs` を追加し、キーボードで`Enter` キーを押して要求を実行します。 すべて順調だと、そのリソースへの URL を含む応答が表示されます。

3. 置換`&id=docs`で`&id=missing`し、応答を確認します。

4. 前のクエリ文字列を置き換える`&id=`し、応答を確認します。

>[!TIP]
>使用して関数をテストすることも、**テスト**関数ポータル UI のタブ。 クエリ パラメーターを追加したり、te までのステップ」の説明に従って、同じ結果を取得する要求本文を指定するだけです。

このユニットでは、Azure Cosmos DB データベースからの読み取りに手動で、最初の入力バインドを作成しました。 データベースを検索し、データの読み取り作成したコードの量が最小限に抑え、バインドに感謝します。 ほとんどのバインディングを構成する作業を行った宣言によって、残りを処理したプラットフォームとします。  

次の単位で、Azure Cosmos DB で、ブックマークのコレクションにより多くのデータの出力バインドを追加します。

> [!TIP]
> このユニットは、Azure Cosmos DB のチュートリアルではありません。 詳しく調べる場合は、次に開始するためのいくつかのリソースを示します。
>
>* [Azure Cosmos DB の概要: SQL API](https://docs.microsoft.com/azure/cosmos-db/sql-api-introduction)
>
>* [Azure Cosmos DB の技術概要](https://azure.microsoft.com/blog/a-technical-overview-of-azure-cosmos-db/)
>
>* [Azure Cosmos DB のドキュメント](https://docs.microsoft.com/azure/cosmos-db/)